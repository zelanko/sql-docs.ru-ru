---
title: Определение возможных причин сбоев подключения между репликами доступности
description: В этой статье описываются возможные причины сбоев подключения между репликами, входящими в группу доступности Always On.
ms.custom: seodec18
ms.date: 05/17/2016
ms.prod: sql
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- troubleshooting [SQL Server], HADR
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], troubleshooting
ms.assetid: cd613898-82d9-482f-a255-0230a6c7d6fe
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8fe226c5d419d7214fe20968525ec64ce44bbee6
ms.sourcegitcommit: f76b4e96c03ce78d94520e898faa9170463fdf4f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70874529"
---
# <a name="determine-possible-reason-for-connectivity-failures-between-availability-replicas"></a>Определение возможных причин сбоев подключения между репликами доступности
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
Физические неисправности, неполадки операционной системы или проблемы с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] могут привести к сбою сеанса между двумя репликами доступности. Реплика доступности не выполняет регулярных проверок компонентов, которые использует процесс Sqlservr.exe, и не контролирует правильность их работы. Однако при сбоях некоторых типов затронутый компонент сообщает приложению Sqlservr.exe об ошибке. Ошибка, о которой сообщил другой компонент, называется *постоянной ошибкой*. Чтобы обнаружить другие сбои, которые в противном случае могли бы быть не замечены, в [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] реализован собственный механизм времени ожидания сеанса. Указывает интервал времени ожидания сеанса в секундах. Данный интервал времени ожидания — это максимальное время, в течение которого экземпляр сервера ожидает получение сообщения PING от другого экземпляра перед тем, как сделать вывод о том, что другой экземпляр отключен. По истечении времени ожидания сеанса между двумя репликами доступности эти реплики доступности предполагают наличие сбоя и объявляют о *программной ошибке*.  
  
> [!IMPORTANT]  
>  Сбои в базах данных, отличных от баз данных-источников, не обнаруживаются. Более того, весьма проблематично будет обнаружить сбой диска данных, если только вследствие такого сбоя база данных не перезапускается.  
  
 Время обнаружения и, следовательно, время реакции на сбой зависят от того, какой это сбой, аппаратный или программный. Отчеты о некоторых постоянных ошибках, таких как сбои в сети, отправляются немедленно. Однако в некоторых случаях зависящие от компонента периоды ожидания могут отложить отправку отчета о некоторых постоянных ошибках. В случае программных ошибок продолжительность времени ожидания сеанса определяет скорость обнаружения ошибки. По умолчанию, это период равен 10 секундам. Это минимальное рекомендуемое значение.  
  
## <a name="failures-due-to-hard-errors"></a>Сбои из-за постоянных ошибок  
 Постоянные ошибки могут быть вызваны следующими причинами (но не ограничиваются ими):  
  
-   физический разрыв соединения или кабеля;  
  
-   неисправная сетевая плата;  
  
-   изменение настроек маршрутизатора;  
  
-   изменения в конфигурации брандмауэра;  
  
-   изменения в конфигурации конечной точки;  
  
-   выход из строя накопителя, на котором находятся журналы транзакций;  
  
-   сбой операционной системы или процесса.  
  
 Например, если устройство, на котором ведется журнал базы данных-источника, не отвечает и отказывает, операционная система сообщает процессу Sqlservr.exe о возникновении серьезной ошибки.  
  
 Некоторые компоненты, например сетевые компоненты и ряд подсистем ввода-вывода, имеют собственные интервалы ожидания, предназначенные для выявления отказов. Такие интервалы ожидания не зависят от [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], у которого совершенно нет сведений ни о них, ни об их поведении. В подобных случаях интервал ожидания увеличивает время между возникновением сбоя и получением репликой доступности сообщения об аппаратном сбое.  
  
> [!NOTE]  
>  Единственным случаем, когда для реплик доступности выполняется активная проверка на ошибки, являются случаи программных ошибок. Дополнительные сведения см. в подразделе «Сбои из-за кратковременных ошибок» далее в этом разделе.  
  
 Чтобы помочь интерпретировать условия возникновения ошибок в сети, спросите у инженера сети, какие сообщения об ошибках отправляются на порт перед возникновением следующих событий в соединении TCP.  
  
-   DNS не работает.  
  
-   Выдернуты кабели.  
  
-   [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows, блокирующий указанный порт.  
  
-   Ошибка приложения, наблюдающего за портом.  
  
-   Переименован сервер Windows.  
  
-   Перезагружен сервер Windows.  
  
> [!NOTE]  
>  [!INCLUDE[ssHADRc](../../../includes/sshadrc-md.md)] не защищает от проблем, связанных с доступом клиентов к серверу. Например, рассмотрите ситуацию, в которой публичный сетевой адаптер обрабатывает подключения клиентов к первичной реплике, в то время как частный сетевой интерфейс обрабатывает весь трафик экземпляров сервера, на которых размещены реплики группы доступности. В этом случае сбой публичного сетевого адаптера приведет к тому, что клиенты не смогут получать доступ к базе данных.  
  
## <a name="failures-due-to-soft-errors"></a>Сбои из-за кратковременных ошибок  
 Условия, приводящие к превышению времени ожидания сеансов, могут быть вызваны следующими причинами (но не ограничиваться ими).  
  
-   Сетевые ошибки (истечение времени ожидания канала связи TCP, пропущенные или искаженные пакеты, поступление пакетов в неверном порядке).  
  
-   Операционная система, сервер или база данных не отвечает на запросы.  
  
-   Время ожидания сервера Windows.  
  
-   Нехватка вычислительных ресурсов (например, из-за перегрузки ЦП или диска, переполнения журнала транзакций, переполнения памяти или превышения числа потоков). В таких случаях необходимо увеличить время ожидания, снизить рабочую нагрузку или сменить оборудование, чтобы оно соответствовало задачам, выполняемым системой.  
  
### <a name="the-session-timeout-mechanism"></a>Механизм превышения времени ожидания  
 Так как экземпляр сервера не в состоянии непосредственно обнаружить программные ошибки, они потенциально могут заставить реплику доступности бесконечно ожидать ответа от другой реплики доступности в рамках сеанса. Для предотвращения такого поведения в [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] используется механизм времени ожидания сеанса, основанный на том, что через определенный интервал подключенные реплики доступности отправляют команду PING по всем открытым соединениям. Получение сообщения PING до истечения интервала ожидания указывает на то, что соединение все еще открыто, и что экземпляры сервера поддерживают связь по нему. При получении сообщения PING реплика сбрасывает таймер ожидания для этого соединения. Сведения о взаимосвязи режима доступности и времени ожидания сеанса см. в разделе [Режимы доступности (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md).  
  
 Первичная и вторичная реплики отправляют друг другу сообщения проверки связи, чтобы подтвердить свою активность, а ограничение времени ожидания сеанса исключает неограниченное ожидание одной репликой ответа от другой. Предельное время ожидания сеанса — это настраиваемое пользователем свойство реплики со значением по умолчанию в 10 секунд. Получение сообщения PING до истечения интервала ожидания указывает на то, что соединение все еще открыто, и что экземпляры сервера поддерживают связь по нему. После получения сообщения проверки связи реплика доступности сбрасывает счетчик времени ожидания для данного соединения.  
  
 Если в течение периода ожидания от другой реплики не приходит сообщение проверки связи, то соединение завершается. Соединение закрывается, и реплика переходит в состояние DISCONNECTED. Даже если для отключенной реплики настроен режим синхронной фиксации, транзакции не будут ожидать ее повторного подключения и повторной синхронизации.  
  
## <a name="responding-to-an-error"></a>Реакция на ошибку  
 Независимо от типа ошибки, экземпляр сервера, который обнаружил ее, реагирует в соответствии с ролью экземпляра, режимом доступности сеанса и состоянием других подключений этого сеанса. Сведения о том, что происходит при потере участника, см. в статье [Режимы доступности (группы доступности AlwaysOn)](../../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md).  
  
## <a name="related-tasks"></a>Связанные задачи  
 **Изменение значения времени ожидания (только в режиме синхронной фиксации)**  
  
-   [Изменение периода ожидания сеанса для реплики доступности (SQL Server)](../../../database-engine/availability-groups/windows/change-the-session-timeout-period-for-an-availability-replica-sql-server.md)  
  
 **Просмотр текущего значения времени ожидания**  
  
-   Запрос **session_timeout** в [sys.availability_replicas (Transact-SQL)](../../../relational-databases/system-catalog-views/sys-availability-replicas-transact-sql.md).  
  
## <a name="see-also"></a>См. также:  
 [Обзор групп доступности AlwaysOn (SQL Server)](../../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)  
  
  
