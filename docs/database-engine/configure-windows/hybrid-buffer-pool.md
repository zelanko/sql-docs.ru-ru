---
title: Гибридный буферный пул | Документация Майкрософт
ms.custom: ''
ms.date: 10/31/2019
ms.prod: sql
ms.prod_service: high-availability
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
ms.assetid: ''
author: briancarrig
ms.author: brcarrig
manager: amitban
ms.openlocfilehash: e2aafb77145fbe22a980ef158cfa7c78db6288d2
ms.sourcegitcommit: 58158eda0aa0d7f87f9d958ae349a14c0ba8a209
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80216263"
---
# <a name="hybrid-buffer-pool"></a>Гибридный буферный пул
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Гибридный буферный пул позволяет объектам буферного пула ссылаться на страницы данных в файлах базы данных, находящихся на устройствах энергонезависимой памяти (PMEM), а не в копиях страниц данных, кэшированных в непостоянной DRAM. Эта функция появилась в [!INCLUDE[sqlv15](../../includes/sssqlv15-md.md)].

![Гибридный буферный пул](./media/hybrid-buffer-pool.png)

Устройства энергонезависимой памяти (PMEM) поддерживают байтовую адресацию. Если используется файловая система с режимом прямого доступа (DAX), поддерживающая энергонезависимую память (например, XFS, EXT4 или NTFS), доступ к файлам в файловой системе осуществляется с помощью обычных API файловой системы в ОС. Кроме того, он позволяет выполнять так называемые операции загрузки и сохранения в размещенных в памяти файлах на устройстве. Это позволяет приложениям с поддержкой PMEM, таким как SQL Server, получать доступ к файлам на устройстве в обход традиционного стека хранилища.

Гибридный буферный пул использует эту возможность для операций загрузки и сохранения с размещенными в памяти файлами, чтобы использовать устройство PMEM как кэш для буферного пула, а также для хранения файлов базы данных. Это создает уникальную ситуацию, когда логическая операция чтения и физическое чтение фактически являются одной операцией. Устройства энергонезависимой памяти доступны через шину памяти так же, как и обычная непостоянная память DRAM.

Только чистые страницы данных кэшируются на устройстве для гибридного буферного пула. Когда страница помечается как "грязная", она копируется в буферный пул DRAM, а затем записывается обратно на устройство PMEM и снова помечается как "чистая". Это происходит во время обычных операций с контрольной точкой аналогично тому, что делается для блочного устройства.

Функция гибридного буферного пула доступна в Windows и Linux. PMEM-устройства должны быть отформатированы с использованием файловой системы, поддерживающей DAX (DirectAccess). DAX поддерживают файловые системы XFS, EXT4 и NTFS. SQL Server автоматически определит, что файлы данных находятся на соответствующим образом отформатированном PMEM-устройстве, и выполнит сопоставление памяти в файлах базы данных во время запуска при подключении, восстановлении либо создании базы данных.

Дополнительные сведения см. в разделе:

* [Изучение и развертывание энергонезависимой памяти (Windows)](/windows-server/storage/storage-spaces/deploy-pmem/)
* [Настройка энергонезависимой памяти (PMEM) для SQL Server на Linux](../../linux/sql-server-linux-configure-pmem.md)


## <a name="enable-hybrid-buffer-pool"></a>Включение гибридного буферного пула

[!INCLUDE[sqlv15](../../includes/sssqlv15-md.md)] представляет язык DDL для управления гибридным буферным пулом.

В следующем примере гибридный буферный пул включается для экземпляра SQL Server:

```sql
ALTER SERVER CONFIGURATION SET MEMORY_OPTIMIZED HYBRID_BUFFER_POOL = ON;
```

По умолчанию гибридный буферный пул отключен на уровне экземпляра. Обратите внимание на то, чтобы изменения параметра вступили в силу, необходимо перезапустить экземпляр SQL Server. Перезапуск необходим для упрощения выделения достаточного числа хэш-страниц, чтобы учесть общую емкость PMEM на сервере.

В следующем примере гибридный буферный пул включается для конкретной базы данных.

```sql
ALTER DATABASE <databaseName> SET MEMORY_OPTIMIZED = ON;
```

По умолчанию гибридный буферный пул включен на уровне базы данных.

## <a name="disable-hybrid-buffer-pool"></a>Отключение гибридного буферного пула

Следующий пример отключает гибридный буферный пул на уровне экземпляра:

```sql
ALTER SERVER CONFIGURATION SET MEMORY_OPTIMIZED HYBRID_BUFFER_POOL = OFF;
```

По умолчанию гибридный буферный пул отключен на уровне экземпляра. Чтобы изменения параметра вступили в силу, необходимо перезапустить экземпляр SQL Server. Это гарантирует, что для буферного пула будет выделено достаточное количество страниц хэша, так как теперь необходимо учитывать емкость PMEM на сервере.

В следующем примере гибридный буферный пул отключается для конкретной базы данных.

```sql
ALTER DATABASE <databaseName> SET MEMORY_OPTIMIZED = OFF;
```

По умолчанию гибридный буферный пул включен на уровне базы данных.

## <a name="view-hybrid-buffer-pool-configuration"></a>Просмотр конфигурации гибридного буферного пула

Следующий пример возвращает текущее состояние конфигурации гибридного буферного пула для экземпляра.

```sql
SELECT * FROM
sys.server_memory_optimized_hybrid_buffer_pool_configuration;
```

В примере ниже перечислены базы данных и параметр уровня базы данных для гибридного буферного пула (`is_memory_optimized_enabled`).

```sql
SELECT name, is_memory_optimized_enabled FROM sys.databases;
```

## <a name="best-practices-for-hybrid-buffer-pool"></a>Рекомендации по использованию гибридного буферного пула

При форматировании PMEM-устройства в Windows используйте максимальный размер единицы размещения, доступный для файловой системы NTFS (2 МБ в Windows Server 2019), и отформатируйте устройство для DAX (Direct Access).

Используйте [заблокированные страницы в памяти](./enable-the-lock-pages-in-memory-option-windows.md) в Windows.

Размеры файлов должны быть кратны 2 МБ (деление по модулю на 2 МБ должно давать ноль).

Если параметр области сервера для гибридного буферного пула отключен, эта функция не будет использоваться какой-либо пользовательской базой данных.

Если параметр гибридного буферного пула на уровне сервера включен, можно использовать параметр области базы данных, чтобы отключить эту функцию для отдельных пользовательских баз данных.
