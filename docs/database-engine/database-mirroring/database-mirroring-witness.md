---
title: Следящий сервер зеркального отображения базы данных | Документы Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: high-availability
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 4dcb3d5669e62836f859252749469703bf26d29e
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68043885"
---
# <a name="database-mirroring-witness"></a>Database Mirroring Witness
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Для поддержки автоматической отработки отказа сеанс зеркального отображения базы данных должен быть настроен на использование режима высокой безопасности, а также должен присутствовать третий экземпляр, называемый *следящим сервером*. Следящий сервер это дополнительный экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , позволяющий зеркальному серверу в сеансе режима высокой безопасности определить, следует ли начать процедуру автоматической отработки отказа. В отличие от двух участников зеркального отображения, следящий сервер не обслуживает базу данных. Его единственная функция заключается в поддержке автоматического перехода на другой ресурс.  
  
> [!NOTE]  
>  В режиме высокой производительности следящий сервер может неблагоприятно повлиять на доступность ресурсов. Если для сеанса зеркального отображения базы данных настроен следящий сервер, то основной сервер должен быть подключен по крайней мере к одному из двух других экземпляров сервера — зеркальному или следящему серверу. В противном случае база данных становится недоступной, а принудительное восстановление службы невозможным, при этом могут быть потеряны данные. Таким образом, в режиме высокой производительности настоятельно рекомендуется всегда поддерживать параметр WITNESS в значении OFF. Дополнительные сведения о том, каким образом следящий сервер влияет на режим высокой производительности, см. в разделе [Режимы работы зеркального отображения базы данных](../../database-engine/database-mirroring/database-mirroring-operating-modes.md).  
  
 Следующий рисунок иллюстрирует сеанс в режиме высокого уровня безопасности с участием следящего сервера.  
  
 ![Сеанс зеркального отображения со следящим сервером](../../database-engine/database-mirroring/media/dbm-3-way-session-intro.gif "Сеанс зеркального отображения со следящим сервером")  
  
 **В этом разделе:**  
  
-   [Использование следящего сервера в нескольких сеансах](#InMultipleSessions)  
  
-   [Рекомендации к выбору оборудования и программного обеспечения](#SwHwRecommendations)  
  
-   [Роль следящего сервера в автоматический переход на другой ресурс](#InAutoFo)  
  
-   [Добавление или удаление следящего сервера](#AddRemoveWitness)  
  
##  <a name="InMultipleSessions"></a> Использование следящего сервера в нескольких сеансах  
 Заданный экземпляр сервера может выступать в роли следящего сервера в нескольких параллельных сеансах зеркального отображения базы данных для разных баз данных. В этих сеансах могут присутствовать различные участники. На следующем рисунке показан экземпляр сервера, который является следящим в двух сеансах зеркального отображения базы данных с различными участниками.  
  
 ![Экземпляр следящего сервера для двух баз данных](../../database-engine/database-mirroring/media/dbm-witness-in-2-sessions.gif "Экземпляр следящего сервера для двух баз данных")  
  
 Кроме того, один и тот же экземпляр сервера может одновременно выступать в качестве следящего сервера в одних сеансах и в качестве участника зеркального отображения в других. Однако на практике экземпляр сервера обычно выступает либо в качестве следящего сервера, либо в качестве участника зеркального отображения, так как для обслуживания производственной базы данных участники требуют мощных и сложных систем с серьезными требованиями к оборудованию, в то время как следящий сервер может работать на любой доступной системе Windows, обеспечивающей работу [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
##  <a name="SwHwRecommendations"></a> Рекомендации к выбору оборудования и программного обеспечения  
 Рекомендуется располагать следящий сервер на отдельном компьютере, который не используется участниками зеркального отображения. Участники зеркального отображения баз данных поддерживаются только выпусками [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise. Однако следящие серверы поддерживаются также в выпусках [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express. Кроме как во время обновления предыдущей версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], на всех экземплярах серверов в сеансе зеркального отображения должна работать одна и та же версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Например, в [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] следящий сервер при обновлении от конфигурации зеркального отображения [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] поддерживается, но не может быть добавлен в существующую или новую конфигурацию зеркального отображения [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] или более поздних версий.  
  
 Следящий сервер может работать на любой надежной компьютерной системе, поддерживающей любой из этих выпусков [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Однако рекомендуется, чтобы каждый экземпляр следящего сервера соответствовал минимальным требованиям к конфигурации, необходимым для используемой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard. Дополнительные сведения об этих требованиях см. в разделе [Требования к оборудованию и программному обеспечению для установки SQL Server 2016](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).  
  
##  <a name="InAutoFo"></a> Роль следящего сервера в автоматический переход на другой ресурс  
 На всем протяжении сеанса зеркального отображения базы данных все экземпляры сервера отслеживают свое состояние соединения. Если произошло отсоединение участников друг от друга, то они, чтобы гарантировать, что в данный момент только один из них обслуживает базу данных, полагаются на следящий сервер. Если синхронизированный зеркальный сервер теряет соединение с основным сервером, но остается соединенным со следящим сервером, зеркальный сервер обращается к следящему серверу, чтобы определить, потерял ли следящий сервер соединение с основным сервером.  
  
-   Если основной сервер до сих пор подключен к следящему серверу, то автоматическая отработка отказа не производится. Вместо этого основной сервер продолжает обслуживать базу данных, накапливая записи журнала для отправки на зеркальный сервер при повторном соединении участников.  
  
-   Если следящий сервер также отключен от основного сервера, то зеркальный сервер считает, что основная база данных стала недоступна. В этом случае зеркальный сервер инициирует немедленную автоматическую отработку отказа.  
  
-   Если зеркальный сервер отключен от следящего и основного серверов, то автоматическая отработка отказа невозможна вне зависимости от состояния основного сервера.  
  
 Требование, которое заключается в том, чтобы по крайней мере два экземпляра сервера оставались подключенными, называется *кворумом*. Кворум гарантирует, что в каждый момент времени база данных может обслуживаться только одним участником. Дополнительные сведения о кворуме и влиянии, которое он оказывает на сеанс, см. в разделе [Кворум. Как следящий сервер влияет на доступность базы данных &#40;зеркальное отображение базы данных&#41;](../../database-engine/database-mirroring/quorum-how-a-witness-affects-database-availability-database-mirroring.md).  
  
##  <a name="AddRemoveWitness"></a> Добавление или удаление следящего сервера  
 **Добавление следящего сервера**  
  
-   [Добавление или замена следящего сервера зеркального отображения базы данных (среда SQL Server Management Studio)](../../database-engine/database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [Добавление следящего сервера для зеркального отображения базы данных с использованием проверки подлинности Windows (Transact-SQL)](../../database-engine/database-mirroring/add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 **Удаление следящего сервера**  
  
-   [Удаление следящего сервера из сеанса зеркального отображения базы данных (SQL Server)](../../database-engine/database-mirroring/remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a>См. также:  
 [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](../../database-engine/database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md)   
 [Режимы работы зеркального отображения базы данных](../../database-engine/database-mirroring/database-mirroring-operating-modes.md)   
 [Кворум. Как следящий сервер влияет на доступность базы данных (зеркальное отображение базы данных)](../../database-engine/database-mirroring/quorum-how-a-witness-affects-database-availability-database-mirroring.md)   
 [Возможные неполадки при зеркальном отображении базы данных](../../database-engine/database-mirroring/possible-failures-during-database-mirroring.md)   
 [Состояния зеркального отображения (SQL Server)](../../database-engine/database-mirroring/mirroring-states-sql-server.md)  
  
  
