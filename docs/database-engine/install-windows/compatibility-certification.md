---
title: Сертификация на совместимость | Документация Майкрософт
description: Сертификация на совместимость позволяет избежать рисков, связанных с несовместимостью приложений, чтобы обновить базу данных SQL Server локально и в облаке.
ms.custom: ''
ms.date: 08/26/2019
ms.prod: sql
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- compatibility [SQL Server], databases
- compatibility levels [SQL Server], after upgrade
- Database Engine [SQL Server], upgrading
- Databases [SQL Server], upgrading
- Database Engine [SQL Server], upgrading
- compatibility [SQL Server], certification
- compatibility level [SQL Server], upgrades
ms.assetid: 3c036813-36cf-4415-a0c9-248d0a433856
author: pmasl
ms.author: pelopes
monikerRange: '>=sql-server-2016||=sqlallproducts-allversions'
ms.openlocfilehash: 2b993647898865d0b67c25c1ab6040b9b7eedaf1
ms.sourcegitcommit: dc965772bd4dbf8dd8372a846c67028e277ce57e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83606476"
---
# <a name="compatibility-certification"></a>Сертификация на совместимость

[!INCLUDE[tsql-appliesto-ss2008-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-asdb-xxxx-xxx-md.md)]

Сертификация на совместимость позволяет компаниям обновлять и модернизировать базу данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в локальной среде, облаке и пограничной зоне, устраняя риски, связанные с совместимостью приложений. 

Одно и то же [!INCLUDE[ssde_md](../../includes/ssde_md.md)] лежит в основе как [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], так и [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)] (включая Управляемый экземпляр). Это общее [!INCLUDE[ssde_md](../../includes/ssde_md.md)] означает, что пользовательскую базу данных можно легко перемещать между локальным сервером [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)]. При этом код приложения, выполняемый в базе данных как [!INCLUDE[tsql](../../includes/tsql-md.md)], продолжит работать так же, как в исходной системе.

Для каждого нового выпуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] уровень совместимости по умолчанию устанавливается в зависимости от версии [!INCLUDE[ssDE](../../includes/ssde-md.md)]. Однако уровень совместимости предыдущих версий сохраняется, чтобы совместимость существующих приложений не терялась. Таблицу совместимости можно просмотреть [здесь](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#supported-dbcompats).
Поэтому если приложение было сертифицировано для работы с определенной версией [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], значит, оно сертифицировано для работы на уровне совместимости по умолчанию этой версии.

Например, в [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] по умолчанию использовался уровень совместимости базы данных 130. Так как уровни совместимости определяют функциональное поведение и способ оптимизации запросов [!INCLUDE[tsql](../../includes/tsql-md.md)], база данных, сертифицированная для работы в [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)], неявно сертифицирована на уровне совместимости базы данных 130. Эта база данных может работать "как есть" в более поздней версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (например, [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]) и в [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)] при условии, что сохраняется уровень совместимости базы данных 130. 

Это фундаментальный принцип модели непрерывной интеграции [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)]. [!INCLUDE[ssde_md](../../includes/ssde_md.md)] постоянно улучшается и обновляется в Azure, но так как для существующих баз данных сохраняется текущий уровень совместимости, они продолжают работать, как было задумано, даже после обновления базового [!INCLUDE[ssde_md](../../includes/ssde_md.md)]. 

## <a name="managing-upgrade-risk-with-compatibility-certification"></a>Управление рисками при обновлении с помощью сертификации на совместимость
Сертификация на совместимость — эффективный подход к модернизации базы данных. Выполняя сертификацию на уровне совместимости, разработчики устанавливают технические требования для поддержки приложения в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)], но отделяют жизненный цикл приложения от жизненного цикла платформы баз данных. Это позволяет компаниям обновлять [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] в соответствии с политиками жизненного цикла, а также использовать улучшения в плане масштабируемости и производительности, не зависящие от кода, а подключающимся приложениям — **сохранять свое функциональное состояние** посредством обновлений.

Возможность негативного влияния на функциональность и производительность — основной фактор риска при любом обновлении. Сертификация на совместимость позволяет уверенно управлять такими рисками.

-  В плане поведения [!INCLUDE[tsql](../../includes/tsql-md.md)] любое изменение означает, что приложение необходимо снова сертифицировать, чтобы подтвердить правильность его работы. Однако [уровень совместимости базы данных](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md) обеспечивает обратную совместимость с более ранними версиями [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] только для указанной базы данных, а не всего сервера. Сохранение уровня совместимости базы данных гарантирует, что существующие запросы приложения будут работать одинаково до и после обновления [!INCLUDE[ssde_md](../../includes/ssde_md.md)]. Дополнительные сведения о поведении [!INCLUDE[tsql](../../includes/tsql-md.md)] и уровнях совместимости см. в разделе [Использование уровня совместимости для обеспечения обратной совместимости](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#backwardCompat).

-  Если говорить о производительности, то, поскольку с каждой новой версией в оптимизатор запросов вводятся усовершенствования, в разных версиях [!INCLUDE[ssde_md](../../includes/ssde_md.md)] можно было бы ожидать различий в планах запросов. Различия в планах запросов при обновлении обычно приводят к возникновению риска, если некоторые изменения могут негативно сказаться на определенном запросе или рабочей нагрузке. В свою очередь, этот риск является побуждающей причиной для повторной сертификации, из-за которой могут откладываться обновления и возникать проблемы с жизненным циклом и поддержкой. 
   Именно в целях устранения рисков, возникающих при обновлении, улучшения оптимизатора запросов ограничиваются уровнем совместимости по умолчанию нового выпуска (другими словами, самым высоким уровнем совместимости, доступным для новой версии). Сертификация на совместимость включает в себя **защиту формы плана запроса**: сохранение уровня совместимости базы данных сразу после обновления [!INCLUDE[ssde_md](../../includes/ssde_md.md)] означает, что модель оптимизации запросов в новой версии остается такой же, как и до обновления, и форма плана запроса не должна изменяться. 
   Дополнительные сведения см. в разделе [Для чего нужна форма плана запроса?](#queryplan_shape).
   
Дополнительные сведения об уровнях совместимости см. в разделе [Использование уровня совместимости для обеспечения обратной совместимости](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#backwardCompat).
   
Если приложению не нужно использовать улучшения, доступные только на более высоком уровне совместимости базы данных, допускается обновлять [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] с сохранением прежнего уровня совместимости без необходимости повторно сертифицировать приложение. Дополнительные сведения см. в разделе [Уровни совместимости и обновления ядра СУБД](#compatibility-levels-and-database-engine-upgrades) далее в этой статье.

Если вы разрабатываете новое приложение или существующему приложению требуется использовать новые возможности, такие как [интеллектуальная обработка запросов](../../relational-databases/performance/intelligent-query-processing.md), или какие-либо новые инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)], спланируйте повышение уровня совместимости до последнего доступного в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и подтвердите возможность работы приложения на этом уровне. Дополнительные сведения о повышении уровня совместимости базы данных см. в разделе [Рекомендации по обновлению уровня совместимости базы данных](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#best-practices-for-upgrading-database-compatibility-level).
   
### <a name="why-query-plan-shape"></a><a name="queryplan_shape"></a> Для чего нужна форма плана запроса?      
Форма плана запроса относится к визуальному представлению различных операторов, составляющих план запроса. Сюда входят такие операторы, как поиск, сканирование, соединение и сортировка, а также связи между ними, указывающие поток данных и порядок операций, которые должны быть выполнены для получения необходимого результирующего набора. Форма плана запроса определяется оптимизатором запросов.

Чтобы сохранить предсказуемую производительность запросов во время обновления, необходимо использовать одну и ту же форму плана запроса. Это можно сделать, не изменяя уровень совместимости базы данных сразу после обновления несмотря на разные версии базового экземпляра [!INCLUDE[ssde_md](../../includes/ssde_md.md)]. Если в экосистеме выполнения запросов больше ничего не изменилось (например, доступные ресурсы или механизм распространения данных в базовых данных не претерпели значительных изменений), производительность запроса должна остаться прежней. 

Однако сохранение формы плана запроса — это не единственный момент, который может повлиять на производительность после обновления. При перемещении базы данных в более новый экземпляр [!INCLUDE[ssde_md](../../includes/ssde_md.md)] и внесении изменений в среду могут появиться факторы, которые немедленно затронут производительность запроса, даже если у плана запроса будет одна форма в разных версиях. Эти изменения могут включать в себя новый [!INCLUDE[ssde_md](../../includes/ssde_md.md)] с большим или меньшим объемом доступных ресурсов памяти и ЦП, изменения параметров конфигурации сервера или базы данных, а также изменения механизма распространения данных, влияющие на создание плана запроса. Поэтому важно понимать, что поддержка уровня совместимости базы данных обеспечивает защиту от изменений в **форме** плана запроса, но не защищает от других факторов среды (некоторые из них являются инициированными пользователем изменениями), влияющих на производительность запросов.

Дополнительные сведения см. в статье [Руководство по архитектуре обработки запросов](../../relational-databases/query-processing-architecture-guide.md#optimizing-select-statements).
   
## <a name="compatibility-certification-benefits"></a>Преимущества сертификации на совместимость
У сертификации базы данных как подхода, основанного на совместимости, а не на конкретных версиях, есть ряд прямых преимуществ.

-  **Отделение сертификации приложения от платформы**. Так как [!INCLUDE[ssde_md](../../includes/ssde_md.md)] является общим, приложениям, которым необходимо просто выполнять запросы [!INCLUDE[tsql](../../includes/tsql-md.md)], не требуются отдельные процессы сертификации для Azure и локальной среды.
-  **Снижение рисков при обновлении** вследствие того, что во время модернизации платформы баз данных циклы обновления на уровне приложений и на уровне платформы баз данных можно разделить, чтобы сократить перерывы в работе и улучшить управление изменениями.
-  **Обновление без изменения кода**. Если при обновлении до новой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)] сохранить уровень совместимости исходной системы, то изменения кода не потребуются. Кроме того, не нужно будет выполнять повторную сертификацию до тех пор, пока приложению не потребуется использовать усовершенствования, доступные только на более высоком уровне совместимости базы данных.
- **Улучшение управляемости и масштабируемости** без внесения изменений в приложения за счет использования усовершенствований, не ограниченных определенным уровнем совместимости базы данных. В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] к ним относятся, например: 
  - дополнительные улучшения возможностей мониторинга и устранения неполадок с помощью новых [системных динамических административных представлений](../../relational-databases/system-dynamic-management-views/system-dynamic-management-views.md), [расширенных событий](../../relational-databases/extended-events/extended-events.md) и [автоматической настройки](../../relational-databases/automatic-tuning/automatic-tuning.md); 
  - улучшение масштабируемости благодаря [автоматическому использованию архитектуры Soft-NUMA](../../database-engine/configure-windows/soft-numa-sql-server.md#automatic-soft-numa).

Для новых баз данных по-прежнему задается уровень совместимости по умолчанию версии [!INCLUDE[ssde_md](../../includes/ssde_md.md)]. Однако при обновлении базы данных с любой более ранней версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до новой версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)] она сохраняет свой существующий уровень совместимости. 

> [!IMPORTANT]
> Перед переносом базы данных в новую версию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[ssazure_md](../../includes/ssazure_md.md)] убедитесь в том, что уровень совместимости базы данных по-прежнему поддерживается. Таблицу поддержки уровня совместимости базы данных можно просмотреть [здесь](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#arguments). 
>
> При обновлении базы данных с уровнем совместимости ниже допустимого (например, уровнем 90, который был уровнем по умолчанию в [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]) устанавливается минимальный допустимый уровень совместимости (100).
>
> Чтобы определить текущий уровень совместимости, запросите столбец **compatibility_level** в представлении [sys.databases](../../relational-databases/system-catalog-views/sys-databases-transact-sql.md).

## <a name="compatibility-levels-and-database-engine-upgrades"></a>Уровни совместимости и обновления ядра СУБД
Чтобы обновить [!INCLUDE[ssde_md](../../includes/ssde_md.md)] до последней версии с сохранением уровня совместимости базы данных, существовавшего до обновления, и состояния поддержки, рекомендуется выполнить статическую функциональную проверку контактной зоны кода приложения в базе данных (объекты программирования, включая хранимые процедуры, функции, триггеры и пр.) и приложении (используя трассировку рабочей нагрузки для записи кода, отправляемого приложением) с использованием [Помощника по миграции данных (Майкрософт)](https://www.microsoft.com/download/details.aspx?id=53595) (DMA). Отсутствие в выходных данных DMA ошибок, связанных с отсутствием или несовместимостью функциональных возможностей, позволит избежать снижения функциональности приложения в новой конечной версии. Дополнительные сведения см. в статье [Общие сведения о Помощнике по миграции данных](../../dma/dma-overview.md).

> [!NOTE]
> DMA поддерживает уровень совместимости базы данных 100 и выше. [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] как исходная версия не поддерживается.   

> [!IMPORTANT]
> [!INCLUDE[msCoName](../../includes/msconame-md.md)] рекомендует проводить минимальное необходимое тестирование для проверки успешности обновления с сохранением прежнего уровня совместимости базы данных. Вам следует определить, что является минимальным необходимым тестированием, с учетом особенностей вашего приложения и сценария.   

> [!NOTE]
> [!INCLUDE[msCoName](../../includes/msconame-md.md)] обеспечивает защиту формы плана запроса в указанных ниже случаях.
>
> - Новая (конечная) версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] работает на оборудовании, сопоставимом с оборудованием, на котором работала предыдущая (исходная) версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].
> - Один и тот же [поддерживаемый уровень совместимости базы данных](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#supported-dbcompats) используется как в конечной версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], так и в исходной версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].
>
> Любая регрессия формы плана запроса (по сравнению с исходной версией [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]) в описанных выше ситуациях требует принятия мер. Обратитесь в службу поддержки клиентов Майкрософт.
  
## <a name="see-also"></a>См. также: 
[Уровень совместимости ALTER DATABASE](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md)       
[Просмотр или изменение уровня совместимости базы данных](../../relational-databases/databases/view-or-change-the-compatibility-level-of-a-database.md)       
[Рекомендации по обновлению уровня совместимости базы данных](../../t-sql/statements/alter-database-transact-sql-compatibility-level.md#best-practices-for-upgrading-database-compatibility-level)      
