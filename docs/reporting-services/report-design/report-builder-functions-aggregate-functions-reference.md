---
title: Справочник по агрегатным функциям (построитель отчетов и службы SSRS) | Документы Майкрософт
ms.date: 03/07/2017
ms.prod: reporting-services
ms.prod_service: reporting-services-native
ms.technology: report-design
ms.topic: conceptual
ms.assetid: db6542ee-02d0-4073-90e6-cba8f9510fbb
author: maggiesMSFT
ms.author: maggies
ms.openlocfilehash: 243f895c22621c3f83fab38a5bab47d1f7b7b490
ms.sourcegitcommit: b78f7ab9281f570b87f96991ebd9a095812cc546
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "68893759"
---
# <a name="report-builder-functions---aggregate-functions-reference"></a>Функции построителя отчетов — справочник по агрегатным функциям
  Чтобы включить в отчет статистические значения, в выражениях можно использовать агрегатные функции. Агрегатная функция по умолчанию для числовых полей — функция SUM. Можно изменить выражение и использовать другую встроенную агрегатную функцию или указать другую область. Область определяет набор данных, используемый при вычислениях.  
  
 Поскольку в обработчике отчетов объединены данные и макет отчета, то выражения для всех элементов отчета вычисляются. При просмотре всех страниц отчета в элементах отчета, подготовленных к просмотру, отображаются результаты для всех выражений.  
  
 В следующей таблице перечислены категории встроенных функций, которые можно включать в выражение.  
  
-   [Встроенные агрегатные функции](#CalculatingAggregates)  
  
-   [Ограничения встроенных полей, коллекций и агрегатных функций](#Restrictions)  
  
-   [Ограничения вложенных агрегатов](#NestedRestrictions)  
  
-   [Вычисление текущих значений](#CalculatingRunningValues)  
  
-   [Получение числа строк](#RetrievingRowCounts)  
  
-   [Уточняющий запрос значений из другого набора данных](#LookupFunctions)  
  
-   [Получение основанных на сортировке значений](#RetrievingPostsortValues)  
  
-   [Получение серверных агрегатов](#RetrievingServerAggregates)  
  
-   [Получение уровня рекурсии](#RetrievingRecursiveLevel)  
  
-   [Тестирование области](#TestingforScope)  
  
 Чтобы определить допустимые области для функции, см. раздел справки по конкретной функции. Дополнительные сведения и примеры см. в разделе [Область выражения для суммирования, агрегатных функций и встроенных коллекций (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-scope-for-totals-aggregates-and-built-in-collections.md).  
  
> [!NOTE]  
>  [!INCLUDE[ssRBRDDup](../../includes/ssrbrddup-md.md)]  
  
##  <a name="CalculatingAggregates"></a> Встроенные агрегатные функции  
 Для вычисления сводных значений для набора ненулевых числовых данных в области по умолчанию или именованной области используются следующие встроенные функции.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[Avg](../../reporting-services/report-design/report-builder-functions-avg-function.md)|Возвращает среднее значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[Count](../../reporting-services/report-design/report-builder-functions-count-function.md)|Возвращает количество значений, отличных от NULL, определяемое выражением, вычисляемым в контексте данной области.|  
|[CountDistinct](../../reporting-services/report-design/report-builder-functions-countdistinct-function.md)|Возвращает количество уникальных значений, отличных от NULL, определяемое выражением, вычисляемым в контексте данной области.|  
|[Max](../../reporting-services/report-design/report-builder-functions-max-function.md)|Возвращает максимальное значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области. Можно использовать для задания максимального значения оси диаграммы при управлении масштабом.|  
|[Min](../../reporting-services/report-design/report-builder-functions-min-function.md)|Возвращает минимальное значение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области. Можно использовать для задания минимального значения оси диаграммы при управлении масштабом.|  
|[StDev](../../reporting-services/report-design/report-builder-functions-stdev-function.md)|Возвращает стандартное отклонение всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[StDevP](../../reporting-services/report-design/report-builder-functions-stdevp-function.md)|Возвращает стандартное отклонение совокупности всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области.|  
|[Sum](../../reporting-services/report-design/report-builder-functions-sum-function.md)|Возвращает сумму всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[Union](../../reporting-services/report-design/report-builder-functions-union-function.md)|Возвращает объединение всех значений пространственных данных типа **SqlGeometry** или **SqlGeography** , не равных NULL и указанных с помощью выражения, которое вычисляется в заданной области.|  
|[Var](../../reporting-services/report-design/report-builder-functions-var-function.md)|Возвращает дисперсию всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
|[VarP](../../reporting-services/report-design/report-builder-functions-varp-function.md)|Возвращает дисперсию совокупности всех числовых значений, отличных от NULL, заданных выражением, вычисляемым в контексте данной области.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="Restrictions"></a> Ограничения встроенных полей, коллекций и агрегатных функций  
 В следующей таблице описываются ограничения местоположений отчетов, в которых можно добавлять выражения, содержащие ссылки на глобальные встроенные коллекции.  
  
|Местоположение в отчете|Поля|Параметры|ReportItems|PageNumber<br /><br /> TotalPages|DataSource<br /><br /> DataSet|Переменные|RenderFormat|  
|------------------------|------------|----------------|-----------------|-------------------------------|----------------------------|---------------|------------------|  
|Заголовок страницы<br /><br /> Нижний колонтитул страницы|Да|Да|Максимум одно<br /><br /> Примечание 1|Да|Да|Да|Да|  
|Текст|Да<br /><br /> Примечание 2|Да|Только элементы в текущей или включающей области<br /><br /> Примечание 3|нет|Да|Да|Да|  
|Параметр отчета|нет|Только ранее упомянутые в списке параметры<br /><br /> Примечание 4|нет|нет|нет|нет|нет|  
|Поле|Да|Да|нет|нет|нет|нет|нет|  
|Параметр запроса|нет|Да|нет|нет|нет|нет|нет|  
|Выражение группы|Да|Да|нет|нет|Да|нет|нет|  
|Выражение сортировки|Да|Да|нет|нет|Да|Да<br /><br /> Примечание 5|нет|  
|Критерий фильтра|Да|Да|нет|нет|Да|Да<br /><br /> Примечание 6|нет|  
|Код|нет|Да<br /><br /> Примечание 7|нет|нет|нет|нет|нет|  
|Report.Language|нет|Да|нет|нет|нет|нет|нет|  
|Переменные|Да|Да|нет|нет|Да|Текущая или включающая область|нет|  
|Статистические выражения|Да|Да|Только в верхнем или нижнем колонтитуле страницы|Только в агрегатных функциях элементов отчета|Да|нет|нет|  
|Функции поиска|Да|Да|Да|нет|Да|нет|нет|  
  
-   **Примечание 1.** Элемент ReportItems должен существовать на странице отчета, подготовленной к просмотру, или их значение равно NULL. Если видимость элемента отчета зависит от выражения, принимающего значение False, то этот элемент отчета не существует на странице.  
  
-   **Примечание 2** . Если ссылка на поле используется в области группы и ссылка на поле не включена в выражение группы, то значение для поля считается неопределенным, за исключением случаев, когда в области имеется только одно значение. Чтобы указать значение используйте методы First и Last и область группы.  
  
-   **Примечание 3** . Выражения, включающие ссылку на элемент ReportItems, могут использоваться для указания значений для других элементов ReportItems в той же или включающей области группы.  
  
-   **Примечание 4** . Значения свойств для предыдущих параметров могут быть равны NULL.  
  
-   **Примечание 5** . Только при сортировке элементов. Нельзя использовать в выражениях сортировки области данных.  
  
-   **Примечание 6** . Только для фильтров элементов. Нельзя использовать в выражениях сортировки области данных или критериев фильтра наборов данных.  
  
-   **Примечание 7.** Коллекция параметров не инициализируется до обработки блока кода, поэтому методы не могут быть использованы для управления параметрами при инициализации.  
  
-   **Примечание 8.** Все агрегатные функции, за исключением Count и CountDistinct, должны иметь один тип данных, или все значения должны быть равны NULL.  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="NestedRestrictions"></a> Ограничения вложенных агрегатов  
 В следующей таблице описываются ограничения, которые используются агрегатными функциями для указания других агрегатных функций как вложенных агрегатов.  
  
|Контекст|RunningValue|RowNumber|Первый<br /><br /> Последний|Previous|Sum и другие функции предварительной сортировки|Агрегаты ReportItem|Функции поиска|Агрегатная функция|  
|-------------|------------------|---------------|--------------------|--------------|-------------------------------------|---------------------------|----------------------|------------------------|  
|Текущее значение|нет|нет|нет|нет|Да|нет|Да|нет|  
|Первый<br /><br /> Последний|нет|нет|нет|нет|Да|нет|нет|нет|  
|Previous|Да|Да|Да|нет|Да|нет|Да|нет|  
|Sum и другие функции предварительной сортировки|нет|нет|нет|нет|Да|нет|Да|нет|  
|Агрегаты ReportItem|нет|нет|нет|нет|нет|нет|нет|нет|  
|Функции поиска|Да|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|Да<br /><br /> Примечание 1|нет|нет|  
|Агрегатная функция|нет|нет|нет|нет|нет|нет|нет|нет|  
  
-   **Примечание 1.** Использование агрегатных функций разрешено только внутри выражения *Source* функции Lookup, если функция Lookup не содержится в агрегате. Использование агрегатных функций не разрешено внутри выражений *Destination* или *Result* функции поиска.  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="CalculatingRunningValues"></a> Вычисление текущих значений  
 Следующие встроенные функции вычисляют текущие значения для набора данных. Функция**RowNumber** подобна функции **RunningValue** тем, что возвращает текущее значение счетчика, которое увеличивается для каждой строки внутри содержащей области. В этих функциях параметр области должен задавать вмещающую область, которая управляет обнулением счетчика.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[RowNumber](../../reporting-services/report-design/report-builder-functions-rownumber-function.md)|Возвращает текущее количество строк в указанной области. Функция **RowNumber** начинает счет с 1, а не с 0.|  
|[RunningValue](../../reporting-services/report-design/report-builder-functions-runningvalue-function.md)|Возвращает текущий агрегат всех числовых значений, отличных от NULL, заданных выражением, вычисляемым для данной области.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="RetrievingRowCounts"></a> Получение числа строк  
 Следующая встроенная функция вычисляет количество строк в данной области. Используйте эту функцию для подсчета всех строк, включая строки, содержащие значение NULL.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[CountRows](../../reporting-services/report-design/report-builder-functions-countrows-function.md)|Возвращает число строк в указанной области, включая строки со значениями NULL.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="LookupFunctions"></a> Уточняющий запрос значений из другого набора данных  
 Следующие функции поиска извлекают значения из указанного набора данных.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[Функция Lookup](../../reporting-services/report-design/report-builder-functions-lookup-function.md)|Возвращает значение определенного выражения из набора данных.|  
|[Функция LookupSet](../../reporting-services/report-design/report-builder-functions-lookupset-function.md)|Возвращает набор значений указанного выражения из набора данных.|  
|[Функция Multilookup](../../reporting-services/report-design/report-builder-functions-multilookup-function.md)|Возвращает первые подходящие значения для набора имен из набора данных, содержащего пары «имя-значение».|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="RetrievingPostsortValues"></a> Получение основанных на сортировке значений  
 Следующие встроенные функции возвращают первое, последнее или предыдущее значения внутри заданной области. Эти функции зависят от порядка сортировки значений данных. С помощью этих функций можно, например, найти последнее и первое значения на странице, чтобы создать заголовок в стиле словаря. Используйте функцию **Previous** , чтобы сравнить значение в одной строке со значением в предыдущей строке конкретной области, например чтобы найти значение годового процента в таблице.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[Первая](../../reporting-services/report-design/report-builder-functions-first-function.md)|Возвращает первое значение указанного выражения для заданной области.|  
|[Последняя](../../reporting-services/report-design/report-builder-functions-last-function.md)|Возвращает последнее значение указанного выражения для заданной области.|  
|[Назад](../../reporting-services/report-design/report-builder-functions-previous-function.md)|Возвращает значение или значение статистического выражения для предыдущего экземпляра элемента внутри заданной области.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="RetrievingServerAggregates"></a> Получение серверных агрегатов  
 Следующая встроенная функция получает пользовательские агрегаты из поставщика данных. Например, при использовании источника данных типа служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] можно получить агрегаты, вычисляемые на сервере источника данных и используемые в заголовке группы.  
  
|**Компонент**|**Описание**|  
|------------------|---------------------|  
|[Aggregate](../../reporting-services/report-design/report-builder-functions-aggregate-function.md)|Возвращает пользовательские статистические данные заданного выражения в соответствии с определением поставщика данных.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="TestingforScope"></a> Тестирование области  
 Следующая встроенная функция тестирует текущий контекст элемента отчета, чтобы увидеть, является ли он элементом определенной области.  
  
|Компонент|Описание|  
|--------------|-----------------|  
|[InScope](../../reporting-services/report-design/report-builder-functions-inscope-function.md)|Указывает, входит ли текущий экземпляр элемента в пределы указанной области действия.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
##  <a name="RetrievingRecursiveLevel"></a> Получение уровня рекурсии  
 Следующая встроенная функция получает текущий уровень при обработке рекурсивной иерархии. Чтобы управлять уровнем отступа визуальной иерархии для рекурсивной группы, используйте результат этой функции вместе со свойством **Padding** в текстовом поле. Дополнительные сведения см. в разделе [Создание групп рекурсивной иерархии (построитель отчетов и службы SSRS)](../../reporting-services/report-design/creating-recursive-hierarchy-groups-report-builder-and-ssrs.md).  
  
|Компонент|Описание|  
|--------------|-----------------|  
|[Level](../../reporting-services/report-design/report-builder-functions-level-function.md)|Возвращает текущий уровень глубины в рекурсивной иерархии.|  
  
 ![Значок стрелки, используемый со ссылкой "К началу"](https://docs.microsoft.com/analysis-services/analysis-services/instances/media/uparrow16x16.gif "Значок стрелки, используемый со ссылкой В начало")К началу  
  
## <a name="see-also"></a>См. также:  
 [Использование выражений в отчетах (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-uses-in-reports-report-builder-and-ssrs.md)   
 [Примеры выражений (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-examples-report-builder-and-ssrs.md)   
 [Область выражения для суммирования, агрегатных функций и встроенных коллекций (построитель отчетов и службы SSRS)](../../reporting-services/report-design/expression-scope-for-totals-aggregates-and-built-in-collections.md)  
  
  
