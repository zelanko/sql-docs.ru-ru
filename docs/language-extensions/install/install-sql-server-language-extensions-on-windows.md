---
title: Установка расширений языка для SQL Server в Windows
titleSuffix: ''
description: Сведения об установке расширений языка для SQL Server в Windows.
author: dphansen
ms.author: davidph
ms.date: 11/06/2019
ms.topic: conceptual
ms.prod: sql
ms.technology: language-extensions
monikerRange: '>=sql-server-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: 3e4f3a84e5001d7485ab590a66ee497522042824
ms.sourcegitcommit: b78f7ab9281f570b87f96991ebd9a095812cc546
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "73658848"
---
# <a name="install-sql-server-language-extensions-on-windows"></a>Установка расширений языка для SQL Server в Windows

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Сведения о том, как установить компонент расширений языка в SQL Server, запустив мастер установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].

> [!NOTE]
> Эта статья предназначена для установки расширений языка SQL Server в Windows. Инструкции по установке в Linux см. в статье [Установка расширений языка (Java) для SQL Server 2019 на Linux](https://docs.microsoft.com/sql//linux/sql-server-linux-setup-language-extensions).

<a name="prerequisites"></a> 

## <a name="pre-install-checklist"></a>Контрольный список перед установкой

+ Для установки расширений языка требуется установка SQL Server 2019.

+ Необходим экземпляр ядра СУБД. Вы не можете установить только функции расширений языка, хотя их можно добавлять в существующий экземпляр постепенно.

+ Для обеспечения непрерывности бизнес-процессов [группы доступности Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) поддерживаются для расширений языка. Необходимо установить расширения языка и настроить пакеты на каждом узле.

+ Установка расширений языка поддерживается в отказоустойчивом кластере в SQL Server 2019.

+ Не устанавливайте расширения языка SQL Server на контроллере домена. Часть программы установки, связанная с расширением языка, выполнена не будет.

+ Расширения языка и [службы машинного обучения](../../advanced-analytics/index.yml) устанавливаются по умолчанию в кластерах больших данных SQL Server. Если вы используете кластеры больших данных, нет необходимости выполнять действия, описанные в этой статье. Дополнительные сведения см. в разделе [Использование служб машинного обучения (Python и R) в кластерах больших данных](../../big-data-cluster/machine-learning-services.md).

> [!IMPORTANT]
> После завершения установки обязательно выполните действия после конфигурации, описанные в этой статье. В их число входят включение SQL Server для использования внешнего кода и добавление учетных записей, необходимых для того, чтобы SQL Server выполнял код Java от вашего имени. Изменения в конфигурации обычно требуют перезапуска экземпляра или службы панели элементов.

<a name="java-jre-jdk"></a>

## <a name="java-jre-or-jdk"></a>Java JRE или JDK

В SQL Server 2019, релиз-кандидат 1 предусмотрены два способа установки и использования Java с SQL Server:

1. Использование среды выполнения Java по умолчанию — Zulu Open JRE версии 11.0.3. Эта среда выполнения поддерживается и входит в установку SQL Server.

1. Использование предпочтительного дистрибутива Java вместо среды выполнения Java по умолчанию.

    В настоящее время в Windows поддерживается версия Java 11. Среда выполнения Java (JRE) является минимальным требованием, но если нужно использовать компилятор Java и пакеты разработки, вам пригодится пакет Java Development Kit (JDK). Поскольку JDK включает все необходимое, при его установке JRE не требуется. В Windows рекомендуется по возможности устанавливать JDK в папку `/Program Files/` по умолчанию. В противном случае для предоставления разрешений исполняемым файлам потребуются дополнительные настройки. Дополнительные сведения см. в разделе о [предоставлении разрешений (Windows)](#perms-nonwindows) в этом документе.

    > [!NOTE]
    > Учитывая, что Java имеет обратную совместимость, более ранние версии могут работать, но поддерживаемая и протестированная версия для данного выпуска релиза-кандидата 1 — это Java 11.
    
## <a name="get-the-installation-media"></a>Получение установочного носителя

[!INCLUDE[GetInstallationMedia](../../includes/getssmedia.md)]

## <a name="run-setup"></a>Запуск программы установки

Для локальных установок необходимо запускать программу установки с правами администратора. При установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из удаленной общей папки необходимо использовать учетную запись домена с разрешениями на чтение и выполнение для удаленной общей папки.

1. Запустите мастер установки SQL Server 2019. 
  
2. На вкладке **Установка** выберите параметр **Новая установка изолированного экземпляра SQL Server или добавление компонентов к существующей установке**.

    ![Установка SQL Server 2019](../media/sql-install.png) 

3. На странице **Выбор компонентов** выберите следующие компоненты:
  
    - **Службы ядра СУБД**
  
        Чтобы использовать расширения языка с SQL Server, необходимо установить экземпляр ядра СУБД. Можно использовать экземпляр по умолчанию или именованный экземпляр.
  
    - **Службы машинного обучения и расширения языка**
  
        Этот параметр устанавливает компонент расширений языка, который поддерживает выполнение кода Java.

        - Если вы хотите установить среду выполнения Java по умолчанию, Zulu Open JRE 11.0.3, выберите и **Службы машинного обучения и расширения языка**, и **Java**.

        - Если вы хотите использовать собственную среду выполнения Java, выберите **Службы машинного обучения и расширения языка**. Не выбирайте Java.

        Если вы хотите использовать R и Python, см. раздел [Установка служб машинного обучения SQL Server в Windows](https://docs.microsoft.com/sql/advanced-analytics/install/sql-machine-learning-services-windows-install).

    ![Параметры расширений языка](../media/sql-install-feature-selection.png)

4. Если в предыдущем шаге вы выбрали параметр **Java** для установки среды выполнения Java по умолчанию, откроется страница **Папка установки Java**.

    Выберите параметр **Установите среду Open JRE 11.0.3, входящую в эту установку**.

    ![Выбор расположения для установки Java](../media/sql-install-openjdk.png)

    > [!NOTE]
    > Для расширений языка параметр **Укажите расположение другой версии, установленной на этом компьютере** не используется.

5. На странице **Все готово для установки** проверьте, включены ли указанные ниже компоненты, и нажмите **Установить**.
  
    + Службы ядра СУБД
    + Службы машинного обучения и расширения языка

    Обратите внимание на расположение папки в каталоге `..\Setup Bootstrap\Log`, где хранятся файлы конфигурации. После завершения установки можно просмотреть установленные компоненты в файле сводки.

6. Если после завершения установки будет предложено перезагрузить компьютер, выполните перезагрузку. После завершения установки важно прочитать сообщение мастера установки. Дополнительные сведения см. в разделе [View and Read SQL Server Setup Log Files](https://docs.microsoft.com/sql/database-engine/install-windows/view-and-read-sql-server-setup-log-files).

## <a name="add-the-jre_home-variable"></a>Добавление переменной JRE_HOME

`JRE_HOME` — это системная переменная среды, указывающая расположение интерпретатора Java. В этом шаге создайте в Windows системную переменную среды.

1. Найдите и скопируйте путь к домашнему каталогу JRE.

    Например, путь к домашнему каталогу JRE для среды выполнения Java Zulu JRE 11.0.3 по умолчанию — `C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\Binn\AZUL-OpenJDK-JRE\`.

    В зависимости от того, в какую папку у вас установлен SQL Server, а также при выборе другой среды выполнения Java расположение JDK или JRE может отличаться от расположения, указанного в приведенном выше примере. Даже если у вас установлен JDK, в процессе его установки часто создается вложенная папка JRE — в этом случае укажите эту папку JRE. Расширение Java попытается загрузить `jvm.dll` из каталога `%JRE_HOME%\bin\server`.

2. На панели управления выберите пункт **Система и безопасность**, а затем **Система** и нажмите **Дополнительные свойства системы**.

3. Выберите пункт **Переменные среды**.

4. Создайте новую системную переменную для `JRE_HOME`, указав в качестве ее значения путь к JDK/JRE (указанный в шаге 1).

5. Перезапустите [Панель запуска](../concepts/extensibility-framework.md#launchpad).

    1. Откройте [Диспетчер конфигурации SQL Server](../../relational-databases/sql-server-configuration-manager.md).

    2. В разделе "Службы SQL Server" щелкните "Панель запуска SQL Server" правой кнопкой мыши и выберите параметр **Перезапустить**.

<a name="perms-nonwindows"></a>

## <a name="grant-access-to-non-default-jre-folder"></a>Предоставление доступа к папке JRE, отличной от используемой по умолчанию

Если вы не устанавливали Zulu Open JRE по умолчанию, предоставляемому вместе с SQL Server, и не установили JDK или JRE в папку Program Files, необходимо выполнить указанные ниже действия. Выполните команды **icacls** в строке *с повышенными привилегиями*, чтобы предоставить доступ к **SQLRUsergroup** и учетным записям службы SQL Server (в **ALL_APPLICATION_PACKAGES**) для доступа к JRE. Эти команды будут рекурсивно предоставлять доступ ко всем файлам и папкам в указанном каталоге.

1. Предоставление разрешений SQLRUserGroup

    Для именованного экземпляра добавьте к SQLRUsergroup имя экземпляра (например, `SQLRUsergroupINSTANCENAME`).

    ```cmd
    icacls "<PATH to JRE>" /grant "SQLRUsergroup":(OI)(CI)RX /T
    ```
    
    Этот шаг можно пропустить, если вы установили JDK/JRE в папку по умолчанию в каталоге Program Files в Windows.

2. Предоставление разрешений AppContainer

    ```cmd
    icacls "<PATH to JRE>" /grant "ALL APPLICATION PACKAGES":(OI)(CI)RX /T
    ```
    
## <a name="enable-script-execution"></a>Включение выполнения сценария

1. Откройте среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. 

    > [!TIP]
    > Скачать и установить соответствующую версию можно с этой страницы: [Скачайте SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
    > 
    > Можно также использовать среду [Azure Data Studio](../../azure-data-studio/what-is.md), которая поддерживает административные задачи и запросы к SQL Server.
  
2. Подключитесь к экземпляру, в который вы установили расширения языка, нажмите **Создать запрос**, чтобы открыть окно запроса, и выполните следующую команду:

    ```sql
    sp_configure
    ```

    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Этот компонент по умолчанию отключен и для того, чтобы вы могли выполнять код Java, его должен явно включить администратор.
    
3.  Чтобы включить внешний компонент написания сценариев, выполните следующую инструкцию:
    
    ```sql
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
    
    Если вы уже включили этот компонент для служб машинного обучения, не выполняйте повторную настройку для расширений языка. Базовая платформа расширяемости поддерживает и те, и другие.

## <a name="restart-the-service"></a>Перезапустите службу.

После завершения установки перезапустите ядро СУБД, прежде чем перейти к следующему шагу — включению выполнения скриптов.

При перезапуске службы автоматически перезапускается соответствующая служба Панель запуска SQL Server.

Службу можно перезапустить, щелкнув ее правой кнопкой мыши и выбрав команду **Перезапустить** для экземпляра SSMS, через раздел **Службы** на панели управления или с помощью [диспетчера конфигурации SQL Server](../../relational-databases/sql-server-configuration-manager.md).

<a name="register_external_language"></a>

## <a name="register-external-language"></a>Регистрация внешнего языка

Для каждой базы данных, в которой необходимо использовать расширения языка, зарегистрируйте внешний язык с помощью команды [CREATE EXTERNAL LANGUAGE](https://docs.microsoft.com/sql/t-sql/statements/create-external-language-transact-sql).

Следующий пример добавляет внешний язык Java в базу данных на сервере SQL Server в Windows.

```SQL
CREATE EXTERNAL LANGUAGE Java
FROM (CONTENT = N'<path-to-zip>', FILE_NAME = 'javaextension.dll');
GO
```

Дополнительные сведения см. в разделе [CREATE EXTERNAL LANGUAGE](https://docs.microsoft.com/sql/t-sql/statements/create-external-language-transact-sql).

## <a name="verify-installation"></a>Проверка установки

Проверьте состояние установки экземпляра по журналам установки.

Выполните указанные ниже действия, чтобы убедиться в том, что все компоненты, используемые для запуска внешнего скрипта, запущены.

1. Откройте новое окно запроса в SQL Server Management Studio или Azure Data Studio и выполните приведенную следующую инструкцию:
    
    ```sql
    EXEC sp_configure  'external scripts enabled'
    ```

    Теперь **run_value** имеет значение 1.
    
2. Откройте раздел **Службы** или диспетчер конфигурации SQL Server и убедитесь, что служба **Панель запуска SQL Server** запущена. У вас должно быть по одной службе для каждого экземпляра ядра СУБД с установленными расширениями языка. Дополнительные сведения об этой службе см. в разделе [Платформа расширяемости](../concepts/extensibility-framework.md). 
   
## <a name="additional-configuration"></a>Дополнительная настройка

Если проверка будет пройдена успешно, вы сможете выполнять Java Cod из SQL Server Management Studio, Azure Data Studio, Visual Studio Code или любого другого клиента, который может отправлять инструкции T-SQL на сервер.

Если при выполнении команды возникнет ошибка, обратитесь к дополнительным шагам настройки, указанным в этом разделе. Возможно, потребуется внести какие-то дополнительные настройки в службу или базу данных.

На уровне экземпляра дополнительная конфигурация может включать следующее:

* [Настройка брандмауэра для служб машинного обучения SQL Server](../../advanced-analytics/security/firewall-configuration.md)
* [Включение дополнительных сетевых протоколов](../../database-engine/configure-windows/enable-or-disable-a-server-network-protocol.md)
* [Включение удаленных подключений](../../database-engine/configure-windows/configure-the-remote-access-server-configuration-option.md)
* [Создание учетных данных для SQLRUserGroup](../../advanced-analytics/security/create-a-login-for-sqlrusergroup.md)

<a name="bkmk_configureAccounts"></a> 
<a name="permissions-external-script"></a> 

В базе данных могут потребоваться следующие обновления конфигурации:

* [Предоставление пользователям доступа к службам машинного обучения SQL Server](../../advanced-analytics/security/user-permission.md)
* [Предоставление пользователям разрешения на выполнение определенного языка](https://docs.microsoft.com/sql/t-sql/statements/create-external-language-transact-sql#permissions)

> [!NOTE]
> Необходимость дополнительной настройки зависит от схемы безопасности, в которой установлен ваш SQL Server, и от того, как ваши пользователи должны подключаться к базе данных и запускать внешние скрипты.

## <a name="suggested-optimizations"></a>Предлагаемые оптимизации

Теперь, когда все работает, также может потребоваться оптимизировать сервер для поддержки расширений языка.

### <a name="optimize-the-server-for-language-extensions"></a>Оптимизация сервера для расширений языка

Параметры по умолчанию для программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] призваны оптимизировать выполнение на сервере различных служб, поддерживаемых ядром СУБД, включая процессы извлечения, преобразования и загрузки, ведение отчетности, аудит и приложения, использующие данные [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. В связи с этим при использовании параметров по умолчанию ресурсы для расширений языка могут быть ограничены или регулироваться, особенно в случае с операциями с интенсивным использованием памяти.

Чтобы задачам расширений языка назначались соответствующие приоритеты и выделялись необходимые ресурсы, рекомендуем использовать Resource Governor SQL Server для настройки внешнего пула ресурсов. Кроме того, можно изменить размер памяти, выделяемой ядру СУБД [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], или увеличить количество учетных записей в службе [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)].

- Сведения о настройке пула ресурсов для управления внешними ресурсами см. в разделе [Создание внешнего пула ресурсов](../../t-sql/statements/create-external-resource-pool-transact-sql.md).
  
- Сведения об изменении объема памяти, выделяемой для базы данных, см. в разделе [Параметры конфигурации памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md).
  
Если у вас установлен выпуск Standard Edition, но отсутствует Resource Governor, вы можете использовать для управления ресурсами сервера динамические административные представления и расширенные события, а также мониторинг событий Windows.

## <a name="next-steps"></a>Дальнейшие действия

Разработчики на языке Java могут ознакомиться с простыми примерами, а также узнать, как код Java работает с SQL Server. Сведения о следующем шаге см. по ссылке:

+ [Руководство. Регулярные выражения с Java](../tutorials/search-for-string-using-regular-expressions-in-java.md)
