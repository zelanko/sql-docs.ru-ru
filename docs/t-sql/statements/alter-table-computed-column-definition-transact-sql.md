---
title: computed_column_definition (Transact-SQL) | Документы Майкрософт
ms.custom: ''
ms.date: 05/05/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: t-sql
ms.topic: language-reference
dev_langs:
- TSQL
helpviewer_keywords:
- ALTER TABLE statement
ms.assetid: 746eabda-3b4f-4940-b0b5-1c379f5cf7a5
author: CarlRabeler
ms.author: carlrab
manager: craigg
ms.openlocfilehash: 7ffaa3267a512fc85b223290c76e239013612d11
ms.sourcegitcommit: 61381ef939415fe019285def9450d7583df1fed0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47672002"
---
# <a name="alter-table-computedcolumndefinition-transact-sql"></a>ALTER TABLE computed_column_definition (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-asdb-xxxx-xxx-md.md)]

  Указывает свойства вычисляемого столбца, который добавляется в таблицу с помощью инструкции [ALTER TABLE](../../t-sql/statements/alter-table-transact-sql.md).  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
column_name AS computed_column_expression  
[ PERSISTED [ NOT NULL ] ]  
[   
    [ CONSTRAINT constraint_name ]  
    { PRIMARY KEY | UNIQUE }  
        [ CLUSTERED | NONCLUSTERED ]  
        [ WITH FILLFACTOR = fillfactor ]  
        [ WITH ( <index_option> [, ...n ] ) ]  
        [ ON { partition_scheme_name ( partition_column_name ) | filegroup   
            | "default" } ]  
    | [ FOREIGN KEY ]   
        REFERENCES ref_table [ ( ref_column ) ]   
        [ ON DELETE { NO ACTION | CASCADE } ]   
        [ ON UPDATE { NO ACTION } ]   
        [ NOT FOR REPLICATION ]   
    | CHECK [ NOT FOR REPLICATION ] ( logical_expression )  
]  
```  
  
## <a name="arguments"></a>Аргументы  
*column_name*  
 Имя столбца, который требуется изменить, добавить или удалить. Имя *column_name* может иметь длину от 1 до 128 символов. Для новых столбцов, созданных с типом данных **timestamp**, аргумент *column_name* можно пропустить. Если для столбца типа **timestamp** не указан аргумент *column_name*, используется имя **timestamp**.  
  
*computed_column_expression*  
 Выражение, определяющее значение вычисляемого столбца. Вычисляемый столбец является виртуальным столбцом, который физически не хранится в таблице, а вычисляется с помощью некоторого выражения, использующего другие столбцы данной таблицы. Например, вычисляемый столбец может иметь определение cost AS price * qty. Выражение может быть именем невычисляемого столбца, константой, функцией, переменной или любой их комбинацией, соединенной одним или несколькими операторами. Выражение не может быть вложенным запросом или включать псевдоним типа данных.  
  
 Вычисляемые столбцы могут использоваться в списках выбора, предложениях WHERE и ORDER BY или в любых других местах, в которых могут использоваться регулярные выражения, за исключением следующих случаев.  
  
-   Вычисляемый столбец нельзя использовать ни в качестве определения ограничения DEFAULT или FOREIGN KEY, ни вместе с определением ограничения NOT NULL. Однако если вычисляемый столбец определен детерминированным выражением и тип данных результата допускается для индексных столбцов, то вычисляемый столбец может быть использован как ключевой столбец в индексе или как часть ограничений PRIMARY KEY или UNIQUE.  
  
     Например, если таблица содержит столбцы a и b со значениями целого типа, то вычисляемый столбец a + b может быть индексирован, но вычисляемый столбец a+DATEPART(dd, GETDATE()) не может быть индексирован, так как значение может меняться при каждом следующем вычислении.  
  
-   Вычисляемый столбец не может быть целевым столбцом инструкций INSERT или UPDATE.  
  
    > [!NOTE]  
    >  Так как каждая строка в таблице может иметь различные значения для столбцов, используемых для вычисляемого столбца, то вычисляемый столбец может не иметь повторяющихся значений в разных строках.  
  
PERSISTED  
 Указывает, что компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] будет физически хранить вычисляемые значения в таблице и обновлять их при изменении любого столбца, от которого зависит вычисляемый столбец. Пометка вычисляемого столбца признаком PERSISTED позволяет создать индекс на детерминистическом, но не точном вычисляемом столбце. Дополнительные сведения см. в разделе [Индексы вычисляемых столбцов](../../relational-databases/indexes/indexes-on-computed-columns.md). Все вычисляемые столбцы, используемые в столбцах секционирования секционированной таблицы, должны быть явно помечены как PERSISTED. Если указан параметр PERSISTED, значение *computed_column_expression* должно быть детерминированным. 

NULL | NOT NULL  
 Указывает, допустимы ли для столбца значения NULL. Предложение NULL не является ограничением в строгом смысле слова, но может быть указано так же, как и NOT NULL. Ограничение NOT NULL может быть указано для вычисляемых столбцов только в случае, если одновременно указан параметр PERSISTED.  
  
CONSTRAINT  
 Указывает начало определения для ограничений PRIMARY KEY или UNIQUE.  
  
*constraint_name*  
 Новое ограничение. Имена ограничений должны подчиняться правилам для [идентификаторов](../../relational-databases/databases/database-identifiers.md), за исключением тех, которые не могут начинаться с символа решетки (#). Если аргумент *constraint_name* не указан, то ограничению присваивается имя, формируемое системой.  
  
PRIMARY KEY  
 Ограничение, выполняющее принудительную проверку целостности сущностей для указанного столбца или столбцов при использовании уникального индекса. Для каждой таблицы может быть создано только одно ограничение PRIMARY KEY.  
  
UNIQUE  
 Ограничение, обеспечивающее целостность сущностей для указанного столбца или столбцов за счет использования уникального индекса.  
  
CLUSTERED | NONCLUSTERED  
 Указывает, что для ограничения PRIMARY KEY или UNIQUE создается кластеризованный или некластеризованный индекс. По умолчанию ограничения PRIMARY KEY имеют значение CLUSTERED. По умолчанию ограничения UNIQUE имеют значение NONCLUSTERED.  
  
 Если кластеризованное ограничение или индекс уже созданы в таблице, значение CLUSTERED не может быть задано. Если кластеризованное ограничение или индекс уже существует в таблице, ограничения PRIMARY KEY по умолчанию имеют значение NONCLUSTERED.  
  
WITH FILLFACTOR =*fillfactor*  
 Указывает, насколько полно компонент [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] должен заполнять каждую страницу индекса, используемую для хранения индексных данных. Пользовательские значения аргумента *fillfactor* могут быть в диапазоне от 1 до 100. Если значение не задано, по умолчанию принимается значение 0.  
  
> [!IMPORTANT]  
>  Описание выражения WITH FILLFACTOR = *fillfactor* как единственного параметра индекса, применимого к ограничениям PRIMARY KEY или UNIQUE, сохранено для обеспечения обратной совместимости, но в будущих выпусках это выражение документировано не будет. Другие параметры индекса можно указать в предложении [index_option (Transact-SQL)](../../t-sql/statements/alter-table-index-option-transact-sql.md) инструкции ALTER TABLE.  
  
FOREIGN KEY REFERENCES  
 Ограничение, которое обеспечивает ссылочную целостность данных в этом столбце или столбцах. Ограничения FOREIGN KEY требуют, чтобы каждое значение в столбце существовало в соответствующем связанном столбце или столбцах в связанной таблице. Ограничения FOREIGN KEY могут ссылаться только на столбцы, являющиеся ограничениями PRIMARY KEY или UNIQUE в связанной таблице или на столбцы, на которые имеются ссылки в индексе UNIQUE INDEX связанной таблицы. Внешние ключи в вычисляемых столбцах должны быть также помечены как PERSISTED.  
  
*ref_table*  
 Имя таблицы, на которую ссылается ограничение FOREIGN KEY.  
  
(*ref_column* )  
 Столбец из таблицы, на которую ссылается ограничение FOREIGN KEY.  
  
ON DELETE { **NO ACTION** | CASCADE }  
 Указывает, какую операцию выполнять над строками таблицы, если эти строки имеют ссылочную связь, и строка, на которую существует ссылка, удаляется из родительской таблицы. Параметр по умолчанию — NO ACTION.  
  
NO ACTION  
 Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] формирует ошибку, и выполняется откат операции удаления строки из родительской таблицы.

CASCADE  
 Если из родительской таблицы удаляется строка, соответствующие ей строки удаляются и из ссылающейся таблицы.  
  
 Например, в базе данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] таблица ProductVendor имеет ссылочную связь с таблицей Vendor. Внешний ключ ProductVendor.BusinessEntityID ссылается на первичный ключ Vendor.BusinessEntityID.  
  
 Если над строкой в таблице Vendor выполняется инструкция DELETE и для внешнего ключа ProductVendor.BusinessEntityID указано действие ON DELETE CASCADE, то компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] проверит наличие одной или нескольких зависимых записей в таблице ProductVendor. Если они существуют, то, в добавление к строке, на которую существует ссылка из таблицы Vendor, будут удалены зависимые строки в таблице ProductVendor.  
  
 В противном случае, если задано значение NO ACTION, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку и откатывает действие по удалению строки из таблицы Vendor, если хотя бы одна строка в таблице ProductVendor ссылается на нее.  
  
 Не следует использовать параметр CASCADE, если таблица будет включена в публикацию слиянием, в которой используются логические записи. Дополнительные сведения о логических записях см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
ON UPDATE { **NO ACTION** }  
 Указывает, какая операция совершается над строками в таблице, когда эти строки имеют ссылочную связь, а строка родительской таблицы, на которую указывает ссылка, обновляется. Если указано NO ACTION, то компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку и откатывает операцию обновления строки таблицы Vendor, если на нее ссылается хотя бы одна строка таблицы ProductVendor.  
  
NOT FOR REPLICATION  
 **Применимо к**: с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Может быть определено для ограничений FOREIGN KEY и CHECK. Если ограничение сопровождается этим предложением, оно не выполняется, когда агенты репликации выполняют операции вставки, обновления или удаления.  
  
CHECK  
 Ограничение, обеспечивающее целостность домена путем ограничения возможных значений, которые могут быть введены в столбец или столбцы. Ограничения CHECK в вычисляемых столбцах должны быть также помечены как PERSISTED.  
  
*logical_expression*  
 Логическое выражение, возвращающее значения TRUE или FALSE. Выражение не может содержать ссылку на псевдоним типа данных.  
  
ON { *partition_scheme_name*(*partition_column_name*) | *filegroup*| "default"}  
 **Применимо к**: с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Указывает место хранения индекса, созданного для ограничения. Если определен аргумент *partition_scheme_name*, индекс разделяется на секции, которые сопоставляются с файловыми группами, определенными аргументом *partition_scheme_name*. Если указан аргумент *filegroup*, индекс создается в файловой группе с таким именем. Если указан аргумент "default" или предложение ON не определено вообще, индекс создается в той же файловой группе, что и таблица. Если при добавлении кластеризованного индекса для ограничений PRIMARY KEY или UNIQUE указано предложение ON, то вся таблица перемещается в указанную файловую группу в момент создания этого индекса.  
  
> [!NOTE]  
>  В этом контексте default не является ключевым словом. Это идентификатор файловой группы, используемой по умолчанию, который должен быть ограничен, как например в выражении ON "default" или ON [default]. Если указано значение "default" (по умолчанию), параметр QUOTED_IDENTIFIER должен иметь значение ON для текущего сеанса. Это параметр по умолчанию. Дополнительные сведения см. в статье [SET QUOTED_IDENTIFIER (Transact-SQL)](../../t-sql/statements/set-quoted-identifier-transact-sql.md).  
  
## <a name="remarks"></a>Remarks  
 Каждое ограничение PRIMARY KEY и UNIQUE создает индекс. Число ограничений UNIQUE и PRIMARY KEY не может вызвать превышение предельного количества индексов в таблице (999 некластеризованных и 1 кластеризованный).  
  
## <a name="see-also"></a>См. также:  
 [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md)  
