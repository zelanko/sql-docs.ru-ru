---
title: ALTER AVAILABILITY GROUP (Transact-SQL) | Документы Майкрософт
ms.custom: ''
ms.date: 01/02/2018
ms.prod: sql
ms.prod_service: sql-database
ms.reviewer: ''
ms.technology: t-sql
ms.topic: language-reference
f1_keywords:
- ALTER_AVAILABILITY_GROUP_TSQL
- ALTER_AVAILABILITY_TSQL
- ALTER AVAILABILITY GROUP
- ALTER AVAILABILITY
dev_langs:
- TSQL
helpviewer_keywords:
- Availability Groups [SQL Server], availability replicas
- ALTER AVAILABILITY GROUP statement
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], Transact-SQL statements
ms.assetid: f039d0de-ade7-4aaf-8b7b-d207deb3371a
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: bcec50b2ddda2b8ddaef8135aee52cf54c1ae07b
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/15/2019
ms.locfileid: "68066032"
---
# <a name="alter-availability-group-transact-sql"></a>ALTER AVAILABILITY GROUP (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx-md](../../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Изменяет существующую группу доступности AlwaysOn в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Большинство аргументов ALTER AVAILABILITY GROUP поддерживаются только в текущей первичной реплике. Однако аргументы JOIN, FAILOVER и FORCE_FAILOVER_ALLOW_DATA_LOSS поддерживаются только во вторичных репликах.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```SQL  
  
ALTER AVAILABILITY GROUP group_name   
  {  
     SET ( <set_option_spec> )   
   | ADD DATABASE database_name   
   | REMOVE DATABASE database_name  
   | ADD REPLICA ON <add_replica_spec>   
   | MODIFY REPLICA ON <modify_replica_spec>  
   | REMOVE REPLICA ON <server_instance>  
   | JOIN  
   | JOIN AVAILABILITY GROUP ON <add_availability_group_spec> [ ,...2 ]  
   | MODIFY AVAILABILITY GROUP ON <modify_availability_group_spec> [ ,...2 ]  
   | GRANT CREATE ANY DATABASE  
   | DENY CREATE ANY DATABASE  
   | FAILOVER  
   | FORCE_FAILOVER_ALLOW_DATA_LOSS   
   | ADD LISTENER 'dns_name' ( <add_listener_option> )  
   | MODIFY LISTENER 'dns_name' ( <modify_listener_option> )  
   | RESTART LISTENER 'dns_name'  
   | REMOVE LISTENER 'dns_name'  
   | OFFLINE  
  }  
[ ; ]  
  
<set_option_spec> ::=   
    AUTOMATED_BACKUP_PREFERENCE = { PRIMARY | SECONDARY_ONLY| SECONDARY | NONE }  
  | FAILURE_CONDITION_LEVEL  = { 1 | 2 | 3 | 4 | 5 }   
  | HEALTH_CHECK_TIMEOUT = milliseconds  
  | DB_FAILOVER  = { ON | OFF }   
  | DTC_SUPPORT  = { PER_DB | NONE }  
  | REQUIRED_SYNCHRONIZED_SECONDARIES_TO_COMMIT = { integer }
  
<server_instance> ::=   
 { 'system_name[\instance_name]' | 'FCI_network_name[\instance_name]' }  
  
<add_replica_spec>::=  
  <server_instance> WITH  
    (  
       ENDPOINT_URL = 'TCP://system-address:port',  
       AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT | CONFIGURATION_ONLY },  
       FAILOVER_MODE = { AUTOMATIC | MANUAL }   
       [ , <add_replica_option> [ ,...n ] ]  
    )   
  
  <add_replica_option>::=  
       SEEDING_MODE = { AUTOMATIC | MANUAL }  
     | BACKUP_PRIORITY = n  
     | SECONDARY_ROLE ( {   
            [ ALLOW_CONNECTIONS = { NO | READ_ONLY | ALL } ]   
        [,] [ READ_ONLY_ROUTING_URL = 'TCP://system-address:port' ]  
     } )  
     | PRIMARY_ROLE ( {   
            [ ALLOW_CONNECTIONS = { READ_WRITE | ALL } ]   
        [,] [ READ_ONLY_ROUTING_LIST = { ( '<server_instance>' [ ,...n ] ) | NONE } ]  
        [,] [ READ_WRITE_ROUTING_URL = { ( '<server_instance>' ) ] 
     } )  
     | SESSION_TIMEOUT = integer
  
<modify_replica_spec>::=  
  <server_instance> WITH  
    (    
       ENDPOINT_URL = 'TCP://system-address:port'   
     | AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT }   
     | FAILOVER_MODE = { AUTOMATIC | MANUAL }   
     | SEEDING_MODE = { AUTOMATIC | MANUAL }   
     | BACKUP_PRIORITY = n  
     | SECONDARY_ROLE ( {   
          ALLOW_CONNECTIONS = { NO | READ_ONLY | ALL }   
        | READ_ONLY_ROUTING_URL = 'TCP://system-address:port'   
          } )  
     | PRIMARY_ROLE ( {   
          ALLOW_CONNECTIONS = { READ_WRITE | ALL }   
        | READ_ONLY_ROUTING_LIST = { ( '<server_instance>' [ ,...n ] ) | NONE }   
          } )  
     | SESSION_TIMEOUT = seconds  
    )   
  
<add_availability_group_spec>::=  
 <ag_name> WITH  
    (  
       LISTENER_URL = 'TCP://system-address:port',  
       AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT },  
       FAILOVER_MODE = MANUAL,  
       SEEDING_MODE = { AUTOMATIC | MANUAL }  
    )  
  
<modify_availability_group_spec>::=  
 <ag_name> WITH  
    (  
       LISTENER = 'TCP://system-address:port'  
       | AVAILABILITY_MODE = { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT }  
       | SEEDING_MODE = { AUTOMATIC | MANUAL }  
    )  
  
<add_listener_option> ::=  
   {  
      WITH DHCP [ ON ( <network_subnet_option> ) ]  
    | WITH IP ( { ( <ip_address_option> ) } [ , ...n ] ) [ , PORT = listener_port ]  
   }  
  
  <network_subnet_option> ::=  
     'ipv4_address', 'ipv4_mask'    
  
  <ip_address_option> ::=  
     {   
        'four_part_ipv4_address', 'four_part_ipv4_mask'  
      | 'ipv6_address'  
     }  
  
<modify_listener_option>::=  
    {  
       ADD IP ( <ip_address_option> )   
     | PORT = listener_port  
    }  
  
```  
  
## <a name="arguments"></a>Аргументы  
 *group_name*  
 Указывает имя новой группы доступности. Аргумент *group_name* должен быть допустимым идентификатором [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и являться уникальным во всех группах доступности в кластере WSFC.  
  
 AUTOMATED_BACKUP_PREFERENCE **=** { PRIMARY | SECONDARY_ONLY| SECONDARY | NONE }  
 Указывает приоритет, согласно которому задание резервного копирования вычисляет первичную реплику при выборе места для создания резервных копий. Вы можете написать скрипт для того, чтобы задание резервного копирования учитывало приоритет автоматического резервного копирования. Важно понимать, что [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не определяет приоритет, поэтому он не влияет на выполнение нерегламентированного резервного копирования.  
  
 Поддерживается только в первичной реплике.  
  
 Возможны следующие значения.  
  
 PRIMARY  
 Указывает, что резервное копирования должно всегда выполняться на первичной реплике. Данный параметр является полезным, если вам требуются такие функции резервного копирования, как создание разностных резервных копий, которые не поддерживаются при выполнении резервного копирования на вторичной реплике.  
  
> [!IMPORTANT]  
>  Если планируется использовать доставку журналов для подготовки баз данных-получателей для группы доступности, задайте параметру автоматизированного резервного копирования значение **Первичная** до тех пор, пока все базы данных-получатели не будут подготовлены и присоединены к группе доступности.  
  
 SECONDARY_ONLY  
 Указывает, что резервное копирование никогда не выполняется на первичной реплике. Если первичная реплика является единственной репликой, находящейся в режиме «в сети», резервное копирование не будет выполняться.  
  
 SECONDARY  
 Указывает, что резервное копирование должно выполняться на вторичной реплике, за исключением тех случаев, когда в режиме «в сети» находится только первичная реплика. В этом случае резервное копирование будет выполняться на первичной реплике. Это поведение по умолчанию.  
  
 None  
 Указывает, что вы предпочитаете, чтобы задания резервного копирования пропускали реплики доступности при выборе реплики для создания резервных копий. Примечание. Задания резервного копирования могут учитывать другие факторы, например приоритет резервного копирования каждой реплики доступности в сочетании с ее состоянием работоспособности и соединения.  
  
> [!IMPORTANT]  
>  Принудительного применения параметра AUTOMATED_BACKUP_PREFERENCE не существует. Интерпретация данного приоритета зависит от логики (при ее наличии), которая внесена в задания резервного копирования для баз данных в указанной группе доступности. Параметр автоматического резервного копирования не влияет на выполнение нерегламентированного резервного копирования. Дополнительные сведения см. в разделе [Настройка резервного копирования в репликах доступности (SQL Server)](../../database-engine/availability-groups/windows/configure-backup-on-availability-replicas-sql-server.md).  
  
> [!NOTE]  
>  Для просмотра приоритета автоматического резервного копирования существующей группы доступности необходимо выбрать столбец **automated_backup_preference** или **automated_backup_preference_desc** представления каталога [sys.availability_groups](../../relational-databases/system-catalog-views/sys-availability-groups-transact-sql.md). Кроме того, приоритет реплики резервного копирования можно просмотреть в представлении [sys.fn_hadr_backup_is_preferred_replica (Transact-SQL)](../../relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql.md).  Эта функция всегда возвращает значение 1 при наличии хотя бы одной реплики, даже если `AUTOMATED_BACKUP_PREFERENCE = NONE`.  
  
 FAILURE_CONDITION_LEVEL **=** { 1 | 2 | **3** | 4 | 5 }  
 Указывает, какие условия сбоя могут запустить автоматический переход на другой ресурс в этой группе доступности. Параметр FAILURE_CONDITION_LEVEL задается на уровне группы, однако он действует только в отношении реплик доступности, настроенных в режиме доступности синхронной фиксации (AVAILABILITY_MODE **=** SYNCHRONOUS_COMMIT). Более того, условия сбоя могут запустить автоматический переход на другой ресурс только в том случае, если и первичная, и вторичная реплики настроены на режим автоматического перехода на другой ресурс (FAILOVER_MODE **=** AUTOMATIC), при этом вторичная реплика должна в данный момент быть синхронизирована с первичной.  
  
 Поддерживается только в первичной реплике.  
  
 Уровни условий сбоя (1–5) варьируются от наименее ограничительного уровня 1 до наиболее ограничительного уровня 5. Заданный уровень условий включает в себя ограничения всех предыдущих уровней. Таким образом, наиболее строгий уровень 5 включает в себя ограничения уровней с 1 по 4, уровень 4 содержит ограничения уровней с 1 по 3 и т. д. Уровни условий сбоя описаны в следующей таблице.  
  
|Level|Условия сбоя|  
|-----------|-----------------------|  
|1|Указывает, что следует запустить автоматический переход на другой ресурс при возникновении любой из следующих ситуаций.<br /><br /> Служба [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] остановлена.<br /><br /> Аренда группы доступности для подключения к кластеру WSFC истекла, поскольку от экземпляра сервера не было получено сообщение ACK. Дополнительные сведения см. в разделе [Как это работает: время ожидания аренды Always On в SQL Server](https://blogs.msdn.com/b/psssql/archive/2012/09/07/how-it-works-sql-server-Always%20On-lease-timeout.aspx).|  
|2|Указывает, что следует запустить автоматический переход на другой ресурс при возникновении любой из следующих ситуаций.<br /><br /> Экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не подключается к кластеру, а определяемый пользователем порог HEALTH_CHECK_TIMEOUT группы доступности превышен.<br /><br /> Реплика доступности находится в неисправном состоянии.|  
|3|Указывает, что следует запустить автоматический переход на другой ресурс в случае появления критических внутренних ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], таких как потерянные спин-блокировки, серьезные нарушения доступа для записи или формирование слишком больших дампов.<br /><br /> Это поведение по умолчанию.|  
|4|Указывает, что следует запустить автоматический переход на другой ресурс в случае появления не столь серьезных внутренних ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], например устойчивое состояние нехватки памяти в пуле внутренних ресурсов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|5|Указывает, что следует запустить автоматический переход на другой ресурс при любом удовлетворяющим условиям состоянии сбоя, включая:<br /><br /> Исчерпание рабочих потоков SQL Engine.<br /><br /> Обнаружение неразрешимой взаимоблокировки.|  
  
> [!NOTE]  
>  Отсутствие ответа экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на клиентские запросы не является существенным для групп доступности.  
  
 Значения FAILURE_CONDITION_LEVEL и HEALTH_CHECK_TIMEOUT определяют *гибкую политику отработки отказа* для заданной группы. Данная гибкая политика отработки отказа предоставляет гранулярное управление условиями, которые могут вызвать автоматический переход на другой ресурс. Дополнительные сведения см. в разделе [Гибкая политика отработки отказа для автоматического перехода на другой ресурс группы доступности (SQL Server)](../../database-engine/availability-groups/windows/flexible-automatic-failover-policy-availability-group.md).  
  
 HEALTH_CHECK_TIMEOUT **=** *milliseconds*  
 Указывает время ожидания (в миллисекундах) возвращения сведений о состоянии сервера системной хранимой процедурой [sp_server_diagnostics](../../relational-databases/system-stored-procedures/sp-server-diagnostics-transact-sql.md) перед тем, как кластер WSFC признает, что экземпляр сервера завис или его работа замедлена. Параметр HEALTH_CHECK_TIMEOUT задается на уровне группы, но применяется только в репликах доступности, настроенных для работы в режиме доступности синхронной фиксации с автоматическим переходом на другой ресурс (AVAILABILITY_MODE **=** SYNCHRONOUS_COMMIT).  Более того, время ожидания для проверки состояния системы может запустить автоматический переход на другой ресурс только в том случае, если первичная и вторичная реплики настроены на режим автоматического перехода на другой ресурс (FAILOVER_MODE **=** AUTOMATIC), при этом вторичная реплика должна быть в данный момент синхронизирована с первичной.  
  
 Значение параметра HEALTH_CHECK_TIMEOUT по умолчанию — 30 000 миллисекунд (30 секунд). Минимальное значение — 15 000 миллисекунд (15 секунд), а максимальное значение — 4 294 967 295 миллисекунд.  
  
 Поддерживается только в первичной реплике.  
  
> [!IMPORTANT]  
>  **sp_server_diagnostics** не выполняет проверку работоспособности на уровне базы данных.  
  
 DB_FAILOVER **=** { ON | OFF }  
 Задает реакцию в случае, когда база данных в первичной реплике находится в автономном режиме. Если задано значение ON, любое состояние базы данных в группе доступности, отличное от ONLINE, инициирует автоматический переход на другой ресурс. Если этот параметр имеет значение OFF, для запуска автоматического перехода на другой ресурс учитывается только работоспособность экземпляра.  
 
 Дополнительные сведения об этом параметре см. в разделе [Параметр определения уровня работоспособности баз данных](../../database-engine/availability-groups/windows/sql-server-always-on-database-health-detection-failover-option.md) 

DTC_SUPPORT  **=** { PER_DB | NONE }  
Указывает, включены ли распределенные транзакции для этой группы доступности. Распределенные транзакции поддерживаются для баз данных в группе доступности только начиная с [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)], а транзакции между базами данных — начиная с [!INCLUDE[ssSQL16](../../includes/sssql15-md.md)] с пакетом обновления 2 (SP2). `PER_DB` создает группу доступности с поддержкой таких транзакций и автоматически делает транзакции между базами данных в группе доступности распределенными транзакциями. `NONE` запрещает автоматическое преобразование транзакций между базами данных в распределенные транзакции и не регистрирует базу данных с устойчивым RMID в DTC. При использовании параметра `NONE` распределенные транзакции не запрещаются, однако отработка отказа и автоматическое восстановление базы данных в некоторых условиях могут быть невозможны. Дополнительные сведения см. в статье [Транзакции между базами данных и распределенные транзакции для групп доступности AlwaysOn и зеркального отображения базы данных (SQL Server)](../../database-engine/availability-groups/windows/transactions-always-on-availability-and-database-mirroring.md). 
 
> [!NOTE]
> Поддержка изменения параметра DTC_SUPPORT для группы доступности появилась в [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] с пакетом обновления 2 (SP2). Этот параметр нельзя использовать с более ранними версиями. Чтобы изменить его в более ранних версиях [!INCLUDE[ssnoversion](../../includes/ssnoversion-md.md)], необходимо удалить (DROP), а затем снова создать (CREATE) группу доступности.
 
 REQUIRED_SYNCHRONIZED_SECONDARIES_TO_COMMIT   
 Впервые представлено в SQL Server 2017. Позволяет задать минимальное число синхронных вторичных реплик, необходимых для фиксации, прежде чем первичная реплика зафиксирует транзакцию. Гарантирует, что транзакции SQL Server будут ожидать, пока журналы транзакций не будут обновлены минимальным числом вторичных реплик. Значение по умолчанию — 0, что дает ту же реакцию на событие, как и в SQL Server 2016. Минимальное значение — 0. Максимальное значение — число реплик минус 1. Этот параметр относится к репликам в режиме синхронной фиксации. Когда реплики находятся в режиме синхронной фиксации, операции записи на первичной реплике ждут, пока операции записи на вторичных синхронных репликах не будут зафиксированы в журнале транзакций базы данных реплики. Если SQL Server, на котором размещена вторичная синхронная реплика, перестает отвечать, SQL Server, на котором размещена первичная реплика, отметит вторичную реплику как NOT SYNCHRONIZED и продолжит. Когда недоступная база данных снова подключается к сети, она будет находиться в состоянии "не синхронизировано", и реплика будет отмечена как неработоспособная, пока снова не синхронизируется с первичной репликой. Данный параметр гарантирует, что первичная реплика не продолжит работу, пока минимальное число реплик не зафиксирует каждую транзакцию. Если минимальное число реплик недоступно, фиксация в первичной реплике завершается ошибкой. В кластере типа `EXTERNAL` этот параметр меняется при добавлении группы доступности в кластерный ресурс. См. [Высокий уровень доступности и защита данных для конфигураций группы доступности](../../linux/sql-server-linux-availability-group-ha.md).
  
 ADD DATABASE *database_name*  
 Задает список из одной или нескольких пользовательских баз данных, которые нужно добавить в группу доступности. Эти базы данных должны размещаться в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], где размещается текущая первичная реплика. Можно указать несколько баз данных для группы доступности, но каждая база данных может принадлежать только к одной группе доступности. Дополнительные сведения о типе баз данных, который поддерживают группы доступности, см. в разделе [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md). Чтобы узнать, какие локальные базы данных уже принадлежат группе доступности, просмотрите столбец **replica_id** в представлении каталога [sys.databases](../../relational-databases/system-catalog-views/sys-databases-transact-sql.md).  
  
 Поддерживается только в первичной реплике.  
  
> [!NOTE]  
>  После создания группы доступности необходимо подключиться к каждому экземпляру сервера, где размещается вторичная реплика, а затем подготовить каждую базу данных-получатель и включить ее в группу доступности. Дополнительные сведения см. в статье [Запуск перемещения данных для базы данных-получателя AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/start-data-movement-on-an-always-on-secondary-database-sql-server.md).  
  
 REMOVE DATABASE *database_name*  
 Удаляет указанную базу данных-источник и соответствующие базы данных-получатели из группы доступности. Поддерживается только в первичной реплике.  
  
 Сведения о рекомендуемых действиях, выполняемых после удаления базы данных доступности из группы доступности, см. в разделе [Удаление базы данных-источника из группы доступности (SQL Server)](../../database-engine/availability-groups/windows/remove-a-primary-database-from-an-availability-group-sql-server.md).  
  
 ADD REPLICA ON  
 Задает до восьми экземпляров SQL Server для размещения вторичных реплик в группе доступности.  Каждая реплика задается по адресу экземпляра своего сервера, за которым следует предложение WITH (…).  
  
 Поддерживается только в первичной реплике.  
  
 Необходимо включить каждую новую вторичную реплику в группу доступности. Дополнительные сведения см. в описании параметра JOIN далее в этом разделе.  
  
 \<server_instance>  
 Задает адрес экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], на котором размещена реплика. Формат адреса зависит от вида экземпляра (именованный или по умолчанию) и типа экземпляра (изолированный или экземпляр отказоустойчивого кластера). Синтаксис:  
  
 { '*системное_имя*[\\*имя_экземпляра*]' | '*сетевое_имя_FCI*[\\*имя_экземпляра*]' }  
  
 Этот адрес состоит из следующих компонентов:  
  
 *системное_имя*  
 Имя NetBIOS компьютера, на котором расположен целевой экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот компьютер должен быть узлом кластера WSFC.  
  
 *сетевое_имя_FCI*  
 Это сетевое имя, используемое для доступа к отказоустойчивому кластеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Используйте его, если экземпляр сервера является участником — партнером по обеспечению отработки отказа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Выполнение SELECT [@@SERVERNAME](../../t-sql/functions/servername-transact-sql.md) на экземпляре сервера FCI возвращает всю его строку '*FCI_network_name*[\\*instance_name*]' (то есть полное имя реплики).  
  
 *instance_name*  
 Имя экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], размещенного на *system_name* или *FCI_network_name* с поддержкой AlwaysOn. Для экземпляра сервера по умолчанию указывать параметр *имя_экземпляра* не обязательно. В именах экземпляров не учитывается регистр символов. На экземпляре изолированного сервера это имя значения совпадает со значением, возвращаемым при выполнении инструкции SELECT [@@SERVERNAME](../../t-sql/functions/servername-transact-sql.md).  
  
 \  
 Разделитель, используемый только при указании значения *instance_name* для отделения от аргументов *system_name* или *FCI_network_name*.  
  
 Дополнительные сведения о предварительных требованиях для узлов WSFC и экземпляров серверов см. в статье [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
 ENDPOINT_URL ='TCP://*system-address*:*port*'  
 Задает URL-адрес для [конечной точки зеркального отображения базы данных](../../database-engine/database-mirroring/the-database-mirroring-endpoint-sql-server.md) в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], где будет размещаться реплика доступности, которая добавляется или изменяется.  
  
 ENDPOINT_URL обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON.  Дополнительные сведения см. в разделе [Указание URL-адреса конечной точки при добавлении или изменении реплики доступности (SQL Server)](../../database-engine/availability-groups/windows/specify-endpoint-url-adding-or-modifying-availability-replica.md).  
  
 **'** TCP **://** _system-address_ **:** _port_ **'**  
 Задает URL-адрес для конечной точки или URL-адрес маршрутизации, доступный только для чтения. Параметры URL-адреса:  
  
 *system-address*  
 Это строка, такая как адрес системы, полное доменное имя или IP-адрес, однозначно идентифицирующий целевую компьютерную систему.  
  
 *port*  
 Номер порта, связанный с конечной точкой зеркального отображения экземпляра сервера (для параметра ENDPOINT_URL), или номер порта, используемый компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)] в экземпляре сервера (для параметра READ_ONLY_ROUTING_URL).  
  
 AVAILABILITY_MODE **=** { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT | CONFIGURATION_ONLY }  
 Указывает, должна ли первичная реплика ждать подтверждения фиксации (записи) записей журнала на диск от вторичной реплики перед тем, как фиксировать транзакцию в указанной базе данных. Фиксация транзакций в других базах данных, расположенных в этой первичной реплике, может выполняться независимо.  
  
 SYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика может фиксировать транзакции только после их записи на данной вторичной реплике (режим синхронной фиксации). Вы можете указать SYNCHRONOUS_COMMIT не более чем для трех реплик, включая первичную.  
  
 ASYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика фиксирует транзакции без ожидания записи журнала на данной вторичной реплике (режим доступности синхронной фиксации). Вы можете указать ASYNCHRONOUS_COMMIT не более чем для пяти реплик доступности, включая первичную реплику.  

 CONFIGURATION_ONLY указывает, что первичная реплика синхронно фиксирует метаданные конфигурации группы доступности в базе данных master этой реплики. Реплика не будет содержать данные пользователя. Этот параметр:

- Может размещаться в любом выпуске SQL Server, включая экспресс-выпуск.
- Требует, чтобы конечная точка зеркального отображения данных реплики CONFIGURATION_ONLY имела тип `WITNESS`.
- Не может быть изменен.
- Недопустим, когда `CLUSTER_TYPE = WSFC`. 

   Дополнительные сведения см. в разделе [Реплика только с конфигурацией](../../linux/sql-server-linux-availability-group-ha.md).
    
 AVAILABILITY_MODE обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON. Дополнительные сведения см. в разделе [Режимы доступности (группы доступности AlwaysOn)](../../database-engine/availability-groups/windows/availability-modes-always-on-availability-groups.md).  
  
 FAILOVER_MODE **=** { AUTOMATIC | MANUAL }  
 Указывает режим отработки отказов определяемой реплики доступности.  
  
 AUTOMATIC  
 Включает автоматический переход на другой ресурс. AUTOMATIC поддерживается, только если указан параметр AVAILABILITY_MODE = SYNCHRONOUS_COMMIT. Значение AUTOMATIC можно задать для трех реплик доступности, включая первичную.  
  
> [!NOTE]  
>  До версии SQL Server 2016 число реплик с автоматическим переходом на другой ресурс было ограничено двумя, включая первичную реплику.
  
> [!NOTE]  
>  Экземпляры отказоустойчивого кластера SQL Server не поддерживают автоматический переход на другой ресурс с учетом групп доступности, поэтому любая реплика доступности, размещенная в них, должна быть настроена для перехода на другой ресурс вручную.  
  
 MANUAL  
 Позволяет администратору базы данных осуществлять переход на другой ресурс вручную или принудительно (*принудительный переход на другой ресурс*).  
  
 FAILOVER_MODE обязательно требуется в предложении ADD REPLICA ON и является необязательным в предложении MODIFY REPLICA ON. Существует два вида перехода на другой ресурс вручную: переход на другой ресурс вручную без потери данных и принудительный переход на другой ресурс (с возможной потерей данных), которые поддерживаются в зависимости от различных условий.  Дополнительные сведения см. далее в подразделе [Отработка отказа и режимы отработки отказа (группы доступности AlwaysOn)](../../database-engine/availability-groups/windows/failover-and-failover-modes-always-on-availability-groups.md).  
  
 SEEDING_MODE **=** { AUTOMATIC | MANUAL }  
 Указывает, как вторичная реплика изначально заполняется данными.  
  
 AUTOMATIC  
 Включает прямое первоначальное заполнение. Этот метод будет заполнять вторичную реплику начальными значениями по сети. Этот метод не требует резервного копирования и восстановления копии базы данных-источника в реплике.  
  
> [!NOTE]  
>  Для прямого присвоения начальных значений необходимо разрешить создание базы данных в каждой вторичной реплике с помощью инструкции **ALTER AVAILABILITY GROUP** с параметром **GRANT CREATE ANY DATABASE**.  
  
 MANUAL  
 Указывает на присвоение начальных значений вручную (по умолчанию). В этом методе вы создаете резервную копию базы данных на первичной реплике и вручную восстанавливаете эту резервную копию на вторичной реплике.  
  
 BACKUP_PRIORITY **=** _n_  
 Указывает приоритет выполнения резервного копирования на данной реплике по отношению к другим репликам из той же группы доступности. Значение представляет собой целое число в диапазоне от 0 до 100. Данные величины имеют следующие значения:  
  
-   1..100 показывает, что реплику доступности можно выбрать для выполнения резервного копирования. 1 указывает минимальный приоритет, 100 — наивысший приоритет. При BACKUP_PRIORITY = 1 реплика доступности будет выбрана для создания резервных копий только в том случае, если реплики доступности с более высоким приоритетом отсутствуют.  
  
-   Значение 0 указывает, что эта реплика доступности никогда не будет использоваться для создания резервных копий. Этот параметр может быть полезным, например, для исключения удаленной реплики доступности, создание резервных копий на которой нежелательно.  
  
 Дополнительные сведения см. в статье [Активные вторичные реплики: резервное копирование во вторичных репликах (группы доступности Always On)](../../database-engine/availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).  
  
 SECONDARY_ROLE **(** ... **)**  
 Задает параметры роли, которые будут действовать, если эта реплика доступности в данный момент имеет вторичную роль (то есть когда реплика является вторичной). В скобках укажите один или два параметра вторичной роли. Если указываются оба параметра, используйте список с разделителями-запятыми.  
  
 Параметры вторичной роли:  
  
 ALLOW_CONNECTIONS **=** { NO | READ_ONLY | ALL }  
 Указывает, могут ли базы данных заданной реплики доступности, играющей роль вторичной (т. е. служащей вторичной репликой), принимать соединения от клиентов. Может принимать одно из следующих значений:  
  
 NO  
 Для баз данных-получателей этой реплики соединения пользователя не разрешаются. Для них не разрешен доступ для чтения. Это поведение по умолчанию.  
  
 READ_ONLY  
 Разрешаются только соединения с базами данных во вторичной реплике, у которых свойство "Назначение приложения" имеет значение **ReadOnly**. Дополнительные сведения об этом свойстве см. в разделе [Using Connection String Keywords with SQL Server Native Client](../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).  
  
 ALL  
 К базам данных во вторичной реплике разрешаются все соединения на доступ только для чтения.  
  
 Дополнительные сведения см. в статье [Активные вторичные реплики: вторичные реплики для чтения (группы доступности Always On)](../../database-engine/availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md).  
  
 READ_ONLY_ROUTING_URL **='** TCP **://** _system-address_ **:** _port_ **'**  
 Указывает URL-адрес, используемый для маршрутизации запросов на соединение с намерением чтения к этой реплике доступности. Этот URL-адрес прослушивается компонентом ядра СУБД SQL Server. Обычно экземпляр по умолчанию компонента ядра СУБД SQL Server прослушивает TCP-порт 1433.  
  
 Номер порта для именованного экземпляра вы можете получить, запросив столбцы **port** и **type_desc** динамического административного представления [sys.dm_tcp_listener_states](../../relational-databases/system-dynamic-management-views/sys-dm-tcp-listener-states-transact-sql.md). Экземпляр сервера использует прослушиватель Transact-SQL (**type_desc='TSQL'** ).  
  
 Дополнительные сведения о вычислении URL-адреса маршрутизации только для чтения для реплики доступности см. в разделе [Вычисление значения read_only_routing_url для AlwaysOn](https://blogs.msdn.com/b/mattn/archive/2012/04/25/calculating-read-only-routing-url-for-Always%20On.aspx).  
  
> [!NOTE]  
>  Для именованного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] прослушиватель Transact-SQL должен быть настроен для использования определенного порта. Дополнительные сведения см. в разделе [Настройка сервера для прослушивания указанного TCP-порта (диспетчер конфигурации SQL Server)](../../database-engine/configure-windows/configure-a-server-to-listen-on-a-specific-tcp-port.md).  
  
 PRIMARY_ROLE **(** ... **)**  
 Задает параметры роли, которые будут действовать, если эта реплика доступности в данный момент имеет первичную роль (то есть когда реплика является первичной). В скобках укажите один или два параметра первичной роли. Если указываются оба параметра, используйте список с разделителями-запятыми.  
  
 Параметры первичной роли:  
  
 ALLOW_CONNECTIONS **=** { READ_WRITE | ALL }  
 Указывает тип соединений, которые принимаются от клиентов базами данных заданной реплики доступности, которая играет роль первичной. Это может быть один из следующих типов:  
  
 READ_WRITE  
 Соединения, у которых свойство "Назначение приложения" равно **ReadOnly** , не разрешены.  Если свойство «Назначение приложения» имеет значение **ReadWrite** или не задано, то соединение разрешено. Дополнительные сведения о свойстве соединения «Назначение приложения» см. в разделе [Using Connection String Keywords with SQL Server Native Client](../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).  
  
 ALL  
 Разрешаются все соединения с базами данных в первичной реплике. Это поведение по умолчанию.  
  
 READ_ONLY_ROUTING_LIST **=** { **('** \<экземпляр_сервера> **'** [ **,** ...*n* ] **)** | NONE }  
 Задает список экземпляров сервера (с разделителями-запятыми), на которых будут размещаться реплики доступности для этой группы доступности, удовлетворяющие следующим требованиям при работе во вторичной роли.  
  
-   Настроены для разрешения всех соединений или соединений только для чтения (см. выше аргумент ALLOW_CONNECTIONS параметра SECONDARY_ROLE).  
  
-   Определен URL-адрес маршрутизации только для чтения (см. выше аргумент READ_ONLY_ROUTING_URL параметра SECONDARY_ROLE).  
  
 READ_ONLY_ROUTING_LIST имеет следующие значения.  
  
 \<server_instance>  
 Задает адрес экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], где размещается вторичная реплика доступности, которая доступна для чтения при работе во вторичной роли.  
  
 Используйте список с разделителями-запятыми, чтобы указать все экземпляры сервера, где может размещаться доступная для чтения вторичная реплика. При маршрутизации только для чтения будет учитываться порядок, в котором экземпляры сервера заданы в списке. Если включить экземпляр сервера, где размещается реплика, в список маршрутизации только для чтения, то обычно рекомендуется поместить этот экземпляр сервера в конец списка, чтобы подключения с намерением чтения направлялись на вторичную реплику, если она доступна.  
  
 Начиная с версии [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] вы можете сбалансировать нагрузку запросов на чтение на вторичных репликах для чтения. Для этого поместите реплики во вложенный набор с круглыми скобками в список маршрутизации только для чтения. Дополнительные сведения и примеры см. в разделе [Настройка балансировки нагрузки между репликами только для чтения](../../database-engine/availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md#loadbalancing).  
  
 None  
 Указывает, что, когда эта реплика доступности является первичной, маршрутизация только для чтения не поддерживается. Это поведение по умолчанию. При использовании с параметром MODIFY REPLICA ON это значение отключает существующий список (если он есть).  
  
 SESSION_TIMEOUT **=** _seconds_  
 Указывает интервал времени ожидания сеанса в секундах. Если этот параметр не определить, интервал времени по умолчанию — 10 секунд. Минимальное значение составляет 5 секунд.  
  
> [!IMPORTANT]  
>  Рекомендуется установить интервал времени ожидания в 10 секунд или более.  
  
 Дополнительные сведения о периоде времени ожидания сеанса см. в разделе [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md).  
  
 MODIFY REPLICA ON  
 Изменяет любую реплику группы доступности. Список реплик для изменения содержит адрес экземпляра сервера с предложением WITH (…) для каждой реплики.  
  
 Поддерживается только в первичной реплике.  
  
 REMOVE REPLICA ON  
 Удаляет указанную вторичную реплику из группы доступности. Текущая первичная реплика не может быть удалена из группы доступности. После удаления реплика перестает получать данные. Принадлежащие ей базы данных-получатели удаляются из группы доступности и переходят в состояние RESTORING.  
  
 Поддерживается только в первичной реплике.  
  
> [!NOTE]  
>  Если удаляется недоступная или сбойная реплика, то после ее возвращения в режим «в сети» она больше не будет относиться к этой группе доступности.  
  
 JOIN  
 Приводит к созданию вторичной реплики локальным экземпляром сервера в указанной группе доступности.  
  
 Поддерживается только во вторичной реплике, которая еще не включена в группу доступности.  
  
 Дополнительные сведения см. в разделе [Присоединение вторичной реплики к группе доступности (SQL Server)](../../database-engine/availability-groups/windows/join-a-secondary-replica-to-an-availability-group-sql-server.md).  
  
 FAILOVER  
Инициирует переход группы доступности на другой ресурс вручную без потери данных с переходом на вторичную реплику, к которой вы подключились. Реплика, в которой будет размещаться первичная реплика, является *целью отработки отказа*.  Цель перехода на другой ресурс примет на себя роль первичной, восстановит собственные копии каждой базы данных и переведет их в режим «в сети» в качестве баз данных-источников. Бывшая первичная реплика параллельно переходит в роль вторичной, а ее базы данных становятся базами данных-получателями и немедленно приостанавливаются. Эти роли могут меняться местами при последовательных сбоях.  
  
 Поддерживается только во вторичной реплике с синхронной фиксацией, которая в данный момент синхронизирована с первичной репликой. Заметьте, что для синхронизации вторичной реплики первичная реплика также должна работать в режиме синхронной фиксации.  
  
> [!NOTE]  
>  Команда отработки отказа завершает работу сразу после того, как цель перехода принимает команду. Однако восстановление базы данных происходит асинхронно после того, как группа доступности закончит отработку отказа.  
  
 Сведения об ограничениях и предварительных условиях, а также рекомендации по выполнению запланированного перехода на другой ресурс вручную см. в разделе [Выполнение запланированного перехода на другой ресурс вручную для группы доступности (SQL Server)](../../database-engine/availability-groups/windows/perform-a-planned-manual-failover-of-an-availability-group-sql-server.md).  
  
 FORCE_FAILOVER_ALLOW_DATA_LOSS  
 > [!CAUTION]  
>  Принудительная обработка отказа, которая может привести к потере некоторых данных, используется исключительно в качестве метода аварийного восстановления. Поэтому настоятельно рекомендуется выполнять принудительную отработку отказа только в том случае, если первичная реплика не выполняется и можно пойти на риск потери данных, а также когда требуется срочно восстановить группу доступности.  
  
 Поддерживается только в реплике, роль которой находится в состоянии SECONDARY или RESOLVING. --Реплика, на которой вводится команда обработки отказа, называется *целью перехода на другой ресурс*.  
  
 Принудительная обработка отказа группы доступности с возможной потерей данных и переходом на другой указанный ресурс. Цель перехода на другой ресурс примет на себя роль первичной, восстановит собственные копии каждой базы данных и переведет их в режим «в сети» в качестве баз данных-источников. Во всех оставшихся вторичных репликах все базы данных-получатели будут приостановлены до их возобновления вручную. Если бывшая первичная реплика станет доступной, она переключится в роль вторичной; ее базы данных станут базами данных-получателями и будут приостановлены.  
  
> [!NOTE]  
>  Команда отработки отказа завершает работу сразу после того, как цель перехода принимает команду. Однако восстановление базы данных происходит асинхронно после того, как группа доступности закончит отработку отказа.  
  
 Дополнительные сведения об ограничениях, обязательных условиях и рекомендациях для принудительной отработки отказа, а также о влиянии принудительной отработки отказа на прежние базы данных-источники в группе доступности см. в разделе [Выполнение принудительного перехода на другой ресурс вручную для группы доступности (SQL Server)](../../database-engine/availability-groups/windows/perform-a-forced-manual-failover-of-an-availability-group-sql-server.md).  
  
 ADD LISTENER **'** _dns\_name_ **'(** \<add_listener_option> **)**  
 Определяет новый прослушиватель группы доступности. Поддерживается только в первичной реплике.  
  
> [!IMPORTANT]
>  Перед созданием первого прослушивателя настоятельно рекомендуется ознакомиться со статьей [Создание или настройка прослушивателя группы доступности (SQL Server)](../../database-engine/availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).  
> 
>  После создания прослушивателя для заданной группы доступности настоятельно рекомендуется выполнить следующие действия.  
> 
>  -   Попросите сетевого администратора зарезервировать IP-адрес, который будет использоваться только этим прослушивателем.  
> -   Передайте имя узла DNS прослушивателя разработчикам приложения для использования в строке подключения при запросе клиентских соединений к данной группе доступности.  
  
 *dns_name*  
 Указывает имя узла DNS для прослушивателя группы доступности. Имя DNS прослушивателя должно быть уникальным в домене и в NetBIOS.  
  
 *dns_name* является строковым значением. Это имя может содержать только буквы, цифры, дефисы (-) и знаки подчеркивания (_) в любом порядке. В именах узлов DNS учитывается регистр. Максимальная длина равна 63 символам.  
  
 Мы рекомендуем указывать строку, которая поддается толкованию. Например, для группы доступности с именем `AG1`понятным именем узла DNS будет `ag1-listener`.  
  
> [!IMPORTANT]  
>  NetBIOS распознает только первые 15 символов в dns_name. При наличии двух кластеров WSFC, которые управляются одной службой Active Directory, и попытке создать в обоих кластерах прослушивателей группы доступности с именами, содержащими более 15 символов, и одинаковым префиксом из 15 символов возникнет ошибка, указывающая, что не удалось подключиться к ресурсу с именем виртуальной сети. Дополнительные сведения о правилах именования префиксов для имен DNS см. в разделе [Присвоение имен доменов](https://technet.microsoft.com/library/cc731265\(WS.10\).aspx).  
  
 JOIN AVAILABILITY GROUP ON  
 Присоединение к *распределенной группе доступности*. Когда вы создаете распределенную группу доступности, группа доступности в кластере, где она создана, является первичной группой доступности. Группа доступности, которая соединяется с распределенной группой доступности, является вторичной группой доступности.  
  
 \<ag_name>  
 Указывает имя группы доступности, составляющей половину распределенной группы доступности.  
  
 LISTENER **='** TCP **://** _system-address_ **:** _port_ **'**  
 Указывает URL-адрес пути для прослушивателя, связанного с группой доступности.  
  
 Требуется предложение LISTENER.  
  
 **'** TCP **://** _system-address_ **:** _port_ **'**  
 Указывает URL-адрес для прослушивателя, связанного с группой доступности. Параметры URL-адреса:  
  
 *system-address*  
 Это строка, такая как имя системы, полное доменное имя или IP-адрес, однозначно идентифицирующая прослушивателя.  
  
 *port*  
 Номер порта, связанный с конечной точкой зеркального отображения группы доступности. Это не порт прослушивателя.  
  
 AVAILABILITY_MODE **=** { SYNCHRONOUS_COMMIT | ASYNCHRONOUS_COMMIT }  
 Указывает, должна ли первичная реплика ждать подтверждения фиксации (записи) записей журнала на диск от вторичной группы доступности перед тем, как фиксировать транзакцию в указанной базе данных.  
  
 SYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика может фиксировать транзакции только после их записи во вторичной группе доступности. Вы можете указать SYNCHRONOUS_COMMIT не более чем для двух групп доступности, включая первичную группу доступности.  
  
 ASYNCHRONOUS_COMMIT  
 Указывает, что первичная реплика фиксирует транзакции без ожидания записи журнала от вторичной группы доступности. Вы можете указать ASYNCHRONOUS_COMMIT не более чем для двух групп доступности, включая первичную группу доступности.  
  
 Предложение AVAILABILITY_MODE является обязательным.  
  
 FAILOVER_MODE **=** { MANUAL }  
 Указывает режим отработки отказа распределенной группы доступности.  
  
 MANUAL  
 Позволяет администратору базы данных осуществлять переход на другой ресурс вручную по плану или принудительно (обычно это называется *принудительным переходом на другой ресурс*).  
  
 Во вторичной группе доступности автоматический переход на другой ресурс не поддерживается.  
  
 SEEDING_MODE **=** { AUTOMATIC | MANUAL }  
 Указывает, как вторичная группа доступности изначально заполняется данными.  
  
 AUTOMATIC  
 Включает автоматическое заполнение. Этот метод будет заполнять вторичную группу доступности начальными значениями по сети. Этот метод не требует резервного копирования и восстановления копии базы данных-источника в репликах вторичной группы доступности.  
  
 MANUAL  
 Задает присвоение начальных значений вручную. В этом методе вы создаете резервную копию базы данных на первичной реплике и вручную восстанавливаете эту резервную копию на репликах вторичной группы доступности.  
  
 MODIFY AVAILABILITY GROUP ON  
 Изменяет параметры группы доступности в распределенной группе доступности. Список групп доступности для изменения содержит имя группы доступности и предложение WITH (…) для каждой группы доступности.  
  
> [!IMPORTANT]  
>  Эту команду необходимо повторить для первичной группы доступности и экземпляров вторичной группы доступности.  
  
 GRANT CREATE ANY DATABASE  
 Позволяет группе доступности создавать базы данных от имени первичной реплики, которая поддерживает прямое присвоение начальных значений (SEEDING_MODE = AUTOMATIC). Этот параметр следует запускать на каждой вторичной реплике, которая поддерживает прямое присвоение начальных значений, после того, как эта вторичная реплика присоединится к группе доступности.  Требуется разрешение CREATE ANY DATABASE.  
  
 DENY CREATE ANY DATABASE  
 Удаляет возможность группы доступности создавать базы данных от имени первичной реплики.  
  
 \<add_listener_option>  
 ADD LISTENER принимает один из следующих параметров.  
  
 WITH DHCP [ ON { **('** _four\_part\_ipv4\_address_ **','** _four\_part\_ipv4\_mask_ **')** } ]  
 Указывает, что прослушиватель группы доступности будет использовать протокол DHCP.  Дополнительно можно использовать предложение ON, чтобы определить сеть, для которой будет создан прослушиватель. Протокол DHCP имеет ограничение на работу только с одной подсетью для каждого экземпляра сервера, на котором размещается реплика доступности в группе доступности.  
  
> [!IMPORTANT]  
>  Использовать протокол DHCP в производственной среде не рекомендуется. Если во время простоя аренда IP-адреса протокола DHCP истечет, то на регистрацию нового сетевого IP-адреса протокола DHCP, связанного с именем DNS-прослушивателя, уйдет дополнительное время, что скажется на производительности клиента. Однако протокол DHCP полезен при настройке среды разработки и проверки и позволяет проверить базовые функции групп доступности и их интеграцию с приложениями.  
  
 Пример:  
  
 `WITH DHCP ON ('10.120.19.0','255.255.254.0')`  
  
 WITH IP **(** { **('** _four\_part\_ipv4\_address_ **','** _four\_part\_ipv4\_mask_ **')**  |  **('** _ipv6\_address_ **')** } [ **,** ..._n_ ] **)** [ **,** PORT **=** _listener\_port_ ]  
 Указывает, что вместо использования протокола DHCP прослушиватель группы доступности будет использовать один или несколько статических IP-адресов. Чтобы создать группу доступности, охватывающую несколько подсетей, в конфигурации прослушивателя должен присутствовать один статический IP-адрес для каждой подсети. Для конкретной подсети статический IP-адрес может иметь формат IPv4 или IPv6. Свяжитесь с администратором сети, чтобы получить статический IP-адрес для каждой подсети, в которой будет размещена реплика доступности для новой группы доступности.  
  
 Пример:  
  
 `WITH IP ( ('10.120.19.155','255.255.254.0') )`  
  
 *ipv4_address*  
 Задает IPv4-адрес, состоящий из четырех частей, для прослушивателя группы доступности. Например, `10.120.19.155`.  
  
 *ipv4_mask*  
 Задает IPv4-маску, состоящую из четырех частей, для прослушивателя группы доступности. Например, `255.255.254.0`.  
  
 *ipv6_address*  
 Задает IPv6-адрес для прослушивателя группы доступности. Например, `2001::4898:23:1002:20f:1fff:feff:b3a3`.  
  
 PORT **=** *listener_port*  
 Указывает номер порта *listener_port* для использования прослушивателем группы доступности, который задается предложением WITH IP. Параметр PORT является необязательным.  
  
 По умолчанию поддерживается номер порта 1433. Однако из соображений безопасности, рекомендуется использовать другой номер порта.  
  
 Например: `WITH IP ( ('2001::4898:23:1002:20f:1fff:feff:b3a3') ) , PORT = 7777`.  
  
 MODIFY LISTENER **'** _dns\_name_ **'(** \<modify\_listener\_option\> **)**  
 Изменяет существующий прослушиватель для данной группы доступности. Поддерживается только в первичной реплике.  
  
 \<modify\_listener\_option\>  
 MODIFY LISTENER принимает один из следующих параметров:  
  
 ADD IP { **('** _four\_part\_ipv4\_address_ **','** _four\_part\_ipv4_mask_ **')** \| <b>('</b>dns\_name*ipv6\_address* __')__ }  
 Добавляет указанный IP-адрес к прослушивателю группы доступности, который задан с помощью *dns\_name*.  
  
 PORT **=** *listener_port*  
 См. описание этого аргумента ранее в этом разделе.  
  
 RESTART LISTENER **'** _dns\_name_ **'**  
 Перезапускает прослушиватель, который связан с указанным именем DNS. Поддерживается только в первичной реплике.  
  
 REMOVE LISTENER **'** _dns\_name_ **'**  
 Удаляет прослушиватель, который связан с указанным именем DNS. Поддерживается только в первичной реплике.  
  
 OFFLINE  
 Переводит группу доступности из режима «в сети» в режим «вне сети». У баз данных с синхронной фиксацией потеря данных невозможна.  
  
 После перехода группы доступности в режим «вне сети» ее базы данных становятся недоступными для клиентов, и невозможно перевести группу доступности обратно в режим «в сети». Таким образом, используйте параметр OFFLINE только во время миграции с [!INCLUDE[ssHADR](../../includes/sshadr-md.md)] при переносе группы доступности на другой ресурс кластера WSFC.  
  
 Дополнительные сведения см. в статье [Перевод группы доступности в режим "вне сети" (SQL Server)](../../database-engine/availability-groups/windows/take-an-availability-group-offline-sql-server.md).  
  
## <a name="prerequisites-and-restrictions"></a>Требования и ограничения  
 Сведения о других условиях и ограничениях для реплик доступности и их экземпляров сервера и компьютеров см. в разделе [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
 Сведения об ограничениях на инструкции AVAILABILITY GROUP языка Transact-SQL см. в разделе [Общие сведения об инструкциях Transact-SQL для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/transact-sql-statements-for-always-on-availability-groups.md).  
  
## <a name="security"></a>безопасность  
  
### <a name="permissions"></a>Разрешения  
 Необходимо разрешение ALTER AVAILABILITY GROUP для группы доступности, разрешение CONTROL AVAILABILITY GROUP, разрешение ALTER ANY AVAILABILITY GROUP или разрешение CONTROL SERVER.  Кроме того, требуется разрешение ALTER ANY DATABASE.   
  
## <a name="examples"></a>Примеры  
  
###  <a name="Join_Secondary_Replica"></a> A. Присоединение вторичной реплики к группе доступности  
 В следующем примере рассматривается присоединение вторичной реплики, с которой установлено соединение, к группе доступности `AccountsAG`.  
  
```SQL  
ALTER AVAILABILITY GROUP AccountsAG JOIN;  
GO  
```  
  
###  <a name="Force_Failover"></a> Б. Принудительный переход на другой ресурс группы доступности  
 В следующем примере выполняется принудительный переход группы доступности `AccountsAG` на вторичную реплику, с которой установлено соединение.  
  
```SQL
ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
GO  
```  
  
## <a name="see-also"></a>См. также:  
 [CREATE AVAILABILITY GROUP (Transact-SQL)](../../t-sql/statements/create-availability-group-transact-sql.md)   
 [ALTER DATABASE SET HADR (Transact-SQL)](../../t-sql/statements/alter-database-transact-sql-set-hadr.md)   
 [DROP AVAILABILITY GROUP (Transact-SQL)](../../t-sql/statements/drop-availability-group-transact-sql.md)   
 [sys.availability_replicas (Transact-SQL)](../../relational-databases/system-catalog-views/sys-availability-replicas-transact-sql.md)   
 [sys.availability_groups (Transact-SQL)](../../relational-databases/system-catalog-views/sys-availability-groups-transact-sql.md)   
 [Поиск и устранение неисправностей конфигурации групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/troubleshoot-always-on-availability-groups-configuration-sql-server.md)   
 [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md)   
 [Прослушиватели групп доступности, возможность подключения клиентов и отработка отказа приложений (SQL Server)](../../database-engine/availability-groups/windows/listeners-client-connectivity-application-failover.md)  
  
  
