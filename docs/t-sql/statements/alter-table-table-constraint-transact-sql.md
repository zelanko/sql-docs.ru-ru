---
title: table_constraint (Transact-SQL) | Документы Майкрософт
ms.custom: ''
ms.date: 09/11/2018
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: t-sql
ms.topic: language-reference
f1_keywords:
- CONSTRAINT_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- table_constraint
ms.assetid: ac2a11e0-cc77-4e27-b107-4fe5bc6f5195
author: VanMSFT
ms.author: vanto
manager: craigg
ms.openlocfilehash: ef0833709d409e7393d71a402b823375b895fb2a
ms.sourcegitcommit: c6e71ed14198da67afd7ba722823b1af9b4f4e6f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/16/2019
ms.locfileid: "54327396"
---
# <a name="alter-table-tableconstraint-transact-sql"></a>ALTER TABLE table_constraint (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2008-asdb-xxxx-xxx-md.md)]

  Задает свойства ограничений PRIMARY KEY, UNIQUE, FOREIGN KEY или CHECK, а также определений DEFAULT, добавленных в таблицу с помощью инструкции [ALTER TABLE](../../t-sql/statements/alter-table-transact-sql.md).  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
[ CONSTRAINT constraint_name ]   
{   
    { PRIMARY KEY | UNIQUE }   
        [ CLUSTERED | NONCLUSTERED ]   
        (column [ ASC | DESC ] [ ,...n ] )  
        [ WITH FILLFACTOR = fillfactor   
        [ WITH ( <index_option>[ , ...n ] ) ]  
        [ ON { partition_scheme_name ( partition_column_name ... )  
          | filegroup | "default" } ]   
    | FOREIGN KEY   
        ( column [ ,...n ] )  
        REFERENCES referenced_table_name [ ( ref_column [ ,...n ] ) ]   
        [ ON DELETE { NO ACTION | CASCADE | SET NULL | SET DEFAULT } ]   
        [ ON UPDATE { NO ACTION | CASCADE | SET NULL | SET DEFAULT } ]   
        [ NOT FOR REPLICATION ]   
    | CONNECTION
        ( { node_table TO node_table } 
          [ , {node_table TO node_table }]
          [ , ...n ]
        )
        [ ON DELETE NO ACTION]
    | DEFAULT constant_expression FOR column [ WITH VALUES ]   
    | CHECK [ NOT FOR REPLICATION ] ( logical_expression )  
}  
```  
  
## <a name="arguments"></a>Аргументы  
 CONSTRAINT  
 Указывает начало определения ограничений PRIMARY KEY, UNIQUE, FOREIGN KEY и CHECK, а также предложения DEFAULT.  
  
 *constraint_name*  
 Имя ограничения. Имена ограничений должны подчиняться правилам для [идентификаторов](../../relational-databases/databases/database-identifiers.md), за исключением тех, которые не могут начинаться с символа решетки (#). Если аргумент constraint_name не указан, то ограничению присваивается имя, формируемое системой.  
  
 PRIMARY KEY  
 Ограничение, выполняющее принудительную проверку целостности сущностей для указанного столбца или столбцов при использовании уникального индекса. Для каждой таблицы может быть создано только одно ограничение PRIMARY KEY.  
  
 UNIQUE  
 Ограничение, обеспечивающее целостность сущностей для указанного столбца или столбцов при использовании уникального индекса.  
  
 CLUSTERED | NONCLUSTERED  
 Указывает, что для ограничения PRIMARY KEY или UNIQUE создается кластеризованный или некластеризованный индекс. По умолчанию ограничения PRIMARY KEY имеют значение CLUSTERED. По умолчанию ограничения UNIQUE имеют значение NONCLUSTERED.  
  
 Если кластеризованное ограничение или индекс уже созданы в таблице, значение CLUSTERED не может быть задано. Если кластеризованное ограничение или индекс уже существует в таблице, ограничения PRIMARY KEY по умолчанию имеют значение NONCLUSTERED.  
  
 Столбцы с типами данных **ntext**, **text**, **varchar(max)**, **nvarchar(max)**, **varbinary(max)**, **xml** или **image** нельзя указать в качестве столбцов для индекса.  
  
 *column*  
 Столбец или список столбцов в скобках, используемые в новом ограничении.  
  
 [ **ASC** | DESC ]  
 Указывает порядок сортировки столбца или столбцов, участвующих в ограничениях таблицы. Значение по умолчанию — ASC.  
  
 WITH FILLFACTOR **=**_fillfactor_  
 Указывает, насколько полно компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] должен заполнять каждую страницу индекса, используемую для хранения индексных данных. Пользовательские значения аргумента *fillfactor* могут быть в диапазоне от 1 до 100. Если значение не задано, по умолчанию принимается значение 0.  
  
> [!IMPORTANT]  
>  Описание выражения WITH FILLFACTOR = *fillfactor* как единственного параметра индекса, применимого к ограничениям PRIMARY KEY или UNIQUE, сохранено для обеспечения обратной совместимости, но в будущих выпусках это выражение документировано не будет. Другие параметры индекса можно указать в предложении [index_option](../../t-sql/statements/alter-table-index-option-transact-sql.md) инструкции ALTER TABLE.  
  
 ON { _partition\_scheme\_name_**(**_partition\_column\_name_**)** | _filegroup_| **"** default **"** }  
 **Применимо к**: с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Указывает место хранения индекса, созданного для ограничения. Если определен аргумент *partition_scheme_name*, индекс разделяется на секции, которые сопоставляются с файловыми группами, определенными аргументом *partition_scheme_name*. Если указан аргумент *filegroup*, индекс создается в файловой группе с таким именем. Если указан аргумент **"** default **"** или предложение ON не определено вообще, индекс создается в той же файловой группе, что и таблица. Если при добавлении кластеризованного индекса для ограничений PRIMARY KEY или UNIQUE указано предложение ON, то вся таблица перемещается в указанную файловую группу в момент создания этого индекса.  
  
 В данном контексте слово "default" не является ключевым словом; это идентификатор файловой группы по умолчанию, который должен быть ограничен специальными символами, как в выражениях ON **"** default **"** или ON **[** default **]**. Если указано значение **"** default **"**, то параметру QUOTED_IDENTIFIER для текущего сеанса должно быть присвоено значение ON. Это параметр по умолчанию.  
  
 FOREIGN KEY REFERENCES  
 Ограничение, обеспечивающее ссылочную целостность данных в столбце. Ограничения FOREIGN KEY требуют, чтобы любое значение в столбце обязательно существовало в указанном столбце ссылочной таблицы.  
  
 *referenced_table_name*  
 Таблица, на которую ссылается ограничение FOREIGN KEY.  
  
 *ref_column*  
 Столбец или список столбцов в скобках, на которые ссылается новое ограничение FOREIGN KEY.  
  
 ON DELETE { **NO ACTION** | CASCADE | SET NULL | SET DEFAULT }  
 Указывает, какое действие производится над строками изменяемой таблицы, если эти строки имеют ссылочную связь, и строка, на которую имеется ссылка, удаляется из родительской таблицы. Параметр по умолчанию — NO ACTION.  
  
 NO ACTION  
 Компонент [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] формирует ошибку, и выполняется откат операции удаления строки из родительской таблицы.  
  
 CASCADE  
 Если из родительской таблицы удаляется строка, соответствующие ей строки удаляются и из ссылающейся таблицы.  
  
 SET NULL  
 Все значения, составляющие внешний ключ, при удалении соответствующей строки родительской таблицы устанавливаются в значение NULL. Для выполнения этого ограничения внешние ключевые столбцы должны допускать значения NULL.  
  
 SET DEFAULT  
 Все значения, содержащие внешний ключ, при удалении соответствующей строки родительской таблицы устанавливаются в значения по умолчанию. Для выполнения этого ограничения все внешние ключевые столбцы должны иметь определения по умолчанию. Если столбец допускает значения NULL и значение по умолчанию явно не определено, значением столбца по умолчанию становится NULL.  
  
 Не следует использовать параметр CASCADE, если таблица будет включена в публикацию слиянием, в которой используются логические записи. Дополнительные сведения о логических записях см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
 Действие ON DELETE CASCADE не может быть определено, если в изменяемой таблице уже существует триггер INSTEAD OF ON DELETE.  
  
 Например, в базе данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] таблица **ProductVendor** имеет ссылочную связь с таблицей **Vendor**. Внешний ключ **ProductVendor.VendorID** ссылается на первичный ключ **Vendor.VendorID**.  
  
 Если для строки в таблице **Vendor** выполняется инструкция DELETE, а для **ProductVendor.VendorID** указано действие ON DELETE CASCADE, то компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] проверяет наличие одной или нескольких зависимых строк в таблице **ProductVendor**. Если они существуют, то, кроме строки в таблице **Vendor**, будут удалены также и все зависимые строки в таблице **ProductVendor**.  
  
 В противном случае, если задано значение NO ACTION, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] вызывает ошибку и откатывает действие по удалению строки в таблице **Vendor**, если хотя бы одна строка в таблице **ProductVendor** ссылается на нее.  
  
 ON UPDATE { **NO ACTION** | CASCADE | SET NULL | SET DEFAULT }  
 Указывает, какое действие совершается над строками в изменяемой таблице, когда эти строки имеют ссылочную связь и строка родительской таблицы, на которую указывает ссылка, обновляется. Параметр по умолчанию — NO ACTION.  
  
 NO ACTION  
 Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] возвращает ошибку, а обновление строки родительской таблицы откатывается.  
  
 CASCADE  
 Соответствующие строки обновляются в ссылающейся таблице, если эта строка обновляется в родительской таблице.  
  
 SET NULL  
 Всем значениям, составляющим внешний ключ, присваивается значение NULL, когда обновляется соответствующая строка в родительской таблице. Для выполнения этого ограничения внешние ключевые столбцы должны допускать значения NULL.  
  
 SET DEFAULT  
 Всем значениям, составляющим внешний ключ, присваивается их значение по умолчанию, когда обновляется соответствующая строка в родительской таблице. Для выполнения этого ограничения все внешние ключевые столбцы должны иметь определения по умолчанию. Если столбец допускает значения NULL и значение по умолчанию явно не определено, значением столбца по умолчанию становится NULL.  
  
 Не следует использовать параметр CASCADE, если таблица будет включена в публикацию слиянием, в которой используются логические записи. Дополнительные сведения о логических записях см. в статье [Группирование изменений в связанных строках с помощью логических записей](../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
 Действия ON UPDATE CASCADE, SET NULL и SET DEFAULT не могут быть определены, если в изменяемой таблице уже существует триггер INSTEAD OF для условия ON UPDATE.  
  
 Например, в базе данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] таблица **ProductVendor** имеет ссылочную связь с таблицей **Vendor**. Внешний ключ **ProductVendor.VendorID** ссылается на первичный ключ **Vendor.VendorID**.  
  
 Если при выполнении инструкции UPDATE для строки в таблице **Vendor** указано ON UPDATE CASCADE для столбца **ProductVendor.VendorID**, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] проверяет наличие одной или нескольких зависимых строк в таблице **ProductVendor**. Если они существуют, то, кроме строки, в таблице **Vendor** будет изменена также и зависимая строка в таблице **ProductVendor**.  
  
 Если же указано NO ACTION, компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] инициирует ошибку и откатывает операцию обновления строки таблицы **Vendor**, если на нее ссылается хотя бы одна строка из таблицы **ProductVendor**.  
  
 NOT FOR REPLICATION  
 **Применимо к**: с [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] до [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 Может быть определено для ограничений FOREIGN KEY и CHECK. Если ограничение сопровождается этим предложением, оно не выполняется, когда агенты репликации выполняют операции вставки, обновления или удаления.  

 CONNECTION Указывает пару таблиц узлов, соединение которых разрешает определенное ограничение ребер.  
 
 DEFAULT  
 Задает значение по умолчанию для столбца. Определения DEFAULT могут использоваться для указания значений по умолчанию для новых столбцов в существующих строках данных. Определения DEFAULT нельзя добавлять к столбцам, которые содержат данные типа **timestamp**, обладают свойством IDENTITY, существующим определением DEFAULT, или в том случае, если для них задано значение по умолчанию. Если для столбца задано значение по умолчанию, необходимо удалить его перед заданием нового умолчания. Если значение по умолчанию указывается для столбца определяемого пользователем типа, этот тип должен поддерживать неявное преобразование выражения *constant_expression* в определяемый пользователем тип. Для сохранения совместимости с более ранними версиями сервера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] значению DEFAULT может быть присвоено имя ограничения.  
  
 *constant_expression*  
 Символьное значение, NULL или системная функция, используемая в качестве значения столбца по умолчанию. Если *constant_expression* используется в сочетании со столбцом определяемого пользователем типа [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)], то реализация типа должна поддерживать неявное преобразование выражения *constant_expression* в определяемый пользователем тип.  
  
 FOR *column*  
 Определяет столбец, связанный с определением DEFAULT уровня таблицы.  
  
 WITH VALUES  
 При добавлении столбца AND ограничение DEFAULT, если столбец допускает значения NULL с использованием WITH VALUES, задает для существующих строк значение нового столбца в качестве значения, указанного в DEFAULT *constant_expression*. Если добавляемый столбец не допускает значения NULL, для существующих строк значение столбца всегда будет присваиваться в качестве значения, предоставляемого в DEFAULT *constant expression*. Начиная с SQL Server 2012, может использоваться операция с метаданными [adding-not-null-columns-as-an-online-operation](alter-table-transact-sql.md?view=sql-server-2017#adding-not-null-columns-as-an-online-operation).
При использовании в ситуации, когда связанный столбец не добавляется, никакого эффекта не будет. 
  
 CHECK  
 Ограничение, обеспечивающее целостность домена путем ограничения возможных значений, которые могут быть введены в столбец или столбцы.  
  
 *logical_expression*  
 Логическое выражение, используемое в ограничении CHECK и возвращающее значения TRUE или FALSE. Аргумент *logical_expression*, используемый в ограничениях CHECK, не может содержать ссылок на другие таблицы, но может ссылаться на другие столбцы той же таблицы в той же строке. Выражение не может ссылаться на псевдоним типа данных.  
  
## <a name="remarks"></a>Примечания  
 При добавлении новых ограничений FOREIGN KEY или CHECK все существующие данные проверяются на соответствие ограничениям, если не указан параметр WITH NOCHECK. В том случае, если обнаруживаются нарушения, выполнение ALTER TABLE завершается с ошибкой. При добавлении к существующему столбцу ограничений PRIMARY KEY или UNIQUE все данные в столбце должны быть уникальны. Если будут обнаружены повторяющиеся значения, ALTER TABLE завершится неудачно. При добавлении ограничения PRIMARY KEY или UNIQUE наличие параметра WITH NOCHECK не имеет значения.  
  
 Каждое ограничение PRIMARY KEY и UNIQUE создает индекс. Число ограничений UNIQUE и PRIMARY KEY не может вызвать превышение предельного количества индексов в таблице (999 некластеризованных и 1 кластеризованный). Ограничения внешнего ключа не вызывают автоматического создания индекса. Однако столбцы внешних ключей часто используются в критериях соединения запросов посредством сопоставления столбца или столбцов из ограничения внешнего ключа одной таблицы со столбцом или столбцами первичного или уникального ключей в другой таблице. Индекс по столбцам таблицы внешнего ключа позволяет компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)] быстро находить связанные данные в таблице внешних ключей.  
  
## <a name="examples"></a>Примеры  
 Примеры см. в статье [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md).  
  
## <a name="see-also"></a>См. также:  
 [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md)  
  
  
