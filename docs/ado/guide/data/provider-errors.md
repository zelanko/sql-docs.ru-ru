---
description: Ошибки поставщика
title: Ошибки поставщика | Документация Майкрософт
ms.prod: sql
ms.prod_service: connectivity
ms.technology: connectivity
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- errors collection [ADO]
- provider errors [ADO]
- event-related errors [ADO]
- errors [ADO], provider
- Error object [ADO], provider errors
ms.assetid: cc7d6ff9-2034-45c6-9d61-90b177010054
author: rothja
ms.author: jroth
ms.openlocfilehash: 9588ddddf094f391f442dd7ad9c4172cce70970e
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88453026"
---
# <a name="provider-errors"></a>Ошибки поставщика
При возникновении ошибки поставщика возвращается ошибка времени выполнения-2147467259. При возникновении этой ошибки проверьте коллекцию **Errors** объекта Active **Connection** , которая будет содержать одну или несколько ошибок, описывающих произошедшее.  
  
## <a name="the-ado-errors-collection"></a>Коллекция ошибок ADO  
 Поскольку конкретная операция ADO может вызвать несколько ошибок поставщика, ADO предоставляет коллекцию объектов Error через объект **Connection** . Эта коллекция не содержит объектов, если операция завершается успешно и содержит один или несколько объектов **ошибок** , если что-то пошло не так, а поставщик вызвал одну или несколько ошибок. Изучите каждый объект Error, чтобы определить точную причину ошибки.  
  
 Как только вы завершите обработку всех произошедших ошибок, можно очистить коллекцию, вызвав метод **clear** . Особенно важно явно очищать коллекцию **ошибок** перед вызовом метода **Resync**, **UpdateBatch**или **CancelBatch** для объекта **набора записей** , метода **Open** для объекта **Connection** или установки свойства **фильтра** для объекта **набора записей** . Если очистить коллекцию явным образом, можно убедиться, что все объекты **ошибок** в коллекции не остались после предыдущей операции.  
  
 Некоторые операции могут создавать предупреждения в дополнение к ошибкам. Предупреждения также представлены объектами **Error** в коллекции **Errors** . Когда поставщик добавляет предупреждение в коллекцию, он не создает ошибку во время выполнения. Проверьте свойство **Count** коллекции **ошибок** , чтобы определить, было ли предупреждение создано определенной операцией. Если число равно единице или больше, то в коллекцию был добавлен объект **Error** . Как только вы определили, что коллекция **Errors** содержит ошибки или предупреждения, можно выполнить итерацию по коллекции и получить сведения о каждом объекте **ошибки** , который он содержит. Это показано в следующем кратком Visual Basic примере:  
  
```  
' BeginErrorHandlingVB02  
Private Function DeleteCustomer(ByVal CompanyName As String) As Long  
    On Error GoTo DeleteCustomerError  
  
    rst.Find "CompanyName='" & CompanyName & "'"  
DeleteCustomerError:  
Dim objError As ADODB.Error  
Dim strError As String  
  
    If cnn.Errors.Count > 0 Then  
        For Each objError In cnn.Errors  
            strError = strError & "Error #" & objError.Number & _  
                " " & objError.Description & vbCrLf & _  
                "NativeError: " & objError.NativeError & vbCrLf & _  
                "SQLState: " & objError.SQLState & vbCrLf & _  
                "Reported by: " & objError.Source & vbCrLf & _  
                "Help file: " & objError.HelpFile & vbCrLf & _  
                "Help Context ID: " & objError.HelpContext  
        Next  
        MsgBox strError  
    End If  
End Function  
' EndErrorHandlingVB02  
```  
  
 Подпрограммы обработки ошибок включают цикл **for each** , который проверяет каждый объект в коллекции **ошибок** . В этом примере он накапливает сообщение для вывода. В работающей программе следует написать код для выполнения соответствующей задачи для каждой ошибки, например закрыть все открытые файлы и завершить работу программы упорядоченно.  
  
## <a name="the-error-object"></a>Объект Error  
 Изучив объект **ошибки** , можно определить, какая ошибка произошла, и что важнее, какое приложение или какой объект привел к ошибке. Объект **Error** имеет следующие свойства:  
  
|Имя свойства|Описание|  
|-------------------|-----------------|  
|**Описание**|Текстовое описание произошедшей ошибки.|  
|**HelpContext, HelpFile**|Ссылается на раздел справки и файл справки, содержащий описание возникшей ошибки.|  
|**NativeError**|Номер ошибки, зависящей от поставщика.|  
|**Число**|Длинное целое число, представляющее количество (указанное в **еррорвалуинум**) возникшей ошибки.|  
|**Source**|Указывает имя объекта или приложения, вызвавшего ошибку.|  
|**SQLState**|Код ошибки из пяти символов, возвращаемый поставщиком во время выполнения инструкции SQL.|  
  
 Объект **ошибки** ADO очень похож на стандартный Visual Basic объект **Err** . Его свойства описывают возникшую ошибку. Помимо номера ошибки вы получаете также два связанных фрагмента информации. Свойство **NativeError** содержит номер ошибки, относящийся к используемому поставщику. В предыдущем примере поставщик является поставщиком Microsoft OLE DB для SQL Server, поэтому **NativeError** будет содержать ошибки, характерные для SQL Server. Свойство **SQLSTATE** имеет 5-буквенный код, описывающий ошибку в инструкции SQL.  
  
## <a name="event-related-errors"></a>Ошибки, связанные с событиями  
 Объект **Error** также используется при возникновении ошибок, связанных с событием. Можно определить, произошла ли ошибка в процессе, вызвавшем событие ADO, путем проверки объекта **ошибки** , переданного в качестве параметра события.  
  
 Если операция, вызывающая событие, завершается успешно, параметр *адстатус* обработчика событий будет установлен в значение *адстатусок*. С другой стороны, если операция, вызвавшая событие, завершилась неудачно, параметр *адстатус* имеет значение *адстатусеррорсоккурред*. В этом случае параметр *perror* будет содержать объект **Error** , описывающий ошибку.
