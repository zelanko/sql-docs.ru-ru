---
description: Функции разработки системы безопасности ADO
title: Проблемы проектирования безопасности ADO | Документация Майкрософт
ms.custom: ''
ms.date: 11/08/2018
ms.reviewer: ''
ms.prod: sql
ms.prod_service: connectivity
ms.technology: ado
ms.topic: conceptual
helpviewer_keywords:
- ADO, security
ms.assetid: 86b83a38-efdf-4831-a6d5-7e470d517d1c
author: rothja
ms.author: jroth
ms.openlocfilehash: 1d485dbb17075033add5e3ee93dbcf9b6bf44e65
ms.sourcegitcommit: 18a98ea6a30d448aa6195e10ea2413be7e837e94
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2020
ms.locfileid: "88991225"
---
# <a name="ado-security-design-features"></a>Функции разработки системы безопасности ADO
В следующих разделах описываются функции разработки системы безопасности в объекты данных ActiveX (ADO) 2,8 и более поздних версий. Эти изменения были внесены в ADO 2,8 для повышения безопасности. ADO 6,0, включенный в Windows DAC 6,0 в Windows Vista, функционально эквивалентен ADO 2,8, который был включен в MDAC 2,8 в Windows XP и Windows Server 2003. В этом разделе содержатся сведения о том, как лучше защитить приложения в ADO 2,8 или более поздней версии.

> [!IMPORTANT]
>  Если вы обновляете приложение из более ранней версии ADO, рекомендуется протестировать обновленное приложение на нерабочем компьютере перед его развертыванием для клиентов. Таким образом вы можете убедиться в наличии проблем совместимости перед развертыванием обновленного приложения.

## <a name="internet-explorer-file-access-scenarios"></a>Сценарии доступа к файлам в Internet Explorer
 Следующие функции влияют на то, как работают ADO 2,8 и более поздние версии при использовании в сценариях веб-страниц в Internet Explorer.

### <a name="revised-and-improved-security-warning-message-box-now-used-to-alert-users"></a>Измененное и улучшенное окно сообщения системы безопасности теперь используется для оповещения пользователей
 Для ADO 2,7 и более ранних версий выводится следующее предупреждающее сообщение, когда веб-страница с скриптом пытается выполнить код ADO от ненадежного поставщика:

```console
This page accesses data on another domain. Do you want to allow this? To
avoid this message in Internet Explorer, you can add a secure Web site to
your Trusted Sites zone on the Security tab of the Internet Options dialog
box.
```

 Для ADO 2,8 и более поздних версий предыдущее сообщение больше не отображается. Вместо этого в этом контексте появится следующее сообщение:

```console
This Website uses a data provider that may be unsafe. If you trust the
Website, click OK, otherwise click Cancel.
```

 Предыдущее сообщение позволяет пользователю принимать обоснованное решение, одновременно зная последствия любого из вариантов:

-   Если пользователь доверяет сайту, при нажатии кнопки "ОК" будет разрешен весь незащищенный от диска код (все методы и свойства ADO, за исключением интерфейсов API, доступных для работы с диском, описанных далее в этом разделе) для запуска и выполнения в окне браузера.

-   Если пользователь не доверяет сайту, нажатие кнопки Отмена блокирует выполнение кода ADO для доступа к данным и выполнения в полном объеме.

### <a name="disk-accessible-code-limited-now-to-trusted-sites"></a>Код, доступный на диске, теперь ограничен надежными сайтами
 В ADO 2,8 были внесены дополнительные изменения в проект, которые специально ограничивают возможности ограниченного набора API-интерфейсов, которые могут представлять потенциальную возможность чтения или записи в файлы на локальном компьютере. Ниже приведены методы API, которые были дополнительно ограничены для обеспечения безопасности при запуске Internet Explorer.

-   Для объекта **потока** ADO, если используются методы [лоадфромфиле](../reference/ado-api/loadfromfile-method-ado.md) или [SaveToFile](../reference/ado-api/savetofile-method.md) .

-   Для объекта **набора записей** ADO, если используется либо [метод Save](../reference/ado-api/save-method.md) , либо метод [Open](../reference/ado-api/open-method-ado-recordset.md) (например, если задан параметр **адкмдфиле** или [поставщик сохраняемости Microsoft OLE DB (мсперсист))](./appendixes/microsoft-ole-db-persistence-provider-ado-service-provider.md) .

 Для этих ограниченных наборов потенциально доступных для диска функций в ADO 2,8 и более поздних версиях происходит следующее поведение, если в Internet Explorer выполняется любой код, использующий эти методы:

-   Если сайт, который предоставил код, был добавлен ранее в список надежных узлов, код выполняется в браузере, а доступ предоставляется локальным файлам.

-   Если сайт не отображается в списке Зона доверенных узлов, код блокируется и доступ к локальным файлам отклоняется.

    > [!NOTE]
    >  В ADO 2,8 и более поздних версиях пользователю не выдается оповещение или не рекомендуется добавлять сайты в список зона надежных узлов. Таким образом, Управление списком надежных сайтов является обязанностью тех, кто развертывает или поддерживает приложения на основе веб-сайтов, требующие доступа к локальной файловой системе.

### <a name="access-blocked-to-the-activecommand-property-on-recordset-objects"></a>Доступ заблокирован для свойства ActiveCommand объектов Recordset
 При запуске в Internet Explorer теперь ADO 2,8 блокирует доступ к свойству [ActiveCommand](../reference/ado-api/activecommand-property-ado.md) для объекта активного **набора записей** и возвращает ошибку. Эта ошибка возникает независимо от того, получена ли страница от веб-сайта, зарегистрированного в списке надежных сайтов.

### <a name="changes-in-handling-for-ole-db-providers-and-integrated-security"></a>Изменения в обработке для поставщиков OLE DB и встроенной безопасности
 При просмотре ADO 2,7 и более ранних версий для потенциальных проблем безопасности и их обнаружения обнаружен следующий сценарий:

 В некоторых случаях поставщики OLE DB, которые поддерживают встроенное свойство безопасности [DBPROP_AUTH_INTEGRATED](/previous-versions/windows/desktop/ms712973(v=vs.85)) , потенциально могут позволить веб-страницам со сценариями повторно использовать объект подключения ADO для случайного подключения к другим серверам с использованием текущих учетных данных входа пользователей. Чтобы избежать этого, ADO 2,8 и более поздние версии обрабатывали OLE DB поставщиков в зависимости от того, как они предрешили предоставлять или не предоставляют, для встроенной безопасности.

 Для веб-страниц, загружаемых с сайтов, перечисленных в списке Зона доверенных узлов, в следующей таблице представлены сведения о том, как ADO 2,8 и более поздние версии управляют подключениями ADO в каждом случае.

|Параметры IE для проверки подлинности пользователя, вход|Поставщик поддерживает встроенную безопасность, а UID и PWD указаны (SQLOLEDB)|Поставщик не поддерживает "встроенную безопасность" (JOLT, MSDASQL, Мсперсист)|Поставщик поддерживает "встроенную безопасность" и имеет значение "SSPI" (не указаны UID/PWD)|
|------------------------------------------------|----------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
|Автоматический вход в систему с текущим именем пользователя и паролем|Разрешить подключение|Разрешить подключение|Разрешить подключение|
|Запрос имени пользователя и пароля|Разрешить подключение|Сбой подключения|Сбой подключения|
|Автоматический вход только в зону интрасети|Разрешить подключение|Запрашивать пользователя с предупреждением системы безопасности|Запрашивать пользователя с предупреждением системы безопасности|
|Анонимный вход|Разрешить подключение|Сбой подключения|Сбой подключения|

 В случае появления предупреждения системы безопасности окно сообщения информирует пользователей:

```console
This Website is using your identity to access a data source. If you trust this Website, click OK, otherwise click Cancel.
```

 Предыдущее сообщение позволяет пользователю принять более обоснованное решение и выполнить соответствующие действия.

> [!NOTE]
>  Для ненадежных сайтов (т. е. сайтов, не перечисленных в списке зон надежных узлов), если поставщик также не является доверенным (как обсуждалось ранее в этом разделе), пользователь может видеть два предупреждения безопасности в строке, предупреждение о ненадежном поставщике и второе предупреждение об попытке использовать их удостоверение. Если пользователь нажимает кнопку ОК до первого предупреждения, выполняются параметры Internet Explorer и код поведения ответа, описанный в предыдущей таблице.

## <a name="controlling-whether-password-text-is-returned-in-ado-connection-strings"></a>Управление тем, возвращается ли текст пароля в строках подключения ADO
 При попытке получить значение свойства [ConnectionString](../reference/ado-api/connectionstring-property-ado.md) для объекта **соединения** ADO происходят следующие события:

1.  Если соединение открыто, после этого выполняется вызов инициализации для базового поставщика OLE DB, чтобы получить строку подключения.

2.  В зависимости от параметра в поставщике OLE DB свойства [DBPROP_AUTH_PERSIST_SENSITIVE_AUTHINFO](/previous-versions/windows/desktop/ms714905(v=vs.85)) , пароли включаются вместе с другими возвращаемыми сведениями о строке подключения.

 Например, если динамическое свойство подключения ADO **Сохранение сведений о безопасности** имеет значение **true**, то сведения о пароле включаются в возвращаемую строку подключения. В противном случае, если базовый поставщик установил свойство в **значение false** (например, с поставщиком SQLOLEDB), в возвращенной строке подключения пропускаются сведения о пароле.

 Если вы используете сторонние поставщики (отличные от Майкрософт) OLE DB поставщиками с кодом приложения ADO, вы можете проверить, как реализуется свойство **DBPROP_AUTH_PERSIST_SENSITIVE_AUTHINFO** , чтобы определить, разрешено ли включение сведений о пароле в строки подключения ADO.

## <a name="checking-for-non-file-devices-when-loading-and-saving-recordsets-or-streams"></a>Проверка нефайловых устройств при загрузке и сохранении наборов записей или потоков
 Для ADO 2,7 и более ранних версий операции ввода-вывода файлов, такие как [Открытие](../reference/ado-api/open-method-ado-recordset.md) и [Сохранение](../reference/ado-api/save-method.md) , которые использовались для чтения и записи файловых данных, в некоторых случаях позволяют использовать URL-адрес или имя файла, для которых задан тип файлов, не основанный на диске. Например, LPT1, COM2, PRN.TXT, AUX можно использовать в качестве псевдонима для ввода-вывода между принтерами и вспомогательными устройствами в системе, используя определенные

 Для ADO 2,8 и более поздних версий эта функция обновлена. Для открытия и сохранения объектов **набора записей** и **потоков** ADO теперь выполняет проверку типа файлов, чтобы убедиться, что входное или выходное устройство, указанное в URL-адресе или имени файла, является фактическим файлом.

> [!NOTE]
>  Проверка типов файлов, описанная в этом разделе, применима только для Windows 2000 и более поздних версий. Это не относится к ситуациям, когда ADO 2,8 или более поздней версии выполняются в более ранних выпусках Windows, например Windows 98.