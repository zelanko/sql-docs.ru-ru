---
title: Получение & Настройка резервного сервера
description: В этой статье описывается, как настроить систему Windows, не поддерживающую устройства, в качестве сервера резервного копирования для использования с функциями резервного копирования и восстановления в системе аналитики (ТД) и Parallel Data Warehouse (PDW).
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: e160c606b19933934ec844b477ffec08475307d8
ms.sourcegitcommit: d587a141351e59782c31229bccaa0bff2e869580
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74401494"
---
# <a name="acquire-and-configure-a-backup-server-for-parallel-data-warehouse"></a>Получение и Настройка резервного сервера для параллельного хранилища данных
В этой статье описывается, как настроить систему Windows, не поддерживающую устройства, в качестве сервера резервного копирования для использования с функциями резервного копирования и восстановления в системе аналитики (ТД) и Parallel Data Warehouse (PDW).  
  
  
## <a name="Basics"></a>Основы резервного сервера  
Резервный сервер:  
  
-   Предоставляется и управляется собственной ИТ-группой.  
  
-   Не требует какого-либо программного обеспечения или средств, связанных с PDW. PDW не устанавливает программное обеспечение на резервный сервер.  
  
-   Находится в собственной стойке и не может быть помещена в устройство APS.  
  
-   Может быть подключен к сети устройства InfiniBand. Резервные копии можно выполнять через InfiniBand или Ethernet; Для повышения производительности рекомендуется использовать InfiniBand.  
  
-   Находится в вашем домене клиента, а не в домене устройства. Нет отношения доверия между доменом клиента и доменом устройства.  
  
-   Размещает файловый ресурс резервной копии, который представляет собой файловый ресурс Windows, использующий сетевой протокол уровня приложения SMB. Разрешения файлового ресурса резервного копирования предоставляют пользователю домена Windows (обычно это выделенный пользователь резервного копирования) возможность выполнять операции резервного копирования и восстановления в общей папке. Учетные данные имени пользователя и пароля пользователя домена Windows хранятся в PDW, чтобы PDW мог выполнять операции резервного копирования и восстановления на файловом ресурсе резервной копии.  
  
## <a name="Step1"></a>Шаг 1. Определение требований к емкости  
Системные требования для резервного сервера архивации практически полностью зависят от вашей рабочей нагрузки. Перед покупкой или подготовкой резервного сервера необходимо определить требования к емкости. Резервный сервер не обязательно должен быть выделен только для резервных копий, если он будет обрабатывать требования к производительности и хранению рабочей нагрузки. Можно также использовать несколько резервных серверов для резервного копирования и восстановления каждой базы данных на одном из нескольких серверов.  
  
Используйте [лист планирования емкости резервного сервера](backup-capacity-planning-worksheet.md) для определения требований к емкости.  
  
## <a name="Step2"></a>Шаг 2. получение резервного сервера  
Теперь, когда вы лучше понимаете требования к емкости, вы можете спланировать серверы и сетевые компоненты, которые потребуется приобрести или подготавливать. Включите в план приобретения приведенный ниже список требований, а затем приобретите сервер или подставьте существующий сервер.  
  
### <a name="software-requirements"></a>Требования к программному обеспечению  
Любой файловый сервер, использующий протокол общего доступа к файлам Windows (SMB).  
  
Мы рекомендуем использовать Windows Server 2012 или более поздней, чтобы:  
  
-   Получите выигрыш в производительности при предварительном выделении файлов по протоколу SMB.  
  
-   Используйте мгновенную инициализацию файлов (IFI) для операций резервного копирования. ИТ – специалисты управляют этим параметром на резервном сервере. Configuration Manager PDW (dwconfig. exe) не устанавливает и не контролирует IFI на резервном сервере. В предыдущих версиях Windows нет IFI, но их также можно использовать в качестве резервных серверов.  
  
### <a name="networking-requirements"></a>Требования к сети  
Для резервных серверов рекомендуется использовать значение InfiniBand, хотя это и не обязательно. Чтобы подготовиться к подключению сервера загрузки к сети InfiniBand устройства, выполните следующие действия.  
  
1.  Запланируйте в стойку сервер, достаточный для устройства, чтобы его можно было подключить к коммутаторам InfiniBand устройства. Дополнительные сведения о технологиях Mellanox для InfiniBand см. в техническом документе [Введение в InfiniBand](https://www.mellanox.com/pdf/whitepapers/IB_Intro_WP_190.pdf).  
  
2.  Приобретите сетевой адаптер для одного или двух портов Mellanox ConnectX-3 FDR InfiniBand. Рекомендуется приобрести сетевой адаптер с двумя портами для отказоустойчивости при передаче данных. Для обеспечения высокой доступности требуется два порта сетевого адаптера.  
  
3.  Приобрести 2 FDR по кабелю InfiniBand для платы с двумя портами или 1 FDR InfiniBand для одной карты порта. Кабели FDR InfiniBand будут подключать сервер загрузки к сети устройства InfiniBand. Длина кабеля зависит от расстояния между сервером загрузки и коммутаторами устройства InfiniBand в соответствии с вашей средой.  
  
## <a name="Step3"></a>Шаг 3. Подключение сервера к сетям InfiniBand  
Выполните следующие действия, чтобы подключить сервер загрузки к сети InfiniBand. Если сервер не использует сеть InfiniBand, пропустите этот шаг.  
  
1.  Стойка. сервер достаточно близок к устройству, чтобы вы могли подключить его к сети устройства InfiniBand.  
  
2.  Установите сетевой адаптер InfiniBand Mellanox ConnectX-3 FDR InfiniBand на сервер загрузки.  
  
3.  Используйте кабели FDR для подключения сетевого адаптера InfiniBand к одному из двух коммутаторов InfiniBand в первой стойке устройства.  
  
4.  Установите и настройте соответствующий драйвер Windows для сетевого адаптера InfiniBand.  
  
    -   Драйверы InfiniBand для Windows разрабатываются компанией Опенфабрикс Alliance, отраслевым консорциумом для поставщиков InfiniBand.  Возможно, правильный драйвер был распространен с помощью сетевого адаптера InfiniBand. В противном случае драйвер можно скачать из www.openfabrics.org.  
  
5.  Настройте параметры InfiniBand и DNS для сетевых адаптеров. Инструкции по настройке см. в статье [Настройка сетевых адаптеров Infiniband](configure-infiniband-network-adapters.md).  
  
## <a name="Step4"></a>Шаг 4. Настройка файлового ресурса резервной копии  
PDW будет обращаться к серверу архивации через общую папку в формате UNC. Чтобы настроить общую папку, сделайте следующее:  
  
1.  Создайте папку на резервном сервере для хранения резервных копий.  
  
2.  Создайте общую папку, называемую общим ресурсом резервной копии, для папки резервного копирования.  
  
3.  Назначьте или создайте учетную запись домена Windows в домене клиента, которую вы хотите использовать в целях резервного копирования и восстановления. По соображениям безопасности лучше использовать выделенную учетную запись в качестве пользователя резервной копии.  
  
4.  Добавьте разрешения в общую папку резервных копий, чтобы только доверенные учетные записи и учетная запись резервного копирования домена могли получать доступ, считывать и записывать их в общую папку.  
  
5.  Добавьте учетные данные резервной учетной записи домена в PDW.  
  
    Например:  
  
    ```sql  
    EXEC sp_pdw_add_network_credentials '10.192.147.63', 'seattle\david', '********';  
    ```  
  
    Дополнительные сведения см. в следующих хранимых процедурах:  
  
    -   [sp_pdw_add_network_credentials](../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md)  
  
    -   [sp_pdw_remove_network_credentials](../relational-databases/system-stored-procedures/sp-pdw-remove-network-credentials-sql-data-warehouse.md)  
  
## <a name="Step5"></a>Шаг 5. Запуск резервного копирования данных  
Теперь все готово для начала резервного копирования данных на сервер архивации.  
  
Чтобы выполнить резервное копирование данных, используйте клиент запросов для подключения к SQL Server PDW, а затем отправьте РЕЗЕРВную копию базы данных или команды RESTORE DATABASE. Используйте предложение DISK =, чтобы указать резервный сервер и расположение резервной копии.  
  
> [!IMPORTANT]  
> Не забудьте использовать IP-адрес InfiniBand сервера архивации. В противном случае данные будут копироваться через Ethernet, а не InfiniBand.  
  
Например:  
  
```sql  
BACKUP DATABASE Invoices TO DISK = '\\10.172.14.255\backups\yearly\Invoices2013Full';  
  
RESTORE DATABASE Invoices2013Full  
FROM DISK = '\\10.172.14.255\backups\yearly\Invoices2013Full'  
```  
  
Дополнительная информация: 
  
-   [BACKUP DATABASE](../t-sql/statements/backup-database-parallel-data-warehouse.md)   
  
-   [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md)  
  
## <a name="Security"></a>Уведомления о безопасности  
Сервер архивации не присоединен к частному домену для устройства. Он находится в вашей сети и не имеет отношения доверия между доменом и частным доменом устройства.  
  
Поскольку резервные копии PDW не хранятся на устройстве, ИТ-группа несет ответственность за управление всеми аспектами безопасности резервного копирования. Например, это включает управление безопасностью данных резервного копирования, безопасность сервера, используемого для хранения резервных копий, а также безопасность сетевой инфраструктуры, которая подключает сервер резервного копирования к устройству APS.  
  
### <a name="manage-network-credentials"></a>Управление сетевыми учетными данными  
  
Сетевой доступ к каталогу резервного копирования осуществляется по стандартным принципам безопасности при обмене файлами в Windows. Перед выполнением резервного копирования необходимо создать или назначить учетную запись Windows, которая будет использоваться для проверки подлинности PDW в каталоге резервного копирования. Эта учетная запись Windows должна иметь разрешения на доступ к каталогу резервного копирования, создание такого каталога и запись в него.  
  
> [!IMPORTANT]  
> Чтобы снизить риски безопасности в работе с данными, рекомендуется назначить одну учетную запись Windows исключительно для выполнения резервного копирования и восстановления. Предоставьте этой учетной записи разрешения исключительно для расположения резервного копирования.  
  
Чтобы сохранить имя пользователя и пароль в PDW, используйте хранимую процедуру [sp_pdw_add_network_credentials](../relational-databases/system-stored-procedures/sp-pdw-add-network-credentials-sql-data-warehouse.md) . PDW использует диспетчер учетных данных Windows для хранения и шифрования имен пользователей и паролей на узле управления и на узлах вычислений. Учетные данные не архивируются с помощью команды BACKUP DATABASE.  
  
Чтобы удалить сетевые учетные данные из PDW, используйте хранимую процедуру [sp_pdw_remove_network_credentials](../relational-databases/system-stored-procedures/sp-pdw-remove-network-credentials-sql-data-warehouse.md) .  
  
Чтобы получить список всех сетевых учетных данных, хранящихся в SQL Server PDW, используйте динамическое административное представление [sys. dm_pdw_network_credentials](../relational-databases/system-dynamic-management-views/sys-dm-pdw-network-credentials-transact-sql.md) .  
  
### <a name="secure-communications"></a>Безопасная связь  
  
Операции на сервере загрузки могут использовать UNC-путь для извлечения данных извне доверенной внутренней сети. Злоумышленник в сети или с возможностью влиять на разрешение имен может перехватывать или изменять данные, отправляемые в PDW. Это представляет риск несанкционированного доступа и раскрытия информации. Чтобы снизить риск незаконного изменения:

- Требовать вход в соединение. 
- На сервере загрузки установите следующий параметр групповой политики в области политики безопасности \ локальные параметры: Клиент сети Microsoft: Цифровая подпись (всегда): включена.  
  
## <a name="see-also"></a>См. также  
[Резервное копирование и восстановление](backup-and-restore-overview.md)  
  
