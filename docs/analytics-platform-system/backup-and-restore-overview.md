---
title: Резервное копирование и восстановление - Parallel Data Warehouse | Документация Майкрософт
description: Описывает, каким образом данные резервном копировании и восстановлении для Parallel Data Warehouse (PDW). Операции резервного копирования и восстановления используются для аварийного восстановления. Резервное копирование и восстановление может также использоваться для копирования базы данных с одного устройства для другого устройства.
author: mzaman1
manager: craigg
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 01/19/2019
ms.author: murshedz
ms.reviewer: martinle
ms.openlocfilehash: e95415c689fda43c2a9d118713c96d0a1d531904
ms.sourcegitcommit: 480961f14405dc0b096aa8009855dc5a2964f177
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2019
ms.locfileid: "54419999"
---
# <a name="backup-and-restore"></a>Резервное копирование и восстановление

Описывает, каким образом данные резервном копировании и восстановлении для Parallel Data Warehouse (PDW). Операции резервного копирования и восстановления используются для аварийного восстановления. Резервное копирование и восстановление может также использоваться для копирования базы данных с одного устройства для другого устройства.  
    
## <a name="BackupRestoreBasics"></a>Основы резервного копирования и восстановления

PDW *резервной копии базы данных* является копией базы данных устройства, хранящиеся в формате, чтобы его можно использовать для восстановления исходной базы данных на устройстве.  
  
Создания резервной копии базы данных PDW с [резервное копирование базы данных](../t-sql/statements/backup-database-parallel-data-warehouse.md) инструкцию t-sql и форматирования для использования с [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md) оператор; его непригодным для использования в любых других целях. Резервную копию можно восстановить только на устройство с столько же или большее количество вычислительных узлов.  
  
<!-- MISSING LINKS
The [master database](master-database.md) is a SMP SQL Server database. It is backed up with the BACKUP DATABASE statement. To restore master, use the [Restore the Master Database](configuration-manager-restore-master-database.md) page of the Configuration Manager tool.  
-->
  
PDW использует технологию резервного копирования SQL Server для резервного копирования и восстановления баз данных устройства. Параметры резервного копирования SQL Server преднастроены для сжатия резервных копий. Невозможно задать параметры резервного копирования, такие как сжатие, контрольная сумма, размер блока и число буферов.  
  
Резервные копии баз данных, хранятся на один или несколько резервных серверов, которые существуют в вашей собственной сети клиента.  PDW записывает резервной копии базы данных пользователя в параллельном режиме непосредственно из вычислительных узлов к одному серверу резервного копирования и восстанавливает резервную копию базы данных пользователя в параллельном режиме непосредственно с сервера архивации на вычислительных узлах.  
  
Резервные копии хранятся на сервере резервного копирования как набор файлов в файловой системе Windows. PDW резервной копии базы данных можно восстановить только к PDW. Тем не менее вы можете архивировать резервные копии баз данных с сервера архивации в другое расположение с помощью стандартных процессов резервного копирования файлов Windows. Дополнительные сведения о резервных серверах см. в разделе [запросов и настройка резервного сервера](acquire-and-configure-backup-server.md).  
  
## <a name="BackupTypes"></a>Типы резервного копирования базы данных

Существует два типа данных, которые требуется резервная копия: пользовательские и системные базы данных (например, базе данных master). PDW не создать резервную копию журнала транзакций.  
  
Полной резервной копии является резервной копии всей базы данных PDW. Это тип резервного копирования по умолчанию. Полной резервной копии пользовательской базы данных включает пользователей базы данных и ролей базы данных. Резервная копия главного включает имена входа.  
  
Разностная резервная копия содержит все изменения с момента последнего полного резервного копирования. Разностная резервная копия обычно создается быстрее, чем полная, создавать такие копии можно чаще. Если несколько разностных резервных копий основаны на одной полной резервной копии, каждая из последних включает все изменения в предыдущей разностной резервной копии.  
  
Например можно создать еженедельное полное резервное копирование и разностное резервное копирование каждый день. Восстановление пользовательской базы данных, создания полной резервной копии, а также последней разностной резервной копии (если он существует) необходимо восстановить.  
  
Разностное резервное копирование поддерживается только для пользовательских баз данных. Резервной копии базы данных master, всегда является полной резервной копии.  
  
Чтобы создать резервную копию всего устройства, необходимо выполнить резервную копию всех пользовательских баз данных и резервной копии базы данных master.  
  
## <a name="BackupProc"></a>Процесс резервного копирования базы данных

В примере ниже показан поток данных во время резервной копии базы данных.  
  
![Процесс резервного копирования PDW](media/backup-process.png "PDW процесс резервного копирования")  
  
Процесс резервного копирования работает следующим образом:  
  
1.  Пользователь отправляет инструкцию tsql резервное копирование базы данных к управляющему узлу.  
  
    -   Резервная копия является полной или разностной резервной копии.  
  
2.  Для пользовательских баз данных управляющий узел (механизм MPP) создает план распределенного запроса копии параллельную базу данных.  
  
3.  Каждый узел участвует в резервных копий, а его файл резервной копии на резервный сервер, с помощью функции резервного копирования SQL Server.  
  
    -   Каждый узел участвует один файл резервной копии копий резервный сервер.  
  
    -   Резервной копии пользовательской базы данных (полной или разностной) включает в себя резервной копии части базы данных, хранящиеся на каждом вычислительном узле и резервную копию базы данных пользователей и роли базы данных.  
  
4.  Устройство выполняет резервное копирование в параллельного использования сети InfiniBand.  
  
    -   PDW параллельно выполняет каждой полной и разностной резервной копии. Тем не менее несколько резервных копий базы данных не выполняются параллельно. Каждый запрос на резервное копирование необходимо ждать запрошенную ранее резервные копии завершить.  
  
    -   Резервную копию базы данных master только резервное копирование данных в управляющем узле. Этот тип резервного копирования выполняется последовательно.  
  
5.  Резервной копии базы данных PDW является группой файлов, хранящихся в каталоге, который находится за пределами устройства. Имя каталога указывается как имя сетевой путь к каталогу. Каталог не может быть локальный путь, и не может быть на устройстве.  
  
6.  После завершения резервного копирования, можно использовать в файловой системе Windows для копирования в каталог резервного копирования в другое расположение, при необходимости.  
  
    -   Резервную копию можно восстановить только в PDW Appliance, который имеет равного или большего количества вычислительных узлов.  
  
    -   Прежде чем выполнять восстановление не может изменить имя резервной копии. Имя каталога резервного копирования должно соответствовать имени исходного имени резервной копии. Исходное имя резервного копирования находится в файле backup.xml в каталоге резервных копий. Чтобы восстановить базу данных с другим именем, можно указать новое имя в команде restore. Например: `RESTORE DATABASE MyDB1 FROM DISK = ꞌ\\10.192.10.10\backups\MyDB2ꞌ`.  
  
## <a name="RestoreModes"></a>Режимы восстановления базы данных

Полное восстановление базы данных повторно создает базу данных PDW, используя данные в резервной копии базы данных. Восстановление базы данных выполняется путем сначала восстановление полной резервной копии и при необходимости восстановления разностная резервная копия одного. Восстановление базы данных включает пользователей базы данных и ролей базы данных.  
  
Восстановление только заголовок возвращает данные заголовка для базы данных. Он не восстанавливает данные на устройство.  
  
При восстановлении устройства является восстановление всего устройства. Это включает в себя восстановление всех пользовательских баз данных и базе данных master.  
  
## <a name="RestoreProc"></a>Процесс восстановления

В примере ниже показан поток данных во время восстановления базы данных.  
  
![Процесс восстановления](media/restore-process.png "процесс восстановления")  
  
## <a name="restoring-to-an-appliance-with-the-same-number-of-compute-nodes"></a>Восстановление на устройство с тем же количеством вычислительных узлов **  
  
При восстановлении данных устройство обнаруживает количество вычислительных узлов на исходном устройстве и устройстве назначения перед восстановлением. Если оба устройства имеют одинаковое число вычислительных узлов, процесс восстановления работает следующим образом:  
  
1.  Восстановить резервную копию базы данных можно найти в общей папки Windows на сервере, не связанных с устройством резервного копирования. Для наилучшей производительности этот сервер подключен к сети InfiniBand устройства.  
  
2.  Пользователь отправляет [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md) инструкции tsql для узла элемента управления.  
  
    -   Восстановление выполняется полное восстановление или восстановление заголовка. Полное восстановление, восстановление полной резервной копии и затем при необходимости восстановление разностной резервной копии.  
  
3.  Управляющий узел (механизм MPP) создает план распределенного запроса для выполнения восстановления параллельную базу данных.  
  
    -   SQL ServerPDW параллельно выполняет восстановление пользовательской базы данных. Тем не менее несколько резервных копий базы данных и восстановления не выполняются параллельно. Механизм MPP помещает каждой инструкции restore в очередь; должен ждать запрошенную ранее резервного копирования и восстановления выполнения запросов.  
  
    -   Восстановление базы данных master только восстанавливает данные на узел элемента управления; восстановление выполняется последовательно.  
  
    -   Восстановление данных заголовка проделывается быстро и не восстанавливаются данные, к узлам вычислений или элемент управления. Вместо этого узел элемента управления возвращает результаты в виде выходных данных запроса.  
  
4.  Файлы резервной копии обычно копируется в правильное вычислительных узлов в параллельном режиме, по сети InfiniBand устройства.  
  
5.  Каждый вычислительный узел восстанавливает свою часть пользовательской базы данных. Если любой из операций восстановления завершается успешно, все базы данных удаляются и восстановление завершено с ошибкой.  
  
## <a name="restoring-to-an-appliance-with-a-larger-number-of-compute-nodes"></a>Восстановление на устройство с большим количеством вычислительных узлов  
  
Восстановление резервной копии на устройство с большим числом вычислительных узлов приводит к увеличению размера базы данных пропорционально количеству вычислительных узлов.  
  
Например при восстановлении 60 ГБ из двух узлов устройства (30 ГБ на каждом узле) на устройство с шестью узлами, SQL Server PDW создает базу данных размером 180 ГБ (6 узлов по 30 ГБ на каждом узле) на устройство с шестью узлами. SQL Server PDW изначально восстанавливает базу данных до 2 узлов в соответствии с конфигурацией источника и затем перераспределяет данные на все 6 узлов.  
  
После распределения каждый вычислительный узел будет содержать меньше фактических данных и больше свободного места, чем каждый вычислительный узел на исходном устройстве меньшего размера. Используйте дополнительное место для добавления дополнительных данных в базу данных. Если размер восстановленной базы данных больше, чем требуется, можно использовать [ALTER DATABASE](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw) сжатие размеры файлов базы данных.  
  
## <a name="related-tasks"></a>Связанные задачи  
  
|Резервное копирование и задачи восстановления|Описание|  
|---------------------------|---------------|  
|Подготовьте сервер как сервер резервного копирования.|[Приобретение и Настройка архивации сервера ](acquire-and-configure-backup-server.md)|  
|Создайте резервную копию базы данных.|[РЕЗЕРВНОЕ КОПИРОВАНИЕ БАЗЫ ДАННЫХ](../t-sql/statements/backup-database-parallel-data-warehouse.md)|  
|Восстановление базы данных.|[RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md)|    

<!-- MISSING LINKS
|Create a disaster recovery plan.|[Create a Disaster Recovery Plan](create-disaster-recovery-plan.md)|
|Restore the master database.|To restore the master database, use the [Restore the master database](configuration-manager-restore-master-database.md) page in the Configuration Manager tool.| 
|Copy a database from one appliance to another appliance.|[Copy a PDW database to another appliance](copy-pdw-database-to-another-appliance.md).|  
|Monitor backups and restores.|[Monitor backups and restores](monitor-backup-and-restore.md)|  
-->
