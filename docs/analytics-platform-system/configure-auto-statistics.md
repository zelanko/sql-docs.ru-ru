---
title: Автоматическая статистика
description: Описание функции автоматической статистики, представленной в разделе Analytics Platform System AU7.
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 06/27/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
monikerRange: '>= aps-pdw-2016-au7 || = sqlallproducts-allversions'
ms.openlocfilehash: 7071c9cb46bde6e2d353293cec9f01451c0b4f67
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "74401285"
---
# <a name="configure-auto-statistics"></a>Настройка автоматической статистики

Узнайте, как настроить Параллельное хранилище данных для автоматической статистики при автоматическом создании и обновлении статистики.  Используйте эту возможность для улучшения планов запросов и, следовательно, повышения производительности запросов.

**Применимо к:** ТД (начиная с 2016-AU7)

## <a name="what-are-statistics"></a>Что такое статистика?
Статистика по оптимизации запросов — это объекты, содержащие статистические сведения о распределении значений в одном или нескольких столбцах таблицы. Оптимизатор запросов использует эти статистические сведения для оценки количества элементов, то есть числа строк, в результатах запроса. Такая оценка количества элементов позволяет оптимизатору запросов создать высококачественный план запроса. Например, в ТД оптимизатор запросов MPP использует оценки количества элементов, чтобы выбрать случайное перезапись или репликацию меньше двух таблиц, используемых в предложении JOIN, и таким образом повысить производительность запросов.  Дополнительные сведения см. в разделе [Statistics](../relational-databases/statistics/statistics.md) and [DBCC SHOW_STATISTICS](../t-sql/database-console-commands/dbcc-show-statistics-transact-sql.md)

## <a name="what-are-auto-statistics"></a>Что такое автоматическая статистика?
Автоматическая статистика — это статистика, создаваемая оптимизатором запросов и автоматически обновляемая для улучшения плана запроса. Статистика может стать устаревшей после операций загрузки, вставки, обновления и удаления. Без автоматической статистики необходимо выполнить собственный анализ, чтобы понять, какие столбцы нуждаются в статистике и когда необходимо обновить статистику.

Автоматическая статистика включает следующие три параметра: 

### <a name="auto_create_statistics"></a>AUTO_CREATE_STATISTICS
Если включен параметр AUTO_CREATE_STATISTICS, оптимизатор запросов при необходимости создает статистику по отдельным столбцам в предикате запроса, чтобы улучшить оценку кратности для плана запроса. Такая статистика по отдельным столбцам создается для столбцов, у которых отсутствует гистограмма в существующем объекте статистики.

### <a name="auto_update_statistics"></a>AUTO_UPDATE_STATISTICS 
Если включен параметр AUTO_UPDATE_STATISTICS (автоматическое обновление статистики), то оптимизатор запросов определяет, когда статистика может оказаться устаревшей, и обновляет ее, если она используется в запросе. Статистика становится устаревшей, если операции вставки, обновления, удаления или слияния изменяют распределение данных в таблице или индексированном представлении. Оптимизатор запросов определяет, когда статистика может оказаться устаревшей, подсчитывая операции изменения данных с момента последнего обновления статистики и сравнивая количество изменений с пороговым значением. Пороговое значение основано на количестве строк в таблице или индексированном представлении.

### <a name="auto_update_statistics_async"></a>AUTO_UPDATE_STATISTICS_ASYNC
Параметр AUTO_UPDATE_STATISTICS_ASYNC, который управляет асинхронным обновлением статистики, определяет, какой режим обновления статистики (синхронный или асинхронный) использует оптимизатор запросов. Для ТД параметр асинхронного обновления статистики включен по умолчанию, а оптимизатор запросов обновляет статистику асинхронно. Параметр AUTO_UPDATE_STATISTICS_ASYNC применяется к объектам статистики, создаваемым для индексов, отдельных столбцов в предикатах запросов, и к статистике, создаваемой инструкцией CREATE STATISTICS.

## <a name="configuration-settings-for-system-administrators"></a>Параметры конфигурации для системных администраторов
После обновления до ТД AU7 автоматическая статистика включена по умолчанию. Системный администратор может включить или отключить автоматическую статистику с помощью переключателя [функции](appliance-feature-switch.md) в Configuration Managerе устройства.  После включения пользователи могут изменять параметры статистики для каждой базы данных.
Изменение любых значений переключателей компонентов требует перезапуска службы на ТД.

## <a name="change-auto-statistics-settings-on-a-database"></a>Изменение параметров автоматической статистики в базе данных
Если автоматическая статистика включена системным администратором, то для изменения параметров статистики в базе данных можно использовать [инструкцию ALTER DATABASE (Параллельное хранилище данных)](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw) . Если системный администратор включил параметр автоматической статистики, то для всех новых баз данных, созданных после обновления до AU7, будет включена автоматическая статистика. Для всех баз данных, существовавших до обновления до AU7, отключена автоматическая статистика. В следующем примере включается автоматическая статистика для существующей базы данных МИПДВ.

```sql
ALTER DATABASE myPDW SET AUTO_CREATE_STATISTICS ON
ALTER DATABASE myPDW SET AUTO_UPDATE_STATISTICS ON 
ALTER DATABASE myPDW SET AUTO_UPDATE_STATISTICS_ASYNC ON
```
 
Параметр AUTO_UPDATE STATISTICS_ASYNC работает, только если AUTO_UPDATE_STATISTICS включен.  Поэтому статистика не обновляется, если AUTO_UPDATE_STATISTICS ВЫКЛЮЧЕНа и AUTO_UPDATE_STATISTICS_ASYNC включена. 

### <a name="error-messages"></a>Сообщения об ошибках
Вы можете получить сообщение об ошибке "Этот параметр не поддерживается в PDW".  Эта ошибка возникает, когда системный администратор не включил автоматическую статистику, и вы пытаетесь задать любые параметры автоматической статистики в инструкции ALTER DATABASE. 

### <a name="limitations-and-restrictions"></a>Ограничения
Автоматическая статистика не работает для внешних таблиц. 

### <a name="check-the-current-values"></a>Проверка текущих значений
Следующий запрос возвращает текущие значения параметров автоматической статистики для всех баз данных.

```sql
SELECT NAME
    , IS_AUTO_CREATE_STATS_ON 
    , IS_AUTO_UPDATE_STATS_ON
    , IS_AUTO_UPDATE_STATS_ASYNC_ON
FROM
    sys.databases;
```

Возвращаемое значение 1 означает, что параметр включен, а 0 означает, что параметр отключен. 

## <a name="next-steps"></a>Дальнейшие действия
Сведения о выполнении запросов см. в разделе [мониторинг активных запросов](monitoring-active-queries.md) .
