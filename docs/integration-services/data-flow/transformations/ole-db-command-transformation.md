---
title: Преобразование "Команда OLE DB" | Документы Майкрософт
ms.custom: ''
ms.date: 03/01/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql13.dts.designer.oledbcommandtrans.f1
helpviewer_keywords:
- statements [Integration Services]
- OLE DB Command transformation
ms.assetid: baa6735c-5acf-4759-b077-1216aca16c6c
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 3e85168ae32063ba938205f2612c5af6a95eed4d
ms.sourcegitcommit: c8e1553ff3fdf295e8dc6ce30d1c454d6fde8088
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2020
ms.locfileid: "86919555"
---
# <a name="ole-db-command-transformation"></a>преобразование «Команда OLE DB»

[!INCLUDE[sqlserver-ssis](../../../includes/applies-to-version/sqlserver-ssis.md)]


  Преобразование «Команда OLE DB» выполняет инструкцию SQL для каждой строки потока данных. Например, можно выполнить инструкцию SQL, с помощью которой создаются, обновляются или удаляются строки в таблице базы данных.  
  
 Преобразование «Команда OLE DB» можно настроить следующими способами.  
  
-   Указать инструкцию SQL, которую преобразование выполняет для каждой строки.  
  
-   Задать время ожидания инструкции SQL в секундах.  
  
-   Указать кодовую страницу по умолчанию.  
  
 Обычно инструкция SQL содержит параметры. Значения параметров хранятся во внешних столбцах на входе преобразования, и сопоставление входного столбца с внешним столбцом означает сопоставление входного столбца с параметром. Например, для размещения строк в таблице **DimProduct** в соответствии со значениями в столбце **ProductKey** и для их последующего удаления можно сопоставить внешний столбец **Param_0** с входным столбцом **ProductKey** и выполнить инструкцию SQL `DELETE FROM DimProduct WHERE ProductKey = ?`. Преобразование «Команда OLE DB» определяет имена параметров, которые нельзя изменить. Имена параметров представляют собой **Param_0**, **Param_1**и т. д.  
  
 Если преобразование «Команда OLE DB» настраивается в диалоговом окне **Расширенный редактор** , с помощью кнопки **Обновить** можно автоматически сопоставить параметры инструкции SQL с внешними столбцами входа преобразования, а также определить характеристики каждого параметра. Тем не менее, если поставщик OLE DB, используемый преобразованием «Команда OLE DB», не поддерживает извлечение сведений о параметрах из самих параметров, то внешние столбцы должны настраиваться вручную. В этом случае для каждого параметра необходимо добавить столбец к внешнему входу преобразования, присвоить столбцам имена типа **Param_0**, указать значение свойства DBParamInfoFlags и сопоставить входные столбцы, в которых содержатся значения параметров, с внешними столбцами.  
  
 Значение свойства DBParamInfoFlags представляет собой характеристики параметра. Например, значение **1** показывает, что параметр является входным, а значение **65** показывает, что параметр является входным и может принимать значение NULL. Значения должны соответствовать значениям из перечисления OLE DB DBPARAMFLAGSENUM. Дополнительные сведения см. в справочной документации по OLE DB.  
  
 Преобразование OLE DB Command включает в себя пользовательское свойство **SQLCommand** . Это свойство может быть обновлено выражением свойства при загрузке пакета. Дополнительные сведения см. в разделах [Выражения служб Integration Services (SSIS)](../../../integration-services/expressions/integration-services-ssis-expressions.md), [Использование выражений свойств в пакетах](../../../integration-services/expressions/use-property-expressions-in-packages.md) и [Пользовательские свойства преобразований](../../../integration-services/data-flow/transformations/transformation-custom-properties.md).  
  
 Это преобразование содержит один вход, один обычный вывод и один вывод ошибок.  
  
## <a name="logging"></a>Logging  
 В журнал можно записывать вызовы, сделанные преобразованием «Команда OLE DB» к внешним источникам данных. Эта возможность протоколирования может быть использована для устранения неполадок соединений и выполнения команд для внешних источников данных, которые выполняются преобразованием «Команда OLE DB». Для протоколирования вызовов, которые преобразование «Команда OLE DB» совершает к внешним поставщикам данных, необходимо разрешить ведение журнала пакета и выбрать событие **Диагностика** на уровне пакета. Дополнительные сведения см. в разделе [Инструменты устранения неполадок при выполнении пакетов](../../../integration-services/troubleshooting/troubleshooting-tools-for-package-execution.md).  
  
## <a name="related-tasks"></a>Связанные задачи  
 Преобразование можно настроить с помощью конструктора служб [!INCLUDE[ssIS](../../../includes/ssis-md.md)] или объектной модели. Сведения о настройке этого преобразования программными средствами см. в руководстве разработчика.  
  
## <a name="configure-the-ole-db-command-transformation"></a>настроить преобразование «Команда OLE DB»
  Для добавления и настройки преобразования «Команда OLE DB» пакет должен уже содержать по меньшей мере одну задачу потока данных и такой источник, как источник неструктурированного файла или источник OLE DB. Преобразование обычно используется для выполнения параметризованных запросов.  
  
#### <a name="to-configure-the-ole-db-command-transformation"></a>Настройка преобразования «Команда OLE DB»  
  
1.  В среде [!INCLUDE[ssBIDevStudioFull](../../../includes/ssbidevstudiofull-md.md)]откройте проект служб [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] , содержащий необходимый пакет.  
  
2.  Чтобы открыть пакет, дважды щелкните его в обозревателе решений.  
  
3.  Перейдите на вкладку **Поток данных** , затем из **области элементов**переместите преобразование «Команда OLE DB» в область конструктора.  
  
4.  Подключите преобразование "Команда OLE DB" к потоку данных, перетащив соединитель — зеленую или красную стрелку — из источника данных или из предыдущего преобразования в преобразование "Команда OLE DB".  
  
5.  Щелкните правой кнопкой мыши компонент и выберите редактировать или показать **Расширенный редактор**.  
  
6.  На вкладке **Диспетчеры соединений** выберите диспетчер соединений OLE DB в списке **Диспетчер соединений** . Дополнительные сведения см. в разделе [Диспетчер соединений OLE DB](../../../integration-services/connection-manager/ole-db-connection-manager.md).  
  
7.  Перейдите на вкладку **Свойства компонентов** и нажмите кнопку с многоточием **(…)** в поле **SqlCommand**.  
  
8.  В **редакторе строковых значений**введите параметризованную инструкцию SQL, используя знак вопроса (?) в качестве маркера параметра для каждого параметра.  
  
9. Нажмите кнопку **Обновить**. При нажатии кнопки **Обновить**преобразование создает столбец для каждого параметра в коллекции "Внешние столбцы" и устанавливает свойство DBParamInfoFlags.  
  
10. Щелкните вкладку **Свойства входов и выходов** .  
  
11. Раскройте **Вход команды OLE DB**, затем раскройте коллекцию **Внешние столбцы**.  
  
12. Проверьте, что в коллекции **Внешние столбцы** перечисляются столбцы для всех параметров инструкции SQL. Столбцы имеют имена **Param_0**, **Param_1**и т. д.  
  
     Не изменяйте имена столбцов. Если изменить имена столбцов, службы [!INCLUDE[ssISnoversion](../../../includes/ssisnoversion-md.md)] сформирует ошибку проверки правильности для трансформации команды OLE DB.  
  
     Не изменяйте и тип данных. Свойство DataType в каждом столбце устанавливается в соответствии с правильным типом данных.  
  
13. Если в списке **Внешние столбцы** нет ни одного столбца, введите их вручную.  
  
    -   Щелкните **Добавить столбец** один раз для каждого параметра в инструкции SQL.  
  
    -   Переименуйте столбцы в **Param_0**, **Param_1**и т. д.  
  
    -   Укажите значение в свойстве DBParamInfoFlags. Значение должно соответствовать значению перечисления OLE DB DBPARAMFLAGSENUM. Дополнительные сведения см. в справочной документации по OLE DB.  
  
    -   Задайте тип данных столбца и в зависимости от типа данных задайте кодовую страницу, длину, точность и масштаб столбца.  
  
    -   Чтобы удалить неиспользуемый параметр, выберите параметр в коллекции **Внешние столбцы**, затем щелкните **Удалить столбец**.  
  
    -   Щелкните **Сопоставления столбцов** и сопоставьте столбцы в списке **Входные столбцы** с параметрами в списке **Доступные целевые столбцы** .  
  
14. Нажмите кнопку **ОК**.  
  
15. Чтобы сохранить обновленный пакет, щелкните **Сохранить** в меню **Файл** .  
  
## <a name="see-also"></a>См. также:  
 [Поток данных](../../../integration-services/data-flow/data-flow.md)   
 [Преобразования служб Integration Services](../../../integration-services/data-flow/transformations/integration-services-transformations.md)  
  
  
