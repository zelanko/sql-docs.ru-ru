---
title: "Использование назначения \"Набора записей\" | Документы Майкрософт"
ms.custom: 
ms.date: 03/01/2017
ms.prod: sql-non-specified
ms.prod_service: integration-services
ms.service: 
ms.component: data-flow
ms.reviewer: 
ms.suite: sql
ms.technology:
- integration-services
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- Recordset destination
ms.assetid: a7b143dc-8008-404f-83b0-b45ffbca6029
caps.latest.revision: 
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: On Demand
ms.openlocfilehash: d18d5e683bfc30270fcf83a2002350a75da9a24c
ms.sourcegitcommit: 9e6a029456f4a8daddb396bc45d7874a43a47b45
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/25/2018
---
# <a name="use-a-recordset-destination"></a>использовать назначение «Набор записей»
  Назначение «Набор записей» не сохраняет данные во внешнем источнике данных. Наоборот, назначение "Набор записей" сохраняет данные в памяти в наборе записей, который хранится в переменной пакета служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] , относящейся к типу данных **Object** . После сохранения данных назначением «Набор записей», как правило, используется контейнер «цикл по каждому элементу» с перечислителем ADO по каждой строке для обработки одной строки набора записей за раз. Перечислитель ADO по каждой строке сохраняет значение из каждого столбца текущей строки в отдельной переменной пакета. Затем настроенные в контейнере «цикл по каждому элементу» задания считывают эти значения из переменных и выполняют с ними ряд действий.  
  
 Назначение «Набор записей» можно использовать во многих различных случаях. Приведем некоторые примеры.  
  
-   Задачу "Отправка почты" и язык выражений служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] можно использовать для отправки пользовательского сообщения электронной почты для каждой строки в наборе записей.  
  
-   Компонент скрипта внутри задачи потока данных, настроенный как источник, можно использовать для считывания значений столбцов в столбцы потока данных. После этого можно использовать преобразования и назначения для преобразования и сохранения строки. В приведенном примере задача потока данных выполняется один раз для каждой строки.  
  
 В следующих разделах сначала описан общий процесс использования назначения «Набор записей», а затем приводится конкретный пример использования назначения.  
  
## <a name="general-steps-to-using-a-recordset-destination"></a>Общие шаги использования назначения «Набор записей»  
 В следующей процедуре приведены шаги, которые необходимо выполнить для сохранения данных в назначении «Набор записей», а затем используется контейнер «цикл по каждому элементу» для обработки каждой строки.  
  
#### <a name="to-save-data-to-a-recordset-destination-and-process-each-row-by-using-the-foreach-loop-container"></a>Сохранение данных в назначении «Набор записей» и обработка каждой строки при помощи контейнера «цикл по каждому элементу»  
  
1.  В среде [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]создайте или откройте пакет служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .  
  
2.  Создайте переменную с набором записей, сохраненным в памяти назначением «Набор записей», и задайте тип переменной **Object**.  
  
3.  Создайте дополнительные переменные соответствующих типов для хранения значений каждого столбца в наборе записей, который требуется использовать.  
  
4.  Добавьте и настройте диспетчер соединений, необходимый для источника данных, который планируется использовать в потоке данных.  
  
5.  Добавьте к пакету задачу потока данных и на вкладке «Поток данных» конструктора служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] настройте источники и преобразования для загрузки и преобразования данных.  
  
6.  Добавьте назначение «Набор записей» к потоку данных и соедините его с преобразованиями. Для свойства **VariableName** назначения «Набор записей» введите имя переменной, созданной для хранения набора записей.  
  
7.  На вкладке «Поток управления» конструктора служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] добавьте контейнер «цикл по каждому элементу» и подключите его к задаче потока данных. Затем откройте **Редактор циклов по каждому элементу** , чтобы настроить следующие параметры контейнера.  
  
    1.  На странице **Коллекция** выберите «Перечислитель ADO по каждой строке». Далее для параметра **Переменная источника объекта ADO**выберите переменную с набором записей.  
  
    2.  На странице **Сопоставления переменных** сопоставьте индекс (с отсчетом от нуля) каждого столбца, который требуется использовать, с соответствующей переменной.  
  
         При каждой итерации цикла перечислитель заполняет эти переменные значениями столбцов из текущей строки.  
  
8.  Внутри контейнера «цикл по каждому элементу» добавьте и настройте задачи обработки одной строки набора записей за раз путем считывания значений из переменных.  
  
## <a name="example-of-using-the-recordset-destination"></a>Пример использования назначения «Набор записей»  
 В следующем примере задача потока данных выполняет загрузку сведений о сотрудниках [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] из таблицы Sales.SalesPerson в назначение «Набор записей». Далее контейнер «цикл по каждому элементу» считывает одну строку данных за раз и вызывает задачу «Отправка почты». Задача «Отправка почты» использует выражения для того, чтобы отправить каждому менеджеру по продажам персонифицированное сообщение о размере его или ее премии.  
  
#### <a name="to-create-the-project-and-configure-the-variables"></a>Создание проекта и настройка переменных  
  
1.  В среде [!INCLUDE[ssBIDevStudio](../../includes/ssbidevstudio-md.md)]создайте новый проект служб [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] .  
  
2.  В меню **Службы SSIS** выберите **Переменные**.  
  
3.  В окне **Переменные** создайте переменные, которые будут содержать набор записей и значения столбцов из текущей строки.  
  
    1.  Создайте переменную с именем **BonusRecordset**и типом **Object**.  
  
         Переменная **BonusRecordset** хранит набор записей.  
  
    2.  Создайте переменную с именем **EmailAddress**и типом **String**.  
  
         Переменная **EmailAddress** хранит адрес электронной почты менеджера по продажам.  
  
    3.  Создайте переменную с именем **FirstName**и типом **String**.  
  
         Переменная **FirstName** хранит имя менеджера по продажам.  
  
    4.  Создайте переменную с именем **Bonus**и типом **Double**.  
  
         Переменная **Bonus** хранит размер премии менеджера по продажам.  
  
#### <a name="to-configure-the-connection-managers"></a>Настройка диспетчеров соединений  
  
1.  В области «Диспетчеры соединений» конструктора служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] добавьте и настройте новый диспетчер соединений OLE DB, подключаемый к образцу базы данных [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)] .  
  
     Источник OLE DB в задаче потока данных будет использовать этот диспетчер соединений для извлечения данных.  
  
2.  В области «Диспетчеры соединений» добавьте и настройте новый диспетчер соединений SMTP, подключаемый к доступному SMTP-серверу.  
  
     Задача «Отправка почты» внутри контейнера «цикл по каждому элементу» будет использовать этот диспетчер соединений для отправки сообщений электронной почты.  
  
#### <a name="to-configure-the-data-flow-and-the-recordset-destination"></a>Настройка потока данных и назначения «Набор записей»  
  
1.  На вкладке **Поток управления** конструктора служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] добавьте в область конструктора задачу потока данных.  
  
2.  На вкладке **Поток данных** tab, add an OLE DB source to the Поток данных task, and then open the **Редактор источника «OLE DB»**.  
  
3.  На странице редактора **Диспетчер соединений** настройте источник со следующими параметрами.  
  
    1.  В области **Диспетчер соединений OLE DB**выберите ранее созданный диспетчер соединений OLE DB.  
  
    2.  В списке **Режим доступа к данным**выберите **Команда SQL**.  
  
    3.  В области **Текст команды SQL**введите следующий запрос:  
  
        ```sql 
        SELECT     Person.Contact.EmailAddress, Person.Contact.FirstName, CONVERT(float, Sales.SalesPerson.Bonus) AS Bonus  
        FROM         Sales.SalesPerson INNER JOIN  
                              Person.Contact ON Sales.SalesPerson.SalesPersonID = Person.Contact.ContactID  
        ```  
  
        > [!NOTE]  
        >  Значение **currency** в столбце "Bonus" потребуется преобразовать к типу данных **float** , прежде чем его можно будет загрузить в переменную пакета типа **Double**.  
  
4.  На вкладке **Поток данных** добавьте назначение «Набор записей» и подключитесь к назначению после источника OLE DB.  
  
5.  Откройте **Редактор назначения «Набор записей»**и настройте назначение со следующими параметрами.  
  
    1.  На вкладке **Свойства компонента** для свойства **VariableName** выберите **User::BonusRecordset**.  
  
    2.  На вкладке **Входные столбцы** выберите все три доступных столбца.  
  
#### <a name="to-configure-the-foreach-loop-container-and-run-the-package"></a>Настройка контейнера «цикл по каждому элементу» и выполнение пакета  
  
1.  На вкладке **Поток управления** конструктора служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] добавьте контейнер «цикл по каждому элементу» и подключите его к задаче потока данных.  
  
2.  Откройте **Редактор циклов по каждому элементу**и настройте следующие параметры контейнера.  
  
    1.  На вкладке **Коллекция** для параметра **Перечислитель**выберите **Перечислитель ADO по каждой строке**, а для параметра **Переменная источника объекта ADO**выберите **User::BonusRecordset**.  
  
    2.  На странице **Сопоставления переменных** сопоставьте **User::EmailAddress** индексу 0, **User::FirstName** индексу 1 и **User::Bonus** индексу 2.  
  
3.  На вкладке **Поток управления** внутри контейнера «цикл по каждому элементу» добавьте задачу «Отправка почты».  
  
4.  Откройте **Редактор задачи «Отправка почты»**и на странице **Почта** настройте следующие параметры задачи.  
  
    1.  В области **SmtpConnection**выберите ранее настроенный диспетчер соединений SMTP.  
  
    2.  В поле **От**введите соответствующий адрес электронной почты.  
  
         Если указать собственный адрес электронной почты, то можно будет проверить успешность выполнения пакета. Будут получены подтверждения о невозможности доставить сообщения, отправленные задачей «Отправка почты» несуществующим менеджерам по продажам [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)].  
  
    3.  В поле **Кому**введите адрес электронной почты по умолчанию.  
  
         Это значение не будет использовано, а будет заменено во время выполнения адресом электронной почты каждого менеджера по продажам.  
  
    4.  В поле **Тема**введите «Ваша годовая премия».  
  
    5.  Для параметра **MessageSourceType**выберите значение **Прямой ввод**.  
  
5.  На странице **Выражения** окна **Редактор задачи "Отправка почты"**нажмите кнопку с многоточием (**…**), чтобы открыть **Редактор выражений свойств**.  
  
6.  В **Редакторе выражений свойств**введите следующие данные.  
  
    1.  В поле **ToLine**добавьте следующее выражение:  
  
        ```  
        @[User::EmailAddress]  
        ```  
  
    2.  Для свойства **MessageSource** добавьте следующее выражение:  
  
        ```  
        "Dear " +  @[User::FirstName] + ": The amount of your bonus for this year is $" +  (DT_WSTR, 12) @[User::Bonus] + ". Thank you!"  
        ```  
  
7.  Запустите пакет.  
  
     Если был указан допустимый SMTP-сервер и задан собственный адрес электронной почты, будут получены подтверждения о невозможности отправки сообщений задачей «Отправка почты» вымышленным менеджерам по продажам [!INCLUDE[ssSampleDBnormal](../../includes/sssampledbnormal-md.md)].  
  
  
