---
title: Загрузка данных в Хранилище данных SQL Azure с помощью SQL Server Integration Services (SSIS) | Документация Майкрософт
description: Демонстрация создания пакета SQL Server Integration Services (SSIS) для перемещения данных из разнообразных источников в Хранилище данных SQL Azure.
documentationcenter: NA
ms.prod: sql
ms.prod_service: integration-services
ms.technology: integration-services
ms.topic: conceptual
ms.custom: loading
ms.date: 08/09/2018
ms.author: chugu
author: chugugrace
ms.openlocfilehash: 317a17d667c9c09009c3fcbd9bab6565108110ad
ms.sourcegitcommit: 591bbf4c7e4e2092f8abda6a2ffed263cb61c585
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2020
ms.locfileid: "86943206"
---
# <a name="load-data-into-azure-sql-data-warehouse-with-sql-server-integration-services-ssis"></a>Загрузка данных в Хранилище данных SQL Azure с помощью SQL Server Integration Services (SSIS)

[!INCLUDE[sqlserver-ssis](../includes/applies-to-version/sqlserver-ssis.md)]



Вы можете создать пакет служб SQL Server Integration Services (SSIS) для загрузки данных в [Хранилище данных SQL Azure](/azure/sql-data-warehouse/index). При необходимости можно реструктуризировать, преобразовать и очистить данные по мере их прохождения через поток данных SSIS.

В этой статье показано следующее:

* Создание проекта служб Integration Services в Visual Studio.
* Создание пакета служб SSIS, который загружает данные из источника в назначение.
* Запуск пакета служб SSIS для загрузки данных.

## <a name="basic-concepts"></a>Основные понятия

Пакет — это базовая единица работы в службах SSIS. Связанные пакеты группируются в проекты. Для создания проектов и пакетов разработки в Visual Studio используется SQL Server Data Tools. Процесс разработки — это визуальный процесс, в котором вы перетаскиваете компоненты с панели элементов в область конструктора, соединяете их и задаете их свойства. Завершив создание пакета, вы можете запустить его и при необходимости развернуть в SQL Server или Базе данных SQL, чтобы получить комплексные возможности управления, мониторинга и защиты.

В рамках этой статьи службы SSIS не будут разбираться подробно. Дополнительные сведения см. в следующих статьях:

- [SQL Server Integration Services](sql-server-integration-services.md)

- [Создание пакета ETL](ssis-how-to-create-an-etl-package.md)

## <a name="options-for-loading-data-into-sql-data-warehouse-with-ssis"></a>Варианты загрузки данных в Хранилище данных SQL с помощью служб SSIS
Службы SQL Server Integration Services (SSIS) — это гибкий набор средств, предоставляющий разнообразные возможности для подключения к хранилищу данных SQL и загрузки в него данных.

1. Предпочтительный и самый эффективный метод — создать пакет, где загрузка выполняется с помощью [задачи отправки информации в Хранилище данных SQL Azure](control-flow/azure-sql-dw-upload-task.md). Эта задача включает сведения как об источнике, так и о получателе. Она предполагает, что исходные данные хранятся локально в текстовых файлах с разделителями.

2. Как альтернативный вариант, вы можете создать пакет, где используется задача потока данных, содержащая источник и получатель. Этот подход поддерживает обширный ряд источников данных, включая SQL Server и Хранилище данных SQL Azure.

## <a name="prerequisites"></a>предварительные требования
Для прохождения этого руководства потребуется следующее.

1. **SQL Server Integration Services (SSIS)** . Службы SSIS — это компонент SQL Server, которому для работы нужна лицензионная версия, версия для разработчиков или ознакомительная версия SQL Server. [Получить ознакомительную версию SQL Server](https://www.microsoft.com/evalcenter/evaluate-sql-server-2017-rtm).
2. **Visual Studio** (необязательно). Для получения бесплатного выпуска Visual Studio Community см. раздел [Visual Studio Community][Visual Studio Community]. Если вы не хотите устанавливать Visual Studio, вы можете установить только SQL Server Data Tools (SSDT). Установка SSDT включает версию Visual Studio с ограниченной функциональностью.
3. **SQL Server Data Tools для Visual Studio (SSDT)** . Чтобы получить SQL Server Data Tools для Visual Studio, см. раздел [Скачивание SQL Server Data Tools (SSDT)][Download SQL Server Data Tools (SSDT)].
4. **База данных и разрешения Хранилища данных SQL Azure**. Этот учебник подключается к экземпляру хранилища данных SQL и загружает в него данные. У вас должны быть разрешения на подключение, создание таблицы и загрузку данных.

## <a name="create-a-new-integration-services-project"></a>Создание нового проекта служб Integration Services
1. Запустите Visual Studio.
2. В меню **Файл** выберите **Создать | Проект**.
3. Перейдите к типам проектов **Установленные | Шаблоны | Бизнес-аналитика | Integration Services**.
4. Выберите **Проект служб SSIS**. Укажите значения для параметров **Имя** и **Расположение**, а затем нажмите кнопку **ОК**.

Visual Studio открывает и создает проект служб Integration Services (SSIS). Затем Visual Studio открывает конструктор для отдельного нового пакета служб SSIS (Package.dtsx) в проекте. Видны следующие области экрана:

* В левой части **панель элементов** для компонентов служб SSIS.
* В центре область конструктора с несколькими вкладками. Как правило, используются по меньшей мере вкладки **Поток управления** и **Поток данных**.
* В правой части — области **Обозреватель решений** и **Свойства**.
  
    ![Снимок экрана Visual Studio: панель элементов, область конструктора, панель обозревателя решений и панель свойств.][01]

## <a name="option-1---use-the-sql-dw-upload-task"></a>Вариант 1. Использование задачи отправки информации в Хранилище данных SQL

В первом подходе применяется пакет, использующий задачу отправки информации в Хранилище данных SQL. Эта задача включает сведения как об источнике, так и о получателе. Она предполагает, что исходные данные хранятся в текстовых файлах с разделителями, локально или в хранилище BLOB-объектов Azure.

### <a name="prerequisites-for-option-1"></a>Необходимые условия для варианта 1

Чтобы продолжить проходить руководство с этим вариантом, потребуется следующее:

- [Пакет дополнительных компонентов Microsoft SQL Server Integration Services для Azure][Microsoft SQL Server 2017 Integration Services Feature Pack for Azure]. Задача отправки информации в хранилище данных SQL входит в пакет дополнительных компонентов.

- Учетная запись [хранилища BLOB-объектов Azure](https://docs.microsoft.com/azure/storage/). Задача отправки информации в хранилище данных SQL загружает данные из хранилища BLOB-объектов Azure в Хранилище данных SQL Azure. Вы можете загружать файлы, которые уже есть в хранилище BLOB-объектов, или файлы с компьютера. При выборе файлов с компьютера задача отправки информации в хранилище данных SQL сначала отправит файлы в хранилище BLOB-объектов для промежуточной обработки, а затем отправит их в Хранилище данных SQL.

### <a name="add-and-configure-the-sql-dw-upload-task"></a>Добавление и настройка задачи отправки информации в хранилище данных SQL

1. Перетащите задачу отправки информации в хранилище данных SQL с панели элементов в центр области конструктора (на вкладке **Поток управления**).

2. Дважды щелкните задачу, чтобы открыть **Редактор задачи отправки информации в хранилище данных SQL**.

    ![Страница "Общие" окна "Редактор задачи отправки информации в хранилище данных SQL"](media/load-data-to-sql-data-warehouse/azure-sql-dw-upload-task-editor.png)

3. Настройте задачу, следуя рекомендациям в статье [Задача отправки информации в хранилище данных SQL Azure](control-flow/azure-sql-dw-upload-task.md). Так как задача включает сведения об источнике и получателе, а также сопоставление исходных и целевых таблиц, в редакторе задачи нужно настроить несколько страниц параметров.

### <a name="create-a-similar-solution-manually"></a>Создание похожего решения вручную

Для более полного контроля вы можете вручную создать пакет, который эмулирует работу задачи отправки информации в хранилище данных SQL. 

1. Используйте задачу передачи BLOB-объектов Azure для размещения данных в хранилище BLOB-объектов Azure. Чтобы получить задачу отправки больших двоичных объектов Azure, скачайте [Пакет дополнительных компонентов Microsoft SQL Server Integration Services для Azure][Microsoft SQL Server 2017 Integration Services Feature Pack for Azure].

2. После этого используйте задачу "Выполнить SQL" служб SSIS, чтобы запустить скрипт PolyBase, который загружает данные в хранилище данных SQL. Пример, который загружает данные из хранилища BLOB-объектов Azure в Хранилище данных SQL (но без использования SSIS), см. в [Руководстве по загрузке данных в Хранилище данных SQL Azure](/azure/sql-data-wAREHOUSE/load-data-wideworldimportersdw).

## <a name="option-2---use-a-source-and-destination"></a>Вариант 2. Использование источника и получателя

Во втором подходе применяется обычный пакет с задачей потока данных, содержащей источник и получатель. Этот подход поддерживает обширный ряд источников данных, включая SQL Server и Хранилище данных SQL Azure.

В этом учебнике в качестве источника данных используется SQL Server. SQL Server запускается на локальном компьютере или в виртуальной машине Azure.

Чтобы подключиться к SQL Server и хранилищу данных SQL, используйте диспетчер подключений ADO.NET с источником и получателем или диспетчер подключений OLE DB с источником и получателем. В этом руководстве используется платформа ADO.NET, так как в ней меньше всего параметров конфигурации. OLE DB может обеспечить немного большую производительность по сравнению с ADO.NET.

Чтобы быстро создать базовый пакет, вы можете использовать Мастер импорта и экспорта SQL Server. Затем сохраните пакет и откройте его в Visual Studio или SSDT для просмотра и настройки. Дополнительные сведения см. в разделе [Импорт и экспорт данных с помощью мастера импорта и экспорта SQL Server](import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard.md).

### <a name="prerequisites-for-option-2"></a>Необходимые условия для варианта 2

Чтобы продолжить проходить руководство с этим вариантом, потребуется следующее:

1. **Образец данных**. В этом учебнике в качестве исходных данных для загрузки в хранилище данных SQL используется образец данных, сохраненный в SQL Server в образце базы данных AdventureWorks. Чтобы получить образец базы данных AdventureWorks, см. раздел [Образцы баз данных AdventureWorks][AdventureWorks 2014 Sample Databases].

2. **Правило брандмауэра**. Перед загрузкой данных в хранилище данных SQL вам нужно создать в нем правило брандмауэра с IP-адресом локального компьютера.

### <a name="create-the-basic-data-flow"></a>Создание простого потока данных
1. Перетащите задачу потока данных с панели элементов в центр области конструктора (на вкладке **Поток управления**).
   
    ![Снимок экрана Visual Studio: задача потока данных, перетаскиваемая на вкладку "Поток управления" области конструктора.][02]
2. Дважды щелкните элемент "Задача потока данных", чтобы перейти на вкладку "Поток данных".
3. В списке "Другие источники" на панели элементов перетащите источник ADO.NET в область конструктора. Выбрав адаптер источника данных, измените его имя на **SQL Server source** (Источник SQL Server) в области **Свойства**.
4. В списке "Другие назначения" на панели элементов перетащите назначение ADO.NET в область конструктора под источником ADO.NET. Выбрав адаптер загрузки данных, измените его имя на **SQL DW destination** (Назначение хранилища данных SQL) в области **Свойства**.
   
    ![Снимок экрана: адаптер загрузки данных, перетаскиваемый в расположение непосредственно под адаптером источника данных.][09]

### <a name="configure-the-source-adapter"></a>Настройка адаптера источника данных
1. Дважды щелкните адаптер источника данных, чтобы открыть **Редактор источника ADO.NET**.
   
    ![Снимок экрана: редактор источника ADO.NET. Вкладка "Диспетчер подключений" видима, а элементы управления доступны для настройки свойств потока данных.][03]
2. На вкладке **Диспетчер соединений** окна **Редактор источника ADO.NET** нажмите кнопку **Создать** рядом со списком **Диспетчер соединений ADO.NET**, чтобы открыть диалоговое окно **Настройка диспетчера соединений ADO.NET** и создать параметры подключения для базы данных SQL Server, откуда этот учебник загружает данные.
   
    ![Снимок экрана: диалоговое окно "Настройка диспетчера соединений ADO.NET". Элементы управления доступны для настройки диспетчеров подключений.][04]
3. В диалоговом окне **Настройка диспетчера соединений ADO.NET** нажмите кнопку **Создать**, чтобы открыть диалоговое окно **Диспетчер соединений** и создать подключение к данным.
   
    ![Снимок экрана: диалоговое окно "Диспетчер подключений". Элементы управления доступны для настройки подключения к данным.][05]
4. В диалоговом окне **Диспетчер соединений** сделайте следующее:
   
   1. В поле **Поставщик** выберите поставщик данных SqlClient.
   2. В поле **Имя сервера** введите имя SQL Server.
   3. В разделе **Вход на сервер** выберите или введите сведения для проверки подлинности.
   4. В разделе **Соединение с базой данных** выберите образец базы данных AdventureWorks.
   5. Нажмите кнопку **Проверить соединение**.
      
       ![Снимок экрана: диалоговое окно с кнопкой "ОК" и текстом, указывающим, что проверка соединения прошла успешно.][06]
   6. В диалоговом окне, сообщающем результаты проверки соединения, нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Диспетчер соединений**.
   7. В диалоговом окне **Диспетчер соединений** нажмите кнопку **ОК** для возврата в диалоговое окно **Настройка диспетчера соединений ADO.NET**.
5. В диалоговом окне **Настройка диспетчера соединений ADO.NET** нажмите кнопку **ОК** для возврата в **Редактор источника ADO.NET**.
6. В окне **Редактор источника ADO.NET** в списке **Имя таблицы или представления** выберите таблицу **Sales.SalesOrderDetail**.
   
    ![Снимок экрана: редактор источника ADO.NET. В списке "Имя таблицы или представления" выбрана таблица Sales.SalesOrderDetail.][07]
7. Нажмите кнопку **Предварительный просмотр**, чтобы просмотреть первые 200 строк данных исходной таблицы в диалоговом окне **Предварительный просмотр результатов запроса**.
   
    ![Снимок экрана: диалоговое окно "Предварительный просмотр результатов запроса". Видны несколько строк данных о продажах из исходной таблицы.][08]
8. В диалоговом окне **Предварительный просмотр результатов запроса** нажмите кнопку **Закрыть** для возврата в **Редактор источника ADO.NET**.
9. В окне **Редактор источника ADO.NET** нажмите кнопку **ОК**, чтобы завершить настройку источника данных.

### <a name="connect-the-source-adapter-to-the-destination-adapter"></a>Подключение адаптера источника данных к адаптеру загрузки данных
1. Выберите адаптер источника данных в области конструктора.
2. Выберите синюю стрелку, отходящую от адаптера источника данных, и перетащите к редактору назначения до ее фиксации.
   
    ![Снимок экрана: адаптер источника данных и адаптер загрузки данных. Синяя стрелка указывает от адаптера источника данных к адаптеру загрузки данных.][10]
   
    В типичном пакете служб SSIS между источником и назначением используется несколько других компонентов из панели элементов SSIS для реструктуризации, преобразования и очистки данных по мере их прохождения через поток данных SSIS. Чтобы сделать этот пример как можно более простым, мы подключаем источник непосредственно к назначению.

### <a name="configure-the-destination-adapter"></a>Настройка адаптера загрузки данных
1. Дважды щелкните адаптер загрузки данных, чтобы открыть **Редактор назначения ADO.NET**.
   
    ![Снимок экрана: редактор назначения ADO.NET. Вкладка "Диспетчер подключений" видима и содержит элементы управления для настройки свойств потока данных.][11]
2. На вкладке **Диспетчер соединений** окна **Редактор назначения ADO.NET** нажмите кнопку **Создать** рядом со списком **Диспетчер соединений ADO.NET**, чтобы открыть диалоговое окно **Настройка диспетчера соединений ADO.NET** и создать параметры подключения для базы данных хранилища данных SQL Azure, куда этот учебник загружает данные.
3. В диалоговом окне **Настройка диспетчера соединений ADO.NET** нажмите кнопку **Создать**, чтобы открыть диалоговое окно **Диспетчер соединений** и создать подключение к данным.
4. В диалоговом окне **Диспетчер соединений** сделайте следующее:
   1. В поле **Поставщик** выберите поставщик данных SqlClient.
   2. В поле **Имя сервера** введите имя хранилища данных SQL.
   3. В разделе **Вход на сервер** выберите **Использовать проверку подлинности SQL Server** и введите сведения для проверки подлинности.
   4. В разделе **Соединение с базой данных** выберите существующую базу данных хранилища данных SQL.
   5. Нажмите кнопку **Проверить соединение**.
   6. В диалоговом окне, сообщающем результаты проверки соединения, нажмите кнопку **ОК**, чтобы вернуться в диалоговое окно **Диспетчер соединений**.
   7. В диалоговом окне **Диспетчер соединений** нажмите кнопку **ОК** для возврата в диалоговое окно **Настройка диспетчера соединений ADO.NET**.
5. В диалоговом окне **Настройка диспетчера соединений ADO.NET** нажмите кнопку **ОК** для возврата в **Редактор назначения ADO.NET**.
6. В окне **Редактор назначения ADO.NET** нажмите кнопку **Создать** рядом со списком **Использовать таблицу или представление**, чтобы открыть диалоговое окно **Создание таблицы** для создания целевой таблицы со списком столбцов, соответствующим исходной таблице.
   
    ![Снимок экрана: диалоговое окно "Создание таблицы". Код SQL для создания целевой таблицы виден.][12a]
7. В диалоговом окне **Создание таблицы** сделайте следующее:
   
   1. Измените имя целевой таблицы на **SalesOrderDetail**.
   2. Удалите столбец **rowguid**. Тип данных **Uniqueidentifier** в хранилище данных SQL не поддерживается.
   3. Измените тип данных столбца **LineTotal** на **money**. Тип данных **decimal** в хранилище данных SQL не поддерживается. Сведения о поддерживаемых типах данных см. в разделе [CREATE TABLE (Хранилище данных SQL Azure или Parallel Data Warehouse)][CREATE TABLE (Azure SQL Data Warehouse, Parallel Data Warehouse)].
      
       ![Снимок экрана: диалоговое окно "Создание таблицы" с кодом для создания таблицы SalesOrderDetail с LineTotal в качестве денежного столбца и без столбца rowguid.][12b]
   4. Нажмите кнопку **ОК**, чтобы создать таблицу и вернуться в **Редактор назначения ADO.NET**.
8. В окне **Редактор назначения ADO.NET** откройте вкладку **Сопоставления**, чтобы просмотреть, как столбцы в источнике сопоставляются со столбцами в назначении.
   
    ![Снимок экрана: вкладка "Сопоставления" редактора назначения ADO.NET. Линии соединяют столбцы с одинаковыми именами в исходной и целевой таблицах.][13]
9. Нажмите кнопку **ОК**, чтобы завершить настройку назначения.

## <a name="run-the-package-to-load-the-data"></a>Запуск пакета для загрузки данных
Запустите пакет, нажав кнопку **Пуск** на панели инструментов или выбрав один из параметров **запуска** в меню **Отладка**.

Ниже описано, что происходит при создании пакета по второму варианту из этой статьи, то есть, с потоком данных, содержащим источник и получатель.

Как только начнется выполнение пакета, вы увидите желтые вращающиеся колеса, обозначающие активность, а также количество обработанных строк.

![Снимок экрана: адаптер источника данных и адаптер загрузки данных с желтыми вращающимися колесами для каждого адаптера и текстом "29916 rows" (29916 строк) между ними.][14]

После завершения выполнения пакета появляются зеленые галочки, указывающие успешность операции, а также общее число строк данных, загруженных из источника в назначение.

![Снимок экрана: адаптер источника данных и адаптер загрузки данных. На каждом адаптере стоят зеленые галочки, а между ними находится текст "121317 rows" (121317 строк).][15]

Поздравляем! Вы успешно использовали службы SQL Server Integration Services для загрузки данных в хранилище данных SQL Azure.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения об отладке пакетов и устранении их неполадок прямо в среде разработки. Начните здесь: [Инструменты устранения неполадок при разработке пакета][Troubleshooting Tools for Package Development].

- Сведения о развертывании пакетов и проектов служб SSIS на сервере служб Integration Services или в другом хранилище. Начните здесь: [Развертывание проектов и пакетов][Deployment of Projects and Packages].

<!-- Image references -->
[01]:  ./media/load-data-to-sql-data-warehouse/ssis-designer-01.png
[02]:  ./media/load-data-to-sql-data-warehouse/ssis-data-flow-task-02.png
[03]:  ./media/load-data-to-sql-data-warehouse/ado-net-source-03.png
[04]:  ./media/load-data-to-sql-data-warehouse/ado-net-connection-manager-04.png
[05]:  ./media/load-data-to-sql-data-warehouse/ado-net-connection-05.png
[06]:  ./media/load-data-to-sql-data-warehouse/test-connection-06.png
[07]:  ./media/load-data-to-sql-data-warehouse/ado-net-source-07.png
[08]:  ./media/load-data-to-sql-data-warehouse/preview-data-08.png
[09]:  ./media/load-data-to-sql-data-warehouse/source-destination-09.png
[10]:  ./media/load-data-to-sql-data-warehouse/connect-source-destination-10.png
[11]:  ./media/load-data-to-sql-data-warehouse/ado-net-destination-11.png
[12a]: ./media/load-data-to-sql-data-warehouse/destination-query-before-12a.png
[12b]: ./media/load-data-to-sql-data-warehouse/destination-query-after-12b.png
[13]:  ./media/load-data-to-sql-data-warehouse/column-mapping-13.png
[14]:  ./media/load-data-to-sql-data-warehouse/package-running-14.png
[15]:  ./media/load-data-to-sql-data-warehouse/package-success-15.png

<!-- Article references -->

<!-- MSDN references -->
[PolyBase Guide]: ../relational-databases/polybase/polybase-guide.md
[Download SQL Server Data Tools (SSDT)]: ../ssdt/download-sql-server-data-tools-ssdt.md
[CREATE TABLE (Azure SQL Data Warehouse, Parallel Data Warehouse)]: ../t-sql/statements/create-table-azure-sql-data-warehouse.md
[Data Flow]: ./data-flow/data-flow.md
[Troubleshooting Tools for Package Development]: ./troubleshooting/troubleshooting-tools-for-package-development.md
[Deployment of Projects and Packages]: ./packages/deploy-integration-services-ssis-projects-and-packages.md

<!--Other Web references-->
[Microsoft SQL Server 2017 Integration Services Feature Pack for Azure]: https://www.microsoft.com/download/details.aspx?id=54798
[SQL Server Evaluations]: https://www.microsoft.com/evalcenter/evaluate-sql-server-2017
[Visual Studio Community]: https://www.visualstudio.com/products/visual-studio-community-vs.aspx
[AdventureWorks 2014 Sample Databases]: https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks
