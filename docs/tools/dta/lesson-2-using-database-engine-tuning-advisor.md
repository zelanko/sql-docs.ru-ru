---
title: Использование помощника по настройке ядра СУБД
ms.prod: sql
ms.prod_service: sql-tools
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- Database Engine [SQL Server], tutorials
ms.assetid: 3317d4f8-ed9e-4f2e-b5f1-a6bf3a9d6c8d
author: markingmyname
ms.author: maghan
ms.manager: jroth
ms.reviewer: ''
ms.custom: seo-lt-2019
ms.date: 03/01/2017
ms.openlocfilehash: 6352a5d32f7b173343729582cdb1bfb0c1de99b3
ms.sourcegitcommit: b78f7ab9281f570b87f96991ebd9a095812cc546
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "75307635"
---
# <a name="lesson-2-using-database-engine-tuning-advisor"></a>Урок 2. Использование помощника по настройке ядра СУБД

[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Помощник по настройке ядра СУБД позволяет настраивать базы данных, управлять сеансами настройки и просматривать рекомендации по настройке. Пользователи, обладающие углубленными знаниями структур физического проектирования, могут использовать это средство для выполнения пробного анализа настройки базы данных. Новички в настройке баз данных могут использовать этот инструмент для поиска оптимальной конфигурации структур физического проектирования для рабочих нагрузок, настройка которых выполняется. Данное занятие содержит базовые практические задания для администраторов баз данных, незнакомых с графическим пользовательским интерфейсом помощника по настройке ядра СУБД, а также для системных администраторов, которые могут не обладать глубокими знаниями в области структур физического проектирования.  

## <a name="prerequisites"></a>Предварительные требования 

Для работы с этим учебником требуется среда SQL Server Management Studio, доступ к серверу SQL Server и база данных AdventureWorks.

- Установите [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).
- Установите выпуск [SQL Server 2017 Developer Edition](https://www.microsoft.com/sql-server/sql-server-downloads).
- Скачайте [пример базы данных AdventureWorks2017](https://docs.microsoft.com/sql/samples/adventureworks-install-configure?view=sql-server-2017).


См. инструкции по восстановлению резервной копии базы данных с помощью SSMS см. в статье: [Восстановление базы данных](https://docs.microsoft.com/sql/relational-databases/backup-restore/restore-a-database-backup-using-ssms?view=sql-server-2017).

  >[!NOTE]
  > Этот учебник предназначен для пользователей, которые знакомы с SQL Server Management Studio и основными задачами по администрированию базы данных. 
  
## <a name="tuning-a-workload"></a>Настройка рабочей нагрузки
Помощник по настройке ядра СУБД можно использовать для определения физической структуры базы данных и выбранных таблиц, оптимальной с точки зрения производительности запросов.  

1.  Скопируйте пример инструкции [SELECT](../../t-sql/queries/select-examples-transact-sql.md) и вставьте эту инструкцию в редактор запросов для [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Сохраните файл с именем **MyScript.sql** в каталог, где его будет легко найти. Ниже приведен пример, который работает с базой данных AdventureWorks2017.  

 ```sql
 Use [Adventureworks2017]; -- may need to modify database name to match database
 GO
 SELECT DISTINCT pp.LastName, pp.FirstName 
 FROM Person.Person pp JOIN HumanResources.Employee e
 ON e.BusinessEntityID = pp.BusinessEntityID WHERE pp.BusinessEntityID IN 
 (SELECT SalesPersonID 
 FROM Sales.SalesOrderHeader
 WHERE SalesOrderID IN 
 (SELECT SalesOrderID 
 FROM Sales.SalesOrderDetail
 WHERE ProductID IN 
 (SELECT ProductID 
 FROM Production.Product p 
 WHERE ProductNumber = 'BK-M68B-42')));
 GO
 ```

  ![Сохранение SQL-запроса](media/dta-tutorials/dta-save-query.png)
  
2.  Запустите помощник по настройке ядра СУБД. Выберите элемент **Помощник по настройке ядра СУБД** из меню **Инструменты** в SQL Server Management Studio (SSMS).  Дополнительные сведения см. в разделе [Запуск помощника по настройке ядра СУБД](lesson-1-basic-navigation-in-database-engine-tuning-advisor.md#launch-database-tuning-advisor). Подключитесь в SQL Server в диалоговом окне **Подключение к серверу**.  
  
3.  На вкладке **Общие** на панели графического пользовательского интерфейса помощника по настройке ядра СУБД справа в поле **Имя сеанса** введите **MySession**. 
  
4.  Выберите **Файл** для нужной **рабочей нагрузки** и щелкните значок бинокля, чтобы **Найти файл рабочей нагрузки**. Откройте файл **MyScript.sql**, сохраненный на шаге 1.  

   ![Поиск ранее сохраненного скрипта](media/dta-tutorials/dta-script.png)
  
5.  Выберите в списке **База данных для анализа нагрузки** значение AdventureWorks2017, щелкните AdventureWorks2017 в сетке **Выберите базы данных и таблицы для настройки** и установите флажок **Сохранить журнал настройки**. В поле**База данных для анализа рабочей нагрузки** указывается первая база данных, к которой будет подключаться помощник по настройке ядра СУБД при настройке рабочей нагрузки. После начала настройки помощник по настройке ядра СУБД подключается к базам данных, определенным в инструкциях `USE DATABASE` , которые содержатся в рабочей нагрузке.  

  ![Параметры помощника по настройке для базы данных](media/dta-tutorials/dta-select-db.png)
  
6.  Перейдите на вкладку **Параметры настройки** . В этом задании не рассматривается настройка параметров, однако рекомендуется ознакомиться со значениями параметров по умолчанию. Нажмите клавишу F1, чтобы вызвать справку для этой страницы с вкладками. Нажмите кнопку **Дополнительные параметры** , чтобы просмотреть дополнительные параметры настройки. Нажмите кнопку **Справка** в диалоговом окне **Расширенные параметры настройки** , чтобы просмотреть дополнительные сведения о параметрах настройки. Нажмите кнопку **Отмена** , чтобы закрыть диалоговое окно **Расширенные параметры настройки** и оставить заданные по умолчанию параметры.  

  ![Параметры настройки DTA](media/dta-tutorials/dta-tuning-options.png)
  
7.  На панели инструментов нажмите кнопку **Начать анализ** . Пока помощник по настройке ядра СУБД ведет анализ рабочей нагрузки, ход выполнения анализа отображается на вкладке **Ход выполнения** . После завершения настройки отображается вкладка **Рекомендации** .  
  
    При возникновении ошибки даты и времени остановки настройки проверьте значение времени **Остановиться** на вкладке **Параметры настройки** . Убедитесь в том, что дата и время в поле **Остановиться** превышают текущие дату и время, и при необходимости измените значения.  

  ![Начать анализ помощника по настройке ядра СУБД](media/dta-tutorials/dta-start-analysis.png)

  
8.  После завершения анализа сохраните рекомендации в виде скрипта [!INCLUDE[tsql](../../includes/tsql-md.md)] , выбрав пункт **Сохранить рекомендации** в меню **Действия** . В диалоговом окне **Сохранить как** перейдите в каталог, где требуется сохранить скрипт рекомендаций, и введите имя файла **MyRecommendations**.  

  ![Сохранить рекомендации помощника по настройке ядра СУБД](media/dta-tutorials/dta-save-recommendations.png)

## <a name="view-tuning-recommendations"></a>Просмотр рекомендаций по настройке
  
1.  На вкладке **Рекомендации** с помощью полосы прокрутки внизу страницы с вкладками просмотрите все столбцы в области **Рекомендации по индексам** . Каждая строка отображает объект базы данных (индекс или индексированное представление), который помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] рекомендует удалить или создать. Прокрутите содержимое до крайнего правого столбца и нажмите кнопку **Определение**. [!INCLUDE[ssDE](../../includes/ssde-md.md)] отобразит окно **Предварительный просмотр скрипта SQL** , где можно просмотреть скрипт [!INCLUDE[tsql](../../includes/tsql-md.md)] , создающий или удаляющий объект базы данных в этой строке. Нажмите кнопку **Закрыть** , чтобы закрыть окно предварительного просмотра.  
  
    В случае возникновения трудностей при размещении окна **Определение** , содержащего ссылку, снимите флажок **Показать существующие объекты** в нижней части страницы с вкладками, что приведет к уменьшению количества отображаемых строк. Если этот флажок снят, помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] отображает только те объекты, для которых были сформированы рекомендации. Установите флажок **Показать существующие объекты** , чтобы просмотреть все объекты базы данных, существующие в базе данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] в настоящий момент. Используйте полосу прокрутки с правой стороны страницы с вкладками, чтобы просмотреть все объекты.

  ![Рекомендации по индексу помощника по настройке ядра СУБД](media/dta-tutorials/dta-recommendation.png)  
  
2.  Щелкните правой кнопкой мыши сетку на панели **Рекомендации по индексам** . В появившемся контекстном меню можно выбрать рекомендации или отменить сделанный выбор. Здесь также можно менять шрифт текста сетки.  
 
   ![Меню выбора для рекомендаций по индексам](media/dta-tutorials/dta-index-recommendation-options.png)
  
3.  В меню **Действия** выберите команду **Сохранить рекомендации** , чтобы сохранить все рекомендации в одном скрипте [!INCLUDE[tsql](../../includes/tsql-md.md)] . Присвойте скрипту имя **MySessionRecommendations.sql**.  
  
    Чтобы просмотреть скрипт MySessionRecommendations.sql, откройте его в редакторе запросов среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] . Можно применить эти рекомендации к образцу базы данных [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] , выполнив скрипт в редакторе запросов, но делать этого не следует. Закройте скрипт в редакторе запросов, не запуская его.  
  
    Другой способ применить рекомендации — выбрать команду **Применение рекомендаций** в меню **Действия** помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] , однако в этой практической работе не следует это делать.  
  
4.  Если на вкладке **Рекомендации** несколько рекомендаций, очистите некоторые из строк, в которых перечислены объекты базы данных в сетке **Рекомендации по индексам** .  
  
5.  В меню **Действия** выберите команду **Оценить рекомендации**. [!INCLUDE[ssDE](../../includes/ssde-md.md)] создаст новый сеанс настройки, в котором можно провести оценку набора исходных рекомендаций из сеанса настройки MySession.  
  
6.  Введите **EvaluateMySession** в поле **Имя сеанса**и нажмите кнопку **Начать анализ** на панели инструментов. Можно повторить шаги 2 и 3 для этого нового сеанса настройки, чтобы просмотреть его рекомендации.  
  
### <a name="summary"></a>Сводка  
Оценка набора рекомендаций по настройке может оказаться обязательной, если появится необходимость изменить параметры настройки после выполнения сеанса. Например, если помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] был настроен таким образом, чтобы учитывать возможность использования индексированных представлений для сеанса, но после формирования рекомендации было принято решение не использовать индексированные представления. В этом случае можно воспользоваться параметром **Оценить рекомендации** в меню **Действия**, чтобы поручить помощнику по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] выполнить повторную оценку сеанса без учета индексированных представлений. Когда запускается команда **Оценить рекомендации** , сформированные ранее рекомендации виртуально применяются к текущей физической структуре базы данных, чтобы образовать физическую структуру для второго сеанса настройки.  
  
Дополнительные сведения о результатах настройки можно получить на вкладке **Отчеты** , которая рассматривается в следующем задании этой задачи.  

## <a name="view-tuning-reports"></a>Просмотр отчетов настройки
Хотя полезно просматривать скрипты, которые можно использовать для применения результатов настройки, помощник по настройке ядра СУБД также предоставляет много полезных отчетов. Эти отчеты содержат сведения о существующих структурах физического проектирования в настраиваемой базе данных, а также о рекомендуемых структурах. Отчеты настройки можно просмотреть, перейдя на вкладку **Отчеты** , как описано в следующей практической работе.


1. Щелкните вкладку **Отчеты**  в помощнике по настройке ядра СУБД. 
2. На панели **Сводка по настройке** можно просмотреть сведения об этом сеансе настройки. Используйте полосу прокрутки, чтобы просмотреть содержимое панели полностью. Обратите внимание на поля **Ожидаемый процент улучшений** и **Пространство, занятое рекомендацией**. При настройке можно ограничить место для рекомендаций. На вкладке **Параметры настройки** выберите **Дополнительные параметры**. Установите флажок **Определить размер места для рекомендаций (МБ)** и укажите в мегабайтах максимальный объем, который может занимать конфигурация рекомендаций. Для возврата в этот учебник нажмите кнопку **Назад** в окне справки. 

    ![Сводка по настройке DTA](media/dta-tutorials/dta-tuning-summary.png)
  
3.  На панели **Отчеты о настройке** щелкните **Отчет о стоимости инструкций** в списке **Выбор отчета** . Если необходимо больше места для просмотра отчета, перетащите границу панели **Монитор сеансов** влево. У каждой инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] , применяемой к таблице базы данных, есть своя стоимость применения. Эта стоимость может быть уменьшена путем создания эффективных индексов для часто используемых столбцов таблицы. Данный отчет показывает предполагаемую степень улучшения при выполнении рекомендации по настройке по сравнению с исходной стоимостью выполнения инструкции. Обратите внимание, что количество данных, содержащихся в отчете, основано на размере и сложности рабочей нагрузки.  

    ![Стоимость инструкции в отчете помощника по настройке ядра СУБД](media/dta-tutorials/dta-statement-cost.png)
  
4.  Щелкните правой кнопкой мыши панель **Отчет о стоимости инструкций** в области сетки и выберите команду **Экспорт в файл**. Сохраните отчет под именем **MyReport**. К имени файла будет автоматически добавлено расширение XML. Файл MyReport.xml можно открыть в любом XML-редакторе или в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] , чтобы просмотреть содержимое отчета.  
  
5.  Вернитесь на вкладку **Отчеты** помощника по настройке ядра СУБД и снова щелкните правой кнопкой мыши область **Отчет о стоимости инструкций** . Просмотрите другие доступные параметры. Обратите внимание, что можно менять шрифт просматриваемого отчета. Изменение шрифта повлияет и на другие страницы с вкладками.  
  
6.  Щелкните другие отчеты в списке **Выбор отчета** , чтобы ознакомиться с ними.  
  
### <a name="summary"></a>Сводка  
Изучена вкладка **Отчеты** графического интерфейса помощника по настройке ядра СУБД для сеанса настройки MySession. Выполните эти шаги, чтобы ознакомиться с отчетами, созданными для сеанса настройки EvaluateMySession. Дважды щелкните сеанс **EvaluateMySession** на панели **Монитор сеансов** .  


 ## <a name="next-lesson"></a>Следующее занятие  
[Урок 3. Использование программы командной строки помощника по настройке ядра СУБД](../../tools/dta/lesson-3-using-the-dta-command-prompt-utility.md)  
   
  
  
