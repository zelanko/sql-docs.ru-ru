---
title: "Обработка ошибок (XQuery) | Документы Microsoft"
ms.custom: 
ms.date: 03/17/2017
ms.prod: sql-non-specified
ms.reviewer: 
ms.suite: 
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: language-reference
applies_to: SQL Server
dev_langs: XML
helpviewer_keywords:
- static errors
- errors [XQuery]
- XQuery, error handling
- dynamic errors [XQuery]
ms.assetid: 7dee3c11-aea0-4d10-9126-d54db19448f2
caps.latest.revision: "29"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: d4bb61baa736b9bc4554524ee366359e41741d4e
ms.sourcegitcommit: 9678eba3c2d3100cef408c69bcfe76df49803d63
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2017
---
# <a name="error-handling-xquery"></a>Обработка ошибок (XQuery)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx_md](../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Спецификация W3C позволяет стирать ошибки типа данных статически или динамически и определяет статические, динамические ошибки и ошибки типа данных.  
  
## <a name="compilation-and-error-handling"></a>Компиляция и обработка ошибок  
 При обработке синтаксически неверных выражений Xquery и инструкций XML DML возвращаются ошибки компиляции. На этапе компиляции проверяется правильность выражений XQuery и DML-инструкций в контексте статических типов и используются XML-схемы для вывода типов типизированного XML. Если выражение может завершиться неудачей в период выполнения из-за нарушения безопасности типов, компилятор формирует ошибки статических типов. Примерами статических ошибок являются добавление строки к целому числу и запрос несуществующего узла типизированных данных.  
  
 Ошибки XQuery периода выполнения преобразуются в пустые последовательности — это отклонение от стандарта W3C. В результате запроса эти последовательности могут быть представлены как пустой XML или как значение NULL, что зависит от контекста вызова.  
  
 Явное приведение к правильному типу позволяет предотвращать статические ошибки, хотя ошибки приведения типов в период выполнения будут преобразовываться в пустые последовательности.  
  
## <a name="static-errors"></a>Статические ошибки  
 Статические ошибки возвращаются при помощи механизма ошибок языка [!INCLUDE[tsql](../includes/tsql-md.md)]. В сервере [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] ошибки типа данных языка XQuery возвращаются статически. Дополнительные сведения см. в разделе [XQuery и Статическая типизация](../xquery/xquery-and-static-typing.md).  
  
## <a name="dynamic-errors"></a>Динамические ошибки  
 В языке XQuery большинство динамических ошибок сопоставляется с пустой последовательностью («()»). Однако есть два исключения: условия переполнения в функциях агрегации языка XQuery и ошибки проверки XML-DML. Обратите внимание, что большинство динамических ошибок сопоставляется с пустой последовательностью. В противном случае выполнение запроса, которое получает преимущества от XML-индексов, может возбудить непредвиденные ошибки. Поэтому, чтобы обеспечить эффективное выполнение без формирования непредвиденных ошибок, компонент [!INCLUDE[ssDEnoversion](../includes/ssdenoversion-md.md)] сопоставляет динамические ошибки с ().  
  
 Часто в ситуации, когда динамическая ошибка возникнет внутри предиката, отсутствие сигнала об ошибке не меняет семантику, потому что () сопоставляется со значением False. Однако в некоторых случаях возврат () вместо динамической ошибки может вызвать непредвиденные результаты. Следующие примеры иллюстрируют данную ситуацию.  
  
### <a name="example-using-the-avg-function-with-a-string"></a>Пример: Использование функции avg() со строкой  
 В следующем примере [avg, функция](../xquery/aggregate-functions-avg.md) вызывается для вычисления среднего арифметического трех значений. Одно из этих значений представляет собой строку. Поскольку в этом случае экземпляр XML не типизирован, все данные в нем принадлежат к нетипизированному элементарному типу. **Avg()** функция приводит эти значения для **xs: double** перед вычислением среднего. Тем не менее значение `"Hello"`, не может быть приведен к **xs: double** и создает динамическую ошибку. В этом случае вместо возвращения динамической ошибки приведение `"Hello"` для **xs: double** вызывает пустую последовательность. **Avg()** функция пропускает данное значение, вычисляет среднее арифметическое двух других значений и возвращает 150.  
  
```  
DECLARE @x xml  
SET @x=N'<root xmlns:myNS="test">  
 <a>100</a>  
 <b>200</b>  
 <c>Hello</c>  
</root>'  
SELECT @x.query('avg(//*)')  
```  
  
### <a name="example-using-the-not-function"></a>Пример Использования не функция  
 При использовании [работать](../xquery/functions-on-boolean-values-not-function.md) в предикате, например, `/SomeNode[not(Expression)]`, и выражение вызывает динамическую ошибку, вместо ошибки будет возвращена пустая последовательность. Применение **not()** к пустой последовательности возвращает значение True, а не ошибку.  
  
### <a name="example-casting-a-string"></a>Пример: Приведение строки  
 В следующем примере строковая константа "NaN" приводится к типу данных xs:string, затем к xs:double. Результатом является пустой набор строк. Несмотря на то, что строка "NaN" не может успешно быть приведена к типу xs:double, это не может быть определено до момента выполнения, потому что сначала строка приводится к типу xs:string.  
  
```  
DECLARE @x XML  
SET @x = ''  
SELECT @x.query(' xs:double(xs:string("NaN")) ')  
GO  
```  
  
 Однако в данном примере статическая ошибка возникает.  
  
```  
DECLARE @x XML  
SET @x = ''  
SELECT @x.query(' xs:double("NaN") ')  
GO  
```  
  
#### <a name="implementation-limitations"></a>Ограничения реализации  
 **Fn:error()** функция не поддерживается.  
  
## <a name="see-also"></a>См. также:  
 [Справочник по языку XQuery (SQL Server)](../xquery/xquery-language-reference-sql-server.md)   
 [Основы XQuery](../xquery/xquery-basics.md)  
  
  
