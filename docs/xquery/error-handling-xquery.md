---
title: Обработка ошибок (XQuery) | Документация Майкрософт
description: Сведения об обработке ошибок в XQuery и просмотре примеров обработки динамических ошибок.
ms.custom: ''
ms.date: 03/17/2017
ms.prod: sql
ms.prod_service: sql
ms.reviewer: ''
ms.technology: xml
ms.topic: language-reference
dev_langs:
- XML
helpviewer_keywords:
- static errors
- errors [XQuery]
- XQuery, error handling
- dynamic errors [XQuery]
ms.assetid: 7dee3c11-aea0-4d10-9126-d54db19448f2
author: rothja
ms.author: jroth
ms.openlocfilehash: b80fda53a6ce0acfd326f6f897cb6cde1bf0e610
ms.sourcegitcommit: 6593b3b6365283bb76c31102743cdccc175622fe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/02/2020
ms.locfileid: "84305920"
---
# <a name="error-handling-xquery"></a>Обработка ошибок (XQuery)
[!INCLUDE[tsql-appliesto-ss2012-xxxx-xxxx-xxx-md](../includes/tsql-appliesto-ss2012-xxxx-xxxx-xxx-md.md)]

  Спецификация W3C позволяет стирать ошибки типа данных статически или динамически и определяет статические, динамические ошибки и ошибки типа данных.  
  
## <a name="compilation-and-error-handling"></a>Компиляция и обработка ошибок  
 При обработке синтаксически неверных выражений Xquery и инструкций XML DML возвращаются ошибки компиляции. На этапе компиляции проверяется правильность выражений XQuery и DML-инструкций в контексте статических типов и используются XML-схемы для вывода типов типизированного XML. Если выражение может завершиться неудачей в период выполнения из-за нарушения безопасности типов, компилятор формирует ошибки статических типов. Примерами статических ошибок являются добавление строки к целому числу и запрос несуществующего узла типизированных данных.  
  
 Ошибки XQuery периода выполнения преобразуются в пустые последовательности — это отклонение от стандарта W3C. В результате запроса эти последовательности могут быть представлены как пустой XML или как значение NULL, что зависит от контекста вызова.  
  
 Явное приведение к правильному типу позволяет предотвращать статические ошибки, хотя ошибки приведения типов в период выполнения будут преобразовываться в пустые последовательности.  
  
## <a name="static-errors"></a>Статические ошибки  
 Статические ошибки возвращаются при помощи механизма ошибок языка [!INCLUDE[tsql](../includes/tsql-md.md)]. В сервере [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] ошибки типа данных языка XQuery возвращаются статически. Дополнительные сведения см. в разделе [XQuery и статическая типизация](../xquery/xquery-and-static-typing.md).  
  
## <a name="dynamic-errors"></a>Динамические ошибки  
 В языке XQuery большинство динамических ошибок сопоставляется с пустой последовательностью («()»). Однако это два исключения: условия переполнения в функциях агрегации XQuery и ошибки проверки XML-DML. Обратите внимание, что большинство динамических ошибок сопоставляется с пустой последовательностью. В противном случае выполнение запроса, которое получает преимущества от XML-индексов, может возбудить непредвиденные ошибки. Поэтому, чтобы обеспечить эффективное выполнение без формирования непредвиденных ошибок, компонент [!INCLUDE[ssDEnoversion](../includes/ssdenoversion-md.md)] сопоставляет динамические ошибки с ().  
  
 Часто в ситуации, когда динамическая ошибка возникнет внутри предиката, отсутствие сигнала об ошибке не меняет семантику, потому что () сопоставляется со значением False. Однако в некоторых случаях возврат () вместо динамической ошибки может вызвать непредвиденные результаты. Следующие примеры иллюстрируют данную ситуацию.  
  
### <a name="example-using-the-avg-function-with-a-string"></a>Пример. Использование функции AVG () со строкой  
 В следующем примере вызывается [функция AVG](../xquery/aggregate-functions-avg.md) для вычисления среднего значения трех значений. Одно из этих значений представляет собой строку. Поскольку в этом случае экземпляр XML не типизирован, все данные в нем принадлежат к нетипизированному элементарному типу. Функция **AVG ()** сначала приводит эти значения к **типу xs: Double** перед вычислением среднего. Однако значение, `"Hello"` , не может быть приведено к **типу xs: Double** и создает динамическую ошибку. В этом случае, вместо возвращающей динамическую ошибку, приведение `"Hello"` к **типу xs: Double** приводит к пустой последовательности. Функция **AVG ()** игнорирует это значение, вычисляет среднее для других двух значений и возвращает 150.  
  
```  
DECLARE @x xml  
SET @x=N'<root xmlns:myNS="test">  
 <a>100</a>  
 <b>200</b>  
 <c>Hello</c>  
</root>'  
SELECT @x.query('avg(//*)')  
```  
  
### <a name="example-using-the-not-function"></a>Пример. Использование функции not  
 Если вы используете [функцию not](../xquery/functions-on-boolean-values-not-function.md) в предикате, например, `/SomeNode[not(Expression)]` и выражение вызывает динамическую ошибку, вместо ошибки возвращается пустая последовательность. Применение **NOT ()** к пустой последовательности возвращает значение true вместо ошибки.  
  
### <a name="example-casting-a-string"></a>Пример. приведение строки  
 В следующем примере строковая константа "NaN" приводится к типу данных xs:string, затем к xs:double. Результатом является пустой набор строк. Несмотря на то, что строка "NaN" не может успешно быть приведена к типу xs:double, это не может быть определено до момента выполнения, потому что сначала строка приводится к типу xs:string.  
  
```  
DECLARE @x XML  
SET @x = ''  
SELECT @x.query(' xs:double(xs:string("NaN")) ')  
GO  
```  
  
 Однако в данном примере статическая ошибка возникает.  
  
```  
DECLARE @x XML  
SET @x = ''  
SELECT @x.query(' xs:double("NaN") ')  
GO  
```  
  
#### <a name="implementation-limitations"></a>Ограничения реализации  
 Функция **fn: Error ()** не поддерживается.  
  
## <a name="see-also"></a>См. также:  
 [Справочник по языку XQuery &#40;SQL Server&#41;](../xquery/xquery-language-reference-sql-server.md)   
 [Основы языка XQuery](../xquery/xquery-basics.md)  
  
  
