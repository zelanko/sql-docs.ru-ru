---
title: Воспроизведение трассировки для SQL Server обновлений
description: Воспроизведение трассировки с Database Experimentation Assistant для SQL Server обновлений
ms.custom: seo-lt-2019
ms.date: 12/12/2019
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: rajsell
ms.reviewer: mathoma
ms.openlocfilehash: 50f082edef5d9a6d4e95b7e37ef6d75f22eb6f2a
ms.sourcegitcommit: 6fd8c1914de4c7ac24900fe388ecc7883c740077
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "79289152"
---
# <a name="replay-a-trace-in-database-experimentation-assistant"></a>Воспроизведение трассировки в Database Experimentation Assistant

В Database Experimentation Assistant (ДЕА) можно воспроизвести захваченный файл трассировки в обновленной тестовой среде. Например, рассмотрим рабочую нагрузку, которая работает на SQL Server 2008 R2. Файл трассировки для рабочей нагрузки должен воспроизводиться дважды: один раз в среде с той же версией SQL Server, которая выполняется в рабочей среде, и второй раз в окружении, где используется версия SQL Server, например SQL Server 2016.

> [!NOTE]
> Для воспроизведения трассировки необходимо вручную настроить виртуальные машины или физические компьютеры для запуска трассировок распределенное воспроизведение. Дополнительные сведения см. в разделе [настройка распределенное воспроизведение для Database experimentation Assistant](database-experimentation-assistant-configure-replay.md).
>

## <a name="configure-a-trace-replay-for-target-1"></a>Настройка воспроизведения трассировки для целевого объекта 1

Во-первых, необходимо выполнить трассировку для целевого объекта 1, который представляет существующую рабочую среду.

1. В ДЕА на панели навигации слева щелкните значок со стрелкой, а затем на странице **все воспроизведения** выберите **новое воспроизведение**.

    ![Создание воспроизведения в ДЕА](./media/database-experimentation-assistant-replay-trace/dea-create-replay.png)

    > [!NOTE]
    > Компьютеру контроллера распределенное воспроизведение требуются разрешения для учетной записи пользователя, используемой для удаленного подключения.

2. На **новой странице воспроизведения** в разделе **сведения о воспроизведении**введите или выберите следующие сведения.

    - **Имя воспроизведения**: введите имя для воспроизведения трассировки.
    - **Исходный формат трассировки**: укажите формат (Trace или XEvents) исходного файла трассировки.
    - **Полный путь к исходному файлу**: укажите полный путь к исходному файлу трассировки. При использовании DReplay файл должен существовать на компьютере, который обслуживает контроллер DReplay, а учетной записи пользователя требуется доступ к файлу и папке.
    - **Средство воспроизведения**: Укажите средство воспроизведения (DReplay или встроенное).
    - **Имя компьютера контроллера**: укажите имя компьютера, который выступает в качестве контроллера распределенное воспроизведение.
    - **Воспроизвести расположение трассировки**: укажите путь для хранения файлов трассировки или XEvents, связанных с воспроизведением трассировки.

        > [!NOTE]
        > Для базы данных SQL Azure или управляемого экземпляра базы данных SQL Azure необходимо предоставить URI SAS учетной записи хранилища BLOB-объектов Azure.

3. Убедитесь, что вы восстановили базы данных, нажав кнопку **Да, флажок базы данных восстановлен вручную** .

4. В разделе **SQL Server сведения о подключении**введите или выберите следующие сведения:

    - **Тип сервера**: Укажите тип SQL Server (**SQLServer**, **азуресклдб**, **азуресклманажединстанце**).
    - **Имя сервера**: укажите имя или IP-адрес сервера SQL Server.
    - **Тип проверки подлинности**. Выберите **Windows**в качестве типа проверки подлинности.
    - **Имя базы данных**: введите имя базы данных, в которой должна начинаться трассировка на стороне сервера. Если не указать базу данных, трассировка будет захвачена во всех базах данных на сервере.

5. Установите или снимите флажки **Шифровать соединение** и **доверять сертификату сервера** в соответствии с вашими сценариями.

    ![Новая страница воспроизведения](./media/database-experimentation-assistant-replay-trace/dea-new-replay.png)

## <a name="start-the-trace-replay-on-target-1"></a>Запуск воспроизведения трассировки на целевом объекте 1

- После ввода или выбора требуемой информации выберите **Запуск** , чтобы начать воспроизведение трассировки.

  Если введенные сведения являются допустимыми, запускается процесс распределенное воспроизведение. В противном случае текстовые поля с неправильными сведениями выделяются красным цветом. Убедитесь, что введены правильные значения, а затем нажмите кнопку **запустить**.

  ![Воспроизвести ход выполнения для целевого объекта 1](./media/database-experimentation-assistant-replay-trace/dea-run-replay-target1.png)

  Этот процесс можно отслеживать по мере необходимости. Когда воспроизведение будет завершено, ДЕА сохранит результаты в файле в указанном расположении.

  ![Воспроизвести с целевого объекта 1 завершено](./media/database-experimentation-assistant-replay-trace/dea-replay-target1-complete.png)

## <a name="perform-the-trace-replay-against-target-2"></a>Выполнение воспроизведения трассировки для целевого объекта 2

После завершения воспроизведения трассировки для целевого объекта 1 необходимо сделать то же самое для второго целевого объекта, который представляет предполагаемую среду обновления.

1. Настройте воспроизведение трассировки, в этот раз используя сведения, связанные с целевой средой 2.
2. Запустите воспроизведение трассировки на целевом компьютере 2.

   Этот процесс можно отслеживать по мере необходимости. Когда воспроизведение будет завершено, ДЕА сохранит результаты в файле в указанном расположении.

## <a name="frequently-asked-questions-about-trace-replay"></a>Часто задаваемые вопросы о воспроизведении трассировки

**Вопрос. какие разрешения безопасности требуются для запуска записи воспроизведения на целевом сервере?**

- Пользователь Windows, выполняющий операцию трассировки в приложении Деа, должен иметь права системного администратора на целевом компьютере, на котором выполняется SQL Server. Эти права пользователя необходимы для запуска трассировки.
- Учетная запись службы, под которой выполняется SQL Server, должна иметь доступ на запись к указанному пути файла трассировки.
- Учетная запись службы, под которой выполняются клиентские службы распределенное воспроизведение, должна иметь права пользователя для подключения к целевому компьютеру, на котором выполняется SQL Server, и для выполнения запросов.

**Вопрос. можно ли запускать более одного воспроизведения в одном сеансе?**

Да, можно запустить несколько повторов и отследить их до завершения в одном сеансе.

**Вопрос. можно ли запускать более одного воспроизведения параллельно?**

Да, но не с тем же набором компьютеров, выбранным в поле **Клиенты контроллера Plus**. Контроллер и клиенты будут заняты. Настройте отдельный набор компьютеров в разделе **контроллер и клиент** , чтобы начать параллельное воспроизведение.

**Вопрос. Сколько времени воспроизведение обычно займет?**

Воспроизведение обычно занимает то же время, что и исходная трассировка, а также время, необходимое для предварительной обработки трассировки источника. Однако если клиентские компьютеры, зарегистрированные в контроллере, недостаточно для управления нагрузкой, созданной на основе воспроизведения, воспроизведение может занять больше времени. Контроллер может зарегистрировать до 16 клиентских компьютеров.

**Вопрос. насколько велики целевые файлы трассировки?**

Целевые файлы трассировки могут находиться в диапазоне от 5 до 15 раз в длину трассировки источника. Размер файла зависит от количества выполняемых запросов. Например, большие двоичные объекты плана запроса могут быть большими. Если статистика для этих запросов изменяется часто, записываются дополнительные события.

**Вопрос. Зачем нужно восстанавливать базы данных?**

SQL Server — это система управления реляционными базами данных с отслеживанием состояния. Для правильного выполнения теста A/B состояние базы данных должно храниться в любое время. В противном случае в запросах во время воспроизведения могут отображаться ошибки, которые не отображаются в рабочей среде. Чтобы избежать этих ошибок, рекомендуется сделать резервную копию прямо перед записью источника. Аналогичным образом, чтобы предотвратить возникновение ошибок во время воспроизведения, необходимо восстановить резервную копию на целевом компьютере, на котором выполняется SQL Server.

**Вопрос. что означает "Pass%" на странице воспроизведения?**

**Pass%** означает, что передается только процент запросов. Можно определить, ожидается ли количество ошибок. Ошибки могут быть ожидаемыми, или ошибки могут возникать из-за потери целостности базы данных. Если значение для параметра **Pass%** не соответствует ожиданиям, можно отключить трассировку и просмотреть файл трассировки в SQL Profiler, чтобы узнать, какие запросы не были выполнены успешно.

**Вопрос. как можно просмотреть события трассировки, собранные во время воспроизведения?**

Откройте целевой файл трассировки и просмотрите его в SQL Profiler. Или, если вы хотите внести изменения в запись воспроизведения, все сценарии SQL Server доступны на языке C\\: Program Files (x86)\\Корпорация Майкрософт\\Database experimentation Assistant\\Scripts\\стартреплайкаптуре. SQL.

**Вопрос. какие события трассировки ДЕА собираются во время воспроизведения?**

ДЕА фиксирует события трассировки, содержащие сведения о производительности. Конфигурация отслеживания находится в скрипте Стартреплайкаптуретраце. SQL. Эти события являются типичными SQL Server событий трассировки, которые перечислены в [справочной документации по sp_trace_setevent (Transact-SQL)](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-trace-setevent-transact-sql).

## <a name="troubleshoot-trace-replay"></a>Устранение неполадок при воспроизведении трассировки

**Вопрос. Почему не удается подключиться к компьютеру, на котором работает SQL Server?**

- Убедитесь, что имя компьютера, на котором работает SQL Server, является допустимым. Для подтверждения попробуйте подключиться к серверу с помощью SQL Server Management Studio (SSMS).
- Убедитесь, что конфигурация брандмауэра не блокирует подключения к компьютеру, на котором работает SQL Server.
- Убедитесь, что у пользователя есть необходимые права пользователя.
- Убедитесь, что учетная запись службы клиента распределенное воспроизведение имеет доступ к компьютеру, на котором работает SQL Server.

Дополнительные сведения можно получить в журналах в каталоге% temp%\\ДЕА. Если проблема не исчезнет, обратитесь к группе разработчиков продукта.

**Вопрос. Почему не удается подключиться к контроллеру распределенное воспроизведение?**

- Убедитесь, что служба контроллера распределенное воспроизведение запущена на компьютере контроллера. Для проверки используйте средства управления распределенное воспроизведение (выполните команду `dreplay.exe status -f 1`).
- Если воспроизведение запускается удаленно:
  - Убедитесь, что компьютер, на котором работает Деа, может успешно проверить связь с контроллером. Убедитесь, что параметры брандмауэра разрешают подключения в соответствии с инструкциями на странице **Настройка среды воспроизведения** . Дополнительные сведения см. в статье [SQL Server распределенное воспроизведение](https://docs.microsoft.com/sql/tools/distributed-replay/sql-server-distributed-replay?view=sql-server-2017).
  - Убедитесь, что удаленный запуск и удаленная активация DCOM разрешены для пользователя контроллера распределенное воспроизведение.
  - Убедитесь, что для пользователя контроллера распределенное воспроизведение разрешены права удаленного доступа DCOM.

**Вопрос. путь к файлу трассировки существует на компьютере. Почему распределенное воспроизведение контроллер не может найти его?**

Распределенное воспроизведение может получать доступ только к локальным дискам. Перед началом воспроизведения необходимо скопировать исходные файлы трассировки на компьютер контроллера распределенное воспроизведение. Кроме того, необходимо указать путь на ДЕА новой странице **воспроизведения** .

Пути UNC несовместимы с распределенное воспроизведение. Пути распределенное воспроизведение должны быть локальными, абсолютными путями к первому исходному файлу трассировки, включая расширение.

**Вопрос. Почему не удается найти файлы на новой странице воспроизведения?**

Поскольку не удается просматривать папки на удаленном компьютере, просмотр файлов не полезен. Более эффективно копировать и вставлять абсолютные пути.

**Вопрос. я начата воспроизведение с трассировкой, но распределенное воспроизведение не воспроизводил какие-либо события. Важно?**

Эта проблема может возникать, если файл трассировки не содержит воспроизводимых событий или не содержит сведений о том, как воспроизвести события. Убедитесь, что указанный путь к файлу трассировки указывает на исходный файл трассировки. Исходный файл трассировки создается с помощью конфигурации, представленной в скрипте Старткаптуретраце. SQL.

**Вопрос. я вижу "непредвиденная ошибка" при попытке предварительной обработки файлов трассировки с помощью контроллера распределенное воспроизведение SQL Server 2017. Важно?**

Эта проблема известна в RTM-версии SQL Server 2017. Дополнительные сведения см. в статье [непредвиденная ошибка при использовании функции DReplay для воспроизведения захваченной трассировки в SQL Server 2017](https://support.microsoft.com/help/4045678/fix-unexpected-error-when-you-use-the-dreplay-feature-to-replay-a).  
  
Эта ошибка устранена в последнем накопительном пакете обновления 1 для SQL Server 2017. Скачайте последнюю версию [накопительного пакета обновления 1 для SQL Server 2017](https://support.microsoft.com/help/4038634/cumulative-update-1-for-sql-server-2017).

## <a name="see-also"></a>См. также

- Чтобы создать аналитический отчет, который поможет получить представление о предлагаемых изменениях, см. раздел [Создание отчетов](database-experimentation-assistant-create-report.md).
