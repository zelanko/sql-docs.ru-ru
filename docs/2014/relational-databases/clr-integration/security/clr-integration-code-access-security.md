---
title: Безопасность доступа к коду для интеграции со средой CLR | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- UNSAFE assemblies
- permissions [CLR integration]
- common language runtime [SQL Server], security
- SAFE assemblies
- code access security [CLR integration]
- EXTERNAL_ACCESS assemblies
ms.assetid: 2111cfe0-d5e0-43b1-93c3-e994ac0e9729
author: rothja
ms.author: jroth
manager: craigg
ms.openlocfilehash: d829ef131bc8772ce2d84391513ffa52b2f2ff1a
ms.sourcegitcommit: 6fd8c1914de4c7ac24900fe388ecc7883c740077
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2020
ms.locfileid: "62873740"
---
# <a name="clr-integration-code-access-security"></a>Управление доступом для кода на основе интеграции со средой CLR
  Среда CLR поддерживает модель безопасности, называемую управлением доступом для кода. В этой модели разрешения предоставляются сборкам на основе идентификатора кода. Дополнительные сведения см. в разделе «Управление доступом для кода» справочной документации пакета средств разработки программного обеспечения .NET Framework.  
  
 Политика безопасности, которая регламентирует разрешения, предоставляемые сборкам, определяется в трех разных местах.  
  
-   Политика компьютера: Эта политика действует для всего управляемого кода, выполняемого на компьютере, на котором [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] установлен.  
  
-   Политика пользователя. это политика, действующая для управляемого кода, размещенного в процессе. Для [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] службы работает.  
  
-   Политика узла. Эта политика настраивается узлом среды CLR (в данном случае [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]), которая действует для управляемого кода, выполняемого на этом узле.  
  
 Механизм управления доступом к коду, поддерживаемый средой CLR, основан на предположении, что в среде времени выполнения может размещаться код, доверенный полностью или частично. Ресурсы, защищенные с помощью управления доступом для кода CLR, обычно упаковываются управляемыми прикладными программными интерфейсами, которые рекуиресе соответствующее разрешение, прежде чем разрешить доступ к ресурсу. Демандфор разрешение удовлетворяется только в том случае, если все вызывающие объекты (на уровне сборки) в стеке вызовов имеют соответствующее разрешение ресурса.  
  
 Набор разрешений управления доступом для кода, предоставляемый управляемому коду при выполнении внутри [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , предоставляет набор разрешений на сборку, загруженную в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. в конечном итоге набор разрешений, предоставленный пользовательскому коду, может быть ограничен дополнительными политиками уровня пользователя и компьютера.  
  
## <a name="sql-server-host-policy-level-permission-sets"></a>Наборы разрешений на уровне политики узла SQL Server  
 Набор разрешений CAS, который предоставляется определяемым пользователем сборкам на уровне политики узла [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], определяется набором разрешений, заданным при создании сборки. Существует три набора разрешений `SAFE`: `EXTERNAL_ACCESS` и `UNSAFE` (задаются с помощью параметра **PERMISSION_SET** [создания сборки &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql)).  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Эта политика не предназначена для домена приложения по умолчанию, который применяется при создании в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] экземпляра среды CLR.  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Фикседполици для системных сборок и определяемой пользователем политики для пользовательских сборок.  
  
 Фиксированная политика для сборок CLR и системных сборок [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] предоставляет этим сборкам полное доверие.  
  
 В основе пользовательской части политики сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] лежит указание владельцем сборки одного из трех сегментов разрешений для каждой сборки. Дополнительные сведения о правах доступа, перечисленных ниже, см. в документации пакета SDK для платформы .NET Framework.  
  
### <a name="safe"></a>SAFE  
 Разрешаются только внутренние вычисления и локальный доступ к данным. Набор разрешений `SAFE` является наиболее ограниченным. Код, выполняемый сборкой с разрешениями `SAFE`, не может получить доступ к внешним системным ресурсам, таким как файлы, сеть, переменные среды или реестр.  
  
 Сборки `SAFE` обладают следующими разрешениями и значениями свойств.  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|`SecurityPermission`|`Execution:` разрешение на выполнение управляемого кода.|  
|`SqlClientPermission`|`Context connection = true`, `context connection = yes`. Можно использовать только контекстное соединение; в строке соединения можно задавать только значение «context connection=true» или «context connection=yes».<br /><br /> **Алловбланкпассворд = false:**  Пустые пароли не допускаются.|  
  
### <a name="external_access"></a>EXTERNAL_ACCESS  
 Сборки EXTERNAL_ACCESS имеют те же разрешения, `SAFE` что и сборки, с дополнительной возможностью доступа к внешним системным ресурсам, таким как файлы, сети, переменные среды и реестр.  
  
 Сборки `EXTERNAL_ACCESS` обладают также следующими разрешениями и значениями свойств.  
  
|Разрешение|Значения и описание|  
|----------------|-----------------------------|  
|`DistributedTransactionPermission`|`Unrestricted:`Распределенные транзакции разрешены.|  
|`DNSPermission`|`Unrestricted:`Разрешение на запрос сведений с серверов доменных имен.|  
|`EnvironmentPermission`|`Unrestricted:` разрешается полный доступ к системным и пользовательским переменным среды.|  
|`EventLogPermission`|`Administer:` разрешаются следующие действия: создание источника события, чтение существующих журналов, удаление источников событий или журналов, формирование ответов на записи, очистка журнала событий, прослушивание событий и доступ к коллекции всех журналов событий.|  
|`FileIOPermission`|`Unrestricted:` разрешен полный доступ к файлам и папкам.|  
|`KeyContainerPermission`|`Unrestricted:` разрешен полный доступ к ключевым контейнерам.|  
|`NetworkInformationPermission`|`Access:` разрешено выполнять команду ping.|  
|`RegistryPermission`|Предоставляет право чтения разделов `HKEY_CLASSES_ROOT`, `HKEY_LOCAL_MACHINE`, `HKEY_CURRENT_USER`, `HKEY_CURRENT_CONFIG` и `HKEY_USERS.`|  
|`SecurityPermission`|`Assertion:` способность подтверждать, что все объекты, вызывающие этот код, имеют нужные разрешения на эту операцию.<br /><br /> `ControlPrincipal:` способность манипулировать основным объектом.<br /><br /> `Execution:` разрешение на выполнение управляемого кода.<br /><br /> `SerializationFormatter:` способность предоставлять услуги сериализации.|  
|**смтппермиссион**|`Access:` разрешены исходящие соединения с портом сервера SMTP 25.|  
|`SocketPermission`|`Connect:` разрешены исходящие соединения для всех портов и протоколов по транспортному адресу.|  
|`SqlClientPermission`|`Unrestricted:` разрешен полный доступ к источнику данных.|  
|`StorePermission`|`Unrestricted:` разрешен полный доступ к хранилищам сертификатов X.509.|  
|`WebPermission`|`Connect:` разрешены исходящие соединения с веб-ресурсами.|  
  
### <a name="unsafe"></a>UNSAFE  
 Набор UNSAFE предоставляет сборкам неограниченный доступ к внутренним и внешним ресурсам [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Код, вызываемый на выполнение из сборки `UNSAFE`, может также вызывать неуправляемый код.  
  
 Сборки `UNSAFE` получают набор разрешений `FullTrust`.  
  
> [!IMPORTANT]  
>  `SAFE` является рекомендованной установкой разрешений для сборок, которые выполняют задачи вычисления и управления данными без доступа к ресурсам вне [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. `EXTERNAL_ACCESS`сборки по умолчанию выполняются в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] качестве учетной записи службы. `EXTERNAL_ACCESS` разрешение на выполнение должно предоставляться только именам входа, доверенным для запуска от имени учетной записи службы. С точки зрения безопасности сборки `EXTERNAL_ACCESS` и `UNSAFE` являются идентичными. Но сборки `EXTERNAL_ACCESS` предоставляют различные средства защиты, обладающие надежностью и прочностью, которые не предусмотрены в сборках `UNSAFE`. Указание `UNSAFE` позволяет коду в сборке выполнять недопустимые операции с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]. Дополнительные сведения о создании сборок среды CLR в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]см. в разделе [Управление сборками интеграции со средой CLR](../../../relational-databases/clr-integration/assemblies/managing-clr-integration-assemblies.md).  
  
## <a name="accessing-external-resources"></a>Доступ к внешним ресурсам  
 Если сборка с определяемыми пользователем типами (UDT), хранимыми процедурами или конструкциями другого типа зарегистрирована с набором разрешений `SAFE`, то управляемый код, который выполняется в конструкции, не способен получить доступ к внешним ресурсам. Но если задан набор разрешений `EXTERNAL_ACCESS` или `UNSAFE` и в управляемом коде предпринимается попытка получить доступ к внешним ресурсам, то в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] применяются следующие правила.  
  
|Если|То|  
|--------|----------|  
|Контекст выполнения соответствует имени входа [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|Попытки получить доступ к внешним ресурсам отклоняются, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, и контекстом выполнения является первоначальный вызывающий объект.|Доступ к внешнему ресурсу предоставляется в контексте безопасности учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].|  
|Вызывающий объект не является первоначальным вызывающим объектом.|Доступ запрещается, и активизируется исключение безопасности.|  
|Контекст выполнения соответствует имени входа Windows, контекст выполнения является исходным вызывающим объектом, а к вызывающему объекту применяется олицетворение.|При доступе используется контекст безопасности вызывающего объекта, а не учетная запись службы.|  
  
## <a name="permission-set-summary"></a>Сводные данные о наборе разрешений  
 На следующей диаграмме показаны ограничения и разрешения, предоставленные наборам разрешений `SAFE`, `EXTERNAL_ACCESS` и `UNSAFE`.  
  
|||||  
|-|-|-|-|  
||`SAFE`|`EXTERNAL_ACCESS`|`UNSAFE`|  
|`Code Access Security Permissions`|Только выполнение|Выполнение и доступ к внешним ресурсам|Неограниченное (включая P/Invoke)|  
|`Programming model restrictions`|Да|Да|Без ограничений|  
|`Verifiability requirement`|Да|Да|Нет|  
|`Local data access`|Да|Да|Да|  
|`Ability to call native code`|Нет|Нет|Да|  
  
## <a name="see-also"></a>См. также  
 [Безопасность интеграции со средой CLR](clr-integration-security.md)   
 [Атрибуты защиты узла и программирование интеграции со средой CLR](../../clr-integration-security-host-protection-attributes/host-protection-attributes-and-clr-integration-programming.md)   
 [Ограничения модели программирования интеграции со средой CLR](../../../relational-databases/clr-integration/database-objects/clr-integration-programming-model-restrictions.md)   
 [Среда размещения CLR](../clr-integration-architecture-clr-hosted-environment.md)  
  
  
