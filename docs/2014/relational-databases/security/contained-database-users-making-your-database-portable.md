---
title: 'Пользователи автономной базы данных: создание переносимой базы данных | Документация Майкрософт'
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- contained database, users
- user [SQL Server], about contained database users
ms.assetid: e57519bb-e7f4-459b-ba2f-fd42865ca91d
author: VanMSFT
ms.author: vanto
manager: craigg
ms.openlocfilehash: a10f892c8fd635892d76061e9f33649340e69593
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "62655484"
---
# <a name="contained-database-users---making-your-database-portable"></a>Пользователи автономной базы данных — создание переносимой базы данных
  Используйте пользователей автономной базы данных для проверки подлинности подключений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssSDS](../../includes/sssds-md.md)] на уровне базы данных. Автономная база данных — это база данных, изолированная от других баз данных и от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]/[!INCLUDE[ssSDS](../../includes/sssds-md.md)] (и базы данных master), на котором размещена эта база данных. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поддерживает пользователей автономной базы данных для проверки подлинности Windows и [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . При использовании [!INCLUDE[ssSDS](../../includes/sssds-md.md)]объединяйте пользователей автономной базы данных с правилами брандмауэра уровня базы данных. В этом разделе рассматриваются различия и преимущества использования модели автономной базы данных по сравнению с традиционной моделью имя для входа/ пользователь и правилами брандмауэра в Windows или на уровне сервера. Конкретные сценарии, управляемость или приложение бизнес-логики могут по-прежнему требовать использования традиционной модели имя для входа/ пользователь и правила брандмауэра на уровне сервера.  
  
> [!NOTE]  
>  Поскольку [!INCLUDE[msCoName](../../includes/msconame-md.md)] развивает службу [!INCLUDE[ssSDS](../../includes/sssds-md.md)] и переходит к более высокому гарантированному соглашению об уровне обслуживания, может потребоваться переключиться на модель пользователя автономной базы данных и правила брандмауэра уровня базы данных для достижения более высокой доступности соглашения об уровне обслуживания и более высокой максимальной частоты команд Login для конкретной базы данных. 
  [!INCLUDE[msCoName](../../includes/msconame-md.md)] рекомендуется рассмотреть такие изменения сегодня.  
  
## <a name="traditional-login-and-user-model"></a>Традиционная модель имени для входа и пользователя  
 В традиционной модели подключения пользователи Windows или участники групп Windows подключаются к [!INCLUDE[ssDE](../../includes/ssde-md.md)] , указывая учетные данные пользователей или групп, прошедших проверку подлинности в Windows. Кроме того, соединение может указать имя и пароль и использовать проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (что является единственным допустимым вариантом при подключении к [!INCLUDE[ssSDS](../../includes/sssds-md.md)]). В обоих случаях у базы данных master должно быть имя, которое соответствует учетным данным подключения. Когда [!INCLUDE[ssDE](../../includes/ssde-md.md)] подтвердит учетные данные для проверки подлинности Windows или выполнит проверку подлинности учетных данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , соединение обычно пытается подключиться к пользовательской базе данных. Для подключения к пользовательской базе данных имя для входа должно быть сопоставлено (то есть, связано) с пользователем в базе данных. Строка подключения также может указывать на подключение к конкретной базе данных, что не является обязательным в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , но требуется в [!INCLUDE[ssSDS](../../includes/sssds-md.md)].  
  
 Важно, чтобы имя для входа (в базе данных master) и пользователь (в базе данных пользователей) существовали и были связаны друг с другом. Это означает, что подключение к пользовательской базе данных зависит от имени для входа в базе данных master, а это ограничивает возможность перемещения базы данных на другой сервер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] или [!INCLUDE[ssSDSfull](../../includes/sssdsfull-md.md)] . Если по какой-либо причине подключение к базе данных master недоступно (например, выполняется отработка отказа), общее время подключения увеличится или истечет время ожидания подключения. Следовательно, это может снизить масштабируемость подключения.  
  
## <a name="contained-database-user-model"></a>Модель пользователя автономной базы данных  
 В модели пользователей автономной базы данных отсутствует имя входа в базе данных master. Вместо этого процесс проверки подлинности происходит в пользовательской базе данных, а у пользователя нет связанного имени для входа в базе данных master. Модель пользователей автономной базы данных поддерживает как проверку подлинности Windows (в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]), так и проверку подлинности [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и [!INCLUDE[ssSDS](../../includes/sssds-md.md)]). Чтобы подключиться как пользователь автономной базы данных, строка подключения должна всегда содержать параметр для пользовательской базы данных, чтобы [!INCLUDE[ssDE](../../includes/ssde-md.md)] было известно, какая база данных отвечает за управление проверкой подлинности. Область действий пользователя автономной базы данных ограничена базой данных проверки подлинности, поэтому при подключении пользователя автономной базы данных учетная запись пользователя необходимо создавать отдельно в каждой базе данных, которая потребуется пользователю. Для смены базы данных пользователю [!INCLUDE[ssSDS](../../includes/sssds-md.md)] необходимо создать новое соединение. Пользователи автономной базы данных в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] могут менять базы данных, если идентичный пользователь имеется в другой базе данных.  
  
 В [!INCLUDE[ssSDS](../../includes/sssds-md.md)] при переходе с традиционной модели на модель пользователей автономной базы данных не требуется менять строку подключения. Для подключений [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имя базы данных необходимо добавить в строку подключения, если оно там отсутствует.  
  
> [!IMPORTANT]  
>  При использовании традиционной модели роли и разрешения на уровне сервера могут ограничить доступ ко всем базам данных. При использовании модель автономной базы данных владельцы и пользователи баз данных с разрешением ALTER ANY USER могут предоставлять к ней доступ. Это сокращает контроль доступа серверных имен с высоким уровнем разрешений и позволяет включить пользователей базы данных с высоким уровнем разрешений.  
  
## <a name="firewalls"></a>Брандмауэры  
  
### [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]  
 Правила брандмауэра Windows применяются для всех подключений и влияют на имена для входа (традиционной модели подключений) так же, как и на пользователей автономной базы данных. Дополнительные сведения о брандмауэре Windows см. в статье [Настройка брандмауэра Windows для доступа к компоненту Database Engine](../../database-engine/configure-windows/configure-a-windows-firewall-for-database-engine-access.md).  
  
### <a name="includesssdsincludessssds-mdmd-firewalls"></a>[!INCLUDE[ssSDS](../../includes/sssds-md.md)]Брандмауэры  
 
  [!INCLUDE[ssSDS](../../includes/sssds-md.md)] позволяет задавать отдельные правила брандмауэров для подключений на уровне сервера (имен для входа) и подключений уровня базы данных (пользователей автономной базы данных). При подключении к базе данных пользователя сначала проверяются правила брандмауэра базы данных. Если нет правил, позволяющих доступ к базе данных, проверяются правила брандмауэра на уровне сервера, что требует доступа к базе данных master логического сервера. Правила брандмауэра уровня базы данных в сочетании с пользователями автономной базы данных могут исключить необходимость доступа к базе данных master сервера во время подключения, повышая масштабируемость подключений.  
  
 Дополнительные сведения о правилах брандмауэра [!INCLUDE[ssSDS](../../includes/sssds-md.md)] см. в следующих статьях:  
  
-   [Брандмауэр базы данных SQL Azure](https://msdn.microsoft.com/library/azure/ee621782.aspx)  
  
-   [Как настроить параметры брандмауэра (база данных SQL Azure)](https://msdn.microsoft.com/library/azure/jj553530.aspx)  
  
-   [sp_set_firewall_rule &#40;базе данных SQL Azure&#41;](/sql/relational-databases/system-stored-procedures/sp-set-firewall-rule-azure-sql-database)  
  
-   [sp_set_database_firewall_rule &#40;базе данных SQL Azure&#41;](/sql/relational-databases/system-stored-procedures/sp-set-database-firewall-rule-azure-sql-database)  
  
## <a name="syntax-differences"></a>Синтаксические отличия  
  
|Традиционная модель|Модель пользователя автономной базы данных|  
|-----------------------|-----------------------------------|  
|При подключении к базе данных master:<br /><br /> `CREATE LOGIN login_name  WITH PASSWORD = 'strong_password';`<br /><br /> Затем при подключении к базе данных пользователя:<br /><br /> `CREATE USER 'user_name' FOR LOGIN 'login_name';`|При подключении к базе данных пользователя:<br /><br /> `CREATE USER user_name  WITH PASSWORD = 'strong_password';`|  
  
|Традиционная модель|Модель пользователя автономной базы данных|  
|-----------------------|-----------------------------------|  
|Изменение пароля в контексте базы данных master.<br /><br /> `ALTER LOGIN login_name  WITH PASSWORD = 'strong_password';`|Изменение пароля в контексте базы данных пользователя.<br /><br /> `ALTER USER user_name  WITH PASSWORD = 'strong_password';`|  
  
## <a name="remarks"></a>Remarks  
  
-   В [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]пользователи автономной базы данных должны быть включены для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. в статье [Параметр конфигурации сервера contained database authentication](../../database-engine/configure-windows/contained-database-authentication-server-configuration-option.md).  
  
-   Пользователи автономной базы данных и имена для входа с неперекрывающимися именами могут сосуществовать в приложениях.  
  
-   Если имеется имя для входа в базе данных master с именем **name1** и создается пользователь автономной базы данных с именем **name1**, то при указании имени базы данных в строке подключения будет избираться контекст пользователя базы данных, а не контекст имени для входа при подключении к базе данных. То есть, пользователи автономной базы данных имеют приоритет над именами для входа с тем же именем  
  
-   В [!INCLUDE[ssSDS](../../includes/sssds-md.md)] имя пользователя автономной базы данных не может быть таким же, как имя учетной записи администратора сервера.  
  
-   Учетная запись администратора сервера [!INCLUDE[ssSDS](../../includes/sssds-md.md)] не может быть пользователем автономной базы данных. Администратор сервера имеет достаточные разрешения для создания пользователей автономной базы данных и управления ими. Администратор сервера может предоставлять разрешения пользователям автономной базы данных для пользовательских баз данных.  
  
-   Поскольку пользователи автономной базы данных являются участниками уровня базы данных, необходимо создать пользователей автономной базы данных в каждой базе данных, которая их использует. Удостоверение сводится к базе данных и не зависит во всех аспектах от пользователя с тем же именем и паролем в другой базе данных на том же сервере.  
  
-   Использование паролей одинаковой сложности с теми, которые обыкновенно используются для имен входа.  
  
## <a name="see-also"></a>См. также:  
 [Автономные базы данных](../databases/contained-databases.md)   
 [Рекомендации по обеспечению безопасности автономных баз данных](../databases/security-best-practices-with-contained-databases.md)   
 [CREATE USER (Transact-SQL)](/sql/t-sql/statements/create-user-transact-sql)  
  
  
