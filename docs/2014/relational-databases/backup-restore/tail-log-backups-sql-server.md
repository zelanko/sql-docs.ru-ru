---
title: Резервные копии заключительного фрагмента журнала (SQL Server) | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dbe-backup-restore
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- backing up [SQL Server], tail of log
- transaction log backups [SQL Server], tail-log backups
- NO_TRUNCATE clause
- backups [SQL Server], log backups
- tail-log backups
- backups [SQL Server], tail-log backups
ms.assetid: 313ddaf6-ec54-4a81-a104-7ffa9533ca58
caps.latest.revision: 55
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.openlocfilehash: 7ad9a530a1bcc67db785af3c23f2fd80496155f1
ms.sourcegitcommit: 5dd5cad0c1bbd308471d6c885f516948ad67dfcf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36086916"
---
# <a name="tail-log-backups-sql-server"></a>Резервные копии заключительного фрагмента журнала (SQL Server)
  В данном разделе рассматриваются вопросы резервного копирования и восстановления только тех баз данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которые используют модель полного восстановления или модель восстановления с неполным протоколированием.  
  
 В *резервную копию заключительного фрагмента журнала* попадают все записи, резервная копия которых еще не была создана ( *заключительный фрагмент журнала*), что позволяет предотвратить потерю работы и сохранить неповрежденную цепочку журналов. Для восстановления базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на последний момент времени необходимо предварительно выполнить резервное копирование заключительного фрагмента журнала ее транзакций. Заключительный фрагмент журнала является становится последней рассматриваемой частью резервной копии в плане восстановления базы данных.  
  
> [!NOTE]  
>  Не для всех сценариев восстановления требуется резервная копия заключительного фрагмента журнала. Резервная копия заключительного фрагмента журнала не нужна, если точка восстановления содержится в более ранней резервной копии журнала. Кроме того, резервная копия заключительного фрагмента журнала не требуется при перемещении или замещении (перезаписи) базы данных, при котором не нужно восстанавливать ее на определенный момент времени после создания ее последней резервной копии.  
  
 
  
##  <a name="TailLogScenarios"></a> Сценарии, в которых требуется резервная копия заключительного фрагмента журнала.  
 Рекомендуется формировать резервную копию заключительного фрагмента журнала в следующих сценариях.  
  
-   Если база данных находится в режиме «в сети» и следующим действием над базой данных должна быть операция восстановления, то прежде необходимо выполнить резервное копирование заключительного фрагмента журнала. Во избежание ошибок для оперативной базы данных необходимо использовать Параметр WITH NORECOVERY [резервного КОПИРОВАНИЯ](/sql/t-sql/statements/backup-transact-sql) [!INCLUDE[tsql](../../includes/tsql-md.md)] инструкции.  
  
-   Если база данных, работающая в режиме «вне в сети», не запускается и необходимо восстановить базу данных, то в первую очередь необходимо выполнить резервное копирование заключительного фрагмента журнала. Так как в это время никакие транзакции не выполняются, параметр WITH NORECOVERY использовать не обязательно.  
  
-   Если база данных повреждена, попытайтесь получить резервную копию заключительного фрагмента журнала, используя параметр WITH CONTINUE_AFTER_ERROR инструкции BACKUP.  
  
     Резервное копирование заключительного фрагмента журнала поврежденной базы данных может быть успешно выполнено только в том случае, если файлы журнала не повреждены, а база данных находится в режиме, который поддерживает резервное копирование заключительного фрагмента журнала, и не содержит какие-либо изменения с неполным протоколированием. Если резервная копия заключительного фрагмента журнала не может быть создана, то любые транзакции, зафиксированные после создания последней резервной копии журнала, будут потеряны.  
  
 В следующей таблице представлена сводка параметров BACKUP NORECOVERY и CONTINUE_AFTER_ERROR.  
  
|Параметр BACKUP LOG|Комментарии|  
|-----------------------|--------------|  
|NORECOVERY|Если планируется продолжить операцию восстановления базы данных, используйте параметр NORECOVERY. NORECOVERY переводит базу данных в состояние восстановления. Это гарантирует, что после создания резервной копии заключительного фрагмента журнала база данных не изменится.  Если параметры NO_TRUNCATE или COPY_ONLY не заданы, то журнал усекается.<br /><br /> **\*\* Важные \* \***  мы рекомендуем не использовать параметр NO_TRUNCATE, если база данных повреждена.|  
|CONTINUE_AFTER_ERROR|Параметр CONTINUE_AFTER_ERROR следует указывать только в том случае, если создается резервная копия заключительного фрагмента журнала поврежденной базы данных.<br /><br /> Примечание: При использовании резервное копирование заключительного фрагмента журнала поврежденной базы данных, некоторые метаданные, захватываемые обычно в резервные копии журналов могут быть недоступны. Дополнительные сведения см. в подразделе [Резервное копирование заключительного фрагмента журнала с неполными метаданными резервной копии](#IncompleteMetadata) ниже в данном разделе.|  
  
##  <a name="IncompleteMetadata"></a> Резервное копирование заключительного фрагмента журнала с неполными метаданными резервной копии  
 Резервное копирование заключительного фрагмента журнала захватывает конец журнала даже в тех случаях, когда база данных работает вне сети, повреждена или в ней не хватает файлов данных. В результате этого метаданные команд восстановления данных и базы данных **msdb**могут быть неполными. Однако несмотря на неполноту метаданных, захваченный журнал будет полным и готовым к использованию.  
  
 Если резервная копия заключительного фрагмента журнала содержит неполные метаданные, то параметр [has_incomplete_metadata](/sql/relational-databases/system-tables/backupset-transact-sql) в таблице **backupset** принимает значение **1**. Кроме того, выходной аргумент [HasIncompleteMetadata](/sql/t-sql/statements/restore-statements-headeronly-transact-sql)инструкции **RESTORE HEADERONLY** принимает значение **1**.  
  
 Если метаданные в резервной копии заключительного фрагмента журнала неполные, то в таблице [backupfilegroup](/sql/relational-databases/system-tables/backupfilegroup-transact-sql) большая часть сведений о файловых группах того времени в резервной копии заключительного фрагмента журнала будет утеряна. Большинство столбцов таблицы **backupfilegroup** содержит значение NULL, другие значения имеют следующие столбцы:  
  
-   **backup_set_id**  
  
-   **filegroup_id**  
  
-   **type**  
  
-   **type_desc**  
  
-   **is_readonly**  
  
##  <a name="RelatedTasks"></a> Связанные задачи  
 Инструкции по созданию резервной копии журнала транзакций см. в разделе [Резервное копирование журнала транзакций при повреждении базы данных (SQL Server)](back-up-the-transaction-log-when-the-database-is-damaged-sql-server.md).  
  
 Инструкции по восстановлению резервной копии журнала транзакций см. в разделе [Восстановление резервной копии журнала транзакций (SQL Server)](restore-a-transaction-log-backup-sql-server.md).  
  
## <a name="see-also"></a>См. также  
 [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql)   
 [RESTORE (Transact-SQL)](/sql/t-sql/statements/restore-statements-transact-sql)   
 [Резервное копирование и восстановление баз данных SQL Server](back-up-and-restore-of-sql-server-databases.md)   
 [Резервные копии только для копирования (SQL Server)](copy-only-backups-sql-server.md)   
 [Резервные копии журналов транзакций (SQL Server)](transaction-log-backups-sql-server.md)   
 [Применение резервных копий журналов транзакций (SQL Server)](apply-transaction-log-backups-sql-server.md)  
  
  
