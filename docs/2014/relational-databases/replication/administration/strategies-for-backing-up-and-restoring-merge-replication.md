---
title: Стратегии резервного копирования и восстановления для репликации слиянием | Документация Майкрософт
ms.custom: ''
ms.date: 03/09/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology:
- replication
ms.topic: conceptual
helpviewer_keywords:
- recovery [SQL Server replication], merge replication
- backups [SQL Server replication], merge replication
- restoring [SQL Server replication], merge replication
- merge replication [SQL Server replication], backup and restore
ms.assetid: b8ae31c6-d76f-4dd7-8f46-17d023ca3eca
author: MashaMSFT
ms.author: mathoma
manager: craigg
ms.openlocfilehash: 01e0d1d3214d9502d3c4a8db91cd16617dd9472a
ms.sourcegitcommit: 3da2edf82763852cff6772a1a282ace3034b4936
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2018
ms.locfileid: "48220894"
---
# <a name="strategies-for-backing-up-and-restoring-merge-replication"></a>Стратегия резервного копирования и восстановления из копии для репликации слиянием
  Для репликации слиянием регулярно создавайте резервные копии следующих баз данных:  
  
-   База данных публикаций на издателе.  
  
-   База данных распространителя на распространителе.  
  
-   База данных подписок на каждом подписчике.  
  
-   Системные базы данных **master** и **msdb** на издателе, распространителе и на всех подписчиках. Резервные копии этих баз данных и копия соответствующей базы данных репликации должны быть сделаны одновременно. Например, создавайте резервную копию баз данных **master** и **msdb** на издателе одновременно с резервной копией базы данных публикаций. Если база данных публикаций восстановлена, убедитесь, что базы данных **master** и **msdb** согласованы с базой данных публикаций по настройке и конфигурации репликации.  
  
 Если резервное копирование журналов выполняется регулярно, любые изменения, касающиеся репликации, будут заноситься в резервные копии журнала. Если резервные копии журналов не создаются, резервное копирование следует выполнять при каждом изменении параметров репликации. Дополнительные сведения см. в статье [Общие действия, для которых необходима обновленная резервная копия](common-actions-requiring-an-updated-backup.md).  
  
 Выберите один из описываемых далее подходов к резервному копированию и восстановлению базы данных публикаций, затем следуйте рекомендациям, приведенным для базы данных распространителя и базы данных подписок.  
  
## <a name="backing-up-and-restoring-the-publication-database"></a>Резервное копирование и восстановление базы данных публикаций  
 Существует два подхода к восстановлению базы данных публикаций слиянием. После восстановления базы данных публикаций из резервной копии следует:  
  
-   Либо синхронизировать базу данных публикаций с базой данных подписок.  
  
-   Либо повторно инициализировать все подписки на публикации в базе данных публикаций.  
  
 Применение любого их этих методов гарантирует, что после восстановления издатель и все подписчики будут синхронизированы.  
  
> [!NOTE]  
>  Если какие-либо таблицы содержат столбцы идентификаторов, следует обеспечить после восстановления назначение правильных диапазонов идентификаторов. Дополнительные сведения см. в статье [Репликация столбцов идентификаторов](../publish/replicate-identity-columns.md).  
  
### <a name="synchronizing-the-publication-database"></a>Синхронизация базы данных публикаций  
 Синхронизация базы данных публикаций с базой данных подписок позволяет загружать из одной или нескольких баз данных подписок те изменения, которые были сделаны ранее в базе данных публикаций, но не были представлены в восстановленной резервной копии. Передаваемые данные зависят от того, как отфильтрованы публикации:  
  
-   Если публикации не отфильтрованы, должна существовать возможность обновления базы данных публикаций посредством синхронизации с самым обновленным подписчиком.  
  
-   Если же публикация отфильтрована, то базу данных публикации, возможно, не удастся обновить. Продумайте таблицу, которая разделена так, что каждая подписка получает данные клиентов только из одного региона: север, восток, юг и запад. Если существует по крайней мере один подписчик из каждой секции данных, синхронизация с подписчиком из каждой секции должна обновить базу данных публикаций. Однако если данные в западной секции, например не были реплицированы на какие-либо подписчики, эти данные на издателе невозможно будет обновить.  
  
> [!IMPORTANT]  
>  Результатом синхронизации базы данных публикаций с базой данных подписок может быть восстановление опубликованных таблиц до более современного состояния, чем состояние других неопубликованных таблиц, восстановленных из резервной копии.  
  
 Если выполняется синхронизация с подписчиком, на котором запущена версия [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] меньше [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], подписка не может быть анонимной. Это должна быть клиентская или серверная подписка (в предыдущих версиях такие подписки называются локальными и глобальными).  
  
 Чтобы синхронизировать подписку, см. разделы [Синхронизация принудительной подписки](../synchronize-a-push-subscription.md) и [Синхронизация подписки по запросу](../synchronize-a-pull-subscription.md).  
  
### <a name="reinitializing-all-subscriptions"></a>Повторная инициализация всех подписок  
 Повторная инициализация всех подписок гарантирует, что все подписчики находятся в состоянии, согласованном с восстановленной базой данных публикаций. Такой подход следует применять, если требуется вернуть всю топологию в предыдущее состояние, представленное резервной копией базы данных публикаций. Например, повторная инициализация всех подписок может потребоваться, если восстановление базы данных публикаций до более ранней точки используется в качестве механизма возврата из ошибочно выполненной пакетной операции.  
  
 Если выбран данный вариант, создайте новый моментальный снимок для его доставки на повторно инициализированные подписчики сразу после восстановления базы данных публикаций.  
  
 Чтобы повторно инициализировать подписку, см. раздел [Повторная инициализация подписки](../reinitialize-a-subscription.md).  
  
 Чтобы создать и применить моментальный снимок, см. разделы [Create и Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md) и [Создание моментального снимка для публикации слиянием с параметризованными фильтрами](../create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).  
  
## <a name="backing-up-and-restoring-the-distribution-database"></a>Резервное копирование и восстановление базы данных распространителя  
 При репликации слиянием база данных распространителя должна регулярно подвергаться резервному копированию, и она может быть восстановлена без дополнительных условий до тех пор, пока время, истекшее с момента создания используемой резервной копии, не превышает кратчайший срок хранения всех публикаций, использующих распространитель. Например, если есть три публикации со сроками хранения 10, 20 и 30 дней соответственно, то используемая резервная копия не должна быть старше 10 дней. База данных распространителя играет ограниченную роль в репликации слиянием: она не хранит данных, используемых для отслеживания изменений, и не служит временным хранилищем изменений репликации слиянием, которые должны пересылаться в базы данных подписок (как это делается при репликации транзакций).  
  
## <a name="backing-up-and-restoring-a-subscription-database"></a>Резервное копирование и восстановление базы данных подписок  
 Чтобы гарантировать успешное восстановление базы данных подписок, подписчики должны синхронизироваться с издателем до резервного копирования базы данных подписок; подписчики также должны синхронизироваться после восстановления базы данных подписок.  
  
-   Синхронизация с издателем до резервного копирования базы данных подписок гарантирует, что если подписчик восстанавливается из резервной копии, подписки все равно будут находиться в пределах срока хранения публикации. Например, предположим, что срок хранения публикации равен 10 дням. Последняя синхронизация была 8 дней назад, а теперь выполняется резервное копирование. Если через 4 дня будет произведено восстановление из резервной копии, то последняя синхронизация окажется 12-дневной давности, то есть за пределами срока хранения публикации. В этом случае потребуется повторная инициализация подписчика. Если подписчик был синхронизован перед резервным копированием, база данных подписок будет находиться в пределах срока хранения публикации.  
  
     Время с момента создания резервной копии не должна превышать кратчайший срок хранения всех публикаций, на которые подписывается подписчик. Например, если подписчик подписывается на три публикации со сроками хранения 10, 20 и 30 дней соответственно, то резервная копия, используемая для восстановления, не должна быть старше 10 дней.  
  
-   Синхронизация базы данных подписок с каждой из ее публикаций после восстановления гарантирует, что подписчик обновлен в соответствии со всеми изменениями издателя.  
  
 Чтобы установить срок хранения публикации, выполните действия из статьи [Установка срока действия подписок](../publish/set-the-expiration-period-for-subscriptions.md).  
  
 Чтобы синхронизировать подписку, см. разделы [Синхронизация принудительной подписки](../synchronize-a-push-subscription.md) и [Синхронизация подписки по запросу](../synchronize-a-pull-subscription.md).  
  
## <a name="backing-up-and-restoring-a-republishing-database"></a>Резервное копирование и восстановление переиздаваемой базы данных  
 Когда база данных подписывается на данные издателя и в свою очередь публикует те же самые данные для других баз данных подписок, ее называют переиздающей базой данных. При восстановлении переиздающей базы данных следуйте инструкциям, описанным в подразделах «Резервное копирование и восстановление базы данных публикаций» и «Резервное копирование и восстановление базы данных подписок» этого раздела.  
  
## <a name="see-also"></a>См. также  
 [Резервное копирование и восстановление баз данных SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md)   
 [Создание резервных копий реплицируемых баз данных и восстановление из них](back-up-and-restore-replicated-databases.md)  
  
  
