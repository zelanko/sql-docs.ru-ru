---
title: Агент SQL Server | Документация Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dbe-cross-instance
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords:
- SQL Server Agent, about SQL Server Agent
- automatic administration steps
ms.assetid: 8d1dc600-aabb-416f-b3af-fbc9fccfd0ec
caps.latest.revision: 28
author: stevestein
ms.author: sstein
manager: craigg
ms.openlocfilehash: 4f3a29acfe387b4b4e80d9e9a0ee232476d6074d
ms.sourcegitcommit: c18fadce27f330e1d4f36549414e5c84ba2f46c2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2018
ms.locfileid: "37230474"
---
# <a name="sql-server-agent"></a>Агент SQL Server

  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] — это служба Microsoft Wвdows, выполняющая запланированные административные задачи, которые называются *заданиями* в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].  
  
 **В этом разделе**  
  
-   [Преимущества агента SQL Server](#Benefits)  
  
-   [Компоненты агента SQL Server](#Components)  
  
-   [Безопасность при администрировании агента SQL Server](#Security)  
  
##  <a name="Benefits"></a> Преимущества агента SQL Server  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Агент использует [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для хранения сведений о заданиях. Задание состоит из одного или нескольких шагов. Каждый шаг содержит собственную задачу, например создание резервной копии базы данных.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может выполнять задания по расписанию в ответ на определенное событие или по требованию. Например, можно автоматизировать задачу создания резервной копии всех серверов компании, чтобы она выполнялась ежедневно по окончании рабочего дня. Запланируйте запуск резервного копирования после 22:00 с понедельника по пятницу; если во время создания резервной копии возникает проблема, агент SQL Server регистрирует соответствующее событие и выдает уведомление.  
  
> [!NOTE]  
>  Служба агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] по умолчанию отключена, если во время установки [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] явно не выбран автоматический запуск службы.  
  
##  <a name="Components"></a> Компоненты агента SQL Server  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Агент использует следующие компоненты, чтобы определить задачи для выполнения, время для выполнения задач и порядок уведомления об успешном или неудачном завершении задач.  
  
### <a name="jobs"></a>Задания
  
 *Задание* — это указанная последовательность действий, выполняемых агентом [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Используйте задания, чтобы определить задачу управления, которую можно выполнить однажды или неоднократно и контролировать на предмет успешного или неудачного выполнения. Задание может выполняться на одном локальном сервере или на нескольких удаленных серверах.  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которые выполнялись во время отработки отказа на экземпляре отказоустойчивого кластера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , не возобновляются после отработки отказа и переключения на другой узел отказоустойчивого кластера. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Задания агента, которые выполнялись во время приостановки работы узла Hyper-V, не возобновляются, если приостановка вызывает отработку отказа с переходом на другой узел. Задания, выполнение которых было начато, но не завершилось в связи с событием отработки отказа, регистрируются в журнале как начатые, но дополнительных записей журнала о завершении или сбое нет. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выглядят как незавершенные.  
  
 Выполнять задания можно несколькими способами:  
  
-   по одному или нескольким расписаниям;
  
  
-   в ответ на одно или несколько предупреждений;
  
  
-   Посредством выполнения хранимой процедуры sp_start_job.  
  
 Каждое действие в задании является *шагом задания*. Например шаг задания может состоять из выполнения инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] , выполнения пакета служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] или выдачи команды серверу служб Analysis Services. Шагами задания управляют как частью задания.  
  
 Каждый шаг задания выполняется в указанном контексте безопасности. Для шагов заданий, использующих [!INCLUDE[tsql](../../includes/tsql-md.md)], применяйте инструкцию EXECUTE AS, чтобы указать контекст безопасности для шага задания. Для других типов шагов заданий используйте учетную запись-посредник, чтобы указать контекст безопасности для шага задания.  
  
### <a name="schedules"></a>Расписания  
 *Расписание* определяет время выполнения задания. Сразу несколько заданий могут выполняться по одному и тому же расписанию, а несколько расписаний могут применяться к одному и тому же заданию. Расписание может определить следующие условия для времени выполнения задания:  
  
-   при каждом запуске агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)];  
  
-   каждый раз, когда использование ЦП компьютера будет достигать уровня, который определен как уровень простоя;
  
  
-   однажды, в указанные дату и время;
  
  
-   Согласно повторяющемуся расписанию.  
  
 Дополнительные сведения см. в разделе [Создание и присоединение расписаний к заданиям](create-and-attach-schedules-to-jobs.md).  
  
### <a name="alerts"></a>видны узлы  
 *Предупреждение* — это автоматический ответ на наступление указанного события. Например, событие может быть заданием, которое начинает выполняться, или системным ресурсом, достигшим указанного порогового значения. Пользователь определяет условия, при которых выдается предупреждение.  
  
 Предупреждение может быть реакцией на одно из следующих условий:  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] события  
  
-   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] условия производительности;  
  
-   события инструментария управления Microsoft Windows (WMI) на компьютере, где работает агент SQL Server;
  
  
 Предупреждение может выполнять следующие действия:  
  
-   Уведомить один или несколько операторов  
  
-   Осуществить запуск задания  
  
 Дополнительные сведения см. в статье [Предупреждения](alerts.md).  
  
### <a name="operators"></a>Операторы  
 *Оператор* определяет контактные сведения о лице, ответственном за обслуживание одного или нескольких экземпляров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. В некоторых организациях обязанности оператора возлагаются на одно лицо. В организациях, использующих несколько серверов, обязанности оператора могут быть разделены между несколькими лицами. Оператор не обладает данными безопасности и не определяет субъекта безопасности.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может уведомлять операторов о предупреждениях одним или несколькими способами из нижеследующих:  
  
-   электронная почта;
  
  
-   пейджер (через электронную почту);
  
  
-   **команда net send.**  
  
> [!NOTE]  
>  Чтобы сделать возможной отправку уведомлений с помощью **net send**, служба Windows Messenger должна быть запущена на компьютере, где работает агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
> [!IMPORTANT]  
>  Режимы отправки уведомлений с помощью пейджера и команды **net send** будут удалены из агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в следующей версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Старайтесь не использовать эти функции в новых разработках и предусмотрите соответствующие изменения в приложениях, которые используют их в настоящее время.  
  
 Для отправки операторам уведомлений по электронной почте или на пейджер необходимо настроить агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для использования компонента Database Mail. Дополнительные сведения см. в разделе [Database Mail](../../relational-databases/database-mail/database-mail.md).  
  
 Можно определить оператора как псевдоним для группы лиц. Таким способом все члены этого псевдонима будут уведомлены одновременно. Дополнительные сведения см. в статье [Операторы](operators.md).  
  
##  <a name="Security"></a> Безопасность при администрировании агента SQL Server  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Агент использует **SQLAgentUserRole**, **SQLAgentReaderRole**, и **SQLAgentOperatorRole** предопределенных ролей базы данных в **msdb** базы данных для управления доступом к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] агент для пользователей, которые не являются членами объекта `sysadmin` предопределенной роли сервера. Помимо этих предопределенных ролей базы данных, подсистемы и учетные записи-посредники позволяют администраторам базы данных гарантировать, что каждый шаг задания выполняется с минимальными разрешениями, необходимыми для выполнения задачи.  
  
### <a name="roles"></a>Роли  
 Членами **SQLAgentUserRole**, **SQLAgentReaderRole**, и **SQLAgentOperatorRole** предопределенных ролей базы данных в **msdb**, и членами `sysadmin` предопределенной роли сервера имеют доступ к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] агента. Пользователь, не принадлежащий ни к одной из этих ролей, не может использовать агент [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Дополнительные сведения о ролях, используемых агентом [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , см. в разделе [Обеспечение безопасности агента SQL Server](implement-sql-server-agent-security.md).  
  
### <a name="subsystems"></a>Подсистемы  
 Подсистема — это предопределенный объект, который содержит функции, доступные шагу задания. Каждая учетная запись-посредник имеет доступ к одной или нескольким подсистемам. Подсистемы обеспечивают безопасность, поскольку разграничивают доступ учетных записей-посредников к функциям. Каждый шаг задания выполняется в контексте учетной записи-посредника, за исключением этапов задания [!INCLUDE[tsql](../../includes/tsql-md.md)] . [!INCLUDE[tsql](../../includes/tsql-md.md)] , применяйте команду EXECUTE AS, чтобы задать контекст безопасности для шага задания.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] определяет подсистемы, перечисленные в следующей таблице:  
  
|Имя подсистемы|Описание|  
|--------------------|-----------------|  
|Скрипт Microsoft ActiveX|Выполните шаг задания со скриптом ActiveX.<br /><br /> **\*\* Важные \* \***  подсистема сценариев ActiveX будет удалена из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] агент в будущих версиях [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Избегайте использования этого компонента в новых разработках и запланируйте изменение существующих приложений, в которых он применяется.|  
|Операционная система (**CmdExec**)|Запустите исполняемую программу.|  
|PowerShell|Выполните шаг задания со скриптом PowerShell.|  
|Распространитель репликации|Выполните шаг задания, на котором активируется агент распространителя репликации.|  
|Репликация слиянием|Выполните шаг задания, на котором активируется агент репликации слиянием.|  
|Агент чтения очереди репликации|Выполните шаг задания, на котором активируется агент чтения очереди репликации.|  
|Моментальный снимок репликации|Выполните шаг задания, на котором активируется агент моментальных снимков.|  
|Агент чтения журнала транзакций репликации|Выполните шаг задания, на котором активируется агент чтения журнала.|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Command|Выполните команду служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] .|  
|[!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Запрос|Выполните запрос служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] .|  
|[!INCLUDE[ssIS](../../includes/ssis-md.md)] выполнение пакетов служб|Выполните пакет служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] .|  
  
> [!NOTE]  
>  Поскольку в шагах задания [!INCLUDE[tsql](../../includes/tsql-md.md)] учетные записи-посредники не используются, какие-либо подсистемы агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для шагов задания [!INCLUDE[tsql](../../includes/tsql-md.md)] отсутствуют.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] применяет ограничения подсистемы принудительно, даже если обычно субъект безопасности для учетной записи-посредника имеет разрешение на выполнение задачи на шаге задания. Например, пользователь, являющийся членом предопределенной роли сервера sysadmin, не сможет выполнить шаг задания служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] , если его учетная запись-посредник не имеет доступа к подсистеме служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] , несмотря на то, что пользователь может выполнять пакеты служб [!INCLUDE[ssIS](../../includes/ssis-md.md)] .  
  
### <a name="proxies"></a>Учетные записи-посредники  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для управления контекстами безопасности использует учетные записи-посредники. Учетная запись-посредник может быть использована на нескольких шагах задания. Членами `sysadmin` предопределенной роли сервера можно создать учетные записи-посредники.  
  
 Каждой учетной записи-посреднику соответствует учетная запись системы безопасности. и может быть связана с множеством подсистем и множеством имен входа. Учетная запись-посредник может применяться только для шагов задания, которые используют связанную с этой учетной записью-посредником подсистему. Чтобы создать шаг задания, использующий определенную учетную запись-посредник, владелец задания должен либо использовать связанное с ней имя входа, либо быть членом роли, имеющей неограниченный доступ к учетным записям-посредникам. Членами `sysadmin` предопределенной роли сервера имеют неограниченный доступ к прокси-серверам. Члены ролей **SQLAgentUserRole**, **SQLAgentReaderRole**и **SQLAgentOperatorRole** могут использовать только учетные записи-посредники, на которые им был предоставлен особый доступ. Каждому пользователю, входящему в одну из предопределенных ролей базы данных агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , необходимо предоставить доступ к конкретным учетным записям-посредникам, чтобы пользователь мог создавать шаги задания, которые будут использовать эти учетные записи-посредники.  
  
## <a name="related-tasks"></a>Related Tasks  
 Используйте следующие шаги для настройки агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для автоматического администрирования [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
1.  Определите, какие административные задачи или события сервера происходят регулярно, а также можно ли эти задачи или события администрировать программным путем. Подходящей для автоматизации является такая задача, которая включает предсказуемую последовательность шагов и выполняется в определенное время или в ответ на определенное событие.  
  
2.  Определите набор заданий, расписаний, предупреждений и операторов, используя среду [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], скрипты [!INCLUDE[tsql](../../includes/tsql-md.md)] или управляющие объекты (SMO) [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Дополнительные сведения см. в разделе [Создание заданий](create-jobs.md).  
  
3.  Запустите назначенные задания агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
> [!NOTE]  
>  В экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]по умолчанию служба [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имеет имя SQLSERVERAGENT. В именованных экземплярах служба агента [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] имеет имя SQLAgent$*имя_экземпляра*.  
  
 Если запущено несколько экземпляров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], то чтобы автоматизировать общие для всех экземпляров задания, можно использовать администрирование нескольких серверов. Дополнительные сведения см. в статье [Автоматизация администрирования в масштабах предприятия](automated-administration-across-an-enterprise.md).  
  
 Используйте следующие задачи, чтобы начать работу с агентом [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] :  
  
|||  
|-|-|  
|**Описание**|**Раздел**|  
|Содержит инструкции по настройке агента SQL Server.|[Настройка агента SQL Server](configure-sql-server-agent.md)|  
|Описывает запуск, остановку и приостановку службы агента SQL Server.|[Запуск, остановка или приостановка службы агента SQL Server](start-stop-or-pause-the-sql-server-agent-service.md)|  
|Описывает вопросы задания учетных записей для службы агента SQL Server.|[Выбор учетной записи для службы агента SQL Server](select-an-account-for-the-sql-server-agent-service.md)|  
|Описывает использование журнала ошибок агента SQL Server.|[Журнал ошибок агента SQL Server](sql-server-agent-error-log.md)|  
|||  
|Содержит инструкции по использованию объектов производительности.|[Использование объектов производительности](use-performance-objects.md)|  
|Описывает мастер планов обслуживания программу, которая используется для создания заданий, оповещений и операторов для автоматизации администрирования экземпляра SQL Server.|[Использование мастера планов обслуживания](../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)|  
|Описывает автоматизацию задач администрирования с помощью агента SQL Server.|[Задачи автоматизированного администрирования (агент SQL Server)](automated-administration-tasks-sql-server-agent.md)|  
  
## <a name="see-also"></a>См. также  
 [Настройка контактной зоны](../../relational-databases/security/surface-area-configuration.md)  
  
  
