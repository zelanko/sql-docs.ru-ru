---
title: Программа SQLdiag | Документы Майкрософт
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology:
- database-engine
ms.topic: conceptual
helpviewer_keywords:
- command prompt utilities [SQL Server], SQLdiag
- stopping diagnostic collection
- storing diagnostic information
- performance [SQL Server], diagnostic collection
- diagnostic records [SQL Server]
- scripts [SQL Server], diagnostic collection
- logs [SQL Server], diagnostic collection
- starting diagnostic collection
- clustered instance of SQL Server
- monitoring performance [SQL Server], diagnostic collection
- security [SQL Server], diagnostic collection
- SQLDIAG service
- space [SQL Server], diagnostic collection
- SQLdiag utility
- disk space [SQL Server], diagnostic collection
- configuration files [SQL Server]
- automatic diagnostic collection
- clusters [SQL Server], diagnostic collection
ms.assetid: 45ba1307-33d1-431e-872c-a6e4556f5ff2
author: stevestein
ms.author: sstein
manager: craigg
ms.openlocfilehash: 475c77650179648642aead8275040b894ccc4b40
ms.sourcegitcommit: 3da2edf82763852cff6772a1a282ace3034b4936
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2018
ms.locfileid: "48125324"
---
# <a name="sqldiag-utility"></a>SQLdiag, программа
  Программа **SQLdiag** — это универсальная диагностическая программа для сбора сведений, которая может выполняться как консольное приложение или как служба. Программа **SQLdiag** позволяет выполнять сбор журналов и файлов данных с [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] и других типов серверов, а также мониторинг серверов и устранение определенных неполадок на серверах. Программа**SQLdiag** предназначена для ускорения и упрощения сбора диагностических сведений, необходимых для службы поддержки пользователей [!INCLUDE[msCoName](../includes/msconame-md.md)] .  
  
> [!NOTE]  
>  Вследствие изменений в программе приложения или скрипты, зависящие от аргументов ее командной строки или особенностей работы, в будущих выпусках могут работать неправильно.  
  
 Программа**SQLdiag** может собирать следующие типы диагностических сведений:  
  
-   журналы производительности Windows;  
  
-   журналы событий Windows;  
  
-   [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] ;  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] ;  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .  
  
 Вы можете указать, какие типы сведений нужно собирать с помощью программы **SQLdiag** , в файле конфигурации SQLDiag.xml, который описывается в следующем разделе.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
      sqldiag   
     { [/?] }  
     |  
     { [/I configuration_file]  
       [/O output_folder_path]  
       [/Psupport_folder_path]  
       [/Noutput_folder_management_option]  
       [/Mmachine1 [ machine2machineN]| @machinelistfile]  
       [/Cfile_compression_type]  
       [/B [+]start_time]  
       [/E [+]stop_time]  
       [/ASQLdiag_application_name]  
       [/T { tcp [ ,port ] | np | lpc } ]  
       [/Q] [/G] [/R] [/U] [/L] [/X] }  
     |  
     { [START | STOP | STOP_ABORT] }  
     |  
     { [START | STOP | STOP_ABORT] /ASQLdiag_application_name }  
```  
  
## <a name="arguments"></a>Аргументы  
 **/?**  
 Отображает сведения об использовании.  
  
 **/I** *configuration_file*  
 Задает файл конфигурации, используемый программой **SQLdiag** . По умолчанию **/I** задает SQLDiag.Xml.  
  
 **/O** *output_folder_path*  
 Перенаправляет выходной поток программы **SQLdiag** в указанную папку. Если параметр **/O** не указан, выходной поток **SQLdiag** направляется во вложенную папку с именем SQLDIAG, расположенную в папке запуска **SQLdiag** . Если папки SQLDIAG не существует, программа **SQLdiag** попытается создать ее.  
  
> [!NOTE]  
>  Расположение выходной папки задается относительно расположения папки поддержки, которое может быть определено параметром **/P**. Для установки абсолютно другого пути к выходной папке укажите полный путь каталога в параметре **/O**.  
  
 **/P** *support_folder_path*  
 Устанавливает путь к папке поддержки. По умолчанию параметр **/P** задает папку, в которой находится исполняемый файл **SQLdiag** . Папка поддержки содержит файлы поддержки **SQLdiag** , например XML-файл конфигурации, скрипты Transact-SQL и другие файлы, используемые программой во время сбора диагностических сведений. Если этот параметр будет использован для указания дополнительного пути к файлам поддержки, программа **SQLdiag** автоматически скопирует необходимые файлы поддержки в указанную папку, если их еще не существует.  
  
> [!NOTE]  
>  Чтобы установить текущую папку в качестве пути к файлам поддержки, укажите **%cd%** в командной строке следующим образом:  
>   
>  **SQLDIAG /P %cd%**  
  
 **/N** *output_folder_management_option*  
 Определяет, должна ли программа **SQLdiag** при запуске перезаписывать или переименовывать выходную папку. Возможные параметры:  
  
 1 = Перезаписывает выходную папку (по умолчанию)  
  
 2 = при запуске программа **SQLdiag** переименовывает выходную папку в SQLDIAG_00001, SQLDIAG_00002 и так далее. После переименования текущей выходной папки программа **SQLdiag** выводит данные в папку по умолчанию SQLDIAG.  
  
> [!NOTE]  
>  Программа**SQLdiag** при запуске не добавляет данные в текущую выходную папку. Она может только перезаписать выходную папку по умолчанию (параметр 1) или переименовать папку (параметр 2), после чего производит вывод в новую выходную папку по умолчанию, имеющую имя SQLDIAG.  
  
 **/M** *machine1* [ *machine2 ** machineN*] | *@machinelistfile*  
 Переопределяет параметр machines, указанный в файле конфигурации. По умолчанию файлом конфигурации является SQLDiag.Xml либо файл, заданный параметром **/I** . При определении более одного компьютера, разделяйте имена компьютеров пробелами.  
  
 Использование параметра *@machinelistfile* позволяет указать имя файла со списком компьютеров, который необходимо сохранить в файле конфигурации.  
  
 **/C** *file_compression_type*  
 Устанавливает тип сжатия файлов, используемый в файлах выходной папки программы **SQLdiag** . Возможные параметры:  
  
 0 = без сжатия (по умолчанию)  
  
 1 = использование сжатия NTFS  
  
 **/B** [**+**]*start_time*  
 Указывает дату и время начала сбора диагностических данных в следующем формате:  
  
 ГГГГММДД_ЧЧ:ММ:СС  
  
 Время указывается в 24-часовом формате. Например, время 14:00 должно указываться как **14:00:00**.  
  
 Используйте **+** без даты (только ЧЧ:ММ:СС) для указания времени относительно текущей даты и времени. Например, если указать **/B +02:00:00**, то программа **SQLdiag** будет ждать 2 часа перед тем, как начать сбор сведений.  
  
 Не вставляйте символ пробела между **+** и указанным значением *start_time*.  
  
 Если указать время запуска, которое уже прошло, программа **SQLdiag** принудительно изменит дату запуска таким образом, что дата и время запуска будут находиться в будущем. Например, если указать **/B 01:00:00** а текущее время — 08:00:00, то программа **SQLdiag** принудительно изменит дату запуска на следующий день.  
  
 Обратите внимание, что **SQLdiag** использует локальное время компьютера, на котором запущена программа.  
  
 **/E** [**+**]*stop_time*  
 Указывает дату и время остановки сбора диагностических данных в следующем формате:  
  
 ГГГГММДД_ЧЧ:ММ:СС  
  
 Время указывается в 24-часовом формате. Например, время 14:00 должно указываться как **14:00:00**.  
  
 Используйте **+** без даты (только ЧЧ:ММ:СС) для указания времени относительно текущей даты и времени. Например, если время запуска и остановки указано как **/B +02:00:00 /E +03:00:00**, то **SQLdiag** будет ждать 2 часа перед тем, как начать сбор сведений, затем будет собирать сведения в течение 3 часов, прежде чем остановится и завершит работу. Если параметр **/B** не указан, программа **SQLdiag** начнет сбор диагностических сведений немедленно и закончит в момент, соответствующий дате и времени, указанным в параметре **/E**.  
  
 Не вставляйте символ пробела между **+** и указанным значением *start_time* или *end_time*.  
  
 Обратите внимание, что **SQLdiag** использует локальное время компьютера, на котором запущена программа.  
  
 **/A**  *SQLdiag_application_name*  
 Разрешает запуск нескольких экземпляров программы **SQLdiag** для работы с одним экземпляром [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .  
  
 Каждое значение *SQLdiag_application_name* определяет другой экземпляр **SQLdiag**. Между экземпляром *SQLdiag_application_name* и именем экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] никакой связи не существует.  
  
 Параметр*SQLdiag_application_name* может использоваться для запуска или остановки указанного экземпляра службы **SQLdiag** .  
  
 Пример:  
  
 **SQLDIAG START /A**  *SQLdiag_application_name*  
  
 Кроме того, он может использоваться с параметром **/R** для регистрации указанного экземпляра **SQLdiag** в качестве службы. Пример:  
  
 **SQLDIAG /R /A** *SQLdiag_application_name*  
  
> [!NOTE]  
>  Программа**SQLdiag** автоматически добавляет префикс DIAG$ к имени экземпляра, указанному для *SQLdiag_application_name*. Это позволяет получить понятное имя службы при регистрации **SQLdiag** в качестве службы.  
  
 /T { tcp [ ,*port* ] | np | lpc }  
 Подключение к экземпляру [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с использованием определенного протокола.  
  
 tcp [,*port*]  
 Протокол TCP/IP. Можно дополнительно определить порт для соединения.  
  
 np  
 Именованные каналы. По умолчанию экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] прослушивает именованные каналы `\\.\pipe\sql\query` и `\\.\pipe\MSSQL$<instancename>\sql\query` для именованных экземпляров. Нельзя соединиться с экземпляром [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью другого имени канала.  
  
 lpc  
 Вызов локальной процедуры. Может использовать протокол общей памяти, если клиент соединяется с экземпляром компонента [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на том же компьютере.  
  
 **/Q**  
 Запускает **SQLdiag** в автоматическом режиме. Параметр **/Q** блокирует все запросы, например запросы на ввод пароля.  
  
 **/G**  
 Запускает **SQLdiag** в обычном режиме. Если указан параметр **/G** , то при запуске программа **SQLdiag** не осуществляет принудительную проверку подключения [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] или проверку членства пользователя в предопределенной роли сервера **sysadmin** . Вместо этого **SQLdiag** запрашивает у Windows определение наличия у пользователя соответствующих прав для сбора каждого из запрашиваемых диагностических сведений.  
  
 Если параметр **/G** не указан, программа **SQLdiag** выполнит проверку, чтобы определить, является ли пользователь членом группы **Администраторы** Windows, и не будет собирать диагностические сведения [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , если пользователь не является членом группы **Администраторы** .  
  
 **/R**  
 Регистрирует программу **SQLdiag** в качестве службы. Все аргументы командной строки, указанные при регистрации **SQLdiag** в качестве службы, сохраняются при последующих запусках службы.  
  
 При регистрации **SQLdiag** в качестве службы имя службы по умолчанию — SQLDIAG. Изменить имя службы можно с помощью аргумента **/A** .  
  
 Для запуска службы используйте аргумент командной строки **START** :  
  
 **SQLDIAG START**  
  
 Также для запуска службы можно использовать команду **net start** :  
  
 **net**  **start SQLDIAG**  
  
 **/U**  
 Отменяет регистрацию программы **SQLdiag** в качестве службы.  
  
 Кроме того, используйте аргумент **/A** , если нужно отменить регистрацию именованного экземпляра **SQLdiag** .  
  
 **/L**  
 Запускает программу **SQLdiag** в непрерывном режиме, когда, помимо прочего, указано время запуска или время остановки с помощью аргумента **/B** или **/E** , соответственно. Программа**SQLdiag** автоматически перезапускается после того, как сбор диагностических сведений останавливается из-за запланированного завершения работы. Например, при использовании аргументов **/E** или **/X** .  
  
> [!NOTE]  
>  Программа**SQLdiag** не учитывает аргумент **/L** , если время запуска или остановки не указано с помощью аргументов командной строки **/B** и **/E** commи line arguments.  
  
 Параметр **/L** не подразумевает запуск в качестве службы. Чтобы использовать параметр **/L** при запуске **SQLdiag** в качестве службы, укажите его в командной строке при регистрации службы.  
  
 **/X**  
 Запускает **SQLdiag** в режиме моментального снимка. **SQLdiag** создает моментальный снимок всех настроенных диагностических сведений и автоматически завершает работу.  
  
 **START** | **STOP** | **STOP_ABORT**  
 Запускает или останавливает службу **SQLdiag** . Параметр**STOP_ABORT** вызывает максимально быстрое завершение работы службы, не дожидаясь окончания выполняемого в настоящий момент сбора диагностических сведений.  
  
 Если используются эти аргументы управления службой, они должны быть первыми аргументами в командной строке. Пример:  
  
 **SQLDIAG START**  
  
 Только аргумент **/A** , указывающий именованный экземпляр **SQLdiag**, может быть использован вместе со **START**, **STOP**или **STOP_ABORT** для управления определенным экземпляром службы **SQLdiag** . Пример:  
  
 **SQLDIAG START /A** *имя_приложения_SQLdiag*  
  
## <a name="security-requirements"></a>Требования безопасности  
 Кроме случая, когда **SQLdiag** выполняется в обычном режиме (с помощью аргумента командной строки **/G** ), пользователь, запускающий **SQLdiag** , должен быть членом группы **Администраторы** Windows и членом предопределенной роли сервера [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sysadmin** . По умолчанию программа **SQLdiag** подключается к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , используя проверку подлинности Windows, но поддерживает и проверку подлинности [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .  
  
## <a name="performance-considerations"></a>Вопросы производительности  
 Влияние выполнения **SQLdiag** на производительность зависит от типа собираемых диагностических данных. Например, если программа **SQLdiag** настроена на сбор данных трассировки [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , то количество классов событий, выбранных для трассировки, будет влиять на производительность сервера.  
  
 Воздействие выполнения программы **SQLdiag** на производительность приблизительно равно сумме затрат на сбор диагностических сведений по отдельности. Например, сбор данных трассировки с помощью **SQLdiag** влияет на производительность так же, как их сбор с помощью [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)]. Влияние программы **SQLdiag** на производительность незначительно.  
  
## <a name="required-disk-space"></a>Необходимое место на диске  
 Поскольку программа **SQLdiag** может собирать различные типы диагностических сведений, количество свободного места на диске, необходимого для выполнения **SQLdiag** , может различаться. Объем собранных диагностических сведений зависит от характера и объема рабочей нагрузки, которую обрабатывает сервер, и может меняться от нескольких мегабайтов до нескольких гигабайтов.  
  
## <a name="configuration-files"></a>Файлы конфигурации  
 При запуске программа **SQLdiag** считывает файл конфигурации и указанные аргументы командной строки. Типы диагностических сведений, которые собирает программа **SQLdiag** , указываются в файле конфигурации. По умолчанию программа **SQLdiag** использует файл конфигурации SQLDiag.Xml, который извлекается каждый раз при запуске программы и расположен в папке запуска **SQLdiag** . Файл конфигурации использует схему XML SQLDiag_schema.xsd, которая также извлекается в каталог запуска программы из исполняемого файла каждый раз при выполнении **SQLdiag** .  
  
### <a name="editing-the-configuration-files"></a>Изменение файлов конфигурации  
 Чтобы изменить типы диагностических данных, собираемых программой **SQLdiag** , можно скопировать и изменить файл SQLDiag.Xml. Для изменения файла конфигурации всегда используйте редактор XML, который может проверить файл конфигурации на соответствие его схеме XML, например [!INCLUDE[ssManStudio](../includes/ssmanstudio-md.md)]. Не следует непосредственно изменять файл SQLDiag.Xml. Вместо этого скопируйте файл SQLDiag.Xml в файл с новым именем в той же самой папке. Затем отредактируйте новый файл и используйте аргумент **/I** , чтобы передать его в программу **SQLdiag**.  
  
#### <a name="editing-the-configuration-file-when-sqldiag-runs-as-a-service"></a>Изменение файла конфигурации во время выполнения программы SQLdiag в качестве службы  
 Если программа **SQLdiag** уже запущена как служба и необходимо изменить файл конфигурации, отмените регистрацию службы SQLDIAG с помощью аргумента командной строки **/U** и повторно зарегистрируйте службу с помощью параметра командной строки **/R** . Отмена регистрации и повторная регистрация службы удаляют старые сведения о конфигурации, которые были сохранены в реестре Windows.  
  
## <a name="output-folder"></a>Выходная папка  
 Если выходная папка не была указана с помощью аргумента **/O** , программа **SQLdiag** создаст вложенную папку с именем SQLDIAG в папке запуска **SQLdiag** . Для сбора диагностических сведений, связанного с трассировкой больших объемов данных, например сведений [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , убедитесь, что выходная папка находится на локальном диске, имеющем достаточное количество свободного места для хранения этих данных.  
  
 После перезапуска программа **SQLdiag** перезаписывает содержимое выходной папки. Чтобы избежать этого, укажите в командной строке **/N 2** .  
  
## <a name="data-collection-process"></a>Процесс сбора данных  
 При запуске программа **SQLdiag** выполняет начальные проверки, необходимые для сбора диагностических данных, указанных в файле SQLDiag.Xml. Этот процесс может занять несколько секунд. После того как программа **SQLdiag** начала сбор диагностических данных в консольном приложении, выводимые сообщения информируют о том, что **SQLdiag** начала сбор данных и остановить процесс можно, нажав CTRL + C. Если программа **SQLdiag** работает как служба, похожее сообщение будет записано в журнал событий Windows.  
  
 Если программа **SQLdiag** используется для диагностики проблемы, которую можно воспроизвести, дождитесь этого сообщения, прежде чем воспроизводить проблему на сервере.  
  
 Программа**SQLdiag** собирает большую часть диагностических данных параллельно. Все диагностические сведения собираются с помощью соединения со средствами, такими как программа [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sqlcmd** или интерпретатор командной строки Windows, кроме тех случаев, когда сведения собираются из журналов производительности Windows и журналов событий. Для наблюдения за сбором диагностических данных с помощью таких средств программа**SQLdiag** использует один рабочий поток на компьютере, при этом часто несколько средств работают одновременно. В процессе сбора данных программа **SQLdiag** направляет выходной поток каждого средства диагностики в выходную папку.  
  
## <a name="stopping-data-collection"></a>Остановка сбора данных  
 После начала сбора диагностических данных **SQLdiag** продолжает этот процесс, пока не будет остановлена пользователем или не остановится в указанное время. Настроить программу **SQLdiag** для остановки в указанное время можно с помощью аргумента **/E** , который позволяет указать время остановки, или с помощью параметра **/X** , который запускает **SQLdiag** в режиме моментального снимка.  
  
 При остановке **SQLdiag** останавливаются и все запущенные ею средства диагностики. Например, останавливается сбор трассировок [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , прекращается выполнение запущенных скриптов [!INCLUDE[tsql](../includes/tsql-md.md)] , и останавливаются любые процессы, порожденные программой во время сбора данных. После того как сбор диагностических данных закончен, **SQLdiag** завершает работу.  
  
> [!NOTE]  
>  Приостановка службы **SQLdiag** не поддерживается. Если вы попытаетесь приостановить службу **SQLdiag** , она остановится после того, как закончит сбор диагностических сведений, выполняемый в момент приостановки. Если перезапустить **SQLdiag** после ее остановки, она запустится и перезапишет выходную папку. Чтобы избежать перезаписи выходной папки, укажите в командной строке **/N 2** .  
  
 **Остановка программы SQLdiag, выполняющейся в консольном приложении**  
  
 Если программа **SQLdiag** запущена в виде консольного приложения, для ее остановки нажмите CTRL + C в окне консоли, в котором выполняется **SQLdiag** . После нажатия CTRL + C в окне консоли отобразится сообщение о том, что программа **SQLdiag** заканчивает сбор данных и нужно подождать, пока процесс завершится, что может занять несколько минут.  
  
 Нажмите Ctrl+C дважды, чтобы принудительно завершить все дочерние диагностические процессы и немедленно завершить приложение.  
  
 **Остановка программы SQLdiag, выполняющейся в режиме службы**  
  
 Если **SQLdiag** запущена как служба, выполните **SQLDiag STOP** в папке запуска **SQLdiag** , чтобы остановить ее.  
  
 Если на одном компьютере выполняется несколько экземпляров **SQLdiag** , для остановки службы в командной строке можно, помимо прочего, передать имя экземпляра **SQLdiag** . Например, чтобы остановить экземпляр **SQLdiag** с именем Instance1, используйте следующий синтаксис:  
  
```  
SQLDIAG STOP /A Instance1  
```  
  
> [!NOTE]  
>  **/A** — единственный параметр командной строки, который может использоваться вместе со **START**, **STOP**или **STOP_ABORT**. Если нужно указать именованный экземпляр **SQLdiag** вместе с одной из команд управления службой, укажите **/A** в командной строке после команды управления, как показано в предыдущем примере синтаксиса. Если используются команды управления, они должны быть первыми аргументами в командной строке.  
  
 Чтобы остановить службу как можно быстрее, выполните в папке запуска программы команду **SQLDIAG STOP_ABORT** . Эта команда прерывает любой сбор диагностических данных, выполняемый в настоящее время, не ожидая его завершения.  
  
> [!NOTE]  
>  Используйте **SQLDiag STOP** или **SQLDIAG STOP_ABORT** для остановки службы **SQLdiag** . Не используйте консоль служб Windows, чтобы остановить **SQLdiag** или другие службы [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .  
  
## <a name="automatically-starting-and-stopping-sqldiag"></a>Автоматический запуск и остановка SQLdiag  
 Чтобы автоматически запускать и останавливать сбор диагностических данных в указанное время, используйте аргументы **/B***время_начала* и **/E***время_окончания* в 24-часовом формате времени. Например, если нужно устранить неполадку, которая регулярно происходит приблизительно в 02:00:00, можно настроить **SQLdiag** таким образом, чтобы она автоматически начинала собирать диагностические данные в 01:00:00 и останавливалась в 03:00:00. Укажите аргументы **/B** и **/E** , чтобы указать время запуска и остановки. Используйте 24-часовой формат времени, чтобы указать точную дату и время запуска и остановки в формате ГГГГММДД_ЧЧ:ММ:СС. Чтобы указать относительное время запуска или остановки, поставьте в начале времени запуска и остановки **+** и не указывайте составляющую даты (ГГГГММДД_), как показано в следующем примере, где программа **SQLdiag** ждет 1 час перед началом сбора сведений, затем собирает сведения в течение 3 часов и завершает работу.  
  
```  
sqldiag /B +01:00:00 /E +03:00:00  
```  
  
 Если указано относительное *start_time* , **SQLdiag** запустится в момент времени, вычисляемый относительно текущей даты и времени. Если указано относительное *end_time* , **SQLdiag** завершит работу в момент времени, вычисляемый относительно указанного *start_time*. Если указать время запуска или окончания, которое уже прошло, **SQLdiag** принудительно изменит дату запуска таким образом, что дата и время запуска будут находиться в будущем.  
  
 В силу этой особенности выбираемые даты запуска и завершения работы имеют большое значение. Рассмотрим следующий пример:  
  
```  
sqldiag /B +01:00:00 /E 08:30:00  
```  
  
 Если текущее время — 08:00, время завершения работы наступит прежде, чем начнется сбор диагностических данных. Поскольку **SQLdiag** автоматически прибавляет к дате запуска и завершения работы один день в случае, если время уже просрочено, в этом примере сбор диагностических сведений начнется в 09:00 текущего дня (относительное время запуска было указано с помощью префикса **+**) и продолжится до 08:30 следующего утра.  
  
### <a name="stopping-and-restarting-sqldiag-to-collect-daily-diagnostics"></a>Остановка и перезапуск SQLdiag для сбора ежедневных диагностических сведений  
 Для сбора указанного набора диагностических сведений ежедневно, без запуска и остановки **SQLdiag**вручную, используйте аргумент **/L** . Аргумент **/L** вызывает выполнение **SQLdiag** в непрерывном режиме с автоматическим перезапуском после запланированного завершения. Если указан аргумент **/L** , а программа **SQLdiag** останавливается, так как наступило время завершения работы, указанное в аргументе **/E** , или программа выполнялась в режиме моментального снимка, заданном аргументом **/X** , то **SQLdiag** перезапустится вместо завершения работы.  
  
 В следующем примере указано, что **SQLdiag** запускается в непрерывном режиме для автоматического перезапуска после сбора диагностических данных, происходящего между 03:00:00 и 05:00:00.  
  
```  
sqldiag /B 03:00:00 /E 05:00:00 /L  
```  
  
 В следующем примере указано, что **SQLdiag** запускается в непрерывном режиме для автоматического перезапуска после создания моментального снимка диагностических данных в 03:00:00.  
  
```  
sqldiag /B 03:00:00 /X /L  
```  
  
## <a name="running-sqldiag-as-a-service"></a>Работа программы SQLdiag в качестве службы  
 Если вы хотите использовать **SQLdiag** для сбора диагностических данных в течение длительных промежутков времени, во время которых может понадобиться выходить из системы компьютера, на котором выполняется **SQLdiag** , можно запустить ее как службу.  
  
 **Регистрация программы SQLDiag для запуска в качестве службы**  
  
 Программу **SQLdiag** можно зарегистрировать для запуска в качестве службы, указав в командной строке аргумент **/R** . Таким образом, **SQLDiag** регистрируется для запуска в качестве службы. Имя службы **SQLdiag** — SQLDIAG. Любые другие аргументы, указанные в командной строке при регистрации **SQLdiag** в качестве службы, сохраняются и используются всякий раз при запуске службы.  
  
 Чтобы изменить имя службы по умолчанию SQLDIAG, используйте параметр командной строки **/A** и укажите другое имя. Программа**SQLdiag** автоматически добавляет префикс DIAG$ к любому имени экземпляра **SQLdiag** , указанному с помощью **/A** , чтобы получить понятное имя службы.  
  
 **Отмена регистрации службы SQLDIAG**  
  
 Чтобы отменить регистрацию службы, укажите аргумент **/U** . При отмене регистрации программы **SQLdiag** в качестве службы из реестра Windows удаляются разделы реестра этой службы.  
  
 **Запуск или перезапуск службы SQLDIAG**  
  
 Чтобы запустить или перезапустить службу SQLDIAG, запустите в командной строке **SQLDiag START** .  
  
 Если работает несколько экземпляров **SQLdiag** , при запуске службы с помощью аргумента **/A** в командной строке можно передать имя экземпляра **SQLdiag** . Например, чтобы запустить экземпляр **SQLdiag** с именем Instance1, используйте следующий синтаксис:  
  
```  
SQLDIAG START /A Instance1  
```  
  
 Также для запуска службы SQLDIAG можно использовать команду **net start** .  
  
 Во время перезапуска программы **SQLdiag**она перезаписывает содержимое текущей выходной папки. Чтобы избежать этого, укажите в командной строке **/N 2** , чтобы переименовать выходную папку при запуске программы.  
  
 Приостановка службы **SQLdiag** не поддерживается.  
  
## <a name="running-multiple-instances-of-sqldiag"></a>Работа нескольких экземпляров программы SQLdiag  
 Запустить несколько экземпляров программы **SQLdiag** на одном компьютере можно, указав в командной строке **/A***имя_приложения_SQLdiag*. Это полезно для одновременного сбора различных наборов диагностических сведений для одного экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Например, именованный экземпляр **SQLdiag** можно настроить на непрерывное выполнение сбора небольшого количества данных. Тогда в случае возникновения определенной проблемы в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]можно запустить экземпляр **SQLdiag** по умолчанию, чтобы собрать диагностические данные об этой проблеме или собрать набор диагностических данных, запрошенных службами поддержки пользователей [!INCLUDE[msCoName](../includes/msconame-md.md)] для диагностики проблемы.  
  
## <a name="collecting-diagnostic-data-from-clustered-sql-server-instances"></a>Сбор диагностических данных из кластеризованных экземпляров SQL Server  
 Программа**SQLdiag** поддерживает сбор диагностических данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] . Для сбора диагностических данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] убедитесь, что в качестве атрибута **name** элемента **\<Machine>** в файле конфигурации SQLDiag.Xml указан символ **"."**, и не указывайте аргумент командной строки **/G**. По умолчанию для атрибута **name** в файле конфигурации указывается символ **"."** , а аргумент **/G** отключен. Как правило, при сборе данных из кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] не нужно изменять файл конфигурации или аргументы командной строки.  
  
 Если в качестве имени компьютера указан символ **.** , то программа **SQLdiag** определяет, что она выполняется на кластере, и одновременно получает диагностические сведения для всех виртуальных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , установленных в этом кластере. Если нужно собрать диагностические сведения только для одного виртуального экземпляра [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], выполняемого на компьютере, укажите этот виртуальный экземпляр [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] в качестве атрибута **name** элемента **\<Machine>** в файле SQLDiag.Xml.  
  
> [!NOTE]  
>  Для сбора сведений о трассировках приложения [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] от кластеризованных экземпляров [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] на кластере должны быть доступны административные общие папки (ADMIN$).  
  
## <a name="see-also"></a>См. также  
 [Справочник по программе командной строки ( компонент Database Engine)](command-prompt-utility-reference-database-engine.md)  
  
  
