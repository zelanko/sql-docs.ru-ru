---
title: Включение и отключение "песочница" для языка определения отчетов | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: reporting-services-native
ms.topic: conceptual
ms.assetid: d5619e9f-ec5b-4376-9b34-1f74de6fade7
author: maggiesMSFT
ms.author: maggies
manager: kfile
ms.openlocfilehash: ebc5ee51dd32cb999f0e6551bb87c36eda8865c7
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "66109225"
---
# <a name="enable-and-disable-rdl-sandboxing"></a>Включение и отключение «песочницы» для языка определения отчетов
  Функция «песочницы» для языка определения отчетов позволяет обнаруживать и ограничивать использование определенных типов ресурсов отдельными пользователями в среде с многочисленными пользователями, которые используют единственную веб-ферму серверов отчетов. Примером этого является сценарий услуг хост-сервера, в котором может поддерживаться единственная веб-ферма серверов отчетов, применяемая несколькими пользователями, а также, возможно, другими компаниями. Администратор сервера отчетов может включить эту функцию для выполнения следующих задач.  
  
-   Ограничение размера внешних ресурсов. Внешние ресурсы включают изображения, XSLT-файлы и данные карт.  
  
-   Во время публикации отчета ограничить типы и члены, используемые в тексте выражения.  
  
-   Во время выполнения ограничить длину текста и размер возвращаемых значений для выражений.  
  
 При включении функции «песочницы» для языка определения отчетов отключаются следующие функции:  
  
-   Пользовательский код в элементе ** \<>кода** определения отчета.  
  
-   режим обратной совместимости выражений языка определения отчетов для пользовательских элементов отчета [!INCLUDE[ssRSversion2005](../includes/ssrsversion2005-md.md)] ;  
  
-   именованные параметры в выражениях.  
  
 В этом разделе описывается каждый элемент в элементе `RDLSandboxing` <> в файле RSReportServer. config. Дополнительные сведения об изменении файла см. в разделе [Изменение файла конфигурации служб Reporting Services (RSreportserver.config)](report-server/modify-a-reporting-services-configuration-file-rsreportserver-config.md). Операции с записями журнала трассировки сервера, связанные с функцией «песочницы» для выражений языка определения отчетов. Дополнительные сведения о журналах трассировки см. в разделе [Журнал трассировки службы сервера отчетов](report-server/report-server-service-trace-log.md).  
  
## <a name="example-configuration"></a>Пример конфигурации  
 В следующем примере показаны параметры и примеры значений для элемента <`RDLSandboxing`> в файле RSReportServer. config.  
  
```  
<RDLSandboxing>  
   <MaxExpressionLength>5000</MaxExpressionLength>  
   <MaxResourceSize>5000</MaxResourceSize>  
   <MaxStringResultLength>3000</MaxStringResultLength>  
   <MaxArrayResultLength>250</MaxArrayResultLength>  
   <Types>  
      <Allow Namespace="System.Drawing" AllowNew="True">Bitmap</Allow>  
      <Allow Namespace="TypeConverters.Custom" AllowNew="True">*</Allow>  
   </Types>  
   <Members>  
      <Deny>Format</Deny>  
      <Deny>StrDup</Deny>  
   </Members>  
</RDLSandboxing>  
```  
  
## <a name="configuration-settings"></a>Параметры конфигурации  
 Сведения о параметрах настройки приведены в следующей таблице. Параметры представлены в том порядке, в котором они следуют в файле конфигурации.  
  
|Параметр|Description|  
|-------------|-----------------|  
|**максекспрессионленгс**|Максимально допустимое число символов в выражении языка определения отчетов.<br /><br /> Значение по умолчанию: 1000|  
|**максресаурцесизе**|Максимально допустимый размер внешнего ресурса (КБ).<br /><br /> По умолчанию — 100|  
|**максстрингресултленгс**|Максимально допустимое число символов для возвращаемого значения выражения языка определения отчетов.<br /><br /> Значение по умолчанию: 1000|  
|**максаррайресултленгс**|Максимальное число элементов для возвращаемого значения выражения языка определения отчетов, допустимое в массиве.<br /><br /> По умолчанию — 100|  
|**Типов**|Список членов, разрешенных для выражений языка определения отчетов.|  
|**Возможность**|Тип или набор типов, разрешенных для выражений языка определения отчетов.|  
|**Пространство имен**|Атрибут для элемента **Allow** , представляющий пространство имен, содержащее один или несколько типов, применимых к атрибуту Value. Это свойство учитывает регистр символов.|  
|`AllowNew`|Логический атрибут для **allow** , определяющий, разрешено ли создание новых экземпляров типа в выражениях языка определения отчетов или в классе языка определения отчетов ** \<>** элемент.<br /><br /> Примечание. Если `RDLSandboxing` включен, новые массивы не могут быть созданы в выражениях языка определения отчетов, независимо от `AllowNew`значения параметра.|  
|**Value**|Значение элемента **Allow** , представляющее имя типа, разрешенного в выражениях языка определения отчетов. Значение **\*** указывает, что разрешены все типы в пространстве имен. Это свойство учитывает регистр символов.|  
|**Члены**|Для списка типов, которые включены в элемент ** \<Types>** , список имен членов, запрещенных в выражениях языка определения отчетов.|  
|**Запретить**|Имя члена, запрещенного в выражении языка определения отчетов. Это свойство учитывает регистр символов.<br /><br /> Примечание. Если для элемента указано **Deny** , то все элементы всех типов с этим именем будут запрещены.|  
  
## <a name="working-with-expressions-when-rdl-sandboxing-is-enabled"></a>Работа с выражениями в режиме «песочницы» для выражений языка определения отчетов  
 Функцию «песочницы» для выражений языка определения отчетов можно изменить, чтобы обеспечить управление ресурсами, используемыми в выражении, следующим образом:  
  
-   ограничение количества символов, используемых в выражении;  
  
-   ограничение размера результата, возвращаемого выражением;  
  
-   разрешение списка определенных типов, которые могут быть использованы в выражении;  
  
-   ограничение списка членов по именам для списка разрешенных типов, которые могут быть использованы в выражении;  
  
-   функция «песочницы» для выражений языка определения отчетов позволяет создать список разрешенных типов и список запрещенных членов. Список разрешенных типов называется списком разрешений. Список запрещенных членов называется списком блокировок.  
  
> [!NOTE]  
>  В определении отчета компьютеру неизвестны типы всех экземпляров в справочниках выражений служб. При добавлении члена к списку блокировок в списке разрешений блокируются все члены всех типов с этим именем.  
  
 Проверка результатов выражений языка определения отчетов производится во время выполнения. Выражения языка определения отчетов проверяются в определении отчета при публикации отчета. Наблюдение за журналом трассировки сервера отчетов на наличие нарушений. Дополнительные сведения см. в статье [Report Server Service Trace Log](report-server/report-server-service-trace-log.md).  
  
### <a name="working-with-types"></a>Работа с типами  
 При добавлении типа к списку разрешений осуществляется управление следующими точками входа, используемыми для доступа к выражениям языка определения отчетов:  
  
-   статические члены этого типа;  
  
-   [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] `New` Метод.  
  
-   Классы>элемента в определении отчета. ** \<**  
  
-   члены, добавленные к списку блокировок, для типа в списке разрешений.  
  
 Список разрешений не управляет следующими точками входа:  
  
-   наборы данных отчетов. Поля в наборах данных отчетов, возвращаемые при запросах, могут содержать любой допустимый тип выражения языка определения отчетов;  
  
-   параметры отчета; Указанные пользователем значения параметров могут содержать любой допустимый тип выражения языка определения отчетов;  
  
-   члены разрешенного типа, не состоящие в списке блокировок. По умолчанию разрешены все члены всех типов в списке разрешений. При добавлении имени члена к списку блокировок в списке разрешений блокируются все члены всех типов с этим именем.  
  
 Чтобы разрешить член одного типа и запретить член другого типа с тем же именем, необходимо выполнить следующие действия:  
  
-   Добавьте элемент ** \<Deny>** в качестве имени члена.  
  
-   в пользовательской сборке создать в классе член-посредник с другим именем для того члена, который необходимо разрешить;  
  
-   добавить этот новый класс к списку разрешений.  
  
 Чтобы добавить функции [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] .NET Framework к списку разрешений, добавьте к списку разрешений соответствующие типы из пространства имен Microsoft.VisualBasic.  
  
 Чтобы добавить ключевые слова, определяющие тип [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] .NET Framework, добавьте к списку разрешений соответствующий тип CLR. Например, чтобы использовать ключевое [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] слово `Integer`.NET Framework, добавьте следующий фрагмент XML в элемент ** \<>включен RDLSandboxing** :  
  
```  
<Allow Namespace="System">Int32</Allow>  
```  
  
 Чтобы добавить универсальный или допускающий значения NULL тип .NET Framework [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] к списку разрешений, выполните следующие действия:  
  
-   создайте тип-посредник для универсального или допускающего значения NULL типа .NET Framework [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] ;  
  
-   добавьте тип-посредник к списку разрешений.  
  
 При добавлении типа из пользовательской сборки к списку разрешений для сборки неявное предоставление разрешения на выполнение не выполняется. Необходимо специально изменить файл управления доступом для кода, предоставив разрешение на выполнение для данной сборки. Дополнительные сведения см. в статье [Code Access Security in Reporting Services](extensions/secure-development/code-access-security-in-reporting-services.md).  
  
#### <a name="maintaining-the-deny-list-of-members"></a>Обслуживание списка \<запрещенных> членов  
 В следующем списке показано, когда необходимо обновление списка заблокированных членов при добавлении нового типа к списку разрешений:  
  
-   при обновлении пользовательской сборки до версии, в которой вводятся новые типы;  
  
-   при добавлении новых членов к типам в списке разрешений;  
  
-   при обновлении [!INCLUDE[dnprdnshort](../includes/dnprdnshort-md.md)] на сервере отчетов;  
  
-   при обновлении сервера отчетов до последней версии служб [!INCLUDE[ssRSnoversion](../includes/ssrsnoversion-md.md)];  
  
-   при обновлении сервера отчетов для обработки последней схемы языка определения отчетов при добавлении новых членов к типам языка определения отчетов.  
  
### <a name="working-with-operators-and-new"></a>Работа с операторами и оператором New  
 По умолчанию все операторы языка [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] .NET Framework, кроме `New`, всегда разрешены. `New` Оператор управляется `AllowNew` атрибутом в элементе ** \<Allow>** . Всегда разрешены другие операторы языка, такие как оператор `!` метода доступа [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] коллекции по умолчанию и `CInt`.NET Frameworkные макросы приведения.  
  
 Добавление операторов к списку заблокированных, включая пользовательские, не поддерживается. Чтобы исключить тип операторов, выполните следующие действия:  
  
-   создайте тип-посредник, не реализующий операторы, которые необходимо исключить;.  
  
-   добавьте тип-посредник к списку разрешений.  
  
 Чтобы создать новый массив в выражении языка определения отчетов, создайте массив в определяемом классе и добавьте этот класс к списку разрешений.  
  
 Чтобы создать новый массив в выражении языка определения отчетов, необходимо выполнить следующие действия:  
  
-   определите новый класс и создайте массив в методе в этом классе;  
  
-   добавьте этот класс к списку разрешений.  
  
## <a name="see-also"></a>См. также:  
 [Файл конфигурации RSReportServer](report-server/rsreportserver-config-configuration-file.md)   
 [Журнал трассировки службы сервера отчетов](report-server/report-server-service-trace-log.md)  
  
  
