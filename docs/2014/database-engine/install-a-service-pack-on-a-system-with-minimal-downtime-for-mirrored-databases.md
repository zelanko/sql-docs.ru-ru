---
title: Установите пакет обновления в системе с минимальным временем простоя для зеркально отображаемых баз данных | Документация Майкрософт
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- hotfixes [SQL Server]
- database mirroring [SQL Server], upgrading system
- rolling upgrades [SQL Server]
- service packs [SQL Server]
- upgrading mirrored database systems
- upgrading SQL Server, mirrored databases
ms.assetid: bdc63142-027d-4ead-9d3e-147331387ef5
author: mashamsft
ms.author: mathoma
manager: craigg
ms.openlocfilehash: 821fd05e94ac820dff50bd08c70c75e7e9cc653d
ms.sourcegitcommit: 2429fbcdb751211313bd655a4825ffb33354bda3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2018
ms.locfileid: "52520385"
---
# <a name="install-a-service-pack-on-a-system-with-minimal-downtime-for-mirrored-databases"></a>Установка пакета обновления на систему с минимальным временем простоя для зеркально отображаемых баз данных
  В этом разделе описывается, как добиться минимального времени простоя зеркальных баз данных при установке пакетов обновления и исправлений. Этот процесс подразумевает последовательное обновление экземпляров [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)], участвующих в зеркальном отображении базы данных. Этой форме обновления, который известен как *последовательным обновлением*, время простоя сокращается до одной отработки отказа. Обратите внимание на то, что режим высокой производительности в сеансах на зеркальный сервер географически удален от основного сервера, последовательное обновление может оказаться неподходящим.  
  
 Последовательное обновление является сложным процессом, состоящим из следующих этапов.  
  
-   Обеспечьте защиту данных.  
  
-   Если в сеанс включен следящий сервер, рекомендуется его удалить. В противном случае при обновлении экземпляра зеркального сервера доступность базы данных будет зависеть от следящего сервера, остающегося подключенным к экземпляру основного сервера. После удаления следящего сервера его можно обновить в любой момент во время последовательного обновления без дополнительного простоя базы данных.  
  
    > [!NOTE]  
    >  Дополнительные сведения см. в разделе [кворума: Как следящий сервер влияет на доступность базы данных &#40;зеркального отображения базы данных&#41;](database-mirroring/quorum-how-a-witness-affects-database-availability-database-mirroring.md).  
  
-   Если сеанс выполняется в режиме высокой производительности, измените его на режим высокой безопасности.  
  
-   Обновление всех экземпляров сервера, участвующих в зеркальном отображении базы данных. Последовательное обновление включает обновление экземпляра сервера, который в настоящий момент является зеркальным сервером, ручной перевод на другой ресурс каждой из его зеркальных баз данных и обновление экземпляра сервера, который первоначально был основным сервером, а сейчас является зеркальным. В этот момент необходимо возобновить зеркальное отображение.  
  
    > [!NOTE]  
    >  Перед началом пошагового обновления рекомендуется выполнить пробную отработку отказа вручную как минимум в одном сеансе зеркального отображения.  
  
-   При необходимости перейдите в высокопроизводительный режим.  
  
-   Если требуется, верните следящий сервер в сеанс.  
  
 Ниже описаны процедуры для этих этапов.  
  
> [!IMPORTANT]  
>  Экземпляр сервера может одновременно исполнять различные роли зеркального отображения (основной сервер, зеркальный сервер или следящий сервер) в параллельных сеансах зеркального отображения. В этом случае придется соответствующим образом адаптировать процесс последовательного обновления.  
  
### <a name="to-protect-your-data-before-an-update-a-best-practice"></a>Защита данных перед обновлением (рекомендации)  
  
1.  Создайте полную резервную копию каждой основной базы данных.  
  
     **Создание резервной копии базы данных**  
  
    -   [Создание полной резервной копии базы данных (SQL Server)](../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md)  
  
2.  Выполните команду [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) в каждой основной базе данных.  
  
### <a name="to-remove-a-witness-from-a-session"></a>Удаление следящего сервера из сеанса  
  
1.  Если сеанс зеркального отображения включает следящий сервер, рекомендуется удалить его перед выполнением последовательного обновления.  
  
     **Удаление следящего сервера**  
  
    -   [Удаление следящего сервера из сеанса зеркального отображения базы данных (SQL Server)](database-mirroring/remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
### <a name="to-change-a-session-from-high-performance-mode-to-high-safety-mode"></a>Изменение режима сеанса с высокопроизводительного на режим высокой безопасности  
  
1.  Если сеанс зеркального отображения выполняется в высокопроизводительном режиме, перед выполнением последовательного обновления измените его на режим высокой безопасности без автоматической отработки отказа. Используйте один из следующих методов.  
  
    -   На языке [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)]. Изменение **режим работы** равным **высокая безопасность без автоматической отработки отказа (синхронный)** с помощью [зеркального отображения страницы](../relational-databases/databases/database-properties-mirroring-page.md) из **базы данных Свойства** диалоговое окно. Дополнительные сведения о доступе к этой странице см. в разделе [Запуск мастер настройки безопасности зеркального отображения баз данных (среда SQL Server Management Studio)](database-mirroring/start-the-configuring-database-mirroring-security-wizard.md).  
  
    -   На языке [!INCLUDE[tsql](../includes/tsql-md.md)]. Установите безопасность транзакций в значение FULL. Дополнительные сведения см. в разделе [Изменение безопасности транзакций в сеансах зеркального отображения базы данных (Transact-SQL)](database-mirroring/change-transaction-safety-in-a-database-mirroring-session-transact-sql.md).  
  
### <a name="to-perform-the-rolling-update"></a>Выполнение последовательного обновления  
  
1.  Чтобы свести к минимуму время простоя, необходимо выполнить следующие рекомендации. Начните последовательное обновление с обновления участника зеркального отображения, который в настоящий момент является зеркальным сервером во всех сеансах зеркального отображения. На этом этапе, возможно, придется обновить несколько экземпляров сервера.  
  
    > [!NOTE]  
    >  Следящий сервер можно обновить в любой момент последовательного обновления. Например, если экземпляр сервера является зеркальным сервером в сеансе 1 и следящим сервером в сеансе 2, этот сервер можно обновить сразу.  
  
     Экземпляр сервера, который следует обновлять в первую очередь, зависит от текущей конфигурации сеансов зеркального отображения следующим образом.  
  
    -   Если какой-либо из экземпляров сервера уже является зеркальным сервером во всех сеансах зеркального отображения баз данных, установите на него пакет обновления или исправление.  
  
    -   Если все экземпляры сервера в настоящее время являются основными серверами в сеансе зеркального отображения баз данных, выберите первый экземпляр сервера для обновления. Затем вручную переведите каждую из основных баз данных на другой ресурс и обновите экземпляр сервера путем установки пакета обновления или исправления.  
  
     После обновления экземпляр сервера автоматически подключится к сеансам зеркального отображения.  
  
     **Отработки отказа вручную**  
  
    -   [Переключение сеанса зеркального отображения базы данных на другой ресурс вручную (среда SQL Server Management Studio)](database-mirroring/manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [Переключение сеанса зеркального отображения базы данных на другой ресурс вручную (язык Transact-SQL)](database-mirroring/manually-fail-over-a-database-mirroring-session-transact-sql.md).  
  
     Дополнительные сведения об отработке отказа вручную см. в разделе [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md).  
  
2.  В каждом сеансе зеркального отображения, зеркальный сервер которого был обновлен, дождитесь окончания синхронизации сеанса. Затем подключитесь к экземпляру основного сервера и вручную переведите этот сеанс на другой ресурс. При отработке отказа обновленный сервер становится основным сервером для этого сеанса, а бывший основной сервер становится зеркальным.  
  
     Цель этого этапа — сделать другой экземпляр сервера зеркальным во всех сеансах зеркального отображения, в которых он участвует.  
  
3.  После перехода на другой ресурс рекомендуется выполнить в основной базе данных команду [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) .  
  
4.  Установите пакет обновления или исправление на каждом экземпляре сервера, который теперь стал зеркальным сервером во всех сеансах зеркального отображения баз данных, участником которых он является. На этом этапе, возможно, придется обновить несколько серверов.  
  
    > [!IMPORTANT]  
    >  В сложной конфигурации зеркального отображения некоторые экземпляры сервера могут все еще исполнять роль основного сервера в одном или нескольких сеансах зеркального отображения. Повторите шаги 2 – 4 для этих экземпляров серверов, пока не будут обновлены все экземплярах.  
  
5.  Возобновление сеанса зеркального отображения.  
  
    > [!NOTE]  
    >  Автоматическая отработка отказа не будет работать, пока не будут обновлены все следящие серверы.  
  
6.  Установите пакеты обновления или исправления на оставшемся экземпляре сервера, который является следящим во всех сеансах зеркального отображения. После подключения обновленного следящего сервера к сеансу зеркального отображения становится возможным автоматическая отработка отказа. На этом этапе, возможно, придется обновить несколько серверов.  
  
### <a name="to-return-a-session-to-high-performance-mode"></a>Возвращение сеанса в высокопроизводительный режим  
  
1.  При необходимости вернитесь в высокопроизводительный режим, используя один из следующих методов.  
  
    -   На языке [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)]. Изменение **режим работы** равным **высокая производительность (асинхронный)** с помощью [зеркального отображения страницы](../relational-databases/databases/database-properties-mirroring-page.md) из **свойства базы данных**диалоговое окно.  
  
    -   На языке [!INCLUDE[tsql](../includes/tsql-md.md)]. Используйте [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql-database-mirroring) установите безопасность транзакций в значение OFF.  
  
### <a name="to-return-a-witness-to-a-mirroring-session"></a>Возврат следящего сервера в сеанс зеркального отображения  
  
1.  При необходимости в режиме высокой безопасности повторно соедините следящий сервер со всеми сеансами зеркального отображения.  
  
     **Чтобы заново установить следящего сервера**  
  
    -   [Добавление или замена следящего сервера зеркального отображения базы данных (среда SQL Server Management Studio)](database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
    -   [Добавление следящего сервера для зеркального отображения базы данных с использованием проверки подлинности Windows (Transact-SQL)](database-mirroring/add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
## <a name="see-also"></a>См. также  
 [Зеркальное отображение базы данных ALTER DATABASE (Transact-SQL)](/sql/t-sql/statements/alter-database-transact-sql-database-mirroring)   
 [BACKUP (Transact-SQL)](/sql/t-sql/statements/backup-transact-sql)   
 [Зеркальное отображение базы данных (SQL Server)](database-mirroring/database-mirroring-sql-server.md)   
 [Режимы работы зеркального отображения базы данных](database-mirroring/database-mirroring-operating-modes.md)   
 [Переключение ролей во время сеанса зеркального отображения базы данных (SQL Server)](database-mirroring/role-switching-during-a-database-mirroring-session-sql-server.md)   
 [Запуск монитора зеркального отображения баз данных (среда SQL Server Management Studio)](database-mirroring/start-database-mirroring-monitor-sql-server-management-studio.md)   
 [Просмотр состояния зеркального отображения базы данных (среда SQL Server Management Studio)](database-mirroring/view-the-state-of-a-mirrored-database-sql-server-management-studio.md)  
  
  
