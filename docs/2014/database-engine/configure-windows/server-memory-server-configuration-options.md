---
title: Параметры конфигурации памяти сервера | Документация Майкрософт
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- Virtual Memory Manager
- max server memory option
- virtual memory [SQL Server]
- VMM
- server memory options [SQL Server]
- servers [SQL Server], memory
- buffer pools [SQL Server]
- min server memory option
- manual memory options [SQL Server]
- memory [SQL Server], servers
ms.assetid: 29ce373e-18f8-46ff-aea6-15bbb10fb9c2
author: MikeRayMSFT
ms.author: mikeray
manager: craigg
ms.openlocfilehash: d4f7302da7be80038478c887a01bb32037503fc0
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "69028691"
---
# <a name="server-memory-configuration-options"></a>Параметры конфигурации памяти сервера
  Два параметра памяти сервера, **min server memory** и **max server memory**, используются для изменения в конфигурации объема памяти (в мегабайтах), управляемой диспетчером памяти SQL Server для процесса SQL Server, применяемого экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
 По умолчанию параметр **min server memory** имеет значение 0, а параметр **max server memory** — 2147483647 МБ. По умолчанию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может динамически изменять требования к памяти в зависимости от доступных системных ресурсов.  
  
> [!NOTE]  
> Если присвоить параметру **max server memory** минимальное значение, производительность [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может значительно ухудшиться, иногда сервер даже не будет запускаться. Если не удается запустить [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] после изменения этого параметра, запустите его с использованием параметра запуска **-f** и верните параметр **max server memory** к предыдущему значению. Дополнительные сведения см. в разделе [Параметры запуска службы Database Engine](database-engine-service-startup-options.md).  
  
 Когда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использует память динамически, он периодически опрашивает систему, чтобы определить объем свободной памяти. Поддержание достаточного объема свободной памяти позволяет избежать подкачки в операционной системе (ОС). Если свободно меньше памяти, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] высвобождает память для ОС. Если свободно больше памяти, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может выделить дополнительный объем памяти. 
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] добавляет память, только если она требуется для рабочей нагрузки; во время простоя сервера размер виртуального адресного пространства не увеличивается.  
  
 Обратитесь к примеру B для запроса о возврате информации об используемой в настоящий момент памяти. параметр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] **max server memory** контролирует выделение памяти, включая буферный пул, память компиляции, все кэши, QE памяти, память диспетчера блокировок и Память CLR (фактически любой клерк памяти, найденный в **sys. dm_os_memory_clerks**). Память для стеки потоков, кучи памяти, связанные поставщики сервера не [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]и память, выделенная не [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] DLL не контролируются параметром max server memory (максимальная память сервера).  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]использует API уведомления памяти **QueryMemoryResourceNotification** , чтобы определить, когда диспетчер памяти SQL Server может выделить память и освободить память.  
  
 Рекомендуется разрешить [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] использовать память динамически; однако существует возможность установить параметры памяти вручную и ограничить объем памяти, доступный серверу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Перед настройкой объема памяти для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]определите подходящее значение путем вычитания из общего объема физической памяти того объема, который требуется операционной системе и другим экземплярам [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (и для других нужд, если компьютер не выделен полностью под сервер [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]). Разница — максимальный объем памяти, который можно выделить серверу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
## <a name="setting-the-memory-options-manually"></a>Настройка параметров памяти вручную  
Можно установить для параметров сервера **Мин. памяти сервера** и **Макс. памяти сервера** значения, покрывающие весь доступный объем памяти. Этот метод полезен для системных администраторов или администраторов баз данных, когда требуется настроить экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] так, чтобы его параметры не противоречили требованиям к памяти других приложений или других экземпляров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], запущенных на этом узле.

> [!NOTE]
> Параметры **min server memory** и **max server memory** являются расширенными. При использовании системной хранимой процедуры **sp_configure** для изменения этих настроек изменить их можно, только если параметр **show advanced options** установлен в значение 1. Эти параметры вступают в силу сразу же без перезагрузки сервера.  
  
<a name="min_server_memory"></a>Используйте **min_server_memory** , чтобы гарантировать минимальный объем памяти, доступный диспетчеру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] памяти для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]не будет немедленно распределять объем памяти, указанный в параметре **min server memory** при запуске. Тем не менее, когда это значение достигается с ростом рабочей нагрузки, экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не может освободить память, выделенную буферному пулу, если не уменьшить значение параметра **min server memory** . Например, если на одном узле может находиться сразу несколько экземпляров [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], задайте параметр min_server_memory вместо max_server_memory, чтобы зарезервировать память для экземпляра. Кроме того, необходимо задать значение min_server_memory в виртуализированной среде, чтобы гарантировать, что при дефиците памяти на базовом узле не будет попыток выделить больше памяти из буферного пула в гостевой виртуальной машине [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], чем это необходимо для приемлемой производительности.
 
> [!NOTE]  
> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]не гарантирует выделение объема памяти, указанного в параметре **min server memory**. Если нагрузка на сервер не требует выделения объема памяти, указанного в параметре **min server memory**, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] будет выполняться с меньшим объемом памяти.  
  
<a name="max_server_memory"></a>Используйте **max_server_memory** , чтобы гарантировать, что операционная система не будет испытывать негативную нагрузку на память. Чтобы задать конфигурацию "Макс. памяти сервера", отследите общее использование памяти процессом [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и определите требования к памяти. Более точные вычисления для одного экземпляра
 -  Зарезервируйте 1–4 ГБ от общего объема памяти для ОС.
 -  Затем вычтите эквивалент потенциального выделения памяти ([!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]), которое не входят в диапазон **max server memory**, состоящий из **_стека <sup>1 </sup> \* вычисляемое максимальное число рабочих потоков <sup>2</sup> + параметр загрузки -g <sup>3</sup>_** (или 256 МБ по умолчанию, если значение *-g* не задано). Остаток и даст значение параметра max_server_memory в случае установки одного экземпляра.
 
<sup>1</sup> сведения о размерах стека потоков для каждой архитектуры см. в [руководстве по архитектуре управления памятью](https://docs.microsoft.com/sql/relational-databases/memory-management-architecture-guide#stacksizes) .

<sup>2</sup> см. страницу документации о [настройке параметра конфигурации сервера max worker threads](../../database-engine/configure-windows/configure-the-max-worker-threads-server-configuration-option.md)для получения сведений о вычисляемых рабочих потоках по умолчанию для заданного числа ЦП привязаны на текущем узле.

<sup>3</sup> сведения о параметре запуска *-g* см. на странице документации [Параметры запуска службы ядро СУБД](https://docs.microsoft.com/sql/database-engine/configure-windows/database-engine-service-startup-options?view=sql-server-2014) . Применимо только для 32-разрядной версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (с [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] по [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)]).

|тип ОС;|Минимальный объем памяти, допустимый для параметра **max server memory**|  
|-------------|----------------------------------------------------------------|  
|32-битная|64 МБ|  
|64-разрядная|128 МБ| 

## <a name="how-to-configure-memory-options-using-sql-server-management-studio"></a>Настройка параметров памяти с помощью среды SQL Server Management Studio  
 Используйте два параметра памяти сервера, **min server memory** и **max server memory**, для настройки объема памяти (в мегабайтах), которая находится в управлении диспетчера памяти SQL Server для экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. По умолчанию [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] может динамически изменять требования к памяти в зависимости от доступных системных ресурсов.  
  
### <a name="procedure-for-configuring-a-fixed-amount-of-memory"></a>Настройка фиксированного объема памяти  
 **Установка фиксированного размера памяти**  
  
1.  В обозревателе объектов щелкните правой кнопкой мыши сервер и выберите пункт **Свойства**.  
  
2.  Щелкните узел **Память** .  
  
3.  В пункте **Параметры памяти сервера**введите нужные значения в поля **Минимальный размер памяти сервера** и **Максимальный размер памяти сервера**.  
  
     Оставьте параметры по умолчанию, чтобы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] изменял требования к памяти динамически, исходя из доступности системных ресурсов. Значение по умолчанию для параметра **min server memory** равно 0, а параметру **max server memory** по умолчанию является 2147483647 мегабайт (МБ).  
  
## <a name="maximize-data-throughput-for-network-applications"></a>Режим «максимизировать пропускную способность для сетевых приложений»  
 Чтобы оптимизировать использование системной памяти для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], следует ограничить объем памяти, используемой системой для кэширования файлов. Чтобы ограничить кэш файловой системы, убедитесь, что снят флажок **макс. пропускная способность доступа к общим файлам** . Можно указать кэш файловой системы минимального размера, выбрав вариант **наименьшая занимаемая память** или **сбалансированный**.  
  
#### <a name="to-check-the-current-setting-on-your-operating-system"></a>Проверка значения параметра в операционной системе  
  
1.  Нажмите кнопку **Пуск**, выберите пункт **Панель управления**, дважды щелкните **Сетевые подключения**, а затем значок **Подключение по локальной сети**.  
  
2.  На вкладке **Общие** нажмите кнопку **Свойства**и выберите **Служба доступа к файлам и принтерам сетей Майкрософт**, затем нажмите кнопку **Свойства**.  
  
3.  Если выбран параметр **макс. пропускная способность для сетевых приложений** , выберите любой другой параметр, нажмите кнопку **ОК**и закройте остальные диалоговые окна.  
  
## <a name="lock-pages-in-memory"></a>Блокировка страниц в памяти  
 Эта политика Windows определяет, какие учетные записи могут использовать процесс для сохранения данных в физической памяти, чтобы система не отправляла страницы данных в виртуальную память на диске. Блокировка страниц в памяти может обеспечивать отклик сервера, когда содержимое памяти заносится в файл подкачки. Параметр SQL Server **Блокировка страниц в памяти** установлен в значение ON в 32-разрядных и 64-разрядных экземплярах [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Standard Edition и выше, когда учетной записи с привилегиями на запуск sqlservr. exe предоставлено право пользователя Windows "Блокировка страниц в памяти" (LPIM). В более ранних версиях SQL Server задание параметра блокировки страниц для 32-разрядного экземпляра SQL Server требовало, чтобы учетная запись с правами запуска sqlservr.exe имела права пользователя LPIM и параметр конфигурации «awe_enabled» был установлен равным ON.  
  
 Чтобы отключить параметр **Блокировка страниц в памяти** для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], удалите право пользователя "заблокированные страницы в памяти" для стартовой учетной записи SQL Server.  
  
### <a name="to-disable-lock-pages-in-memory"></a>Отключение блокировки страниц в памяти  
 **Чтобы отключить параметр Блокировка страниц в памяти, выполните следующие действия.**  
  
1.  В меню **Пуск** выберите команду **Выполнить**. В поле **Открыть** введите `gpedit.msc`.  
  
     Откроется диалоговое окно **Групповая политика**.  
  
2.  В консоли **Групповая политика** разверните узел **Конфигурация компьютера**, а затем — **Конфигурация Windows**.  
  
3.  Разверните узел **Параметры безопасности**, а затем — **Локальные политики**.  
  
4.  Выберите папку **Назначение прав пользователя**.  
  
     Политики будут показаны на панели подробностей.  
  
5.  В данной области дважды щелкните запись **Блокировка страниц в памяти**.  
  
6.  В диалоговом окне **Параметр политики локальной защиты** выберите учетную запись с правами запуска sqlservr.exe и нажмите **Удалить**.  
  
## <a name="virtual-memory-manager"></a>Диспетчер виртуальной памяти  
 32-разрядная операционная система обеспечивает доступ к 4 ГБ виртуального адресного пространства. 2 ГБ виртуальной памяти предназначены всем процессам и доступны приложениям. 2 ГБ зарезервировано для использования операционной системой. Все выпуски операционных систем содержат переключатель, предоставляющий приложениям доступ к 3 ГБ виртуального адресного пространства, ограничивая объем памяти, доступный операционной системе, до 1 ГБ. Дополнительные сведения о переключателе конфигурации памяти см. в разделе о настройке памяти объемом 4 ГБ в документации Windows. Если 32-разрядная версия [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] запущена в 64-разрядной системе, пользователю доступно все 4 ГБ виртуального адресного пространства.  
  
 Определенные области адресного пространства сопоставляются с физической памятью диспетчером виртуальной памяти Windows (VMM).  
  
 Дополнительные сведения об объеме физической памяти, поддерживаемой различными операционными системами, см. в разделе «Ограничения памяти для выпусков Windows» в документации Windows.  
  
 Система виртуальной памяти позволяет превышать объем физической памяти, при этом соотношение виртуальной памяти к физической может быть больше 1:1. В результате чего на компьютерах с разными конфигурациями физической памяти могут работать большие программы. Тем не менее, если объем используемой виртуальной памяти значительно превышает общий объем рабочих множеств всех процессов, производительность может ухудшиться.  
  
 Параметры **min server memory** и **max server memory** являются расширенными. При использовании системной хранимой процедуры **sp_configure** для изменения этих настроек изменить их можно, только если параметр **show advanced options** установлен в значение 1. Эти параметры вступают в силу сразу же без перезагрузки сервера.  
  
## <a name="running-multiple-instances-of-sql-server"></a>Выполнение нескольких экземпляров SQL Server  
 При выполнении нескольких экземпляров компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]существует три подхода к управлению памятью.  
  
-   Контроль использования памяти с помощью параметра **max server memory** . Установите максимальные значения для каждого экземпляра, учитывая, что их сумма не должна превышать общий объем физической памяти, установленной на компьютере. Рекомендуется выделять каждому экземпляру объем памяти, пропорциональный его ожидаемой рабочей нагрузке или размеру базы данных. Данный подход имеет то преимущество, что свободная память доступна новым процессам или экземплярам сразу же после их запуска. Недостаток состоит в том, что, когда выполняются не все экземпляры, ни один из выполняющихся экземпляров не сможет использовать память, оставшуюся свободной.  
  
-   Контроль использования памяти с помощью параметра **min server memory** . Установите минимальные значения для каждого экземпляра так, чтобы их сумма была на 1-2 ГБ меньше общего объема физической памяти, установленной на компьютере. Рекомендуется выделять каждому экземпляру минимальный объем памяти, пропорциональный его ожидаемой рабочей нагрузке. Данный подход имеет то преимущество, что выполняющиеся экземпляры могут использовать оставшуюся свободную память в случае, когда выполняются не все экземпляры. Данный подход также полезен, когда на компьютере выполняется другой процесс, интенсивно потребляющий память, так как при этом обеспечивается удовлетворение как минимум заданных потребностей сервера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в памяти. Недостаток состоит в том, что при запуске нового экземпляра (или любого другого процесса) уже выполняющимся экземплярам требуется некоторое время для освобождения памяти, особенно если для этого им необходимо записать измененные страницы обратно в базу данных.  
  
-   Отсутствие действий (не рекомендуется). Первый экземпляр, столкнувшийся с рабочей нагрузкой, попытается захватить всю память. Простаивающие экземпляры или экземпляры, запущенные позже других, могут в конечном итоге быть вынуждены работать лишь с минимальным доступным объемом памяти. 
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не пытается равномерно распределять возможности использования памяти между экземплярами. Тем не менее все экземпляры будут реагировать на сигналы уведомлений памяти Windows, корректируя объемы используемой ими памяти. Операционная система Windows не балансирует память между приложениями с помощью уведомлений памяти API-интерфейса. Эти уведомления лишь обеспечивают глобальную обратную связь относительно доступности памяти в системе.  
  
 Эти настройки можно изменять без перезапуска экземпляров, поэтому можно легко экспериментировать с целью нахождения наиболее подходящих настроек для данной модели использования.  
  
## <a name="providing-the-maximum-amount-of-memory-to-sql-server"></a>Выделение SQL Server максимального объема памяти  
  
||32-битная|64-разрядная|  
|-|-------------|-------------|  
|Обычная память|Не более ограничения виртуального адресного пространства процесса во всех выпусках [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:<br /><br /> 2 ГБ<br /><br /> 3 ГБ с параметром загрузки **/3gb** *<br /><br /> 4 ГБ на WOW64\*\*|Не более ограничения виртуального адресного пространства процесса во всех выпусках [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:<br /><br /> 8 ТБ для архитектуры x64|  
  
 ***/3gb** — это параметр загрузки операционной системы. Дополнительные сведения см. в [библиотеке MSDN](https://go.microsoft.com/fwlink/?LinkID=10257&clcid=0x409).  
  
 * * WOW64 (Windows в Windows 64) — это режим, в котором 32- [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] разрядная версия работает в 64-разрядной операционной системе. Дополнительные сведения см. в [библиотеке MSDN](https://go.microsoft.com/fwlink/?LinkID=10257&clcid=0x409).  
  
## <a name="examples"></a>Примеры  
  
### <a name="example-a"></a>Пример A  
 В следующем примере параметр `max server memory` устанавливается равным 4 ГБ.  
  
```  
sp_configure 'show advanced options', 1;  
GO  
RECONFIGURE;  
GO  
sp_configure 'max server memory', 4096;  
GO  
RECONFIGURE;  
GO  
```  
  
### <a name="example-b-determining-current-memory-allocation"></a>Пример Б. Определение текущего распределения памяти  
 Следующий запрос возвращает информацию о текущем распределении памяти.  
  
```  
SELECT  
(physical_memory_in_use_kb/1024) AS Memory_usedby_Sqlserver_MB,  
(locked_page_allocations_kb/1024) AS Locked_pages_used_Sqlserver_MB,  
(total_virtual_address_space_kb/1024) AS Total_VAS_in_MB,  
process_physical_memory_low,  
process_virtual_memory_low  
FROM sys.dm_os_process_memory;  
```  
  
## <a name="see-also"></a>См. также:  
 [Наблюдение и настройка производительности](../../relational-databases/performance/monitor-and-tune-for-performance.md)   
 [RECONFIGURE (Transact-SQL)](/sql/t-sql/language-elements/reconfigure-transact-sql)   
 [Параметры конфигурации сервера (SQL Server)](server-configuration-options-sql-server.md)   
 [sp_configure (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql)  
  
  
