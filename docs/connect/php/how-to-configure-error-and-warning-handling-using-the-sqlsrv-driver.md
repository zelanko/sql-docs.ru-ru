---
title: Настройка обработки ошибок и предупреждений с помощью драйвера SQLSRV | Документы Майкрософт
ms.custom: ''
ms.date: 03/26/2018
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- errors and warnings
ms.assetid: 257c6f53-9137-4619-a613-eee33d2077e8
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 2073159ce86604109c71c7addce7caac431851c5
ms.sourcegitcommit: b78f7ab9281f570b87f96991ebd9a095812cc546
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2020
ms.locfileid: "67993571"
---
# <a name="how-to-configure-error-and-warning-handling-using-the-sqlsrv-driver"></a>Практическое руководство. Настройка обработки ошибок и предупреждений с помощью драйвера SQLSRV
[!INCLUDE[Driver_PHP_Download](../../includes/driver_php_download.md)]

Эта статья описывает настройку драйвера SQLSRV для обработки ошибок и предупреждений.  
  
По умолчанию драйвер SQLSRV рассматривает предупреждения как ошибки. Вызов функции **sqlsrv**, создающий ошибку или предупреждение, возвращает значение **false**. Чтобы отключить такое поведение, используйте функцию [sqlsrv_configure](../../connect/php/sqlsrv-configure.md). Если включить следующую строку кода в начало скрипта, функция **sqlsrv**, которая создает только предупреждения (без ошибок), не возвращает значение **false**:  
  
`sqlsrv_configure("WarningsReturnAsErrors", 0);`  
  
Следующая строка кода выполняет возврат к поведению по умолчанию (предупреждения обрабатываются как ошибки):  
  
`sqlsrv_configure("WarningsReturnAsErrors", 1);`  
  
> [!NOTE]  
> Предупреждения, которые соответствуют значениям SQLSTATE 01000, 01001, 01003 и 01S02, никогда не обрабатываются как ошибки. Независимо от конфигурации функция **sqlsrv** , которая создает только предупреждения, соответствующие одному из этих состояний, не возвращает значение **false**.  
  
Значение для **WarningsReturnAsErrors** также можно задать в файле php.ini. Например, эта запись в разделе `[sqlsrv]` файла php.ini отключает поведение по умолчанию.  
  
`sqlsrv.WarningsReturnAsErrors = 0`  
  
Сведения об извлечении сведений об ошибках и предупреждениях см. в статьях [sqlsrv_errors](../../connect/php/sqlsrv-errors.md) и [Практическое руководство. Обработка ошибок и предупреждений](../../connect/php/how-to-handle-errors-and-warnings-using-the-sqlsrv-driver.md).  
  
## <a name="example"></a>Пример  
Следующий пример кода показывает, как отключить поведение обработки ошибок по умолчанию. Пример использует команду PRINT языка Transact-SQL для создания предупреждения. Дополнительные сведения о команде PRINT см. в статье [PRINT (Transact-SQL)](../../t-sql/language-elements/print-transact-sql.md).  
  
Сначала пример демонстрирует поведение обработки ошибок по умолчанию путем выполнения запроса, создающего предупреждение. Это предупреждение считается ошибкой. После изменения конфигурации обработки ошибок выполняется тот же самый запрос. Предупреждение не считается ошибкой.  
  
В примере предполагается, что SQL Server установлен на локальном компьютере. При выполнении примера из командной строки все выходные данные выводятся в консоль.  
  
```  
<?php  
/* Connect to the local server using Windows Authentication. */  
$serverName = "(local)";  
$conn = sqlsrv_connect( $serverName );  
if( $conn === false )  
{  
     echo "Could not connect.\n";  
     die( print_r( sqlsrv_errors(), true));  
}  
  
/* The Transact-SQL PRINT statement can be used to return   
informational or warning messages*/  
$tsql = "PRINT 'The PRINT statement can be used ";  
$tsql .= "to return user-defined warnings.'";  
  
/* Execute the query and print any errors. */  
$stmt1 = sqlsrv_query( $conn, $tsql);  
if($stmt1 === false)  
{  
     echo "By default, warnings are treated as errors:\n";  
     /* Dump errors in the error collection. */  
     print_r(sqlsrv_errors(SQLSRV_ERR_ERRORS));  
}  
  
/* Disable warnings as errors behavior. */  
sqlsrv_configure("WarningsReturnAsErrors", 0);  
  
/* Execute the same query and print any errors. */  
$stmt2 = sqlsrv_query( $conn, $tsql);  
if($stmt2 === false)  
{  
     /* Dump errors in the error collection. */  
     /* Since the warning generated by the query is be treated as   
        an error, this block of code will not be executed. */  
     print_r(sqlsrv_errors(SQLSRV_ERR_ERRORS));  
}  
else  
{  
     echo "After calling ";  
     echo "sqlsrv_configure('WarningsReturnAsErrors', 0), ";  
     echo "warnings are not treated as errors.";  
}  
  
/*Close the connection. */  
sqlsrv_close($conn);  
?>  
```  
  
## <a name="see-also"></a>См. также:  
[Ведение журнала](../../connect/php/logging-activity.md)

[Руководство по программированию драйверов Microsoft для PHP для SQL Server](../../connect/php/programming-guide-for-php-sql-driver.md)

[Справочник по API для драйвера SQLSRV](../../connect/php/sqlsrv-driver-api-reference.md)  
  
