---
title: Определение вычисляемых элементов | Документация Майкрософт
ms.date: 05/06/2019
ms.prod: sql
ms.technology: analysis-services
ms.custom: multidimensional-models
ms.topic: tutorial
ms.author: owend
ms.reviewer: owend
author: minewiskan
manager: kfile
ms.openlocfilehash: e3cda7757d5cf7f62f5946dc69882e5bd8cd5c42
ms.sourcegitcommit: 54c8420b62269f6a9e648378b15127b5b5f979c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2019
ms.locfileid: "65404056"
---
# <a name="lesson-6-1---defining-calculated-members"></a>Занятие 6 – 1-Определение вычисляемых элементов
[!INCLUDE[ssas-appliesto-sqlas](../../includes/ssas-appliesto-sqlas.md)]

Вычисляемые элементы — это элементы измерения или группы мер, которые определяются на основе сочетания данных куба, арифметических операторов, чисел и функций. Например, можно создать вычисляемый элемент для расчета суммы двух физических мер в кубе. Определения вычисляемых элементов хранятся в кубах, а их значения рассчитываются при выполнении запроса.  
  
Для создания вычисляемого элемента следует использовать команду **Создать вычисляемый элемент** на вкладке **Вычисления** конструктора кубов. Вычисляемые элементы можно создавать в любом измерении, в том числе в измерении мер. Их также можно разместить в папке отображения из диалогового окна **Calculation Properties** . Дополнительные сведения см. в разделах [Вычисления](../multidimensional-models-olap-logical-cube-objects/calculations.md), [Вычисления в многомерных моделях](../multidimensional-models/calculations-in-multidimensional-models.md)и [Создание вычисляемых элементов](../multidimensional-models/create-calculated-members.md).  
  
В задачах этого раздела определяются вычисляемые меры, чтобы обеспечить пользователям возможность просмотра коэффициента валовой прибыли и показателя продаж для осуществления продаж через Интернет, товарооборота посредников и всех других продаж.  
  
## <a name="defining-calculations-to-aggregate-physical-measures"></a>Определение статистических вычислений для физических мер  
  
1.  Откройте конструктор кубов, выберите куб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] Tutorial и перейдите на вкладку **Вычисления** .  
  
    Обратите внимание, что по умолчанию на панели **Выражения вычисления** и панели **Организатор скриптов** доступна команда CALCULATE. Эта команда указывает, что меры в кубе должны быть вычислены в соответствии со значениями свойства AggregateFunction. Значения мер обычно суммируются, но могут подсчитываться или статистически обрабатываться другим образом.  
  
    На рисунке ниже показана вкладка **Вычисления** конструктора кубов.  
  
    ![Вкладка «вычисления» конструктора кубов](../media/l6-calculatedmembers-1.gif "вкладка «Вычисления» конструктора кубов")  
  
2.  На панели инструментов вкладки **Вычисления** нажмите кнопку **Создать вычисляемый элемент**.  
  
    В панели **Выражения вычисления** будет отображена новая форма, в которой следует задать свойства нового вычисляемого элемента. Новый элемент также отображается на панели **Организатор скриптов** .  
  
    На рисунке ниже показана форма, отображаемая в панели **Выражения вычисления** при нажатии кнопки **Создать вычисляемый элемент**.  
  
    ![Вычисление выражения области формы](../media/l6-calculatedmembers-02.gif "выражения вычисления области формы")  
  
3.  В поле **Имя** измените имя вычисляемой меры на **[Итоговая сумма продаж]**.  
  
    Если имя вычисляемого элемента содержит пробелы, его необходимо заключать в квадратные скобки.  
  
    Обратите внимание, что в списке **Родительская иерархия** по умолчанию новый вычисляемый элемент создается в измерении **Меры** . Вычисляемый элемент в измерении мер часто называют вычисляемой мерой.  
  
4.  На вкладке **Метаданные** панели **Средства вычисления** вкладки **Вычисления** последовательно раскройте узлы **Меры** и **Продажи через Интернет** , чтобы просмотреть метаданные для группы мер **Продажи через Интернет** .  
  
    Элементы метаданных можно перетащить с панели **Средства вычисления** в поле **Выражение** , а затем добавить операторы и другие элементы для создания многомерных выражений. Кроме того, многомерное выражение можно ввести непосредственно в поле **Выражение** .  
  
    > [!NOTE]  
    > Если в области **Средства вычисления** не отображаются метаданные, нажмите кнопку **Повторное соединение** на панели инструментов. Если это не помогает, возможно, следует выполнить обработку куба или запустить экземпляр служб [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)].  
  
5.  Перетащите показатель **Продажи через Интернет — объем продаж** с вкладки **Метаданные** панели **Средства вычисления** в поле **Выражение** панели **Выражения вычисления** .  
  
6.  В поле **Выражение** после **+** [Меры].[Продажи через Интернет — объем продаж] **введите знак плюс (**).  
  
7.  На вкладке **Метаданные** панели **Средства вычисления** разверните элемент **Товарооборот посредников**и перетащите показатель **Товарооборот посредников — объем продаж** в поле **Выражение** панели **Выражения вычисления** после знака плюс (+).  
  
8.  В списке **Строка форматирования** выберите **Валюта**.  
  
9. В списке **Установленное поведение** установите флажки для показателей **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж**, а затем нажмите кнопку **ОК**.  
  
    Меры, указанные в списке **Установленное поведение** , используются для разрешения запросов NON EMPTY в многомерных выражениях. Если в списке **Установленное поведение** указана одна или несколько мер, в службах [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] вычисляемый элемент считается пустым, если все указанные меры пусты. Если значение свойства **Установленное поведение** не указано, в службах [!INCLUDE[ssASnoversion](../../includes/ssasnoversion-md.md)] проводится оценка вычисляемого элемента с целью определения того, является ли он пустым.  
  
    На рисунке ниже показана панель **Выражения вычисления** , заполненная параметрами, указанными в предыдущих шагах.  
  
    ![Панель «Выражения вычисления» для Populated](../media/l6-calculatedmembers-03.gif "область заполняется выражения вычисления")  
  
10. В области инструментов вкладки **Вычисления** нажмите кнопку **Представление скрипта**и просмотрите скрипт расчета на панели **Выражения вычисления** .  
  
    Обратите внимание, что новое вычисление добавляется в исходное выражение CALCULATE. Вычисления разделены точкой с запятой. Кроме того, обратите внимание, что в начале скрипта вычисления отображается комментарий. Рекомендуется добавлять комментарии в скрипт для групп вычислений, поскольку в дальнейшем они помогут другим разработчикам понимать сложные скрипты вычислений.  
  
11. Добавьте новую строку в скрипт вычисления после команды **Calculate;** и перед добавленным скриптом вычислений, а затем введите на отдельной строке скрипта следующий текст:  
  
    ```  
    /* Calculations to aggregate Internet Sales and Reseller Sales measures */  
    ```  
  
    На следующем рисунке показаны возможные сценарии вычислений, отображаемые в панели **Выражения вычисления** при выполнении всех заданий учебника.  
  
    ![Сценарии в панель «выражения вычисления»](../media/l6-calculatedmembers-04.gif "скриптов панель «выражения вычисления»")  
  
12. На панели инструментов вкладки **Вычисления** нажмите кнопку **Представление формы**, убедитесь в том, что в области **Организатор скриптов** выбран показатель **[Итоговая сумма продаж]** , и нажмите кнопку **Создать вычисляемый элемент**.  
  
13. Измените имя нового вычисляемого элемента на **[Общая стоимость продукции]** и создайте следующее выражение в поле **Выражения** :  
  
    ```  
    [Measures].[Internet Sales-Total Product Cost] + [Measures].[Reseller Sales-Total Product Cost]  
    ```  
  
14. В списке **Строка форматирования** выберите **Валюта**.  
  
15. В списке **Установленное поведение** установите флажки для показателей **Продажи через Интернет — общая стоимость продукции** и **Товарооборот посредников — общая стоимость продукции**, а затем нажмите кнопку **ОК**.  
  
    Заданы два вычисляемых элемента, которые отображаются на панели **Организатор скриптов** . Эти вычисляемые элементы можно использовать в других вычислениях, если они будут впоследствии заданы в скрипте вычисления. Определение любого вычисляемого элемента можно просмотреть, выбрав его на панели **Организатор скриптов** . Оно отображается на панели **Выражения вычисления** в представлении формы. Новые определенные вычисляемые элементы не отображаются в панели **Средства вычисления** , пока не будут развернуты. Вычисления не требуют обработки.  
  
## <a name="defining-gross-profit-margin-calculations"></a>Создание вычислений коэффициента валовой прибыли  
  
1.  Убедитесь в том, что в области **Организатор скриптов** выбран показатель **[Общая стоимость продукции]** , и нажмите кнопку **Создать вычисляемый элемент** на панели инструментов вкладки **Вычисления** .  
  
2.  В поле **Имя** измените имя новой вычисляемой меры на **[Коэффициент валовой прибыли по продажам через Интернет]**.  
  
3.  В поле **Выражение** создайте следующее многомерное выражение:  
  
    ```  
    ([Measures].[Internet Sales-Sales Amount] -   
    [Measures].[Internet Sales-Total Product Cost]) /  
    [Measures].[Internet Sales-Sales Amount]  
    ```  
  
4.  В списке **Строка форматирования** выберите значение **Проценты**.  
  
5.  В списке **Установленное поведение** установите флажок для показателя **Продажи через Интернет — объем продаж**и нажмите кнопку **ОК**.  
  
6.  На панели инструментов вкладки **Вычисления** нажмите кнопку **Создать вычисляемый элемент**.  
  
7.  В поле **Имя** измените имя новой вычисляемой меры на **[Коэффициент валовой прибыли по товарообороту посредников]**.  
  
8.  В поле **Выражение** создайте следующее многомерное выражение:  
  
    ```  
    ([Measures].[Reseller Sales-Sales Amount] -   
    [Measures].[Reseller Sales-Total Product Cost]) /  
    [Measures].[Reseller Sales-Sales Amount]  
    ```  
  
9. В списке **Строка форматирования** выберите значение **Проценты**.  
  
10. В списке **Установленное поведение** установите флажок для показателя **Товарооборот посредников — объем продаж**и нажмите кнопку **ОК**.  
  
11. На панели инструментов вкладки **Вычисления** нажмите кнопку **Создать вычисляемый элемент**.  
  
12. В поле **Имя** измените имя вычисляемой меры на **[Итоговый коэффициент валовой прибыли]**.  
  
13. В поле **Выражение** создайте следующее многомерное выражение:  
  
    ```  
    ([Measures].[Total Sales Amount] -   
    [Measures].[Total Product Cost]) /  
    [Measures].[Total Sales Amount]  
    ```  
  
    Обратите внимание, что этот вычисляемый элемент ссылается на другие вычисляемые элементы. Этот вычисляемый элемент является допустимым, поскольку он рассчитывается после вычисляемых элементов, на которые ссылается.  
  
14. В списке **Строка форматирования** выберите значение **Проценты**.  
  
15. В списке **Установленное поведение** установите флажки для показателей **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж**, а затем нажмите кнопку **ОК**.  
  
16. На панели инструментов вкладки **Вычисления** нажмите кнопку **Представление скрипта** и просмотрите три вычисления, только что добавленные в скрипт вычисления.  
  
17. Добавьте новую строку в скрипт вычисления непосредственно перед вычислением **[Коэффициент валовой прибыли по продажам через Интернет]** , а затем введите в следующей строке скрипта приведенный ниже текст.  
  
    ```  
    /* Calculations to calculate gross profit margin */  
    ```  
  
    На рисунке ниже показана панель **Выражения** с тремя новыми вычислениями.  
  
    ![Новые вычисления на панели «Выражения вычисления»](../media/l6-calculatedmembers-05.gif "новые вычисления на панели «Выражения вычисления»")  
  
## <a name="defining-the-percent-of-total-calculations"></a>Создание вычислений «Проценты от общего»  
  
1.  На панели инструментов вкладки **Вычисления** нажмите кнопку **Представление формы**.  
  
2.  На панели **Организатор скриптов** выберите показатель **[Итоговый коэффициент валовой прибыли]** и нажмите кнопку **Создать вычисляемый элемент** на панели инструментов вкладки **Вычисления** .  
  
    Выбор последнего вычисляемого элемента на панели **Организатор скриптов** перед нажатием кнопки **Создать вычисляемый элемент** гарантирует, что новый вычисляемый элемент будет добавлен в конец скрипта. Скрипты выполняются в том порядке, в котором они отображаются на панели **Организатор скриптов** .  
  
3.  Измените имя нового вычисляемого элемента на **[Доля продаж через Интернет по всей номенклатуре продукции]**.  
  
4.  В поле **Выражение** введите следующее выражение:  
  
    ```  
    Case  
        When IsEmpty( [Measures].[Internet Sales-Sales Amount] )   
        Then 0  
        Else ( [Product].[Product Categories].CurrentMember,  
               [Measures].[Internet Sales-Sales Amount]) /  
             ( [Product].[Product Categories].[(All)].[All],   
               [Measures].[Internet Sales-Sales Amount] )  
        End  
    ```  
  
    В этом многомерном выражении рассчитывается доля каждого из товаров в итоговом значении продаж через Интернет. Использование инструкции Case в сочетании с функцией IS EMPTY позволяет избежать ошибки деления на ноль в том случае, если по данному товару отсутствуют продажи.  
  
5.  В списке **Строка форматирования** выберите значение **Проценты**.  
  
6.  В списке **Установленное поведение** установите флажок для показателя **Продажи через Интернет — объем продаж**и нажмите кнопку **ОК**.  
  
7.  На панели инструментов вкладки **Вычисления** нажмите кнопку **Создать вычисляемый элемент**.  
  
8.  Измените имя нового вычисляемого элемента на **[Доля продаж через торгового посредника по всей номенклатуре продукции]**.  
  
9. В поле **Выражение** введите следующее выражение:  
  
    ```  
    Case  
        When IsEmpty( [Measures].[Reseller Sales-Sales Amount] )   
        Then 0  
        Else ( [Product].[Product Categories].CurrentMember,  
               [Measures].[Reseller Sales-Sales Amount]) /  
             ( [Product].[Product Categories].[(All)].[All],   
               [Measures].[Reseller Sales-Sales Amount] )  
        End  
    ```  
  
10. В списке **Строка форматирования** выберите значение **Проценты**.  
  
11. В списке **Установленное поведение** установите флажок для показателя **Товарооборот посредников — объем продаж**и нажмите кнопку **ОК**.  
  
12. На панели инструментов вкладки **Вычисления** нажмите кнопку **Создать вычисляемый элемент**.  
  
13. Измените имя нового вычисляемого элемента на **[Общая доля продаж по всей номенклатуре продукции]**.  
  
14. В поле **Выражение** введите следующее выражение:  
  
    ```  
    Case  
        When IsEmpty( [Measures].[Total Sales Amount] )   
        Then 0  
        Else ( [Product].[Product Categories].CurrentMember,  
               [Measures].[Total Sales Amount]) /  
             ( [Product].[Product Categories].[(All)].[All],   
               [Measures].[Total Sales Amount] )  
        End  
    ```  
  
15. В списке **Строка форматирования** выберите значение **Проценты**.  
  
16. В списке **Установленное поведение** установите флажки для показателей **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж**, а затем нажмите кнопку **ОК**.  
  
17. На панели инструментов вкладки **Вычисления** нажмите кнопку **Представление скриптов**и просмотрите три вычисления, только что добавленные в скрипт вычисления.  
  
18. Добавьте новую строку в скрипт вычисления непосредственно перед вычислением **[Доля продаж через Интернет по всей номенклатуре продукции]** , а затем введите в следующей строке скрипта приведенный ниже текст.  
  
    ```  
    /* Calculations to calculate percentage of product to total product sales */  
    ```  
  
    Теперь создано восемь вычисляемых элементов, которые отображаются на панели **Организатор скриптов** в представлении формы.  
  
## <a name="browsing-the-new-calculated-members"></a>Просмотр новых вычисляемых элементов  
  
1.  В меню **Построение** среды [!INCLUDE[ssBIDevStudioFull](../../includes/ssbidevstudiofull-md.md)]выберите команду **Развернуть Analysis Services Tutorial**.  
  
2.  После успешного окончания развертывания перейдите на вкладку **Обозреватель** и нажмите кнопку **Повторное соединение**.  
  
3.  Щелкните ярлык Excel, а затем выберите **Включить**.  
  
4.  На панели **Список полей сводной таблицы** раскройте папку **Значения** , чтобы отобразить новые вычисляемые элементы в измерении мер.  
  
5.  Перетащите меру **Итоговая сумма продаж** в область значений и просмотрите результаты.  
  
    Перетащите меры **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж** из групп мер **Продажи через Интернет** и **Товарооборот посредников** в область значений.  
  
    Обратите внимание, что мера **Итоговая сумма продаж** является суммой мер **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж** .  
  
6.  Добавьте определяемую пользователем иерархию **Категории товаров** в область фильтра области **Фильтр отчета** и отфильтруйте данные по позиции **Горные велосипеды**.  
  
    Обратите внимание на то, что мера **Общая сумма продаж** рассчитывается для категории продаж товара **Горные велосипеды** на основе мер **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж** для позиции **Горные велосипеды**.  
  
7.  Добавьте определяемую пользователем иерархию **Date.Calendar Date** в область меток строк и просмотрите результаты.  
  
    Обратите внимание на то, что мера **Итоговая сумма продаж** рассчитывается за каждый календарный год для категории продаж товара **Горные велосипеды** на основе мер **Продажи через Интернет — объем продаж** и **Товарооборот посредников — объем продаж** для позиции **Горные велосипеды**.  
  
8.  Добавьте меры **Итоговый коэффициент валовой прибыли**, **Коэффициент валовой прибыли по продажам через Интернет**и **Коэффициент валовой прибыли по товарообороту посредников** в область значений и просмотрите результаты.  
  
    Обратите внимание, что коэффициент валовой прибыли по продажам через торгового посредника значительно ниже, чем по продажам через Интернет, как показано на следующем рисунке.  
  
    ![Области данных продаж через торгового посредника](../media/l6-calculatedmembers-7b.gif "областью данных продаж через торгового посредника")  
  
9. Добавьте в область значений меры **Общая доля продаж по всей номенклатуре продукции**, **Доля продаж через Интернет по всей номенклатуре продукции**и **Доля продаж через торгового посредника по всей номенклатуре продукции** .  
  
    Обратите внимание, что доля продаж горных велосипедов во всей номенклатуре продукции увеличивается с течением времени для продаж через Интернет и уменьшается для продаж через торгового посредника. Кроме того, обратите внимание, что доля продаж горных велосипедов во всей номенклатуре продукции меньше по продажам через торгового посредника, чем по продажам через Интернет.  
  
10. Измените фильтр с **Горные велосипеды** на **Велосипеды**и просмотрите результаты.  
  
    Обратите внимание, что коэффициент валовой прибыли по всем велосипедам, проданным через торговых посредников, является отрицательной, поскольку туристические и дорожные велосипеды продаются в убыток.  
  
11. Измените фильтр на **Аксессуары**и просмотрите результаты.  
  
    Обратите внимание, что продажа аксессуаров увеличивается с течением времени, но они составляют лишь небольшую часть общей суммы продаж. Кроме того, обратите внимание, что коэффициент валовой прибыли для продаж аксессуаров выше, чем для велосипедов.  
  
## <a name="next-task-in-lesson"></a>Следующая задача занятия  
[Определение именованных наборов](lesson-6-2-defining-named-sets.md)  
  
## <a name="see-also"></a>См. также  
[Вычисления](../multidimensional-models-olap-logical-cube-objects/calculations.md)  
[Вычисления в многомерных моделях](../multidimensional-models/calculations-in-multidimensional-models.md)  
[Создание вычисляемых элементов](../multidimensional-models/create-calculated-members.md)  
  
  
  
