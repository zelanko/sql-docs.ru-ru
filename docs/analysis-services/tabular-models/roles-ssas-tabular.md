---
title: Роли | Документы Microsoft
ms.custom: ''
ms.date: 03/17/2017
ms.prod: analysis-services
ms.prod_service: analysis-services, azure-analysis-services
ms.component: data-mining
ms.reviewer: ''
ms.suite: pro-bi
ms.technology: ''
ms.tgt_pltfrm: ''
ms.topic: conceptual
ms.assetid: e547382a-c064-4bc6-818c-5127890af334
caps.latest.revision: 29
author: Minewiskan
ms.author: owend
manager: kfile
ms.openlocfilehash: d1bb19f3220da7300a7a7329ae55e859bf86334a
ms.sourcegitcommit: 1740f3090b168c0e809611a7aa6fd514075616bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="roles"></a>Роли
[!INCLUDE[ssas-appliesto-sqlas-aas](../../includes/ssas-appliesto-sqlas-aas.md)]
  В табличной модели роли определяют разрешения члена для модели. Члены роли могут выполнять с моделью действия, заданные в разрешении роли. Роли, которым заданы разрешения на чтение, также могут обеспечивать дополнительную защиту на уровне строк с помощью фильтров уровня строк. 
  
 Для SQL Server Analysis Services членами ролей могут быть пользователя, имя пользователя Windows или группы Windows и разрешения (чтение, процесс, администратор). Для служб Azure Analysis Services пользователи должны находиться в Azure Active Directory и имена пользователей и групп, указанных должен быть адрес электронной почты в организации или имя участника-пользователя. 
  
> [!IMPORTANT]  
>  Чтобы пользователи могли подключаться к развернутой модели с помощью клиентского приложения создания отчетов, необходимо создать хотя бы одну роль с по крайней мере в которую входят этих пользователей разрешение на чтение.  
  
 Сведения в этом разделе предназначены для создателей табличных моделей, определяющих роли с помощью диалогового окна диспетчера ролей в SSDT. Роли, определенные при создании модели, применяются к базе данных рабочей области модели. После развертывания базы данных model, модель базы данных администраторы могут управлять (Добавление, изменение и удаление) члены роли с помощью среды SSMS. Дополнительные сведения об управлении членами ролей в развернутой базе данных см. в разделе [табличной модели роли](../../analysis-services/tabular-models/tabular-model-roles-ssas-tabular.md).  
  
##  <a name="bkmk_underst"></a> Understanding roles  
 Роли используются в службах Analysis Services для управления доступом к данным модели. Существует два типа ролей.  
  
-   Роль сервера — фиксированная роль, предоставляющая доступ администратора к экземпляру сервера служб Analysis Services.  
  
-   Роли базы данных — роли, определенные авторами моделей и администраторами для контроля доступа к шаблонам базы данных и данным пользователями, которые не являются администраторами.  
  
 Роли, определенные для табличной модели, являются ролями базы данных. То есть роли содержит являются пользователи или группы, имеющие те элементы, определенные разрешения, которые определяют действия может занять на базе модели. Роль создается как отдельный объект в базе данных и действует только в той базе данных, где она создана. Пользователи и группы включены в роль автором модели, которая по умолчанию, имеющего права администратора на сервере базы данных рабочей области. для развернутой модели, администратором.  
  
 В табличных моделях роли можно детализировать с помощью фильтров строк. Фильтры строк используют выражения DAX для определения строк в таблице и любых строк на стороне связи «многие», которые может просматривать пользователь. Фильтры строк, в которых используются выражения DAX, могут быть определены только для разрешений на чтение, чтение и обработку. Дополнительные сведения см. в разделе [фильтры строк](#bkmk_rowfliters) далее в этом разделе.  
  
 По умолчанию при создании нового проекта табличной модели в нем нет никаких ролей. Роли можно определять с помощью диалогового окна диспетчера ролей в SSDT. При определении ролей во время создания модели они применяются к базе данных рабочей области модели. При развертывании модели те же роли применяются к развертываемой модели. После развертывания модели члены роли сервера ([Analysis Services администратор) и администраторами баз данных могут управлять роли, связанные с моделью и элементы, связанные с каждой ролью с помощью среды SSMS.  
  
##  <a name="bkmk_permissions"></a> Разрешения  
 Каждая роль определяет одно разрешение для базы данных (за исключением объединенного разрешения на чтение и обработку). По умолчанию новая роль имеет разрешение «Нет». То есть члены этой роли, добавленные с разрешением «Нет», не смогут изменять базу данных, выполнять операции по обработке, запрашивать данные и даже видеть базу данных, пока им не будет предоставлено другое разрешение.  
  
 Группа или пользователь может быть членом любого числа ролей, каждая роль с разными разрешениями. Когда пользователь является членом нескольких ролей, он обладает всеми разрешениями, определенными для каждой из них. Например, если пользователь является членом роли с разрешением на чтение, а также роли с разрешением «Нет», этот пользователь будет обладать разрешением на чтение.  
  
 Каждой роли можно назначить одно из следующих разрешений.  
  
|Разрешения|Описание|Фильтры строк с DAX|  
|-----------------|-----------------|----------------------------|  
|Нет|Члены не могут вносить изменения в схему шаблона базы данных, а также просматривать данные.|Фильтры строк не применяются. Пользователи в этой роли не могут видеть данные|  
|Чтение|Члены могут запрашивать данные (с учетом фильтров строк), но не могут видеть шаблон базы данных в среде SSMS, не могут вносить изменения в схему шаблона базы данных, и пользователь не может обработать модель.|Фильтры строк могут применяться. Пользователи могут видеть только данные, указанные в формуле DAX фильтра строк.|  
|Чтение и обработка|Члены могут просматривать данные (с учетом фильтров уровня строк) и выполнять операции по обработке, запуская скрипты или пакеты, содержащие команду обработки, но не могут вносить изменения в базу данных. Не удается просмотреть базы данных model в среде SSMS.|Фильтры строк могут применяться. Выполнять запросы можно только к данным, указанным в формуле DAX фильтра строк.|  
|Процесс|Члены могут выполнять операции по обработке путем запуска скриптов или пакетов, содержащих команды обработки. Не могут изменять схему шаблона базы данных. Запросы к данным невозможны. Не удалось запросить базу данных model в среде SSMS.|Фильтры строк не применяются. Члены этой роли не могут запрашивать данные|  
|Администратор|Члены могут вносить изменения в схему модели и просматривать все данные в конструкторе моделей, клиенте отчетов и SSMS.|Фильтры строк не применяются. Члены этой роли могут запрашивать любые данные|  
  
##  <a name="bkmk_rowfliters"></a> Row filters  
 Фильтры строк определяют, какие строки таблицы могут запрашивать члены определенной роли. Фильтры строк для каждой таблицы модели определяются с помощью формул DAX.  
  
 Фильтры строк можно определять только для ролей с разрешениями на чтение, а также на чтение и обработку. По умолчанию, если фильтр строк не задан для какой-то таблицы, члены роли с разрешением на чтение или на чтение и обработку могут просматривать все строки таблицы, если нет перекрестной фильтрации из другой таблицы.  
  
 Если для таблицы задан фильтр строк, формула DAX, результат вычисления которой должен быть равен TRUE или FALSE, определяет строки, которые могут запрашиваться членами этой роли. Строки, не включенные в формулу DAX, запрашиваться не могут. Например, при использовании выражения фильтров строк *=Customers [Country] = "USA"* члены роли Sales могут видеть в таблице Customers только клиентов из США.  
  
 Фильтры строк применяются к указанным, а также к связанным строкам. Когда таблица содержит несколько связей, фильтры применяют защиту к связи, которая является активной. Фильтры строк пересекаются с другими фильтрами строк, определенными в связанных таблицах, например:  
  
|Таблица|Выражение DAX|  
|-----------|--------------------|  
|Region|=Region[Country]=”USA”|  
|ProductCategory|=ProductCategory[Name]=”Bicycles”|  
|Transactions|=Transactions[Year]=2008|  
  
 В результате применения этих разрешений к таблице Transactions члены роли смогут запрашивать только строки данных, в которых клиенты находятся в США, категория продуктов — велосипеды, а год — 2008. Пользователи не смогут запрашивать сделки, совершенные не в США, не по велосипедам и не в 2008 году, если они не являются членами другой роли, которая предоставляет такие разрешения.  
  
 Чтобы запретить доступ ко всем строкам таблицы, можно использовать фильтр *=FALSE()*.  
  
### <a name="dynamic-security"></a>Динамическая безопасность  
 Динамическая безопасность позволяет задать защиту на уровне строк с учетом имени пользователя, который находится в системе в данный момент, или свойства CustomData из строки подключения. Для реализации динамической безопасности в модель необходимо включить таблицу со значениями имен входа (имена пользователей Windows) для пользователей, а также поле, которое можно использовать для определения конкретных разрешений, например таблицу dimEmployees с идентификаторами входа (домен или имя пользователя) и значением подразделения для каждого сотрудника.  
  
 Для реализации динамической безопасности можно использовать следующие функции в формуле DAX для получения имени пользователя, который находится в системе в данный момент, или свойства CustomData из строки подключения.  
  
|Функция|Описание|  
|--------------|-----------------|  
|[USERNAME, функция (DAX)](http://msdn.microsoft.com/en-us/22dddc4b-1648-4c89-8c93-f1151162b93f)|Возвращает значение вида «домен\имя пользователя» для пользователя, который находится в системе в настоящий момент.|  
|[CUSTOMDATA, функция (DAX)](http://msdn.microsoft.com/en-us/58235ad8-226c-43cc-8a69-5a52ac19dd4e)|Возвращает свойство CustomData в строке подключения.|  
  
 Функция LOOKUPVALUE позволяет возвращать значения для столбца, в котором имя пользователя Windows соответствует имени пользователя, возвращенного функцией USERNAME, или строке, возвращенной функцией CustomData. После этого можно ограничить запросы строками, в которых значения, возвращенные функцией LOOKUPVALUE, совпадают со значениями в этой же или связанной таблице.  
  
 Пример использования формулы  
  
 `='dimDepartmentGroup'[DepartmentGroupId]=LOOKUPVALUE('dimEmployees'[DepartmentGroupId], 'dimEmployees'[LoginId], USERNAME(), 'dimEmployees'[LoginId], 'dimDepartmentGroup'[DepartmentGroupId])`  
  
 Функция LOOKUPVALUE возвращает значения для столбца dimEmployees[DepartmentId], где значение dimEmployees[LoginId] равно идентификатору входа текущего пользователя, возвращенному функцией USERNAME, а значения для dimEmployees[DepartmentId] равны значениям для dimDepartmentGroup[DepartmentId]. Значения в поле DepartmentId, возвращенные функцией LOOKUPVALUE, используются для ограничения строк, запрашиваемых в таблице dimDepartment и любых таблицах, связанных по столбцу DepartmentId. Возвращаются только строки, столбец DepartmentId в которых входит в список значений DepartmentId, возвращенных функцией LOOKUPVALUE.  
  
 **dimEmployees**  
  
|LastName|FirstName|LoginID|DepartmentName|DepartmentId|  
|--------------|---------------|-------------|--------------------|------------------|  
|Коричневый|Кевин|Adventure-works\kevin0|Маркетинг|7|  
|Bradley|David|Adventure-works\david0|Маркетинг|7|  
|Dobney|JoLynn|Adventure-works\JoLynn0|Production|4|  
|Baretto DeMattos|Paula|Adventure-works\Paula0|Human Resources|2|  
  
 **dimDepartment**  
  
|DepartmentId|DepartmentName|  
|------------------|--------------------|  
|1|Corporate|  
|2|Executive General and Administration|  
|3|Inventory Management|  
|4|Manufacturing|  
|5|Quality Assurance|  
|6|Research and Development|  
|7|Sales and Marketing|  
  
##  <a name="bkmk_testroles"></a> Testing roles  
 При создании проекта модели с помощью функции «Анализ в Excel» можно протестировать эффективность заданных ролей. Если в меню **Модель** конструктора моделей выбрать команду **Анализ в Excel**, еще до открытия окна Excel появляется диалоговое окно **Выбор учетных данных и перспективы** . В этом диалоговом окне можно указать текущее имя пользователя, другое имя пользователя, роль и перспективу, которые будут использоваться для подключения к базе данных рабочей области модели в качестве источника данных. Дополнительные сведения см. в разделе [анализ в Excel](../../analysis-services/tabular-models/analyze-in-excel-ssas-tabular.md).  
  
##  <a name="bkmk_rt"></a> Related tasks  
  
|Раздел|Описание|  
|-----------|-----------------|  
|[Создание ролей и управление ими](../../analysis-services/tabular-models/create-and-manage-roles-ssas-tabular.md)|Задачи в этом разделе демонстрируют создание ролей и управление ими с помощью диалогового окна **Диспетчер ролей** .|  
  
## <a name="see-also"></a>См. также  
 [Перспективы](../../analysis-services/tabular-models/perspectives-ssas-tabular.md)   
 [Анализ в Excel](../../analysis-services/tabular-models/analyze-in-excel-ssas-tabular.md)   
 [USERNAME, функция (DAX)](http://msdn.microsoft.com/en-us/22dddc4b-1648-4c89-8c93-f1151162b93f)   
 [Функция LOOKUPVALUE (DAX)](http://msdn.microsoft.com/en-us/73a51c4d-131c-4c33-a139-b1342d10caab)   
 [CUSTOMDATA, функция (DAX)](http://msdn.microsoft.com/en-us/58235ad8-226c-43cc-8a69-5a52ac19dd4e)  
  
  
