---
title: Общие сведения о групповой загрузке XML (SQLXML)
ms.date: 03/17/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: MightyPen
ms.author: genemi
ms.custom: seo-lt-2019
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 4116bef21a70e6de699046019fd404798826bf18
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "75246735"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a>Введение в массовую загрузку XML (SQLXML 4.0)
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../../includes/appliesto-ss-asdb-xxxx-xxx-md.md)]
  Массовая загрузка XML является изолированным объектом COM, который позволяет загрузить частично структурированные XML-данные в таблицы Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
 Можно вставить XML-данные в базу данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] при помощи инструкции INSERT и функции OPENXML, однако программа массовой загрузки обладает более высокой производительностью, если нужно вставить большие объемы XML-данных.  
  
 Метод Execute модели объектов с массовым загрузкой XML принимает два параметра:  
  
-   Схема XSD (XML Schema definition) с заметками или схема XDR (XML-Data Reduced) с заметками. Программа массовой загрузки XML интерпретирует эту схему сопоставления и заметки, которые указаны в схеме, при идентификации таблиц SQL Server, в которые XML-данные будут вставлены.  
  
-   XML-документ или фрагмент документа (фрагмент документа — это документ, в котором элемент верхнего уровня может быть не единственным). Может быть указано имя файла или поток, из которого массовая загрузка XML может читать.  
  
 Массовая загрузка XML интерпретирует схему сопоставления и указывает таблицу или таблицы, в которые будут вставлены XML-данные.  
  
 Предполагается, что читатель знаком со следующими функциями [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
-   Схемы XSD и XDR с заметками. Дополнительные сведения о схемах XSD с заметками см. [в статье Введение в схемы XSD с Заметками &#40;SQLXML 4,0&#41;](../../../relational-databases/sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md). Сведения о схемах XDR с заметками см. [в разделе схемы XDR с Заметками &#40;устаревшие в SQLXML 4,0&#41;](../../../relational-databases/sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).  
  
-   Механизмы массовой вставки [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], такие как инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT и программа bcp. Дополнительные сведения см. в статьях [BULK INSERT &#40;Transact-SQL&#41;](../../../t-sql/statements/bulk-insert-transact-sql.md) и [bcp Utility](../../../tools/bcp-utility.md).  
  
## <a name="streaming-of-xml-data"></a>Потоковая передача XML-данных  
 Так как исходный XML-документ может быть большого размера, для обработки массовой загрузки целый документ не читается в память. Вместо этого массовая загрузка XML интерпретирует XML-данные как поток и читает. После того как программа прочитает данные, она идентифицирует таблицу базы данных, создает соответствующую запись из источника XML-данных, а затем отправляет запись [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] для вставки.  
  
 Например, следующий исходный XML-документ состоит из ** \<элементов Customer>** и ** \<Order>** дочерних элементов:  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 Поскольку при выполнении операции XML-загрузки выполняется считывание элемента ** \<>Customer** , он создает запись для кустомертабле. Когда он считывает тег ** \</Customer>** , при выполнении операции XML-загрузки выполняется вставка этой записи в таблицу [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]в. Аналогичным образом, при считывании элемента ** \<Order>** , при выполнении групповой загрузки XML-данных создается запись для ордертабле, а затем эта запись вставляется в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] таблицу при чтении закрывающего тега ** \</Order>** .  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a>Транзакционные и нетранзакционные операции массовой загрузки XML  
 Массовая загрузка XML может работать в транзакционном и нетранзакционном режимах. Производительность обычно является оптимальной при выполнении многоязыковой загрузки в неусловном режиме: то есть свойство Transaction имеет значение FALSE, и одно из следующих условий имеет значение true.  
  
-   Таблицы, в которые происходит массовая загрузка данных, пусты и не имеют индексов.  
  
-   Таблицы содержат данные и имеют уникальные индексы.  
  
 Нетранзакционный подход не гарантирует возможности отката, если в процессе массовой загрузки что-то пойдет не так (также могут случаться частичные откаты). Нетранзакционная массовая загрузка подходит, если база данных пуста. В этом случае, если что-то пошло не так, можно очистить базу данных и начать массовую загрузку XML заново.  
  
> [!NOTE]  
>  В нетранзакционном режиме массовая загрузка XML использует вложенные внутренние транзакции по умолчанию и фиксирует их. Если свойство Transaction имеет значение TRUE, при выполнении этой транзакции не выполняется автоматическая загрузка XML.  
  
 Если для свойства Transaction задано значение TRUE, то при выполнении операции XML-загрузки выполняется создание временных файлов, по одному для каждой таблицы, определенной в схеме сопоставления. Массовая загрузка XML сначала поместит записи из исходного XML-документа в эти временные файлы. Затем инструкция [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT получит эти записи из файлов и поместит их в соответствующие таблицы. Расположение этих временных файлов можно указать с помощью свойства TempFilePath. Следует убедиться, что у учетной записи [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], используемой в массовой загрузке XML, есть доступ к этому пути. Если свойство TempFilePath не задано, для создания временных файлов используется путь к файлу по умолчанию, указанный в переменной среды TEMP.  
  
 Если для свойства Transaction задано значение FALSE (значение по умолчанию), при выполнении групповой загрузки XML для выполнения операции загрузки данных используется интерфейс OLE DB IRowsetFastLoad.  
  
 Если свойство ConnectionString задает строку соединения, а свойство Transaction имеет значение TRUE, то при выполнении операции XML-загрузки выполняется в собственном контексте транзакции. (Например, массовая загрузка XML начинает собственную транзакцию и фиксирует изменения или при необходимости производит откат.)  
  
 Если свойство ConnectionCommand устанавливает соединение с существующим объектом соединения, а свойство Transaction имеет значение TRUE, то при выполнении автоматической загрузки XML инструкция COMMIT или ROLLBACK не выдается в случае успеха или сбоя соответственно. Если происходит ошибка, массовая загрузка XML возвращает соответствующее сообщение об ошибке. Решение об использовании инструкции COMMIT или ROLLBACK остается за клиентом, который инициировал массовую загрузку. Объект соединения, используемый для групповой загрузки XML, должен иметь тип ICommand или объект команды ADO.  
  
 В SQLXML 4,0 Коннектионобжект нельзя использовать, если свойство Transaction имеет значение FALSE. Неподдерживаемый режим не поддерживается для Коннектионобжект, так как невозможно открыть более одного интерфейса IRowsetFastLoad в переданном сеансе.  
  
  
