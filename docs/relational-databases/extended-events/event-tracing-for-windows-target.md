---
title: Цель «Средство трассировки событий для Windows»
description: Узнайте, как использовать трассировку событий Windows (ETW) в качестве целевого объекта. Трассировка событий Windows используется совместно с расширенными событиями или в качестве потребителя расширенных событий.
ms.date: 03/15/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: MightyPen
ms.author: genemi
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: c4a20924d617f3c0333d548a3134f2bfc211dab7
ms.sourcegitcommit: da88320c474c1c9124574f90d549c50ee3387b4c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2020
ms.locfileid: "85733686"
---
# <a name="event-tracing-for-windows-target"></a>Цель «Средство трассировки событий для Windows»

[!INCLUDE [SQL Server Azure SQL Database](../../includes/applies-to-version/sql-asdb.md)]

  Прежде чем использовать средство трассировки событий для Windows (ETW) в качестве назначения, рекомендуется сначала попрактиковаться в работе с данным средством. Трассировка событий Windows используется совместно с расширенными событиями или в качестве потребителя расширенных событий. Следующие внешние ссылки помогут получить начальные сведения о трассировке событий Windows.  
  
-   [События Windows](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [Усовершенствованные отладка и настройка производительности с помощью приложения ETW](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 Цель «Трассировка событий Windows» является одноэлементным целевым объектом, хотя она может быть добавлена в несколько сеансов. Если событие происходит в нескольких сеансах, то данное событие будет передано цели трассировки событий Windows по одному разу для каждого произошедшего события. Каждый процесс может иметь только одну подсистему расширенных событий.  
  
> [!IMPORTANT]  
>  Чтобы назначение ETW работало, стартовая учетная запись служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должна входить в группу «Пользователи журналов производительности».  
  
 Конфигурация событий в сеансе ETW управляется процессом, в котором размещена подсистема расширенных событий. Эта подсистема управляет последовательностью и условиями запуска событий.  
  
 После привязки к сеансу расширенных событий, который присоединяет назначение средства отслеживания событий для Windows в первый раз в процессе, средство ETW открывает один сеанс ETW в поставщике [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Если сеанс ETW уже существует, цель ETW получает ссылку на существующий сеанс. Этот сеанс ETW используется всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на компьютере. Сеанс ETW получает все события от сеансов, имеющих цель ETW.  
  
 Поскольку приложению ETW требуются поставщики, способные потреблять события и направлять их в ETW, в сеансе включаются все пакеты расширенных событий. При запуске события цель ETW отправляет его в сеанс, в котором включен поставщик события.  
  
 Назначение ETW поддерживает синхронную публикацию событий в потоке, запускающем это событие. Однако назначение ETW не поддерживает асинхронную публикацию событий.  
  
 Назначение трассировки событий Windows не может управляться внешними контроллерами трассировки событий Windows, например Logman.exe. Для трассировки событий Windows нужно создать сеанс события с назначением трассировки событий Windows. Дополнительные сведения см. в разделе [CREATE EVENT SESSION (Transact-SQL)](../../t-sql/statements/create-event-session-transact-sql.md).  
  
> [!NOTE]  
>  При включении назначения ETW создается сеанс ETW с именем XE_DEFAULT_ETW_SESSION. Если сеанс с именем XE_DEFAULT_ETW_SESSION уже существует, то он используется как есть, без изменения свойств. Сеанс XE_DEFAULT_ETW_SESSION используется совместно всеми экземплярами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. После запуска сеанса XE_DEFAULT_ETW_SESSION необходимо остановить его с помощью контроллера ETW, например инструмента Logman. Например, можно выполнить в командной строке следующую команду: **logman stop XE_DEFAULT_ETW_SESSION -ets**.  
  
 В следующей таблице описаны доступные параметры для настройки назначения ETW.  
  
|Параметр|Допустимые значения|Описание|  
|------------|--------------------|-----------------|  
|default_xe_session_name|Любая строка длиной до 256 символов. Это значение является необязательным.|Имя сеанса расширенных событий. По умолчанию это XE_DEFAULT_ETW_SESSION.|  
|default_etw_session_logfile_path|Любая строка длиной до 256 символов. Это значение является необязательным.|Путь к файлу журнала сеанса расширенных событий. По умолчанию %TEMP%\ XEEtw.etl.|  
|default_etw_session_logfile_size_mb|Любое целое число без знака. Это значение является необязательным.|Размер файла журнала для сеанса расширенных событий (в мегабайтах, МБ). По умолчанию установлено значение 20 МБ.|  
|default_etw_session_buffer_size_kb|Любое целое число без знака. Это значение является необязательным.|Размер буфера в памяти (в килобайтах) для сеанса расширенных событий. Значение по умолчанию — 128 КБ.|  
|retries|Любое целое число без знака.|Число попыток публикации события в подсистеме ETW до удаления события. Значение по умолчанию равно 0.|  
| &nbsp; | &nbsp; | &nbsp; |

 Конфигурация указанных параметров не обязательна. Цель ETW использует для них параметры по умолчанию.  
  
 Цель ETW отвечает за следующие действия.  
  
-   Создание сеанса ETW по умолчанию.  
  
-   Регистрация всех пакетов расширенных событий в приложении ETW. Тем самым обеспечивается сохранность событий в приложении ETW.  
  
-   Управление потоком событий, направляемых приложению ETW. Цель ETW создает событие ETW с данными, полученными от расширенных событий, и отправляет это событие в соответствующий сеанс ETW. Если событие превышает размер буфера или данные не вмещаются в одно событие ETW, приложение ETW разбивает это событие на фрагменты.  
  
-   Хранение пакетов расширенных событий включено постоянно.  
  
 Приложение ETW по умолчанию использует следующие расположения.  
  
-   Выходной файл ETW: %TEMP%\XEEtw.etl.  
  
    > [!IMPORTANT]  
    >  После начала первого сеанса путь к файлу изменить нельзя.  
  
-   MOF-файлы находятся в папке: *\<your install path>* \Microsoft SQL Server\Shared Дополнительные сведения см. в разделе [Формат управляющих объектов](https://go.microsoft.com/fwlink/?LinkId=92851) библиотеки MSDN.

<!-- ?LinkId=92851  ==  https://docs.microsoft.com/windows/desktop/WmiSdk/managed-object-format--mof-
-->

## <a name="adding-the-target-to-a-session"></a>Добавление цели к сеансу  
 Для добавления назначения счетчика событий в сеанс расширенных событий следует использовать одну из следующих инструкций при создании или изменении сеанса события:  
  
```sql
ADD TARGET package0.etw_classic_sync_target  
```  
  
 Дополнительные сведения о полном примере, который показывает, как использовать назначение трассировки событий, включая просмотр данных, см. в разделе [отслеживать активность системы с помощью расширенных событий](../../relational-databases/extended-events/monitor-system-activity-using-extended-events.md).  
  
## <a name="see-also"></a>См. также:  
 [Цели расширенных событий SQL Server](targets-for-extended-events-in-sql-server.md)   
 [sys.dm_xe_session_targets (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql.md)   
 [CREATE EVENT SESSION (Transact-SQL)](../../t-sql/statements/create-event-session-transact-sql.md)   
 [ALTER EVENT SESSION (Transact-SQL)](../../t-sql/statements/alter-event-session-transact-sql.md)  
  
  
