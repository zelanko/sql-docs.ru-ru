---
title: "Создание индексов с включенными столбцами | Документация Майкрософт"
ms.custom: 
ms.date: 03/09/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- dbe-indexes
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- index size [SQL Server]
- index keys [SQL Server]
- index columns [SQL Server]
- size [SQL Server], indexes
- key columns [SQL Server]
- included columns
- nonclustered indexes [SQL Server], included columns
- designing indexes [SQL Server], included columns
- nonkey columns
ms.assetid: d198648d-fea5-416d-9f30-f9d4aebbf4ec
caps.latest.revision: 29
author: BYHAM
ms.author: rickbyh
manager: jhubbard
ms.workload: Active
ms.translationtype: Human Translation
ms.sourcegitcommit: 2edcce51c6822a89151c3c3c76fbaacb5edd54f4
ms.openlocfilehash: 815756ed3e14540705a1c2cdbab16d5648a6d2ec
ms.contentlocale: ru-ru
ms.lasthandoff: 06/22/2017

---
# <a name="create-indexes-with-included-columns"></a>Создание индексов с включенными столбцами
[!INCLUDE[tsql-appliesto-ss2016-asdb-xxxx-xxx_md](../../includes/tsql-appliesto-ss2016-asdb-xxxx-xxx-md.md)]

  В этой теме описывается добавление невключенных или неключевых столбцов, чтобы расширить функциональные возможности некластеризованных индексов в [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../includes/tsql-md.md)]. Добавление неключевых столбцов позволяет создавать некластеризованные индексы, покрывающие больше запросов. Это обусловлено следующими преимуществами неключевых столбцов.  
  
-   Они могут содержать типы данных, не разрешенные для ключевых столбцов индекса.  
  
-   Они не учитываются компонентом [!INCLUDE[ssDE](../../includes/ssde-md.md)] при расчете числа ключевых столбцов индекса и размера ключа индекса.  
  
 Индекс с неключевыми столбцами может значительно повысить производительность запроса, когда все столбцы запроса включены в индекс как ключевые или неключевые. Производительность повышается благодаря тому, что оптимизатор запросов может найти все значения столбцов в этом индексе; при этом нет обращения к данным таблиц или кластеризованных индексов, что приводит к меньшему количеству дисковых операций ввода-вывода.  
  
> [!NOTE]  
>  Если индекс содержит все столбцы, на которых в запросе имеются ссылки, это обычно называется *покрытием запроса*.  
  
 **В этом разделе**  
  
-   **Перед началом работы выполните следующие действия.**  
  
     [Рекомендации по проектированию](#DesignRecs)  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Создание индекса с неключевыми столбцами с помощью различных средств.**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="DesignRecs"></a> Рекомендации по проектированию  
  
-   Переопределите некластеризованные индексы с большим размером ключа индекса, чтобы только столбцы, используемые для поиска и уточняющего запроса, были ключевыми. Все остальные столбцы, покрывающие запрос, сделайте неключевыми столбцами. Таким образом, в наличии будут все столбцы, покрывающие запрос, но сам ключ индекса будет небольшим и эффективным.  
  
-   Включите неключевые столбцы в некластеризованный индекс, чтобы не превышать существующие ограничения на размер индекса (32 столбца) и размер ключа индекса (1 700 байт). До версии [!INCLUDE[ssSQL15_md](../../includes/sssql15-md.md)] использовались ограничения в 16 столбцов и 900 байт. Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] не учитывает неключевые столбцы при расчете количества ключевых столбцов индекса и размера ключа индекса.  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Неключевые столбцы можно задавать только для некластеризованных индексов.  
  
-   Все типы данных, за исключением **text**, **ntext**, и **image** могут использоваться как неключевые столбцы.  
  
-   Вычисляемые столбцы, являющиеся детерминированными, в том числе точными или неточными, могут быть неключевыми столбцами. Дополнительные сведения см. в разделе [Indexes on Computed Columns](../../relational-databases/indexes/indexes-on-computed-columns.md).  
  
-   Вычисляемые столбцы, полученные на основе типов данных **image**, **ntext**и **text** , могут быть неключевыми столбцами, если тип данных этого вычисляемого столбца допустим в качестве неключевого индексного столбца.  
  
-   Неключевые столбцы можно удалить из таблицы только после удаления из этой таблицы индекса.  
  
-   Неключевые столбцы нельзя изменять, за исключением следующих операций:  
  
    -   изменение поведения столбца в отношении значения NULL с NOT NULL на NULL;  
  
    -   увеличение длины столбцов типов **varchar**, **nvarchar**и **varbinary** .  
  
###  <a name="Security"></a> Безопасность  
  
####  <a name="Permissions"></a> Разрешения  
 Необходимо разрешение ALTER для таблицы или представления. Пользователь должен быть членом предопределенной роли сервера **sysadmin** или предопределенных ролей базы данных **db_ddladmin** и **db_owner** .  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
#### <a name="to-create-an-index-with-nonkey-columns"></a>Создание индекса с неключевыми столбцами  
  
1.  В обозревателе объектов щелкните знак «плюс», чтобы развернуть базу данных, содержащую таблицу, в которой необходимо создать индекс с неключевыми столбцами.  
  
2.  Чтобы развернуть папку **Таблицы** , щелкните значок «плюс».  
  
3.  Щелкните знак «плюс», чтобы развернуть таблицу, в которой необходимо создать индекс с неключевыми столбцами.  
  
4.  Щелкните правой кнопкой мыши папку **Индексы** , выберите **Создать индекс**и **Некластеризованный индекс…**  
  
5.  В диалоговом окне **Создание индекса** на странице **Общие** введите имя нового индекса в поле **Имя индекса** .  
  
6.  На вкладке **Ключевые столбцы индекса** нажмите кнопку **Добавить…**.  
  
7.  В диалоговом окне **Выбор столбцов из***имя_таблицы* установите флажки для столбцов таблицы, добавляемых к индексу.  
  
8.  Нажмите кнопку **ОК**.  
  
9. На вкладке **Включенные столбцы** нажмите кнопку **Добавить…**.  
  
10. В диалоговом окне **Выбор столбцов из***имя_таблицы* установите флажки для столбцов таблицы, добавляемых в индекс в качестве неключевых столбцов.  
  
11. Нажмите кнопку **ОК**.  
  
12. В диалоговом окне **Создание индекса** нажмите кнопку **ОК**.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-create-an-index-with-nonkey-columns"></a>Создание индекса с неключевыми столбцами  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].  
  
2.  На стандартной панели выберите пункт **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**.  
  
    ```  
    USE AdventureWorks2012;  
    GO  
    -- Creates a nonclustered index on the Person.Address table with four included (nonkey) columns.   
    -- index key column is PostalCode and the nonkey columns are  
    -- AddressLine1, AddressLine2, City, and StateProvinceID.  
    CREATE NONCLUSTERED INDEX IX_Address_PostalCode  
    ON Person.Address (PostalCode)  
    INCLUDE (AddressLine1, AddressLine2, City, StateProvinceID);  
    GO  
    ```  
  
 Дополнительные сведения см. в разделе [CREATE INDEX (Transact-SQL)](../../t-sql/statements/create-index-transact-sql.md).  
  
  

