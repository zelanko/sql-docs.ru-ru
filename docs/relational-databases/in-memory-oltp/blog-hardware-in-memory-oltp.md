---
title: Оборудование для выполняющейся в памяти OLTP в SQL | Документация Майкрософт
description: Узнайте о рекомендациях по использованию оборудования для улучшения производительности выполняющейся в памяти OLTP в SQL Server. Выполняющаяся в памяти OLTP использует память и диск иначе, чем таблицы на диске.
ms.custom: ''
ms.date: 03/28/2019
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
author: MightyPen
ms.author: genemi
monikerRange: =azuresqldb-current||=azuresqldb-mi-current||>=sql-server-2016||>=sql-server-linux-2017||=sqlallproducts-allversions
ms.openlocfilehash: e5486dddb1b71d2a32055cb4175ed300ce19320f
ms.sourcegitcommit: 7a47aaffbd82bab2707cd69f44571a9037d2273b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2020
ms.locfileid: "85377625"
---
# <a name="hardware-considerations-for-in-memory-oltp-in-sql-server"></a>Рекомендации по использованию оборудования для выполняющейся в памяти OLTP в SQL Server

Выполняющаяся в памяти OLTP использует память и диск иначе, чем традиционные таблицы на диске. Улучшение производительности, достигаемое в результате применения выполняющейся в памяти OLTP, зависит от используемого оборудования. В этой публикации блога рассматривается целый ряд общих вопросов, посвященных оборудованию, и приводятся универсальные рекомендации по использованию оборудования с выполняющейся в памяти OLTP.

> [!NOTE]
> Эта статья была записью блога, опубликованной 1 августа 2013 г. командой разработчиков Microsoft SQL Server 2014. Сейчас веб-страница блога выводится из числа действующих.
>
> [Выполняющаяся в памяти OLTP в SQL Server](index.md)

<!--
    Here was the link to the blog. This blog was captured into this new article on 2018/11/30, by GeneMi (MightyPen).
    https://cloudblogs.microsoft.com/sqlserver/2013/08/01/hardware-considerations-for-in-memory-oltp-in-sql-server-2014/
    At least one pre-existing article that contained the obsolete blog link was:
        relational-databases\in-memory-oltp\sample-database-for-in-memory-oltp.md
-->

## <a name="cpu"></a>ЦП

Выполняющейся в памяти OLT не требуется высокопроизводительный сервер для поддержки рабочей нагрузки OLTP с высокой пропускной способностью. Рекомендуется использовать сервер среднего уровня с двумя сокетами ЦП. Из-за увеличенной пропускной способности, включенной выполняющейся в памяти OLTP, двух сокетов, скорее всего, будет достаточно для удовлетворения потребностей вашего бизнеса.

Рекомендуется также включить многопоточность. В этом случае производительность некоторых рабочих нагрузок OLTP увеличивается на 40 %.

## <a name="memory"></a>Память

Все оптимизированные для памяти таблицы полностью находятся в памяти. Поэтому необходимо иметь достаточный объем физической памяти для самих таблиц и для поддержки выполнения рабочей нагрузки в базе данных. Фактически необходимый объем памяти в основном зависит от рабочей нагрузки, но для начала можно выделить объем доступной памяти, примерно вдвое превышающий размер данных. Также потребуется достаточный объем памяти для буферного пула в случае, если рабочая нагрузка выполняется в обычных таблицах на диске.

Чтобы определить объем памяти, используемый таблицей, оптимизированной для памяти, выполните следующий запрос:

```sql
select object_name(object_id), * from sys.dm_db_xtp_table_memory_stats;
```

В выходных данных будет указан объем памяти, используемый для оптимизированных для памяти таблиц и их индексов. В состав данных таблицы входят данные пользователя, а также все предыдущие версии строк, которые по-прежнему требуются в транзакциях или еще не были удалены системой. Объем памяти, используемый хэш-индексами, является постоянным и не зависит от количества строк в таблице.

Важно помнить, что при использовании выполняющейся в памяти OLTP база данных не должна полностью помещаться в памяти. Размер базы данных может составлять несколько терабайт, и вам будут доступны преимущества выполняющейся в памяти OLTP до тех пор, пока размер горячих данных (т. е. таблиц, оптимизированных для памяти) не превышает 256 ГБ. Максимальное число файлов данных контрольных точек, которыми SQL Server может управлять для одной базы данных, составляет 4000, а размер каждого файла равен 128 МБ. Несмотря на то, что в результате получается теоретический максимум, равный 512 ГБ, мы поддерживаем до 256 ГБ, что позволяет обеспечивать соответствие SQL Server объединенным файлам контрольных точек и не достигать предела в 4000 файлов. Обратите внимание, что это ограничение применяется только к таблицам, оптимизированным для памяти. Подобное ограничение для обычных таблиц на диске в одной и той же базе данных SQL Server отсутствует.

Неустойчивые оптимизированные для памяти таблицы (NDT), т. е. оптимизированные для памяти таблицы с DURABILITY = SCHEMA_ONLY, не сохраняются на диске. Несмотря на то, что для таблиц NDT не действует ограничение по числу файлов контрольных точек, поддерживается только 256 ГБ. Рекомендации по дискам журналов и данных в оставшейся части этой публикации не применяются к неустойчивым таблицам, так как данные существуют только в памяти.

## <a name="log-drive"></a>Диск журнала

Записи журнала, относящиеся к таблицам, оптимизированным для памяти, регистрируются в журнале транзакций базы данных вместе с другими записями журнала SQL Server.

Очень важно всегда размещать файл журнала на диске с низкой задержкой, чтобы транзакциям не приходилось слишком долго ждать. Кроме того, это позволит избежать конфликтов ввода-вывода журнала. Система будет работать со скоростью самого медленного компонента (закон Амдала). Необходимо сделать так, чтобы при использовании выполняющейся в памяти OLTP устройство ввода-вывода журнала не стало узким местом. Рекомендуется использовать устройство хранения с низкой задержкой — как минимум диск SSD.

Обратите внимание, что таблицы, оптимизированные для памяти, потребляют меньше пропускной способности журнала, чем таблицы на диске, так как они не регистрируют операции с индексами и записи отмены. Это может помочь уменьшить число конфликтов ввода-вывода журнала.

## <a name="data-drive"></a>Диск данных

Для сохраняемости оптимизированных для памяти таблиц, использующих файлы контрольных точек, применяется потоковый ввод-вывод. Таким образом, этим файлам не требуется диск с низкой задержкой или быстрым произвольным вводом-выводом. Основным определяющим фактором для этих дисков является скорость последовательного ввода-вывода и пропускная способность адаптера шины (HBA). Поэтому для файлов контрольных точек диски SSD не нужны. Файлы можно размещать на высокопроизводительных шпинделях (например, SAS), пока скорость последовательного ввода-вывода соответствует вашим требованиям.

Важнейшим фактором определения требования к скорости является RTO [цель времени восстановления] при перезапуске сервера. Во время восстановления базы данных все данные в таблицах, оптимизированных для памяти, должны быть считаны с диска в память. Восстановление базы данных выполняется со скоростью последовательного чтения имеющейся подсистемы ввода-вывода. Диск здесь является узким местом.

Чтобы соблюсти строгие требования RTO, рекомендуется распределить файлы контрольных точек по нескольким дискам, добавив несколько контейнеров в файловую группу MEMORY_OPTIMIZED_DATA. SQL Server поддерживает параллельную загрузку файлов контрольных точек с нескольких дисков — восстановление выполняется с суммарной скоростью дисков.

Рекомендуется, чтобы свободного места на диске было вдвое или втрое больше, чем для доступных оптимизированных для памяти таблиц.

## <a name="see-also"></a>См. также раздел

[Пример базы данных для выполняющейся в памяти OLTP](sample-database-for-in-memory-oltp.md)
