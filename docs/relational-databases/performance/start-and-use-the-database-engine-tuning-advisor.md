---
title: Запуск и использование помощника по настройке ядра СУБД | Документация Майкрософт
description: Сведения о том, как запустить и использовать помощник по настройке ядра СУБД в SQL Server для создания рабочих нагрузок, настройки баз данных и создания входных XML-файлов.
ms.custom: ''
ms.date: 01/09/2017
ms.prod: sql
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
f1_keywords:
- sql13.dta.workload.f1
- sql13.dta.general.f1
- sql13.dta.advancedtuningoptions.f1
- sql13.dta.tuningoptions.f1
- sql13.dta.progress.f1
- sql13.dta.options.f1
helpviewer_keywords:
- Database Engine Tuning Advisor [SQL Server], starting
ms.assetid: a4e3226a-3917-4ec8-bdf0-472879d231c9
author: WilliamDAssafMSFT
ms.author: wiassaf
ms.openlocfilehash: c8cd352c5347cbc48979af4e03775c9d7da8f3d1
ms.sourcegitcommit: 0e0cd9347c029e0c7c9f3fe6d39985a6d3af967d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2020
ms.locfileid: "96504973"
---
# <a name="start-and-use-the-database-engine-tuning-advisor"></a>Запуск и использование помощника по настройке ядра СУБД
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
  В этом разделе описано, как запускать и использовать помощник по настройке ядра СУБД в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Дополнительные сведения о просмотре и работе с результатами после настройки базы данных см. в статье [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](../../relational-databases/performance/view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).  
  
##  <a name="initialize-the-database-engine-tuning-advisor"></a><a name="Initialize"></a> Инициализация помощника по настройке ядра СУБД  
 При первом использовании помощника по настройке ядра СУБД его должен инициализировать пользователь, имеющий предопределенную роль сервера **sysadmin** . Это связано с тем, что для поддержки операций настройки в базе данных **msdb** необходимо создать несколько системных таблиц. Инициализация также помогает пользователям, являющимся членами предопределенной роли базы данных **db_owner** , настраивать рабочие нагрузки для таблиц в принадлежащих им базах данных.  
  
 Пользователь с разрешениями системного администратора должен выполнить одно из следующих действий.  
  
-   Через графический пользовательский интерфейс помощника по настройке ядра СУБД установить соединение с экземпляром [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]. Дополнительные сведения см. ниже в подразделе [Запуск помощника по настройке ядра СУБД](#Start) .  
  
-   Воспользуйтесь для настройки первой рабочей нагрузки служебной программой **dta** . Дополнительные сведения см. ниже в подразделе [Использование служебной программы dta](#dta) .  
  
##  <a name="start-the-database-engine-tuning-advisor"></a><a name="Start"></a> Запуск помощника по настройке ядра СУБД  
 Запустить графический интерфейс пользователя для помощника по настройке ядра СУБД вы можете разными способами, в зависимости от необходимых возможностей настройки базы данных. Способы запуска помощника по настройке ядра СУБД: из меню **Пуск** , из меню **Сервис** в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], из редактора запросов в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]и из меню **Сервис** в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]. При первом запуске помощника по настройке ядра СУБД приложение отображает диалоговое окно **Соединение с сервером** , где вы можете указать экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , с которым необходимо установить соединение.  
  
> [!WARNING]  
>  Не следует запускать помощник по настройке ядра СУБД, если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] работает в однопользовательском режиме. Если попытаться запустить его, когда сервер работает в однопользовательском режиме, будет возвращена ошибка и помощник по настройке ядра СУБД запущен не будет. Дополнительные сведения об однопользовательском режиме см. в статье [Запуск SQL Server в однопользовательском режиме](../../database-engine/configure-windows/start-sql-server-in-single-user-mode.md).  
  
#### <a name="to-start-database-engine-tuning-advisor-from-the-windows-start-menu"></a>Запуск помощника по настройке ядра СУБД из меню «Пуск» в Windows  
  
1.  В меню **Пуск** последовательно укажите **Все программы**, **Microsoft SQL Server**, **Средства обеспечения производительности**, **Помощник по настройке ядра СУБД**.  
  
#### <a name="to-start-the-database-engine-tuning-advisor-in-sql-server-management-studio"></a>Запуск помощника по настройке ядра СУБД из среды SQL Server Management Studio  
  
1.  В меню [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] **Сервис** выберите пункт **Помощник по настройке ядра СУБД**.  
  
#### <a name="to-start-the-database-engine-tuning-advisor-from-the-sql-server-management-studio-query-editor"></a>Запуск помощника по настройке ядра СУБД из редактора запросов среды SQL Server Management Studio  
  
1.  Откройте файл скрипта [!INCLUDE[tsql](../../includes/tsql-md.md)] в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Дополнительные сведения см. в статье [Редакторы запросов и текста (SQL Server Management Studio)](../../ssms/f1-help/database-engine-query-editor-sql-server-management-studio.md?view=sql-server-ver15).  
  
2.  Выделите запрос в скриптe [!INCLUDE[tsql](../../includes/tsql-md.md)] или весь скрипт целиком, щелкните правой кнопкой мыши выбранный фрагмент и выберите пункт **Анализ запроса в помощнике по настройке ядра СУБД**. Откроется графический интерфейс помощника по настройке ядра СУБД, после чего будет выполнен импорт скрипта как XML-файла рабочей нагрузки. Для настройки выбранных запросов [!INCLUDE[tsql](../../includes/tsql-md.md)] в качестве рабочей нагрузки вы можете указать имя сеанса и параметры настройки.  
  
#### <a name="to-start-the-database-engine-tuning-advisor-in-sql-server-profiler"></a>Запуск помощника по настройке ядра СУБД из приложения SQL Server Profiler  
  
1.  В меню **Сервис** приложения SQL Server Profiler выберите пункт **Помощник по настройке ядра СУБД**.  
  
##  <a name="create-a-workload"></a><a name="Create"></a> Создание рабочей нагрузки  
 Рабочая нагрузка представляет собой набор инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] , выполняемый в одной или нескольких базах данных, которые необходимо настроить. Помощник по настройке ядра СУБД анализирует эти рабочие нагрузки для рекомендации индексов или стратегий секционирования, которые улучшат производительность запросов сервера.  
  
 Создать рабочую нагрузку можно одним из следующих методов.  
  
-   Используйте [хранилище запросов](../../relational-databases/performance/how-query-store-collects-data.md) качестве рабочей нагрузки. Это позволяет не создавать рабочую нагрузку вручную. Дополнительные сведения см. в статье [Настройка базы данных с помощью рабочей нагрузки из хранилища запросов](../../relational-databases/performance/tuning-database-using-workload-from-query-store.md).  

      ||  
      |-|  
      |**Область применения**: [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] и более поздних версий.|  

  
-   Использовать кэш планов в качестве рабочей нагрузки. Это позволяет не создавать рабочую нагрузку вручную. Дополнительные сведения см. далее в подразделе [Настройка базы данных](#Tune) .  
  
-   В редакторе запросов в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или в привычном текстовом редакторе создайте скрипт рабочей нагрузки [!INCLUDE[tsql](../../includes/tsql-md.md)] вручную.  
  
-   Чтобы создать рабочие нагрузки файла или таблицы трассировки, воспользуйтесь приложением [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] .  
  
    > [!NOTE]  
    >  При использовании таблицы трассировки в качестве рабочей нагрузки эта таблица должна находиться на том же сервере, на котором работает помощник по настройке ядра СУБД. При создании таблицы трассировки на другом сервере необходимо затем переместить ее на тот сервер, на котором работает помощник по настройке ядра СУБД.  
  
-   Кроме того, рабочие нагрузки могут быть внедренными во входные XML-файлы, где также можно указать весовой коэффициент для каждого события. Дополнительные сведения о задании внедренных рабочих нагрузок см. далее в подразделе [Создание входного файла XML-данных](#XMLInput) .  
  
###  <a name="to-create-transact-sql-script-workloads"></a><a name="SSMS"></a> Для создания рабочей нагрузки скрипта Transact-SQL  
  
1.  Запустите редактор запросов в среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Дополнительные сведения см. в статье [Редакторы запросов и текста (SQL Server Management Studio)](../../ssms/f1-help/database-engine-query-editor-sql-server-management-studio.md?view=sql-server-ver15).  
  
2.  Введите скрипт на языке [!INCLUDE[tsql](../../includes/tsql-md.md)] в редакторе запросов. Этот скрипт должен содержать набор инструкций языка [!INCLUDE[tsql](../../includes/tsql-md.md)] , выполняемых в одной или нескольких базах данных, которые необходимо настроить.  
  
3.  Сохраните файл с расширением **SQL** . Графический интерфейс помощника по настройке ядра СУБД и программа командной строки **dta** могут использовать этот скрипт [!INCLUDE[tsql](../../includes/tsql-md.md)] в качестве рабочей нагрузки.  
  
###  <a name="to-create-trace-file-and-trace-table-workloads"></a><a name="Profiler"></a> Для создания рабочих нагрузок файла и таблицы трассировки.  
  
1.  Запустите приложение [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] одним из следующих способов.  
  
    -   В меню **Пуск** последовательно укажите **Все программы**, **Microsoft SQL Server**, **Средства обеспечения производительности** и выберите пункт **SQL Server Profiler**.  
  
    -   В среде [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]в меню **Сервис** выберите пункт **Приложение SQL Server Profiler**.  
  
2.  Создайте файл или таблицу трассировки, как описано в представленных ниже процедурах, использующих шаблон приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] **Настройка**.  
  
    -   [Создание трассировки (приложение SQL Server Profiler)](../../tools/sql-server-profiler/create-a-trace-sql-server-profiler.md)  
  
    -   [Сохранение результатов трассировки в файл (приложение SQL Server Profiler)](../../tools/sql-server-profiler/save-trace-results-to-a-file-sql-server-profiler.md)  
  
         Помощник по настройке ядра СУБД предполагает, что файл трассировки рабочей нагрузки является файлом продолжения. Дополнительные сведения о файлах продолжения см. в разделе [Limit Trace File and Table Sizes](../../relational-databases/sql-trace/limit-trace-file-and-table-sizes.md).  
  
    -   [Сохранение результатов трассировки в таблицу (SQL Server Profiler)](../../tools/sql-server-profiler/save-trace-results-to-a-table-sql-server-profiler.md)  
  
         Перед использованием таблицы трассировки в качестве рабочей нагрузки необходимо убедиться, что данная трассировка остановлена.  
  
 Рекомендуется использовать шаблон настройки приложения SQL Server Profiler для фиксирования рабочих нагрузок для помощника по настройке ядра СУБД.  
  
 Чтобы использовать собственный шаблон, необходимо убедиться, что отслеживаются приведенные ниже события трассировки:  
  
-   **RPC:Completed**  
  
-   **SQL:BatchCompleted**  
  
-   **SP:StmtCompleted**  
  
 Также можно использовать варианты **Starting** этих событий трассировки. Например **SQL:BatchStarting**. Однако варианты **Completed** этих событий трассировки включают столбец **Продолжительность** , который позволяет помощнику по настройке ядра СУБД выполнять настройку рабочих нагрузок более эффективно. Помощник по настройке ядра СУБД не выполняет настройку других типов событий трассировки. Дополнительные сведения об этих событиях трассировки см. в разделах [Stored Procedures Event Category](../../relational-databases/event-classes/stored-procedures-event-category.md) и [TSQL Event Category](../../relational-databases/event-classes/tsql-event-category.md). Сведения об использовании хранимых процедур трассировки SQL для создания рабочей нагрузки файла трассировки см. в статье [Создание трассировки (Transact-SQL)](../../relational-databases/sql-trace/create-a-trace-transact-sql.md).  
  
### <a name="trace-file-or-trace-table-workloads-that-contain-the-loginname-data-column"></a>Рабочие нагрузки файла или таблицы трассировки, содержащие столбец данных LoginName  
 Помощник по настройке ядра СУБД направляет запросы Showplan в процессе настройки. Если таблица или файл трассировки, содержащие столбец данных **LoginName** , используются в качестве рабочей нагрузки, помощник по настройке ядра СУБД олицетворяет пользователя, указанного в столбце **LoginName**. Если этому пользователю не было предоставлено разрешение SHOWPLAN, которое позволяет выполнять и создавать запросы Showplan для инструкций, содержащихся в трассировке, помощник по настройке ядра СУБД не будет выполнять настройку подобных инструкций.  
  
##### <a name="to-avoid-granting-the-showplan-permission-to-each-user-specified-in-the-loginname-column-of-the-trace"></a>Избежание предоставления разрешения SHOWPLAN каждому пользователю, указанному в столбце трассировки LoginName  
  
1.  Настройте рабочую нагрузку файла или таблицы трассировки. Дополнительные сведения см. далее в подразделе [Настройка базы данных](#Tune) .  
  
2.  Проверьте журнал настройки для инструкций, которые не были настроены из-за несоответствующих разрешений. Дополнительные сведения см. в статье [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](../../relational-databases/performance/view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).  
  
3.  Создайте новую рабочую нагрузку путем удаления столбца **LoginName** из событий, которые не были настроены, затем в файле или таблице трассировки сохраните только ненастроенные события. Дополнительные сведения об удалении столбцов данных из трассировки см. в статье [Указание столбцов событий и данных для файла трассировки (приложение SQL Server Profiler)](../../tools/sql-server-profiler/specify-events-and-data-columns-for-a-trace-file-sql-server-profiler.md) или [Изменение существующей трассировки (Transact-SQL)](../../relational-databases/sql-trace/modify-an-existing-trace-transact-sql.md).  
  
4.  Повторно передайте новую рабочую нагрузку без столбца **LoginName** помощнику по настройке ядра СУБД.  
  
 Помощник по настройке ядра СУБД произведет настройку новой рабочей нагрузки, так как сведения об имени входа не указаны в трассировке. Если столбец **LoginName** для инструкции не существует, то помощник по настройке ядра СУБД настроит инструкцию посредством олицетворения пользователя, запустившего сеанс настройки (являющегося либо членом предопределенной роли сервера **sysadmin** , либо членом предопределенной роли базы данных **db_owner** ).  
  
##  <a name="tune-a-database"></a><a name="Tune"></a> Настройка базы данных  
 Настроить базу данных можно с помощью графического интерфейса помощника по настройке ядра СУБД или программы **dta** .  
  
> [!NOTE]  
>  Прежде чем использовать таблицу трассировки в качестве рабочей нагрузки для помощника по настройке ядра СУБД, убедитесь, что трассировка остановилась. Помощник по настройке ядра СУБД не позволяет использовать в качестве рабочей нагрузки таблицу трассировки, в которую еще производится запись трассируемых событий.  
  
### <a name="use-the-database-engine-tuning-advisor-graphical-user-interface"></a>Использование графического пользовательского интерфейса помощника по настройке ядра СУБД  
 В графическом интерфейсе пользователя помощника по настройке ядра СУБД настроить базу данных вы можете с помощью кэша планов, а также файлов или таблиц рабочей нагрузки. Графический интерфейс пользователя помощника по настройке ядра СУБД позволяет легко просмотреть результаты текущего и предыдущего сеансов настройки. Дополнительные сведения о параметрах пользовательского интерфейса см. далее в подразделе [Описание пользовательского интерфейса](#UI) . Дополнительные сведения о работе с результатами после настройки базы данных см. в статье [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](../../relational-databases/performance/view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).  

####  <a name="to-tune-a-database-by-using-the-query-store"></a><a name="PlanCache"></a> Настройка базы данных при помощи хранилища запросов
Дополнительные сведения см. в статье [Настройка базы данных с помощью рабочей нагрузки из хранилища запросов](../../relational-databases/performance/tuning-database-using-workload-from-query-store.md).
  
####  <a name="to-tune-a-database-by-using-the-plan-cache"></a><a name="PlanCache"></a> Настройка базы данных при помощи кэша планов  
  
1.  Запустите помощник по настройке ядра СУБД и войдите в экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. выше в подразделе [Запуск помощника по настройке ядра СУБД](#Start) .  
  
2.  На вкладке **Общие** введите имя в поле **Имя сеанса** , чтобы создать новый сеанс настройки. Перед началом сеанса настройки необходимо заполнить поля на вкладке **Общие** . Перед началом сеанса настройки нет необходимости изменять параметры на вкладке **Параметры настройки** .  
  
3.  Укажите **Кэш планов** в качестве рабочей нагрузки. Помощник по настройке ядра СУБД выбирает верхнюю тысячу событий из кэша планов для использования при анализе.  
  
4.  Выберите одну или несколько баз данных для настройки и, при необходимости, в списке **Выбранные таблицы** выберите одну или несколько таблиц из каждой базы данных. Чтобы включить записи кэша для всех баз данных, в поле **Параметры настройки** выберите **Дополнительные параметры** и установите флажок **Включать события кэша планов из всех баз данных**.  
  
5.  Установите флажок **Сохранить журнал настройки** , чтобы сохранить копию журнала настройки. Снимите этот флажок, если не нужно сохранять копию журнала настройки.  
  
     Журнал настройки можно посмотреть после анализа, открыв сеанс и выбрав вкладку **Выполнение** .  
  
6.  Перейдите на вкладку **Параметры настройки** и выберите приведенные на ней параметры.  
  
7.  Нажмите кнопку **Начать анализ**.  
  
     Если нужно остановить сеанс настройки после его начала, в меню **Действия** выберите один из следующих вариантов.  
  
    -   **Остановить анализ (с рекомендациями)** прерывает сеанс настройки и выводит приглашение для выбора, должен ли помощник по настройке ядра СУБД сформировать рекомендации на основе анализа, проведенного до этого момента.  
  
    -   Пункт **Остановить анализ** прерывает сеанс настройки без формирования рекомендаций.  
  
> [!NOTE]  
>  Временная остановка помощника по настройке ядра СУБД не поддерживается. Если на панели инструментов нажать кнопку **Начать анализ** после кнопки **Остановить анализ** или **Остановить анализ (с рекомендациями)** , то помощник по настройке ядра СУБД начинает новый сеанс настройки.  
  
#### <a name="to-tune-a-database-using-a-workload-file-or-table-as-input"></a>Настройка базы данных с использованием в качестве входных данных файла рабочей нагрузки или таблицы  
  
1.  Определите все компоненты (индексы, индексированные представления, секции) базы данных, которые помощник по настройке ядра СУБД должен проанализировать на предмет добавления, удаления или сохранения.  
  
2.  Создайте рабочую нагрузку. Дополнительные сведения см. выше в подразделе [Создание рабочей нагрузки](#Create) .  
  
3.  Запустите помощник по настройке ядра СУБД и войдите в экземпляр [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. выше в подразделе [Запуск помощника по настройке ядра СУБД](#Start) .  
  
4.  На вкладке **Общие** введите имя в поле **Имя сеанса** , чтобы создать новый сеанс настройки.  
  
5.  Выберите **Файл рабочей нагрузки** или **Таблица** и введите в соседнем текстовом поле путь к файлу или имя таблицы.  
  
     Формат для указания таблицы  
  
    ```  
    database_name.schema_name.table_name  
    ```  
  
     Чтобы найти файл рабочей нагрузки или таблицу, нажмите кнопку **Обзор**. Помощник по настройке ядра СУБД предполагает, что файлы рабочей нагрузки — это файлы продолжения. Дополнительные сведения о файлах продолжения см. в разделе [Limit Trace File and Table Sizes](../../relational-databases/sql-trace/limit-trace-file-and-table-sizes.md).  
  
     При использовании таблицы трассировки в качестве рабочей нагрузки она должна находиться на том же сервере, настройку которого производит помощник по настройке ядра СУБД. Если таблица трассировки создана на другом сервере, прежде чем использовать ее в качестве рабочей нагрузки, переместите эту таблицу на сервер, который настраивает помощник по настройке ядра СУБД.  
  
6.  Выберите базы данных и таблицы, для которых будет выполняться рабочая нагрузка, выбранная на шаге 5. Чтобы выбрать таблицы, нажмите стрелку **Выбранные таблицы** .  
  
7.  Установите флажок **Сохранить журнал настройки** , чтобы сохранить копию журнала настройки. Снимите этот флажок, если не нужно сохранять копию журнала настройки.  
  
     Журнал настройки можно посмотреть после анализа, открыв сеанс и выбрав вкладку **Выполнение** .  
  
8.  Перейдите на вкладку **Параметры настройки** и выберите приведенные на ней параметры.  
  
9. На панели инструментов нажмите кнопку **Начать анализ** .  
  
     Если нужно остановить сеанс настройки после его начала, в меню **Действия** выберите один из следующих вариантов.  
  
    -   **Остановить анализ (с рекомендациями)** прерывает сеанс настройки и выводит приглашение для выбора, должен ли помощник по настройке ядра СУБД сформировать рекомендации на основе анализа, проведенного до этого момента.  
  
    -   Пункт **Остановить анализ** прерывает сеанс настройки без формирования рекомендаций.  
  
> [!NOTE]  
>  Временная остановка помощника по настройке ядра СУБД не поддерживается. Если на панели инструментов нажать кнопку **Начать анализ** после кнопки **Остановить анализ** или **Остановить анализ (с рекомендациями)** , то помощник по настройке ядра СУБД начинает новый сеанс настройки.  
  
###  <a name="use-the-dta-utility"></a><a name="dta"></a> Использование служебной программы dta  
 Программа [dta](../../tools/dta/dta-utility.md) представляет собой программу командной строки, которая может быть использована для настройки баз данных. Она дает доступ к функциональности помощника по настройке ядра СУБД в пакетных файлах и скриптах. Программа **dta** использует в качестве рабочей нагрузки элементы кэша планов, файлы трассировки, таблицы трассировки и скрипты на языке [!INCLUDE[tsql](../../includes/tsql-md.md)] . Она также использует входные XML-данные, соответствующие схеме помощника по настройке ядра СУБД, находящейся на [веб-сайте Microsoft](https://go.microsoft.com/fwlink/?linkid=43100).  
  
 Перед началом настройки рабочей нагрузки при помощи программы **dta** обратите внимание на следующее.  
  
-   При использовании таблицы трассировки в качестве рабочей нагрузки она должна находиться на том же сервере, настройку которого производит помощник по настройке ядра СУБД. Если таблица трассировки создается на другом сервере, переместите ее на сервер, настраиваемый помощником по настройке ядра СУБД.  
  
-   Прежде чем использовать таблицу трассировки в качестве рабочей нагрузки для помощника по настройке ядра СУБД, убедитесь, что трассировка остановилась. Помощник по настройке ядра СУБД не позволяет использовать в качестве рабочей нагрузки таблицу трассировки, в которую еще производится запись трассируемых событий.  
  
-   Если сеанс настройки длится дольше, чем предполагалось, для остановки сеанса настройки и формирования рекомендаций, основанных на анализе, который служебная программа **dta** выполнила к данному моменту, нажмите клавиши CTRL+C. Будет выведен запрос о создании рекомендаций. Чтобы прервать сеанс настройки без формирования рекомендаций, еще раз нажмите сочетание клавиш CTRL+C.  
  
 Дополнительные сведения о синтаксисе и примеры использования программы **dta** см. в разделе [dta Utility](../../tools/dta/dta-utility.md).  
  
#### <a name="to-tune-a-database-by-using-the-plan-cache"></a>Настройка базы данных при помощи кэша планов  
  
1.  Задайте параметр **-ip** . Анализируется верхняя тысяча событий кэша планов для выбранных баз данных.  
  
     В командной строке введите следующую команду:  
  
    ```  
    dta -E -D DatabaseName -ip -s SessionName  
    ```  
  
2.  Чтобы изменить количество событий для анализа, задайте параметр **–n**. В следующем примере увеличивается число элементов кэша до 2 000.  
  
    ```  
    dta -E -D DatabaseName -ip -n 2000-s SessionName1  
    ```  
  
3.  В целях анализа событий для всех баз данных в экземпляре укажите параметр **-ipf** .  
  
    ```  
    dta -E -D DatabaseName -ip -ipf -n 2000 -s SessionName2  
    ```  
  
#### <a name="to-tune-a-database-by-using-a-workload-and-dta-utility-default-settings"></a>Настройка базы данных при помощи рабочей нагрузки и параметров программы dta по умолчанию  
  
1.  Определите все компоненты (индексы, индексированные представления, секции) базы данных, которые помощник по настройке ядра СУБД должен проанализировать на предмет добавления, удаления или сохранения.  
  
2.  Создайте рабочую нагрузку. Дополнительные сведения см. выше в подразделе [Создание рабочей нагрузки](#Create) .  
  
3.  В командной строке введите следующую команду:  
  
    ```  
    dta -E -D DatabaseName -if WorkloadFile -s SessionName  
    ```  
  
     где переключатель `-E` указывает, что сеанс настройки использует доверительное соединение (вместо идентификатора входа и пароля), а переключатель `-D` задает имя настраиваемой базы данных. По умолчанию программа устанавливает соединение с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] на локальном компьютере по умолчанию. (Для задания удаленной базы данных, как показано в следующей процедуре, или для задания именованного экземпляра используйте переключатель `-S` ). Переключатель `-if` задает имя и путь к файлу рабочей нагрузки (который может быть скриптом на языке [!INCLUDE[tsql](../../includes/tsql-md.md)] или файлом трассировки), а переключатель `-s` задает имя сеанса настройки.  
  
     Перечисленные здесь четыре аргумента (имя базы данных, рабочая нагрузка, тип соединения и имя сеанса) являются обязательными.  
  
#### <a name="to-tune-a-remote-database-or-a-named-instance-for-a-specific-duration"></a>Настройка удаленной базы данных или именованного экземпляра в течение определенного периода времени  
  
1.  Определите все компоненты (индексы, индексированные представления, секции) базы данных, которые помощник по настройке ядра СУБД должен проанализировать на предмет добавления, удаления или сохранения.  
  
2.  Создайте рабочую нагрузку. Дополнительные сведения см. выше в подразделе [Создание рабочей нагрузки](#Create) .  
  
3.  В командной строке введите следующую команду:  
  
    ```  
    dta -S ServerName\Instance -D DatabaseName -it WorkloadTableName   
    -U LoginID -P Password -s SessionName -A TuningTimeInMinutes  
    ```  
  
     где переключатель `-S` задает имя удаленного сервера и экземпляр (или именованный экземпляр на локальном сервере), а переключатель `-D` задает имя настраиваемой базы данных. Переключатель `-it` задает имя таблицы рабочей нагрузки, переключатели `-U` и `-P` определяют идентификатор входа и пароль для входа в удаленную базу данных, переключатель `-s` задает имя сеанса настройки и переключатель `-A` задает длительность сеанса настройки в минутах. По умолчанию для программы **dta** устанавливается длительность настройки, равная 8 часам. Если необходимо, чтобы помощник по настройке ядра СУБД мог настраивать рабочую нагрузку в течение неограниченного времени, задайте значение **0** (ноль) для переключателя `-A` .  
  
#### <a name="to-tune-a-database-using-an-xml-input-file"></a>Настройка базы данных при помощи входного файла XML  
  
1.  Определите все компоненты (индексы, индексированные представления, секции) базы данных, которые помощник по настройке ядра СУБД должен проанализировать на предмет добавления, удаления или сохранения.  
  
2.  Создайте рабочую нагрузку. Дополнительные сведения см. выше в подразделе [Создание рабочей нагрузки](#Create) .  
  
3.  Создайте входной файл XML-данных. Дополнительные сведения см. далее в подразделе [Создание входных файлов XML-данных](#XMLInput) .  
  
4.  В командной строке введите следующую команду:  
  
    ```  
    dta -E -S ServerName\Instance -s SessionName -ix PathToXMLInputFile  
    ```  
  
     где переключатель `-E` задает доверительное соединение, переключатель `-S` задает удаленный сервер и экземпляр или именованный экземпляр на локальном сервере, переключатель `-s` задает имя сеанса настройки и переключатель `-ix` задает входной файл XML-данных, используемый в сеансе настройки.  
  
5.  После окончания настройки рабочей нагрузки результаты сеансов настройки вы можете просмотреть в графическом пользовательском интерфейсе помощника по настройке ядра СУБД. В качестве альтернативы с помощью параметра **-ox** вы можете также указать, что рекомендации по настройке необходимо записать в XML-файл. Дополнительные сведения см. в статье [dta Utility](../../tools/dta/dta-utility.md).  
  
##  <a name="create-an-xml-input-file"></a><a name="XMLInput"></a> Создание входного файла XML-данных  
 Опытный XML-разработчик может создавать файлы в формате XML, которые помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] сможет использовать для настройки рабочих нагрузок. Чтобы создать эти XML-файлы, используйте наиболее удобные для вас XML-инструменты для изменения файла образца или создания экземпляра из XML-схемы помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .  
  
 XML-схема помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] доступна в следующем каталоге установленной копии [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:  
  
 `C:\Program Files\Microsoft SQL Server\100\Tools\Binn\schemas\sqlserver\2004\07\dta\dtaschema.xsd` 
  
 Схема XML помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] также доступна в сети на [веб-сайте Майкрософт](https://go.microsoft.com/fwlink/?linkid=43100&clcid=0x409).  
  
 Этот URL-адрес ведет на страницу с множеством доступных XML-схем [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Прокручивайте страницу вниз до тех пор, пока не появится строка с помощником по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .  
  
#### <a name="to-create-an-xml-input-file-to-tune-workloads"></a>Создание входного XML-файла для настройки рабочих нагрузок  
  
1.  Создайте рабочую нагрузку. Можно использовать файл или таблицу трассировки через шаблон настройки в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]либо создать скрипт [!INCLUDE[tsql](../../includes/tsql-md.md)] для воспроизведения показательной рабочей нагрузки для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Дополнительные сведения см. выше в подразделе [Создание рабочей нагрузки](#Create) .  
  
2.  Создать входной XML-файл одним из следующих способов:  
  
    -   Скопируйте и вставьте один из [образцов входных XML-файлов (DTA)](../../tools/dta/xml-input-file-samples-dta.md) в редактор XML по своему выбору. Изменить значения с целью указания соответствующих аргументов для установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и сохранения XML-файла;  
  
    -   Используя избранный XML-инструмент, сформировать экземпляр из схемы XML помощника по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .  
  
3.  После создания входного XML-файла используйте его как входной файл для программы командной строки **dta** при настройке рабочей нагрузки. Сведения об использовании входных файлов XML-данных с этой программой см. выше в разделе [Использование служебной программы dta](#dta) .  
  
> [!NOTE]  
>  Если необходимо использовать встроенную рабочую нагрузку, которая указывается непосредственно во входном файле XML-данных, воспользуйтесь образцом [Образец входного XML-файла с описанием встроенной рабочей нагрузки (DTA)](../../tools/dta/xml-input-file-sample-with-inline-workload-dta.md).  
  
##  <a name="user-interface-descriptions"></a><a name="UI"></a> Описание пользовательского интерфейса  
  
### <a name="tools-menuoptions-page"></a>Меню «Сервис»/«Страница "Параметры"»  
 Это диалоговое окно служит для указания общих параметров конфигурации для помощника по настройке ядра СУБД.  
  
 **При запуске**  
 Укажите, что должен делать помощник по настройке ядра СУБД при его запуске: открыть без подключения к базе данных, открыть диалоговое окно **Создание соединения** , открыть новый сеанс или загрузить последний загружаемый сеанс.  
  
 **Изменить шрифт**  
 Определяет шрифт, используемый в таблицах помощником по настройке ядра СУБД.  
  
 **Число элементов в списках последних использованных объектов**  
 Указывается число сеансов или файлов, отображаемых в списках **Последние сеансы** и **Последние файлы** в меню **Файл** .  
  
 **Запоминать последние параметры настройки**  
 Сохранять параметры настройки между сеансами. Выбрано по умолчанию. Снимите этот флажок, чтобы помощник по настройке ядра СУБД всегда запускался с параметрами по умолчанию.  
  
 **Запрашивать подтверждение перед окончательным удалением сеансов**  
 Отображать диалоговое окно подтверждения перед удалением сеансов.  
  
 **Запрашивать подтверждение перед остановкой анализа сеанса**  
 Отображать диалоговое окно подтверждения перед остановкой анализа рабочей нагрузки.  
  
#### <a name="general-tab-options"></a>Параметры на вкладке «Общие»  
 Перед началом сеанса настройки необходимо заполнить поля на вкладке **Общие** . Перед началом сеанса настройки изменять параметры на вкладке **Параметры настройки** не обязательно.  
  
 **Имя сеанса**  
 Укажите имя для этого сеанса. Это имя сеанса связывает имя с сеансом настройки. Впоследствии по этому имени можно обращаться к данному сеансу настройки.  
  
 **Файл**  
 Укажите SQL-скрипт или файл трассировки для рабочей нагрузки. Укажите путь и имя файла в соответствующих полях. Помощник по настройке ядра СУБД предполагает, что файл трассировки рабочей нагрузки является файлом продолжения. Дополнительные сведения о файлах продолжения см. в разделе [Limit Trace File and Table Sizes](../../relational-databases/sql-trace/limit-trace-file-and-table-sizes.md).  
  
 **Таблица**  
 Укажите таблицу трассировки для рабочей нагрузки. Укажите полное имя таблицы трассировки в текстовом поле следующим образом:  
  
```  
database_name.owner_name.table_name  
```  
  
-   Перед использованием таблицы трассировки в качестве рабочей нагрузки необходимо убедиться, что данная трассировка остановлена.  
  
-   Таблица трассировки должна находиться на том же сервере, который настраивается помощником по настройке ядра СУБД. Если таблица трассировки создается на другом сервере, переместите ее на сервер, настраиваемый помощником по настройке ядра СУБД.  
  
 **Кэш планов**  
 Укажите кэш планов в качестве рабочей нагрузки. Это позволяет не создавать рабочую нагрузку вручную. Помощник по настройке ядра СУБД выбирает верхнюю тысячу событий для использования при анализе.  
  
 **Xml**  
 Этот параметр не появляется, если рабочая нагрузка не импортируется из среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  
  
 Для импорта запроса рабочей нагрузки из среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]сделайте следующее:  
  
1.  Введите запрос в редакторе запросов и выделите его.  
  
2.  Щелкните выделение правой кнопкой мыши и выберите команду **Анализ запроса в помощнике по настройке ядра СУБД**.  
  
 **Выберите рабочую нагрузку [файл или таблицу]**  
 Если в качестве источника рабочей нагрузки выбраны **Файл** или **Таблица** , то источник можно выбрать, нажав эту кнопку просмотра.  
  
 **Предварительный просмотр рабочей нагрузки в формате XML**  
 Просмотр рабочей нагрузки в формате XML, импортированной из среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].  
  
 **База данных для анализа рабочей нагрузки**  
 Укажите первую базу данных, к которой подключается помощник по настройке ядра СУБД при настройке рабочей нагрузки. После начала настройки помощник по настройке ядра СУБД подключается к базам данных, определенным в инструкциях `USE DATABASE` , которые содержатся в рабочей нагрузке.  
  
 **Выберите базы данных и таблицы для настройки**  
 Выберите настраиваемые базы данных и таблицы. Чтобы выбрать все базы данных, установите флажок в заголовке столбца **Имя** . Чтобы выбрать определенные базы данных, установите флажки рядом с их именами. По умолчанию все таблицы для выбранных баз данных автоматически включаются в сеанс настройки. Для исключения таблиц щелкните стрелку в столбце **Выбранные таблицы** , затем снимите флажки против таблиц, которые не нужно настраивать.  
  
 Стрелка вниз **Выбранные таблицы**  
 Выводит список таблиц для выбора отдельных таблиц для настройки.  
  
 **Сохранить журнал настройки**  
 Создает журнал и записывает сообщения об ошибках сеанса.  
  
> [!NOTE]  
>  Помощник по настройке ядра СУБД не обновляет автоматически данные о строках для таблиц, выведенных на вкладке **Общие** . Вместо этого он основывается на метаданных в базе данных. Если есть основания считать, что данные о строках устарели, выполните команду DBCC UPDATEUSAGE для соответствующих объектов.  
  
##### <a name="tuning-tab-options"></a>Вкладка «Параметры настройки»  
 На вкладке **Параметры настройки** задаются общие параметры настройки по умолчанию. Перед началом сеанса настройки изменять параметры на вкладке **Параметры настройки** не обязательно.  
  
 **Ограничить время настройки**  
 Ограничивается время текущего сеанса настройки. Предоставление большего количества времени для настройки повышает качество рекомендаций. Для обеспечения наилучших рекомендаций не выбирайте этот параметр.  
  
> [!NOTE]  
> [!INCLUDE[ssDE](../../includes/ssde-md.md)] во время анализа потребляет системные ресурсы. Параметр **Ограничить время настройки** служит для прекращения настройки до начала ожидаемой высокой рабочей нагрузки настраиваемого сервера.  
  
 **Дополнительные параметры**  
 Диалоговое окно **Дополнительные параметры настройки** служит для настройки максимально доступного свободного пространства, максимального количества ключевых столбцов и рекомендаций по индексам в сети.  
  
 **Определить размер места для рекомендаций (МБ)**  
 Укажите рекомендованный помощником по настройке ядра СУБД максимальный объем пространства, которое будет использовано структурами физического проектирования.  
  
 Если здесь не будет указано какое-либо значение, помощник по настройке Database Engine выберет наименьший из указанных ниже объемов пространства.  
  
-   троекратный текущий размер необработанных данных, включая общий размер куч и кластеризованных индексов в таблицах базы данных;  
  
-   свободное место на всех присоединенных дисках плюс размер необработанных данных.  
  
 **Включать события кэша планов из всех баз данных**  
 Укажите, что анализируются события кэша планов из всех баз данных.  
  
 **Максимальное число столбцов в индексе**  
 Укажите максимальное число столбцов, включаемых в любой индекс. Значение по умолчанию — 1023.  
  
 **Создавать только рекомендации вне сети**  
 Создать по возможности наилучшие рекомендации, но не рекомендовать создания структур физического проектирования в режиме в сети.  
  
 **Создавать рекомендации в сети, когда возможно**  
 При создании инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] для внедрения рекомендаций используйте методы, которые можно реализовать при функционировании сервера в режиме в сети, даже если существуют более быстрые методы при работе в автономном режиме.  
  
 **Создавать только рекомендации в сети**  
 Создавать только такие рекомендации, которые позволяют серверам оставаться в режиме в сети.  
  
 **Остановиться на**  
 Указывает дату и время, когда помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] должен прекратить работу.  
  
 **Индексы и индексированные представления**  
 Убедитесь в том, что это поле содержит рекомендации по добавлению кластеризованных и некластеризованных индексов, а также индексированных представлений.  
  
 **Индексированные представления**  
 Включаются только рекомендации по добавлению индексированных представлений. Рекомендаций по кластеризованным и некластеризованным индексам не будет.  
  
 **Включить отфильтрованные индексы**  
 Включает рекомендации по добавлению отфильтрованных индексов. Этот параметр доступен при выборе одной из следующих физических структур: **Индексы и индексированные представления**, **Индексы** или **Некластеризованные индексы**.  
  
 **Индексы**  
 Включаются только рекомендации по добавлению кластеризованных и некластеризованных индексов. Без рекомендаций по индексированным представлениям.  
  
 **Некластеризованные индексы**  
 Включаются рекомендации только по некластеризованным индексам. Без рекомендаций по кластеризованным индексам и индексированным представлениям.  
  
 **Оценивать использование только существующих структур PDS**  
 Оценка эффективности текущих индексов без рекомендаций по дополнительным индексам или индексированным представлениям.  
  
 **Без секционирования**  
 Не формировать рекомендации по секционированию.  
  
 **Полное секционирование**  
 Включить рекомендации по секционированию.  
  
 **Секционирование с выравниванием**  
 Для облегчения обслуживания секции, создаваемые в соответствии с новыми рекомендациями, будут выровнены.  
  
 **Не сохранять существующие PDS**  
 Рекомендуется удаление ненужных существующих индексов, представлений и секций. Если существующая структура физического проектирования (PDS) полезна для рабочей нагрузки, помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] не рекомендует ее удалять.  
  
 **Сохранять только индексы**  
 Сохраняются все существующие индексы, но рекомендуется удаление ненужных индексированных представлений и секционирования.  
  
 **Сохранять все существующие PDS**  
 Сохраняются все существующие индексы, индексированные представления и секции.  
  
 **Сохранять только кластеризованные индексы**  
 Сохраняются все существующие кластеризованные индексы, но рекомендуется удаление ненужных индексированных представлений, секций и некластеризованных индексов.  
  
 **Сохранять секционирование с выравниванием**  
 Сохраняются выровненные в настоящее время структуры секционирования, но рекомендуется удаление ненужных индексированных представлений, индексов и невыровненных секций. Все дополнительные рекомендованные структуры будут выровнены по секциям в соответствии с текущей схемой секционирования.  
  
###### <a name="progress-tab-options"></a>Параметры на вкладке «Выполнение»  
 Вкладка **Выполнение** помощника по настройке ядра СУБД появляется после того, как он начинает анализ рабочей нагрузки.  
  
 Если нужно остановить сеанс настройки после его начала, в меню **Действия** выберите один из следующих вариантов.  
  
-   **Остановить анализ (с рекомендациями)** прерывает сеанс настройки и выводит приглашение для выбора, должен ли помощник по настройке ядра СУБД сформировать рекомендации на основе анализа, проведенного до этого момента.  
  
-   Пункт **Остановить анализ** прерывает сеанс настройки без формирования рекомендаций.  
  
 **Ход настройки**  
 Отображает текущее состояние процесса настройки. Содержит количество выполненных действий, ошибок, полученных сообщений об успешном выполнении и сообщений с предупреждениями.  
  
 **Сведения**  
 Содержит значок, обозначающий состояние.  
  
 **Действие**  
 Отображает выполняемые этапы.  
  
 **Состояние**  
 Отображает состояние этапа действия.  
  
 **Сообщение**  
 Содержит сообщения, возвращенные этапами действия.  
  
 **Журнал настройки**  
 Содержит сведения, касающиеся этого сеанса настройки. Для распечатки этого журнала щелкните его правой кнопкой мыши и выберите пункт **Печать**.  
  
## <a name="see-also"></a>См. также:  
 [Просмотр и работа с выходными данными помощника по настройке ядра СУБД](../../relational-databases/performance/view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)   
 [Служебная программа dta](../../tools/dta/dta-utility.md)    
 [Руководство. Помощник по настройке ядра СУБД](../../tools/dta/tutorial-database-engine-tuning-advisor.md)
