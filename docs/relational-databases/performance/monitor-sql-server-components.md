---
title: "Наблюдение за компонентами SQL Server | Документация Майкрософт"
ms.custom: 
ms.date: 03/14/2017
ms.prod: sql-non-specified
ms.prod_service: database-engine
ms.service: 
ms.component: performance
ms.reviewer: 
ms.suite: sql
ms.technology: database-engine
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: e8f1b16b-ea40-4e12-886c-967ebda4e6e4
caps.latest.revision: "8"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: Inactive
ms.openlocfilehash: 4cc1115ebc7142d49a8b0cda79cc6dee1d8f250f
ms.sourcegitcommit: 44cd5c651488b5296fb679f6d43f50d068339a27
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2017
---
# <a name="monitor-sql-server-components"></a>Наблюдение за компонентами SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)] Важность мониторинга обусловлена динамикой среды, в которой выполняется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Данные приложений постоянно изменяются. Меняется тип доступа, который требуется пользователям. Меняется способ подключения пользователей. Может измениться даже тип приложений, обращающихся к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , однако [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] автоматически управляет такими системными ресурсами, как память и место на диске, поэтому ручная настройка системы практически не требуется. Мониторинг позволяет администраторам следить за тенденциями изменения производительности и определять ситуации, когда требуются изменения.  
  
 Для организации эффективного мониторинга компонентов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выполните следующие действия.  
  
1.  Определите цели мониторинга.  
  
2.  Выберите подходящее средство.  
  
3.  Определите компоненты, подлежащие мониторингу.  
  
4.  Выберите метрики для этих компонентов.  
  
5.  Произведите мониторинг работы сервера.  
  
6.  Проанализируйте данные.  
  
 Ниже подробно описан каждый шаг.  
  
## <a name="determine-your-monitoring-goals"></a>Определение целей мониторинга  
 Чтобы обеспечить эффективность мониторинга [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , необходимо четко определить, для чего он нужен. Мониторинг может осуществляться в следующих целях.  
  
-   Формирование основных критериев оценки производительности.  
  
-   Определение изменений производительности во времени.  
  
-   Диагностика проблем, связанных с производительностью.  
  
-   Определение компонентов и процессов, требующих оптимизации.  
  
-   Сравнение влияния различных клиентских приложений на производительность.  
  
-   Аудит активности пользователей.  
  
-   Проверка работы сервера под воздействием различных нагрузок.  
  
-   Проверка архитектуры базы данных.  
  
-   Проверка расписания обслуживания.  
  
-   Проверка планов резервного копирования и восстановления.  
  
-   Определение необходимости изменения конфигурации оборудования.  
  
## <a name="select-the-appropriate-tool"></a>Выбор подходящего средства  
 Определив цели мониторинга, следует выбрать соответствующие средства для этого типа мониторинга: В состав [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и операционной системы Windows входит полный набор средств мониторинга серверов в средах с большим количеством транзакций. Эти средства подробно описывают состояние экземпляра компонента SQL Server Database Engine или экземпляра служб SQL Server Analysis Services.  
  
 Windows предоставляет следующие средства мониторинга приложений, запущенных на сервере.  
  
-   Системный монитор, который позволяет собирать и просматривать данные об использовании памяти, диска и процессора в реальном времени  
  
-   Журналы и предупреждения производительности  
  
-   Диспетчер задач  
  
 Дополнительные сведения о средствах Windows Server и Windows см. в документации по операционной системе Windows.  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] предоставляет следующие средства мониторинга компонентов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]:  
  
-   Трассировка SQL  
  
-   [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]  
  
-   Программа распределенного воспроизведения  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] Монитор активности  
  
-   [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] Графическое отображение инструкции Showplan  
  
-   Хранимые процедуры  
  
-   Консольные команды базы данных (DBCC)  
  
-   Встроенные функции  
  
-   Флаги трассировки  
  
 Дополнительные сведения о средствах наблюдения [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] см. в статье [Средства контроля и настройки производительности](../../relational-databases/performance/performance-monitoring-and-tuning-tools.md).  
  
## <a name="identify-the-components-to-monitor"></a>Определение компонентов, подлежащих мониторингу  
 На этом шаге требуется определить компоненты [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , которые нужно контролировать. Например, при трассировке сервера при помощи приложения [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] можно собирать данные об определенных событиях. Кроме того, можно исключить из трассировки события, ненужные в данной конкретной ситуации.  
  
## <a name="select-metrics-for-monitored-components"></a>Выбор метрик для наблюдаемых компонентов  
 Определив компоненты, подлежащие мониторингу, укажите метрики. Например, выбрав события для включения в трассировку, можно указать, какие именно данные требуются для анализа. Ограничив круг отслеживаемых данных можно сэкономить ресурсы системы, которые требуются для выполнения трассировки.  
  
## <a name="monitor-the-server"></a>Мониторинг работы сервера  
 Для наблюдения за сервером запустите средство мониторинга, настроенное для сбора данных. Например, определив трассировку, запустите ее, чтобы собрать данные о событиях, происходящих на сервере.  
  
## <a name="analyze-the-data"></a>Анализ данных  
 После окончания трассировки проанализируйте данные и попытайтесь понять, достигнута ли цель мониторинга. Если нет, измените компоненты или метрики, которые используются для мониторинга сервера.  
  
 Ниже описан процесс сбора данных о событиях и работа с ними.  
  
1.  Примените фильтры, чтобы ограничить объем собираемых данных о событиях.  
  
     Фильтры позволяют системе собирать данные только о тех событиях, которые имеют отношение к поставленной задаче мониторинга. Например, если требуется проконтролировать медленные запросы, с помощью фильтра можно собрать данные только о тех запросах к конкретной базе данных, которые выполняются более 30 секунд. Дополнительные сведения см. в статьях [Создание фильтра трассировки (Transact-SQL)](../../relational-databases/sql-trace/set-a-trace-filter-transact-sql.md) и [Фильтровать события в трассировке (приложение SQL Server Profiler)](../../tools/sql-server-profiler/filter-events-in-a-trace-sql-server-profiler.md).  
  
2.  Соберите данные о событиях.  
  
     После включения мониторинга собираются данные указанного приложения, экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]или операционной системы. Например, при мониторинге активности диска с помощью системного монитора собираются и отображаются на экране данные о событиях чтения и записи. Дополнительные сведения см. в статье [Наблюдение за использованием ресурсов (системный монитор)](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md).  
  
3.  Сохраните собранные данные о событиях.  
  
     Сохранение данных собираемых событий позволяет позже проанализировать их и даже воспроизвести в программе распределенного воспроизведения или в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]. Данные сохраняются в файле, который впоследствии можно загрузить обратно в средство, изначально создавшее этот файл для целей анализа. [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] позволяет сохранить данные о событиях в таблице [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Возможность сохранения играет важную роль при определении базового уровня производительности. Данные базового уровня производительности сохраняются и используются для сравнения с данными новых событий, что позволяет определить, является ли производительность оптимальной. Дополнительные сведения см. в статье [Шаблоны и разрешения приложения SQL Server Profiler](../../tools/sql-server-profiler/sql-server-profiler-templates-and-permissions.md).  
  
4.  Создайте шаблоны трассировки, содержащие параметры сбора событий.  
  
     Шаблоны трассировки включают определения самих событий, данных о событиях и фильтрах, которые применяются для сбора данных. Эти шаблоны применяются для мониторинга определенного набора событий в будущем и не требуют переопределения событий, данных и фильтров. Например, если часто приходится наблюдать за количеством взаимоблокировок и за тем, какие пользователи затронуты этими взаимоблокировками, можно создать шаблон, определив нужные события, данные событий и фильтры, и сохранить его в отдельном файле; впоследствии этот фильтр можно использовать для наблюдения за взаимоблокировками. [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] для этой цели используются шаблоны трассировки. Дополнительные сведения см. в статьях [Установка определения трассировки по умолчанию (приложение SQL Server Profiler)](../../tools/sql-server-profiler/set-trace-definition-defaults-sql-server-profiler.md) и [Создание шаблона трассировки (приложение SQL Server Profiler)](../../tools/sql-server-profiler/create-a-trace-template-sql-server-profiler.md).  
  
5.  Проанализируйте собранные данные о событиях.  
  
     Для анализа сохраненные данные загружаются в приложение, с помощью которого они были собраны. Например, трассировку, собранную приложением [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] , можно повторно загрузить в [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] для просмотра и анализа. Дополнительные сведения см. в статье [Просмотр и анализ трассировок с помощью приложения SQL Server Profiler](../../tools/sql-server-profiler/view-and-analyze-traces-with-sql-server-profiler.md).  
  
     Анализ данных подразумевает определение того, что происходит и почему. В зависимости от типа анализа эти сведения позволяют совершить действия, которые могут увеличить производительность, например добавить память, изменить индексы, исправить проблемы в коде инструкций Transact-SQL и хранимых процедур и т. п. Например, используя помощник по настройке компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] , можно проанализировать трассировку, записанную приложением [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] , и получить рекомендации по построению индексов.  
  
6.  Воспроизведите собранные данные о событиях.  
  
     Возможность воспроизведения позволяет создать копию базы данных, в которой были собраны данные, и повторить события, как будто они произошли в реальной системе. Это возможно только в программе распределенного воспроизведения или в приложении [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]. События можно воспроизводить с первоначальной скоростью, с максимально возможной скоростью (чтобы загрузить систему) или пошагово (чтобы проанализировать состояние системы после каждого события). Анализ событий в тестовой среде позволяет избежать повреждений в производственной системе. Дополнительные сведения см. в статье [Воспроизведение трассировок](../../tools/sql-server-profiler/replay-traces.md).  
  
  
