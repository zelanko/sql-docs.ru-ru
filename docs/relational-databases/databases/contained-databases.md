---
title: Автономные базы данных | Документация Майкрософт
ms.custom: ''
ms.date: 08/24/2016
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.component: databases
ms.reviewer: ''
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords:
- contained database
- database_uncontained_usage event
- partially contained database
- contained database, understanding
ms.assetid: 36af59d7-ce96-4a02-8598-ffdd78cdc948
caps.latest.revision: 37
author: stevestein
ms.author: sstein
manager: craigg
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 24e5cc8b801a80b754b7aaed9ab72b69ae9e93fc
ms.sourcegitcommit: 4183dc18999ad243c40c907ce736f0b7b7f98235
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2018
ms.locfileid: "43107977"
---
# <a name="contained-databases"></a>Автономные базы данных
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../includes/appliesto-ss-asdb-xxxx-xxx-md.md)]

  *Автономная база данных* — это база данных, изолированная от других баз данных и от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , на котором размещена эта база данных.  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] помогает пользователю изолировать свою базу данных от экземпляра четырьмя способами.  
  
-   Большая часть метаданных, описывающих базу данных, ведется в базе данных. (В дополнение или вместо хранения метаданных в базе данных master.)  
  
-   Все метаданные определяются с использованием одних и тех же параметров сортировки.  
  
-   База данных может выполнять проверку подлинности пользователей, что сокращает зависимость баз данных от имен входа экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
-   Среда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (динамические административные представления, XEvents и т. д.) предоставляет отчеты об автономности и может работать с ней.  
  
 Некоторые особенности частично автономных баз данных, например хранение метаданных в самой базе данных, относятся ко всем базам данных [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] . Некоторые преимущества частично автономных баз данных, например проверка подлинности на уровне базы данных или сортировка каталогов, необходимо включить, чтобы воспользоваться ими. Частичная автономность включается с помощью инструкций **CREATE DATABASE** и **ALTER DATABASE** или с использованием [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]. Дополнительные сведения о включении частичной автономности базы данных см. в разделе [Migrate to a Partially Contained Database](../../relational-databases/databases/migrate-to-a-partially-contained-database.md).  
  
##  <a name="Concepts"></a> Основные понятия частично автономных баз данных  
 Полностью автономная база данных содержит все параметры и метаданные, необходимые для определения базы данных, а ее конфигурация не зависит от экземпляра компонента [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , на котором устанавливается база данных. В предыдущих версиях [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]отделение базы данных от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] было трудоемким и требовало детальных знаний о взаимосвязи между базой данных и экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Частично автономные базы данных упрощают отделение базы данных от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и других баз данных.  
  
 В автономной базе данных функции предоставляются с учетом автономности. Любая определяемая пользователем сущность, использующая только расположенные в базе данных функции, считается полностью автономной. Любая определяемая пользователем сущность, использующая расположенные вне базы данных функции, считается неавтономной. (Дополнительные сведения см. в подразделе [Автономность](#containment) далее в этом разделе.)  
  
 В модели автономной базы данных применяются следующие термины.  
  
 Граница базы данных  
 Граница между базой данных и экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Граница между базой данных и другими базами данных.  
  
 Автономная  
 Элемент, существующий полностью в пределах базы данных.  
  
 Неавтономная  
 Элемент, пересекающий границы базы данных.  
  
 Неавтономная база данных  
 База данных, параметр автономности которой имеет значение **NONE**. Все базы данных, имеющие версии, предшествующие [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] , являются неавтономными. По умолчанию у всех баз данных в [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] и более поздних версий параметр автономности установлен в значение **NONE**.  
  
 Частично автономная база данных  
 Частично автономной базой данных является автономная база данных, в которой допускается пересечение границы базы данных определенными функциями. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] доступна возможность определения пересечения границы включения.  
  
 Автономный пользователь  
 Для автономных баз данных имеется два типа пользователей.  
  
-   **Пользователь автономной базы данных с паролем**  
  
     Проверку подлинности пользователей автономной базы данных с паролями выполняет база данных. Дополнительные сведения см. в разделе [Пользователи автономной базы данных — создание переносимой базы данных](../../relational-databases/security/contained-database-users-making-your-database-portable.md).  
  
-   **Участники Windows**  
  
     Авторизованные пользователи Windows и члены авторизованных групп Windows могут подключаться непосредственно к базе данных, для них не требуется имя входа в базе данных **master** . База данных возлагает проверку подлинности на Windows.  
  
 Пользователям, использующим имена входа базы данных **master** , можно предоставить доступ к автономной базе данных, но это приведет к зависимости от экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Поэтому при создании пользователей на основе имен входа см. примечание для частично автономных баз данных.  
  
> [!IMPORTANT]  
>  Включение частично автономных баз данных передает управление над доступом к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] владельцам базы данных. Дополнительные сведения см. в статье [Security Best Practices with Contained Databases](../../relational-databases/databases/security-best-practices-with-contained-databases.md).  
  
 Граница базы данных  
 Поскольку частично автономные базы данных отделяют функции базы данных от функций экземпляра, между этими элементами имеется явно определенная разграничительная линия, называемая *границей базы данных*.  
  
 Внутри границы базы данных находится *модель базы данных*, в которой выполняется разработка баз данных и управление этими базами данных. Примерами сущностей, находящихся внутри модели базы данных, служат такие системные таблицы, как **sys.table**, пользователи автономной базы данных с паролями, а также пользовательские таблицы в текущей базе данных, ссылаемые по двухкомпонентному имени.  
  
 Вне границы базы данных находится *модель управления*, хранящая функции и задачи управления на уровне экземпляра. Примерами сущностей, находящихся за границами базы данных, служат такие системные таблицы, как **sys.endpoints**, пользователи, сопоставленные с именами входа, а также пользовательские таблицы в другой базе данных, ссылаемые по трехкомпонентному имени.  
  
##  <a name="containment"></a> Автономность  
 Пользовательские сущности, целиком расположенные в базе данных, считаются *автономными*. Любые пользовательские сущности, находящиеся вне базы данных или взаимодействующие с функциями вне базы данных, считаются *неавтономными*.  
  
 Обычно пользовательские сущности подпадают в следующие категории включения.  
  
-   Полностью автономные пользовательские сущности (которые никогда не пересекают границу базы данных), например sys.indexes. Код, использующий эти функции или любые объекты, ссылающиеся только на эти сущности, является полностью автономным.  
  
-   Неавтономные пользовательские сущности (которые пересекают границу базы данных), например sys.server_principals или сам участник на уровне сервера (имя входа). Код, использующий эти сущности или любые функции, ссылающиеся на эти сущности, является неавтономным.  
  
###  <a name="partial"></a> Partially Contained Database  
 Автономная база данных в настоящее время доступна только в частично автономном состоянии. Частично автономной базой данных является автономная база данных, которая разрешает использование неавтономных функций.  
  
 Чтобы получить сведения о неавтономных объектах и функциях, используйте представления [sys.dm_db_uncontained_entities](../../relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql.md) и [sys.sql_modules (Transact-SQL)](../../relational-databases/system-catalog-views/sys-sql-modules-transact-sql.md). Определив состояние автономности элементов базы данных, вы можете узнать, какие объекты и функции необходимо заменить или изменить для обеспечения автономности.  
  
> [!IMPORTANT]  
>  Поскольку некоторые объекты по умолчанию имеют параметр автономности **NONE**, это представление может возвращать ложные положительные результаты.  
  
 Поведение частично автономных баз данных резко отличается от поведения неавтономных баз данных в отношении параметров сортировки. Дополнительные сведения о проблемах, связанных с параметрами сортировки, см. в разделе [Contained Database Collations](../../relational-databases/databases/contained-database-collations.md).  
  
##  <a name="benefits"></a> Преимущества использования частично автономных баз данных  
 Существуют связанные с неавтономными базами данных проблемы и трудности, которые можно разрешить путем использования частично автономной базы данных.  
  
### <a name="database-movement"></a>Перемещение базы данных  
 Одна из проблем, возникающих при перемещении баз данных, заключается в том, что часть важной информации может быть недоступна при перемещении базы данных с одного экземпляра на другой. Например, информация об именах входа хранится на экземпляре, а не в базе данных. При перемещении неавтономной базы данных с одного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]на другой эта информация остается на первом экземпляре. Необходимо определить, какая информация отсутствует, и перенести ее вместе с базой данных на новый экземпляр [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот процесс может быть сложным и занимать много времени.  
  
 В частично автономных базах данных важная информация может храниться в базе данных, в результате чего она останется в базе данных и после ее переноса.  
  
> [!NOTE]  
>  Частично автономный экземпляр базы данных может содержать документацию по используемым базой данных компонентам, которые нельзя отделить от экземпляра. Они включают список других взаимосвязанных баз данных, настройки системы, которые необходимы базе данных, но не могут быть автономными, и т. д.  
  
### <a name="benefit-of-contained-database-users-with-always-on"></a>Преимущества использования пользователей автономной базы данных в решениях AlwaysOn  
 Уменьшая привязку к экземпляру [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], частично автономные базы данных могут быть полезны при отработке отказа, если используется [!INCLUDE[ssHADR](../../includes/sshadr-md.md)].  
  
 Создание автономных пользователей позволяет им напрямую подключаться к автономной базе данных. Это крайне важная функция в сценариях высокого уровня доступности и восстановления после аварии, например при использовании решения AlwaysOn. Если пользователи являются автономными, то в случае отработки отказа они смогут подключиться к базе данных-получателю без создания имен входа на экземпляре, на котором она размещена. Выгода обеспечивается немедленно. Дополнительные сведения см. в разделах [Обзор групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) и [Предварительные требования, ограничения и рекомендации для групп доступности AlwaysOn (SQL Server)](../../database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability.md).  
  
### <a name="initial-database-development"></a>Первоначальная разработка баз данных  
 Поскольку разработчик может не знать, где будет развернута новая база данных, ограничение влияния разворачиваемой среды на базу данных уменьшает трудозатраты и сложности для разработчика. В неавтономной модели разработчик должен учитывать возможное влияние среды на новую базу данных и программировать в соответствии с ним. Однако при использовании частично автономных баз данных разработчики могут столкнуться с факторами, влияющими на базу данных на уровне экземпляра и связанными с этим проблемами.  
  
### <a name="database-administration"></a>Администрирование базы данных  
 Поддержка параметров базы данных в самой базе данных, а не в базе данных master, позволяет каждому владельцу базы данных лучше управлять собственными базами данных, при этом владельцам не требуется предоставлять разрешение **sysadmin** .  
  
##  <a name="Limitations"></a> Ограничения  
 В частично автономных базах данных не допускаются следующие функции.  
  
-   Частично автономные базы данных не могут использовать репликацию, систему отслеживания измененных данных или отслеживание изменений.  
  
-   Нумерованные процедуры  
  
-   Привязанные к схеме объекты, которые зависят от встроенных функций с изменениями параметров сортировки  
  
-   Изменение привязки в результате изменений параметров сортировки, включая ссылки на объекты, столбцы, символы или типы.  
  
-   Репликация, система отслеживания измененных данных и отслеживание изменений.  
  
> [!WARNING]  
>  В данный момент разрешено использование временных хранимых процедур. Так как временные хранимые процедуры нарушают изоляцию, в будущих версиях автономной базы данных их поддержки не будет.  
  
##  <a name="Identifying"></a> Определение состояния включения базы данных  
 Для определения состояния автономности базы данных можно использовать два средства. Представление [sys.dm_db_uncontained_entities (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql.md) показывает все потенциально неавтономные сущности в базе данных. Событие database_uncontained_usage происходит, если во время выполнения найдена любая фактическая неавтономная сущность.  
  
### <a name="sysdmdbuncontainedentities"></a>sys.dm_db_uncontained_entities  
 Это представление содержит все сущности базы данных, которые потенциально могут быть неавтономными, например пересекающие границу базы данных. К ним относятся пользовательские сущности, которые могут использовать объекты вне модели базы данных. Однако, так как включение некоторых сущностей (например, использующих динамический SQL) невозможно определить до времени выполнения, в представлении могут отображаться некоторые сущности, которые фактически не являются неавтономными. Дополнительные сведения см. в разделе [sys.dm_db_uncontained_entities (Transact-SQL)](../../relational-databases/system-dynamic-management-views/sys-dm-db-uncontained-entities-transact-sql.md).  
  
### <a name="databaseuncontainedusage-event"></a>событие database_uncontained_usage  
 Это событие XEvent возникает, когда во время выполнения обнаруживается любая фактически неавтономная сущность. Учитываются и сущности, формируемые в клиентском коде. Это событие XEvent возникает только для фактически неавтономных сущностей. Однако это событие происходит только во время выполнения. Поэтому любые неавтономные пользовательские сущности, которые не будут запущены, не обнаруживаются данным событием Xevent.  
  
## <a name="see-also"></a>См. также:  
 [Измененные функции (автономная база данных)](../../relational-databases/databases/modified-features-contained-database.md)   
 [Параметры сортировки автономной базы данных](../../relational-databases/databases/contained-database-collations.md)   
 [Security Best Practices with Contained Databases](../../relational-databases/databases/security-best-practices-with-contained-databases.md)   
 [Migrate to a Partially Contained Database](../../relational-databases/databases/migrate-to-a-partially-contained-database.md)   
 [Пользователи автономной базы данных — создание переносимой базы данных](../../relational-databases/security/contained-database-users-making-your-database-portable.md)  
  
  
