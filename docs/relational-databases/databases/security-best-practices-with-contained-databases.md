---
title: "Рекомендации по защите автономных баз данных | Документация Майкрософт"
ms.custom: 
ms.date: 03/14/2016
ms.prod: sql-non-specified
ms.prod_service: database-engine, sql-database
ms.service: 
ms.component: databases
ms.reviewer: 
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- contained database, threats
ms.assetid: 026ca5fc-95da-46b6-b882-fa20f765b51d
caps.latest.revision: 
author: stevestein
ms.author: sstein
manager: craigg
ms.workload: Inactive
ms.openlocfilehash: c18410a29b500b3fd4fadfac987b1e94503ec7bb
ms.sourcegitcommit: dcac30038f2223990cc21775c84cbd4e7bacdc73
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2018
---
# <a name="security-best-practices-with-contained-databases"></a>Рекомендации по обеспечению безопасности автономных баз данных
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

  С автономными базами данных связаны некоторые уникальные угрозы, о которых администраторы [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] должны знать (и принимать меры по их устранению). Большая часть угроз связана с процессом проверки подлинности **USER WITH PASSWORD** , который перемещает границу проверки подлинности с уровня компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] на уровень базы данных.  
  
## <a name="threats-related-to-users"></a>Угрозы, связанные с пользователями  
 Пользователям автономной базы данных, имеющим разрешение **ALTER ANY USER** , таким как члены предопределенных ролей базы данных **db_owner** и **db_securityadmin** , может быть предоставлен доступ к базе данных без ведома или разрешения администратора [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Предоставление пользователям доступа к автономной базе данных увеличивает контактную зону возможной атаки на всем экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Администраторы должны понимать это делегирования контроля доступа и должны быть очень осторожными при предоставлении пользователям в автономной базе данных разрешения **ALTER ANY USER** . Все владельцы базы данных обладают разрешением **ALTER ANY USER** . [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должны периодически проводить аудит пользователей в автономной базе данных.  
  
### <a name="accessing-other-databases-using-the-guest-account"></a>Доступ к другим базам данных с использованием гостевой учетной записи  
 Владельцы и пользователи базы данных, имеющие разрешение **ALTER ANY USER** , могут создавать пользователей автономной базы данных. После соединения с автономной базой данных в экземпляре [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]пользователь автономной базы данных имеет доступ к другим базам данных в [!INCLUDE[ssDE](../../includes/ssde-md.md)], если в других базах данных включена **гостевая** учетная запись.  
  
### <a name="creating-a-duplicate-user-in-another-database"></a>Создание повторяющегося пользователя в другой базе данных  
 Для некоторых приложений может оказаться необходимым, чтобы пользователь имел доступ к более чем одной базе данных. Это можно сделать путем создания идентичных пользователей автономной базы данных в каждой базе данных. При создании второй учетной записи пользователя, защищенной паролем, используйте параметр идентификатора безопасности. В следующем примере создается два идентичных пользователя в двух базах данных.  
  
```  
USE DB1;  
GO  
CREATE USER Carlo WITH PASSWORD = '<strong password>';   
-- Return the SID of the user  
SELECT SID FROM sys.database_principals WHERE name = 'Carlo';  
  
-- Change to the second database  
USE DB2;  
GO  
CREATE USER Carlo WITH PASSWORD = '<same password>', SID = <SID from DB1>;  
GO  
```  
  
 Для выполнения межбазового запроса необходимо установить параметр **TRUSTWORTHY** в вызывающей базе данных. Например, если определенный выше пользователь (Carlo) находится в базе данных DB1 для выполнения запроса `SELECT * FROM db2.dbo.Table1;` , то параметр **TRUSTWORTHY** должен быть включен для базы данных DB1. Чтобы включить параметр **TRUSTWORTHY** , выполните следующий код:  
  
```  
ALTER DATABASE DB1 SET TRUSTWORTHY ON;  
```  
  
### <a name="creating-a-user-that-duplicates-a-login"></a>Создание пользователя с повторяющимся именем входа  
 Если при создании пользователя автономной базы данных с паролем в качестве имени пользователя было использовано имя входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и пользователь с именем входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в запросе на подключение указывает автономную базу данных в качестве исходного каталога, то пользователь с именем входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] подключиться не сможет. Соединение будет оцениваться как пользователь (участник) автономной базы данных с паролем автономной базы данных, а не пользователь на основе имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Это может вызвать намеренный или случайный отказ в обслуживании для имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
-   Согласно рекомендациям, члены предопределенной роли сервера **sysadmin** должны всегда рассматривать соединение без использования параметра исходного каталога. Это вызывает подключение имени входа к базе данных master и предотвращает попытки владельца базы данных неправильно использовать попытку входа. Затем администратор может выполнить переключение на автономную базу данных с помощью инструкции **USE***\<база данных>*. Можно также установить в качестве базы данных по умолчанию автономную базу данных, которая выполняет вход в базу данных **master**, а затем переносит вход на автономную базу данных.  
  
-   Рекомендуется не создавать пользователей автономной базы данных с паролями, имена которых совпадают с именами входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
  
-   Если существует дублированное имя входа, выполните подключение к базе данных **master** без указания исходного каталога, а затем выполните команду **USE** , чтобы переключиться в автономную базу данных.  
  
-   При наличии автономных баз данных пользователи баз данных, не являющихся автономными, должны подключаться к [!INCLUDE[ssDE](../../includes/ssde-md.md)] , указывая в качестве исходного каталога имя неавтономной базы данных или вообще не указывая исходный каталог. Это предотвращает соединение с автономной базой данных, которая находится под меньшим контролем администратора компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] .  
  
### <a name="increasing-access-by-changing-the-containment-status-of-a-database"></a>Увеличение доступа путем изменения состояния включения базы данных  
 Имена входа, которые имеют разрешение **ALTER ANY DATABASE** , такие как члены предопределенной роли сервера **dbcreator** и пользователи неавтономной базы данных, с разрешением **CONTROL DATABASE** , такие как члены предопределенной роли базы данных **db_owner** , могут изменять параметр включения базы данных. При изменении параметра включения базы данных с **NONE** на **PARTIAL** или **FULL**пользователю может быть предоставлен доступ путем создания пользователей автономной базы данных с паролями. В результате можно предоставить доступ без ведома или согласия администраторов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Чтобы предотвратить появление автономных баз данных, присвойте параметру **проверка подлинности автономной базы данных** компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)] значение 0. Для предотвращения подключения пользователей автономной базы данных с паролями к выбранным автономным базам данных, используйте триггеры входа для отмены попыток входа пользователей автономной базы данных с паролями.  
  
### <a name="attaching-a-contained-database"></a>Присоединение автономной базы данных  
 При присоединении автономной базы данных администратор может предоставить нежелательным пользователям доступ к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]. Для предотвращения такого риска администратор может перевести базу данных в состояние "в сети" в режиме **RESTRICTED USER** , в результате чего пользователи автономной базы данных с паролями не смогут пройти проверку подлинности. Доступ к компоненту [!INCLUDE[ssDE](../../includes/ssde-md.md)]смогут получить только участники, авторизованные через имена входа.  
  
 Пользователи создаются с учетом требований к паролю, действительных в момент их создания, и при присоединении базы данных повторная проверка паролей не производится. При присоединении автономной базы данных, допускающей простые пароли к системе с более строгой политикой паролей, администратор может разрешить пароли, которые не соответствуют текущей политике паролей присоединяемого компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]. Администраторы могут запретить сохранение простых паролей с помощью требования переустановки всех паролей в присоединенной базе данных.  
  
### <a name="password-policies"></a>Политики паролей  
 Можно потребовать, чтобы пароли в базе данных были надежными, но защитить их надежными политиками паролей нельзя. По возможности используйте проверку подлинности Windows, чтобы использовать преимущества более сложных политик паролей, доступных в Windows.  
  
### <a name="kerberos-authentication"></a>Проверка подлинности Kerberos  
 Пользователи автономной базы данных с паролями не могут использовать проверку подлинности Kerberos. По возможности используйте проверку подлинности Windows, чтобы использовать преимущества таких возможностей Windows, как Kerberos.  
  
### <a name="offline-dictionary-attack"></a>Атака вне сети перебором по словарю  
 Хэши паролей для пользователей автономной базы данных с паролями хранятся в автономной базе данных. Любое лицо с доступом к базе данных может выполнить атаку перебором по словарю против пользователей автономной базы данных с паролями в системе без аудита. Чтобы устранить эту угрозу, ограничьте доступ к файлам базы данных или разрешите подключение к автономным базам данных только с использованием проверки подлинности Windows.  
  
## <a name="escaping-a-contained-database"></a>Экранирование автономной базы данных  
 Если база данных является частично автономной, то администраторы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] должны периодически выполнять аудит возможностей пользователей и модулей в автономных базах данных.  
  
## <a name="denial-of-service-through-autoclose"></a>Отказ в обслуживании через параметр AUTO_CLOSE  
 Не настраивайте автономную базу данных на автоматическое закрытие. Если закрыть базу данных, ее открытие для проверки подлинности пользователя будет связано с потреблением дополнительных ресурсов, что может стать объектом атаки типа «отказ в обслуживании».  
  
## <a name="see-also"></a>См. также:  
 [Автономные базы данных](../../relational-databases/databases/contained-databases.md)   
 [Миграция на частично автономную базу данных](../../relational-databases/databases/migrate-to-a-partially-contained-database.md)  
  
  
