---
description: CDC. &lt; &gt;_CT capture_instance (Transact-SQL)
title: CDC. &lt; capture_instance &gt; _CT (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 05/01/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- cdc
- cdc_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- cdc.<capture_instance>_CT
ms.assetid: 979c8110-3c54-4e76-953c-777194bc9751
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: c6f91c8064316c8d1fa94b88a4a5c123a652cb5f
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88454778"
---
# <a name="cdcltcapture_instancegt_ct-transact-sql"></a>CDC. &lt; &gt;_CT capture_instance (Transact-SQL)
[!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

  Таблица изменений, созданная при включении системы отслеживания измененных данных в исходной таблице. Эта таблица содержит по одной строке для каждой операции вставки и удаления в исходной таблице и по две строки для каждой операции обновления в исходной таблице. Если имя таблицы изменений не задано при включении исходной таблицы, создается производное имя. Имя имеет формат CDC. *capture_instance*_CT, где *capture_instance* — имя схемы исходной таблицы и имя исходной таблицы в формате *schema_table*. Например, если таблица **Person. адрес** в образце базы данных **AdventureWorks** включена для отслеживания измененных данных, то производное имя таблицы изменений будет храниться в **CDC. Person_Address_CT**.  
  
 Рекомендуется **не выполнять запросы к системным таблицам напрямую**. Вместо этого выполните функции [CDC. fn_cdc_get_all_changes_<capture_instance>](../../relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql.md) и [cdc. fn_cdc_get_net_changes_<capture_instance ](../../relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql.md)>.  
  

  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|**__$start_lsn**|**binary(10)**|Регистрационный номер транзакции в журнале (LSN), связанный с фиксацией транзакции изменения.<br /><br /> Все изменения, зафиксированные в одной транзакции, имеют общий номер LSN фиксации. Например, если операция удаления в исходной таблице удаляет две строки, таблица изменений будет содержать две строки с одинаковым значением **__ $ start_lsn** .|  
|**__ $ end_lsn**|**binary(10)**|[!INCLUDE[ssInternalOnly](../../includes/ssinternalonly-md.md)]<br /><br /> В [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] этот столбец всегда имеет значение NULL.|  
|**__$seqval**|**binary(10)**|Значение последовательности, используемое для упорядочивания изменений строк в пределах транзакции.|  
|**__$operation**|**int**|Определяет операцию языка обработки данных (DML), связанную с изменением. Может применяться один из перечисленных ниже типов.<br /><br /> 1 = удаление<br /><br /> 2 = вставка<br /><br /> 3 = обновление (старые значения)<br /><br /> Перед выполнением инструкции обновления в данных столбца содержатся эти значения строк.<br /><br /> 4 = обновление (новые значения)<br /><br /> После выполнения инструкции обновления в данных столбца содержатся эти значения строк.|  
|**__$update_mask**|**varbinary(128)**|Битовая маска, основанная на порядковых номерах измененных столбцов в таблице изменений.|  
|*\<captured source table columns>*|непостоянно|Остальные столбцы в таблице изменений — это столбцы из исходной таблицы, определенные, как отслеживаемые при создании экземпляра отслеживания. Если в списке отслеживаемых столбцов не указано ни одного столбца, в эту таблицу включаются все столбцы из исходной таблицы.|  
|**__ $ command_id** |**int** |Отслеживает порядок операций в рамках транзакции. |  
  
## <a name="remarks"></a>Комментарии  

Столбец `__$command_id` был представлен в накопительном обновлении в версиях 2012 – 2016. Сведения о версии и загрузке см. в статье базы знаний 3030352 в [исправлении: таблица изменений неправильно упорядочивается для обновленных строк после включения системы отслеживания измененных данных для Microsoft SQL Server базы данных](https://support.microsoft.com/help/3030352/fix-the-change-table-is-ordered-incorrectly-for-updated-rows-after-you).  Дополнительные сведения см. в разделе [функция CDC может прерываться после обновления до последней версии Cu для SQL Server 2012, 2014 и 2016](https://blogs.msdn.microsoft.com/sql_server_team/cdc-functionality-may-break-after-upgrading-to-the-latest-cu-for-sql-server-2012-2014-and-2016/).

## <a name="captured-column-data-types"></a>Типы данных отслеживаемых столбцов  
 Отслеживаемые столбцы, включенные в эту таблицу, имеют те же типы данных и значения, что и соответствующие им столбцы в исходной таблице, за следующими исключениями.  
  
-   Столбцы **отметок времени** определены как **двоичные (8)**.  
  
-   Столбцы **идентификаторов** определяются как **int** или **bigint**.  
  
 Однако значения этих столбцов совпадают со значениями столбцов в исходной таблице.  
  
### <a name="large-object-data-types"></a>Типы данных больших объектов  
 Столбцам типа данных **Image**, **Text**и **ntext** всегда присваивается значение **null** , если __ $ operation = 1 или \_ \_ $Operation = 3. Столбцам типа данных **varbinary (max)**, **varchar (max)** или **nvarchar (max)** присваивается значение **null** при \_ \_ $Operation = 3, если только столбец не изменился во время обновления. Если \_ \_ $Operation = 1, этим столбцам присваиваются значения во время удаления. Вычисленные столбцы, которые включены в экземпляр отслеживания, всегда имеют значение **null**.  
  
 По умолчанию максимальный объем данных, которые можно добавить в столбец, отслеженный с помощью одной инструкции INSERT, UPDATE, WRITETEXT или UPDATETEXT, не должен превышать 65 536 байт или 64 КБ. Чтобы увеличить этот размер для поддержки больших объемов данных LOB, используйте [параметр конфигурации сервера max text repl size](../../database-engine/configure-windows/configure-the-max-text-repl-size-server-configuration-option.md) , чтобы указать больший максимальный размер. Дополнительные сведения см. в статье [Настройка параметра конфигурации сервера max text repl size](../../database-engine/configure-windows/configure-the-max-text-repl-size-server-configuration-option.md).  
  
## <a name="data-definition-language-modifications"></a>Изменения, внесенные с помощью языка DDL  
 Изменения DDL в исходной таблице, такие как добавление или удаление столбцов, записываются в таблицу [CDC. ddl_history](../../relational-databases/system-tables/cdc-ddl-history-transact-sql.md) . Эти изменения не применяются к таблице изменений. То есть определение таблицы изменений остается постоянным. При вставке строк в таблицу изменений процесс отслеживания не учитывает столбцы, которые не появляются в списке отслеживаемых столбцов, связанных с исходной таблицей. Если в списке отслеживаемых столбцов появляется столбец, больше не присутствующий в исходной таблице, этому столбцу присваивается значение NULL.  
  
 Изменение типа данных столбца в исходной таблице также записывается в таблицу [CDC. ddl_history](../../relational-databases/system-tables/cdc-ddl-history-transact-sql.md) . Тем не менее, это изменение не затрагивает определение таблицы изменений. Тип данных отслеживаемого столбца в таблице изменений меняется, если процесс отслеживания найдет запись журнала, относящуюся к изменению на языке DDL, внесенному в исходную таблицу.  
  
 Если нужно изменить тип данных отслеживаемого столбца в исходной таблице способом, который сократил бы размер этого типа данных, используется следующая процедура, которая обеспечивает успешное изменение соответствующего столбца в таблице изменений.  
  
1.  В исходной таблице обновите значения изменяемого столбца, чтобы они соответствовали нужному размеру типа данных. Например, если изменить тип данных с **int** на **smallint**, обновите значения до размера, который соответствует диапазону **smallint** , от-32 768 до 32 767.  
  
2.  В таблице изменений выполните такую же операцию обновления в эквивалентном столбце.  
  
3.  Измените исходную таблицу, задав новый тип данных. Изменение типа данных распространяется на таблицу изменений.  

## <a name="data-manipulation-language-modifications"></a>Изменения, внесенные с помощью языка обработки данных  
 При выполнении операций вставки, обновления и удаления в исходной таблице с включенной системой отслеживания измененных данных записи об этих операциях DML фиксируются в журнале транзакций базы данных. Процесс отслеживания измененных данных извлекает сведения об этих изменениях из журнала транзакций и добавляет одну или две строки в таблицу изменений для записи изменений. Записи добавляются в таблицу изменений в том же порядке, в каком они были зафиксированы в исходной таблице, однако фиксация записей таблицы изменений, как правило, выполняется для группы изменений, а не для отдельной записи.  
  
 В записи таблицы изменений столбец **__ $ start_lsn** используется для записи номера LSN фиксации, связанного с изменением в исходной таблице, а **столбец __ $ seqval** используется для упорядочивания изменений в своей транзакции. С помощью этих столбцов метаданных в совокупности можно обеспечить сохранность порядка фиксации исходных изменений. Поскольку сведения об изменениях в процессе отслеживания извлекаются из журнала транзакций, важно отметить, что записи таблицы изменений не отображаются синхронно с соответствующими изменениями в исходной таблице. Вместо этого, такие изменения отображаются асинхронно после того, как процессом отслеживания обработаны соответствующие записи об изменениях из журнала транзакций.  
  
 Для операций вставки и удаления устанавливаются все биты в маске обновления. Для операций обновления маска обновления как в старой строке обновления, так и в новой меняется, чтобы отразить столбцы, изменившиеся во время обновления.  
  
## <a name="see-also"></a>См. также  
 [sys. sp_cdc_enable_table &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql.md)   
 [sys. sp_cdc_get_ddl_history &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql.md)  
  
  
