---
title: bcp_colfmt | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
apiname:
- bcp_colfmt
apilocation:
- sqlncli11.dll
apitype: DLLExport
helpviewer_keywords:
- bcp_colfmt function
ms.assetid: 5c3b6299-80c7-4e84-8e69-4ff33009548e
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: 857022f04047178f9eaf2db2c59d2d99987afbaa
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "73783149"
---
# <a name="bcp_colfmt"></a>bcp_colfmt
[!INCLUDE[appliesto-ss-asdb-asdw-pdw-md](../../includes/appliesto-ss-asdb-asdw-pdw-md.md)]

  Указывает исходный или целевой формат данных в пользовательском файле. При использовании в качестве исходного формата **bcp_colfmt** задает формат существующего файла данных, используемого в качестве источника данных при выполнении операции с массовым копированием в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] таблицу. При использовании в качестве целевого формата файл данных создается с использованием форматов столбцов, указанных в **bcp_colfmt**.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
RETCODE bcp_colfmt (  
        HDBC hdbc,  
        INT idxUserDataCol,  
        BYTE eUserDataType,  
        INT cbIndicator,  
        DBINT cbUserData,  
        LPCBYTE pUserDataTerm,  
        INT cbUserDataTerm,  
        INT idxServerCol);  
```  
  
## <a name="arguments"></a>Аргументы  
 *hdbc*  
 Дескриптор соединения ODBC с поддержкой массового копирования.  
  
 *idxUserDataCol*  
 Порядковый номер столбца в пользовательском файле данных, для которого указывается формат. Первый столбец имеет номер 1.  
  
 *eUserDataType*  
 Тип данных этого столбца в файле пользователя. Если это отличается от типа данных соответствующего столбца в таблице базы данных (*идкссерверколумн*), то при выполнении операции по возможности по мере их выполнения операция по мере их преобразования будет преобразована.  
  
 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]Добавлена поддержка токенов типа данных SQLXML и SQLUDT в параметре *еусердататипе* .  
  
 Параметр *еусердататипе* перечисляется маркерами типа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] данных в sqlncli. h, а не в перечислителях типа данных ODBC C. Например, можно указать символьную строку SQL_C_CHAR типа ODBC с помощью специфического для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] типа SQLCHARACTER.  
  
 Чтобы задать представление данных по умолчанию для типа данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , установите этот параметр в значение 0.  
  
 Для полного копирования из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] в файл, если *ЕУСЕРДАТАТИПЕ* имеет значение SQLDECIMAL или SQLNUMERIC:  
  
-   Если исходный столбец не является **десятичным** или **числовым**, используются точность и масштаб по умолчанию.  
  
-   Если исходный столбец имеет тип **Decimal** или **numeric**, то используются точность и масштаб исходного столбца.  
  
 *cbIndicator*  
 Длина в байтах признака длины и допустимости значений NULL в данных столбца. Допускаются следующие значения длины признака: 0 (если признак не используется), 1, 2, 4 или 8.  
  
 Чтобы задать для признака массового копирования использование по умолчанию, установите этот параметр в значение SQL_VARLEN_DATA.  
  
 Признаки располагаются в памяти непосредственно перед данными, а в файле данных — непосредственно перед данными, к которым они применяются.  
  
 Если для столбца файла данных используется несколько способов задания длины (например, признак и максимальная длина столбца или признак и последовательность-признак конца), то для массового копирования выбирается способ, применение которого вызовет копирование данных наименьшего объема.  
  
 Если пользователь не изменяет формат данных, то создаваемые при массовом копировании файлы данных содержат признаки, которые определяют, когда столбец может принимать значение NULL или его данные имеют переменную длину.  
  
 *cbUserData*  
 Максимальная длина в байтах данных в столбце пользовательского файла, не включая длину признака длины или признака конца.  
  
 Если для параметра *cbUserData* задано значение SQL_NULL_DATA, то все значения в столбце файла данных должны быть или равны NULL.  
  
 Установка параметра *cbUserData* в значение SQL_VARLEN_DATA указывает, что система должна определить длину данных в каждом столбце. Для некоторых столбцов это может означать, что создаваемые признаки длины и допустимости значений NULL предваряют данные при копировании из [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], или ожидается их наличие в данных, копируемых в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].  
  
 Для [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] символьных и двоичных типов данных *cbUserData* может быть SQL_VARLEN_DATA, SQL_NULL_DATA, 0 или положительным значением. Если *cbUserData* SQL_VARLEN_DATA, система использует либо индикатор длины, если он присутствует, либо последовательность признаков конца для определения длины данных. Если задан и признак длины, и последовательность признака конца, то при массовом копировании используется значение, применение которого вызывает копирование данных наименьшего объема. Если *cbUserData* имеет SQL_VARLEN_DATA, то типом данных является [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] символьный или двоичный тип, и не указан ни индикатор длины, ни последовательность признаков конца, система возвращает сообщение об ошибке.  
  
 Если значение *cbUserData* больше или равно 0, то система рассматривает значение *cbUserData* как максимальную длину данных. Но если в дополнение к положительному значению для *cbUserData*указан признак длины или последовательность признака конца, то система определяет объем данных методом, который приведет к копированию наименьшего объема данных.  
  
 Значение *cbUserData* представляет объем данных в байтах. Если символьные данные представлены строкой знаков в Юникоде, то положительное значение параметра *cbUserData* представляет количество символов, умноженное на размер символа в байтах.  
  
 *pUserDataTerm*  
 Последовательность-признак конца, используемая для этого столбца. Этот параметр предназначен главным образом для символьных типов данных, поскольку все другие типы имеют фиксированную длину или, как в случае с двоичными данными, требуют наличия признака длины, в котором записано точное число присутствующих байтов.  
  
 Чтобы исключить обработку признака конца в извлекаемых данных или указать, что данные в файле пользователя не имеют признака конца, установите этот параметр в значение NULL.  
  
 Если для столбца файла пользователя используется несколько способов задания длины (например, признак конца и признак длины или признак конца и максимальная длина столбца), то для массового копирования выбирается способ, применение которого вызывает копирование данных наименьшего объема.  
  
 При необходимости API-интерфейс массового копирования выполнит преобразование символов из Юникода в многобайтовую кодировку (MBCS). Обратите особое внимание, правильно ли задана строка байтов, служащая признаком конца, а также ее длина.  
  
 *cbUserDataTerm*  
 Длина в байтах последовательности-признака конца, используемой для этого столбца. Если в данных признак конца отсутствует или нежелателен, то установите это значение в 0.  
  
 *idxServerCol*  
 Порядковый номер столбца в таблице базы данных. Первый столбец имеет номер 1. Порядковый номер столбца возвращается функцией [SQLColumns](../../relational-databases/native-client-odbc-api/sqlcolumns.md).  
  
 Если это значение равно 0, операция массового копирования пропускает столбец в файле данных.  
  
## <a name="returns"></a>Результаты  
 SUCCEED или FAIL.  
  
## <a name="remarks"></a>Remarks  
 Функция **bcp_colfmt** позволяет указать формат пользовательского файла для операций с массовым копированием. Формат для массового копирования состоит из следующих частей:  
  
-   сопоставление столбцов файла пользователя со столбцами базы данных;  
  
-   тип данных каждого столбца в файле пользователя;  
  
-   длина дополнительного признака для каждого столбца;  
  
-   максимальная длина данных в каждом столбце файла пользователя;  
  
-   дополнительная последовательность байт, служащая признаком конца для каждого столбца;  
  
-   длина дополнительной последовательности байт, служащей признаком конца.  
  
 Каждый вызов **bcp_colfmt** задает формат для одного столбца пользовательского файла. Например, чтобы изменить параметры по умолчанию для трех столбцов в файле пользовательских данных, состоящий из пяти столбцов, сначала вызовите [bcp_columns](../../relational-databases/native-client-odbc-extensions-bulk-copy-functions/bcp-columns.md)**(5)**, а затем вызовите **bcp_colfmt** пять раз, и три из этих вызовов задавая свой собственный формат. Для оставшихся двух вызовов задайте для *еусердататипе* значение 0, а для свойств *кбиндикатор*, *cbUserData*и *кбусердататерм* — 0, SQL_VARLEN_DATA и 0 соответственно. Эта процедура копирует все пять столбцов. Для трех применяется заданный измененный формат, а для двух оставшихся — формат по умолчанию.  
  
 Для *кбиндикатор*значение 8 означает, что тип больших значений теперь является допустимым. Если для поля, которому соответствует столбец с новым типом max, указан префикс, его значение можно установить только в 8. Дополнительные сведения см. в разделе [bcp_bind](../../relational-databases/native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md).  
  
 Функция **bcp_columns** должна вызываться перед вызовами функции **bcp_colfmt**.  
  
 Необходимо вызвать **bcp_colfmt** один раз для каждого столбца в файле пользователя.  
  
 Вызов **bcp_colfmt** более одного раза для любого столбца файла пользователя приводит к ошибке.  
  
 Нет необходимости копировать все данные из пользовательского файла в таблицу [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Чтобы пропустить столбец, укажите формат данных для этого столбца, установив для параметра *idxServerCol* значение 0. Если требуется пропустить столбец, необходимо указать его тип.  
  
 Для сохранения спецификации формата можно воспользоваться функцией [bcp_writefmt](../../relational-databases/native-client-odbc-extensions-bulk-copy-functions/bcp-writefmt.md) .  
  
## <a name="bcp_colfmt-support-for-enhanced-date-and-time-features"></a>Поддержка функцией bcp_colfmt улучшенных возможностей даты и времени  
 Дополнительные сведения о типах, используемых с параметром *еусердататипе* для типов даты и времени, см. в разделе " [изменения в ходе операции копирования для расширенных типов даты и времени &#40;OLE DB и ODBC&#41;](../../relational-databases/native-client-odbc-date-time/bulk-copy-changes-for-enhanced-date-and-time-types-ole-db-and-odbc.md).  
  
 Дополнительные сведения см. в разделе [улучшения даты и времени &#40;&#41;ODBC ](../../relational-databases/native-client-odbc-date-time/date-and-time-improvements-odbc.md).  
  
## <a name="see-also"></a>См. также:  
 [Bulk Copy Functions](../../relational-databases/native-client-odbc-extensions-bulk-copy-functions/sql-server-driver-extensions-bulk-copy-functions.md)  
  
  
