---
title: Определение и изменение фильтра соединения между статьями публикации слиянием | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- filters [SQL Server replication], join
- merge replication join filters [SQL Server replication]
- modifying filters, join
- join filters
ms.assetid: f7f23415-43ff-40f5-b3e0-0be1d148ee5b
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: d695ccd9545c6bc839edcc1b0644c1f1a4d84ab8
ms.sourcegitcommit: 8732161f26a93de3aa1fb13495e8a6a71519c155
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2019
ms.locfileid: "71710905"
---
# <a name="define-and-modify-a-join-filter-between-merge-articles"></a>Определение и изменение фильтра соединения между статьями публикации слиянием
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  В этом разделе описывается определение и изменение фильтра соединения между статьями публикации слиянием в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] при помощи среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)]. Репликация слиянием поддерживает фильтры соединения, которые обычно используются совместно с параметризованными фильтрами для распространения секционирования таблиц на все связанные статьи таблиц.  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Рекомендации](#Recommendations)  
  
-   **Для определения и изменения фильтра соединения между статьями публикации слиянием используется:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Чтобы создать фильтр соединения, публикация должна содержать не менее двух связанных таблиц. Фильтр соединения расширяет фильтр строк, и поэтому следует задать фильтр строк для одной таблицы перед тем, как можно будет расширять фильтр соединением с другой таблицей. После того как будет определен один фильтр соединения, его можно расширить еще одним фильтром соединения, если публикация содержит другие связанные таблицы.  
  
-   Если добавление, изменение или удаление фильтра соединения выполняется после инициализации подписок на публикацию, следует создать новый моментальный снимок и повторно инициализировать все подписки после внесения изменений. Дополнительные сведения о требованиях к изменениям свойств см. в статье [Изменение свойств публикации и статьи](../../../relational-databases/replication/publish/change-publication-and-article-properties.md).  
  
###  <a name="Recommendations"></a> Рекомендации  
  
-   Фильтры соединения можно создать вручную для набора таблиц, или же репликация может создать эти фильтры автоматически, основываясь на связях между внешними ключами и первичными ключами, заданных в таблицах. Дополнительные сведения об автоматическом создании набора фильтров соединения см. в статье [Автоматическое создание фильтров соединения между статьями публикации слиянием](../../../relational-databases/replication/publish/automatically-generate-join-filters-between-merge-articles.md).  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
 Операции определения, изменения и удаления фильтров соединения выполняются на странице **Фильтрация строк таблицы** мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<публикация>** . Дополнительные сведения об использовании мастера и доступе к этому диалоговому окну см. в статьях [Создание публикации](../../../relational-databases/replication/publish/create-a-publication.md) и [Просмотр и изменение свойств публикации](../../../relational-databases/replication/publish/view-and-modify-publication-properties.md).  
  
#### <a name="to-define-a-join-filter"></a>Определение фильтра соединения  
  
1.  На странице **Фильтрация строк таблицы** мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<публикация>** выберите существующий фильтр строк или фильтр соединения в области **Отфильтрованные таблицы**.  
  
2.  Щелкните **Добавить**и выберите **Добавить соединение для расширения выбранного фильтра**.  
  
3.  Создайте инструкцию соединения: выберите либо **Использовать построитель для создания инструкции** , либо **Создать инструкцию соединения вручную**.  
  
    -   Если решено применить конструктор, то для создания инструкции соединения используйте столбцы в сетке (**Сопряжение**, **Фильтруемый столбец таблицы**, **Оператор**и **Столбец соединяемой таблицы**).  
  
         Каждый столбец в сетке содержит раскрывающийся список для выбора двух столбцов и оператора ( **=** , **<>** , **<=** , **\<** , **>=** , **>** и **like**). Результаты выводятся в текстовом поле **Предварительный просмотр** . Если в соединении участвует более двух столбцов, выберите логику (AND или OR) из столбца **Сопряжение** , а затем введите еще два столбца и оператор.  
  
    -   Если нужно написать инструкцию вручную, введите ее в текстовом поле **Инструкция соединения** . Используйте списки **Столбцы фильтруемой таблицы** и **Столбцы соединяемой таблицы** , перетягивая из них поля в текстовое поле **Инструкция соединения** .  
  
    -   Полная инструкция соединения будет выглядеть таким образом:  
  
        ```  
        SELECT <published_columns> FROM [Sales].[SalesOrderHeader] INNER JOIN [Sales].[SalesOrderDetail] ON [SalesOrderHeader].[SalesOrderID] = [SalesOrderDetail].[SalesOrderID]  
        ```  
  
         В предложении JOIN необходимо использовать имена, состоящие их двух частей; имена, состоящие из трех и четырех частей не поддерживаются.  
  
4.  Задайте параметры соединения.  
  
    -   Если столбец, по которому производится соединение в отфильтрованной таблице (родительской таблице), уникален, выберите **Уникальный ключ**.  
  
        > [!CAUTION]  
        >  Выбор этого параметра указывает, что связь между дочерней и родительской таблицей в фильтре соединения — «одна к одной» или «одна к нескольким». Устанавливайте этот параметр, лишь если на объединяющий столбец в дочерней таблице наложено ограничение, гарантирующее уникальность. Если параметр задан неправильно, может возникнуть потеря конвергенции данных.  
  
    -   По умолчанию во время синхронизации процесс репликации слиянием обрабатывает изменения построчно. Чтобы в строках и фильтруемой, и присоединенной таблицы присутствовали связанные изменения и присоединенная таблица функционировала бы как целое, выберите **Логическая запись** (только [!INCLUDE[msCoName](../../../includes/msconame-md.md)][!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] и более поздние версии). Этот параметр доступен, только если удовлетворяются требования статьи и публикации на использование логических записей. Дополнительные сведения см. в подразделе "Вопросы использования логических записей" раздела [Группирование изменений в связанных строках с помощью логических записей](../../../relational-databases/replication/merge/group-changes-to-related-rows-with-logical-records.md).  
  
5.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
6.  Если вы находитесь в диалоговом окне **Свойства публикации — \<публикация>** , нажмите кнопку **ОК**, чтобы сохранить изменения и закрыть диалоговое окно.  

[!INCLUDE[freshInclude](../../../includes/paragraph-content/fresh-note-steps-feedback.md)]

#### <a name="to-modify-a-join-filter"></a>Изменение фильтра соединения  
  
1.  На странице **Фильтрация строк таблицы** мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<публикация>** выберите фильтр в области **Отфильтрованные таблицы**, а затем нажмите кнопку **Изменить**.  
  
2.  В окне **Изменить соединение** измените фильтр.  
  
3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
#### <a name="to-delete-a-join-filter"></a>Удаление фильтра соединения  
  
1.  На странице **Фильтрация строк таблицы** мастера создания публикаций или странице **Фильтрация строк** диалогового окна **Свойства публикации — \<публикация>** выберите фильтр в области **Отфильтрованные таблицы**, а затем нажмите кнопку **Удалить**. Если удаляемый фильтр соединения расширен за счет других фильтров, эти фильтры также будут удалены.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
 Эти процедуры демонстрируют совместное использование параметризованного фильтра родительской статьи с фильтрами соединения связанных с ней дочерних статей. Фильтры соединения могут создаваться программным путем с помощью хранимых процедур репликации.  
  
#### <a name="to-define-a-join-filter-to-extend-an-article-filter-to-related-articles-in-a-merge-publication"></a>Определение фильтра соединения для распространения фильтра статьи на связанные с ней статьи в публикации слиянием  
  
1.  Определите параметры фильтрации статьи, к которой производится присоединение (она также называется родительской статьей).  
  
    -   Дополнительные сведения о фильтрации статьи при помощи параметризованного фильтра строк см. в разделе [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).  
  
    -   Дополнительные сведения о фильтрации статьи с помощью статического строкового фильтра см. в разделе [Define and Modify a Static Row Filter](../../../relational-databases/replication/publish/define-and-modify-a-static-row-filter.md).  
  
2.  Чтобы определить связанные с публикацией статьи (которые также называют дочерними), в базе данных публикации на издателе выполните хранимую процедуру [sp_addmergearticle (Transact-SQL)](../../../relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql.md). Дополнительные сведения см. в статье [определить статью](../../../relational-databases/replication/publish/define-an-article.md).  
  
3.  На издателе в базе данных публикации выполните хранимую процедуру [sp_addmergefilter (Transact-SQL)](../../../relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql.md). Задайте значение параметра `@publication`, а также укажите уникальное имя фильтра в параметре `@filtername`, имя дочерней статьи, созданной на шаге 2, — в параметре `@article`, имя родительской статьи, к которой производится присоединение, — в параметре `@join_articlename`, а в параметре `@join_unique_key` задайте одно из следующих значений.  
  
    -   **0** — указывает на соединение типа «многие к одному» или «многие ко многим» между родительской и дочерними статьями.  
  
    -   **1** — указывает на соединение типа «один к одному» или «один ко многим» между родительской и дочерними статьями.  
  
     Таким образом определяется используемый фильтр соединения двух статей.  
  
    > [!CAUTION]  
    >  Если на столбец, по которому производится соединение, в базовой таблице для родительской статьи наложено ограничение, гарантирующее уникальность, укажите в параметре `@join_unique_key` значение **1**. Если параметру `@join_unique_key` по ошибке будет присвоено значение **1**, то может произойти потеря конвергенции данных.  
  
###  <a name="TsqlExample"></a> Примеры (Transact-SQL)  
 В следующем примере производится определение статьи для публикации слиянием, где статья таблицы `SalesOrderDetail` фильтруется по таблице `SalesOrderHeader` , для фильтрации которой, в свою очередь, используется статический строковый фильтр. Дополнительные сведения см. в разделе [Define and Modify a Static Row Filter](../../../relational-databases/replication/publish/define-and-modify-a-static-row-filter.md).  
  
 [!code-sql[HowTo#sp_AddMergeArticle](../../../relational-databases/replication/codesnippet/tsql/define-and-modify-a-join_1.sql)]  
  
 В следующем примере определяется группа статей в публикации слиянием, где производится фильтрация статей с помощью набора фильтров соединения по таблице `Employee` , для фильтрации которой, в свою очередь, используется параметризованный фильтр строк по значению параметра [HOST_NAME](../../../t-sql/functions/host-name-transact-sql.md) в столбце **LoginID** . Дополнительные сведения см. в статье [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../../relational-databases/replication/codesnippet/tsql/define-and-modify-a-join_2.sql)]  
  
## <a name="see-also"></a>См. также:  
 [Фильтры соединения](../../../relational-databases/replication/merge/join-filters.md)   
 [Параметризованные фильтры строк](../../../relational-databases/replication/merge/parameterized-filters-parameterized-row-filters.md)   
 [Изменение свойств публикации и статьи](../../../relational-databases/replication/publish/change-publication-and-article-properties.md)   
 [Фильтрация опубликованных данных для репликации слиянием](../../../relational-databases/replication/merge/filter-published-data-for-merge-replication.md)   
 [Руководство. Как определить и изменить фильтр соединения между статьями публикации слиянием (среда SQL Server Management Studio)](../../../relational-databases/replication/publish/define-and-modify-a-join-filter-between-merge-articles.md)   
 [Replication System Stored Procedures Concepts](../../../relational-databases/replication/concepts/replication-system-stored-procedures-concepts.md)   
 [Определение связи логических записей между статьями таблиц слияния](../../../relational-databases/replication/publish/define-a-logical-record-relationship-between-merge-table-articles.md)   
 [Определение и изменение параметризованного фильтра строк для статьи публикации слиянием](../../../relational-databases/replication/publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md)  
  
  
