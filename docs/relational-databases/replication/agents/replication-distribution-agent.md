---
title: "Агент распространения репликации | Документация Майкрософт"
ms.custom: 
ms.date: 02/23/2016
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- replication
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- Distribution Agent, executables
- agents [SQL Server replication], Distribution Agent
- Distribution Agent, parameter reference
- command prompt [SQL Server replication]
ms.assetid: 7b4fd480-9eaf-40dd-9a07-77301e44e2ac
caps.latest.revision: 64
author: BYHAM
ms.author: rickbyh
manager: jhubbard
ms.translationtype: Human Translation
ms.sourcegitcommit: f3481fcc2bb74eaf93182e6cc58f5a06666e10f4
ms.openlocfilehash: ed4deeaf1b608410977ba5d5bbe14a09d379020f
ms.contentlocale: ru-ru
ms.lasthandoff: 06/22/2017

---
# <a name="replication-distribution-agent"></a>Агент распространения репликации
  Агент распространения репликации перемещает моментальный снимок (для репликации моментальных снимков или транзакций) и транзакции, находящиеся в таблицах базы данных распространителя (для репликации транзакций), в целевые таблицы на подписчиках.  
  
> [!NOTE]  
>  Параметры можно указывать в любом порядке. Если необязательные параметры не указаны, используются стандартные значения из реестра локального компьютера.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
distrib [-?]  
-Publisher server_name[\instance_name]  
-PublisherDB publisher_database  
-Subscriber server_name[\instance_name]  
-SubscriberDB subscriber_database   
[-AltSnapshotFolder alt_snapshot_folder_path]   
[-BcpBatchSize bcp_batch_size]  
[-CommitBatchSize commit_batch_size]  
[-CommitBatchThreshold commit_batch_threshold]  
[-Continuous]  
[-DefinitionFile def_path_and_file_name]  
[-Distributor distributor]  
[-DistributorLogin distributor_login]  
[-DistributorPassword distributor_password]  
[-DistributorSecurityMode [0|1]]  
[-EncryptionLevel [0|1|2]]  
[-ErrorFile error_path_and_file_name]  
[-ExtendedEventConfigFile configuration_path_and_file_name]  
[-FileTransferType [0|1]]  
[-FtpAddress ftp_address]  
[-FtpPassword ftp_password]   
[-FtpPort ftp_port]  
[-FtpUserName ftp_user_name]  
[-HistoryVerboseLevel [0|1|2|3]]  
[-Hostname host_name]  
[-KeepAliveMessageInterval keep_alive_message_interval_seconds]  
[-LoginTimeOut login_time_out_seconds]  
[-MaxBcpThreads]  
[-MaxDeliveredTransactions number_of_transactions]  
[-MessageInterval message_interval]  
[-OledbStreamThreshold oledb_stream_threshold]  
[-Output output_path_and_file_name]  
[-OutputVerboseLevel [0|1|2]]  
[-PacketSize packet_size]  
[-PollingInterval polling_interval]  
[-ProfileName profile_name]  
[-Publication publication]  
[-QueryTimeOut query_time_out_seconds]  
[-QuotedIdentifier quoted_identifier]  
[-SkipErrors native_error_id [:...n]]  
[-SubscriberDatabasePath subscriber_path]  
[-SubscriberLogin subscriber_login]  
[-SubscriberPassword subscriber_password]  
[-SubscriberSecurityMode [0|1]]  
[-SubscriberType [0|1|3]]  
[-SubscriptionStreams [1|2|...64]]  
[-SubscriptionTableName subscription_table]  
[-SubscriptionType [0|1|2]]  
[-TransactionsPerHistory [0|1|...10000]]  
[-UseDTS]  
[-UseInprocLoader]  
[-UseOledbStreaming]  
```  
  
## <a name="arguments"></a>Аргументы  
 **-?**  
 Выводит список всех доступных параметров.  
  
 **-Publisher** *server_name*[**\\***i**nstance_name*]  
 Имя издателя. Укажите *server_name* , чтобы использовать экземпляр сервера [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] по умолчанию. Укажите *server_name***\\***instance_name* , чтобы обратиться к именованному экземпляру [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] по умолчанию.  
  
 **-PublisherDB** *publisher_database*  
 Имя базы данных издателя.  
  
 **-Subscriber** *server_name*[**\\***instance_name*]  
 Имя подписчика. Укажите *server_name* , чтобы использовать экземпляр сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] по умолчанию. Укажите *server_name***\\***instance_name* , чтобы обратиться к именованному экземпляру [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] по умолчанию.  
  
 **-SubscriberDB** *subscriber_database*  
 Имя базы данных подписчика.  
  
 **-AltSnapshotFolder** *alt_snapshot_folder_path*  
 Путь к папке, где хранится исходный моментальный снимок для подписки.  
  
 **-BcpBatchSize** *bcp_batch_size*  
 Число строк для отправки при операции массового копирования. При выполнении операции **bcp in** размер пакета равен числу строк для отправки на сервер в одной транзакции, а также числу строк, которые необходимо отправить до того, как агент распространителя зарегистрирует сообщение о ходе выполнения от программы **bcp** . При выполнении операции **bcp out** используются пакеты фиксированного размера ( **1000** ).  
  
 **-CommitBatchSize** *commit_batch_size*  
 Число транзакций, отправляемых подписчику перед выполнением инструкции COMMIT. Значение по умолчанию — 100.  
  
 **-CommitBatchThreshold**  *commit_batch_threshold*  
 Число команд репликации, отправляемых подписчику перед выполнением инструкции COMMIT. Значение по умолчанию — 1000.  
  
 **-Continuous**  
 Определяет, будет ли агент постоянно опрашивать реплицируемые транзакции. Если параметр задан, то даже при отсутствии ожидающих транзакций агент опрашивает реплицируемые транзакции с источника через интервалы опроса.  
  
 **-DefinitionFile** *def_path_and_file_name*  
 Путь к файлу определения агента. Файл определения агента содержит параметры командной строки для агента. Содержимое файла анализируется как для исполняемого файла. Для указания значений параметров, содержащих произвольные символы, используются двойные кавычки (").  
  
 **-Distributor** *distributor*  
 Имя распространителя. Для принудительного распространения по умолчанию используется имя локального распространителя.  
  
 **-DistributorLogin** *distributor_login*  
 Имя входа распространителя.  
  
 **-DistributorPassword** *distributor_password*  
 Пароль распространителя.  
  
 **-DistributorSecurityMode** [ **0**| **1**]  
 Указывает режим безопасности распространителя. Значение 1 означает проверку подлинности Windows (по умолчанию), а значение 0 — проверку подлинности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .  
  
 **-EncryptionLevel** [ **0** | **1** | **2** ]  
 Уровень шифрования по протоколу SSL, который используется агентом распространителя при установлении соединений.  
  
|Значение EncryptionLevel|Описание|  
|---------------------------|-----------------|  
|**0**|Указывает, что SSL не используется.|  
|**1**|Указывает, что SSL используется, но агент не проверяет, подписан ли сертификат сервера SSL надежным издателем.|  
|**2**|Указывает, что SSL используется и сертификат подтвержден.|  
  
 Дополнительные сведения см. в статье [Общие сведения о безопасности (репликация)](../../../relational-databases/replication/security/security-overview-replication.md).  
  
 **-ErrorFile** *error_path_and_file_name*  
 Путь и имя файла ошибок, создаваемого агентом распространителя. Этот файл создается в любой момент, когда происходит ошибка при применении транзакций репликации на подписчике; ошибки, возникающие на издателе или распространителе, в этом файле не регистрируются. Этот файл содержит транзакции репликации, завершившиеся ошибкой, и соответствующие сообщения об ошибках. Если параметр не указан, файл ошибок создается в текущем каталоге агента распространителя. Его именем будет имя агента распространителя с расширением ERR. Если файл с указанным именем уже существует, то сообщения об ошибках будут добавляться в существующий файл. Длина параметра не должна превышать 256 символов Юникода.  
  
 **-ExtendedEventConfigFile** *configuration_path_and_file_name*  
 Задает путь и имя файла для XML-файла конфигурации расширенных событий. Файл конфигурации расширенных событий позволяет настраивать сеансы и включать события для трассировки.  
  
 **-FileTransferType** [ **0**| **1**]  
 Определяет тип передачи файла. **0** означает UNC (формат соглашения об универсальных именах), а **1** означает FTP (протокол передачи файлов).  
  
 **-FtpAddress** *ftp_address*  
 Сетевой адрес службы FTP распространителя. Если он не указан, то используется параметр **DistributorAddress** . Если не указан параметр **DistributorAddress** , то используется параметр **Distributor** .  
  
 **-FtpPassword** *ftp_password*  
 Пароль пользователя, используемый для подключения к службе FTP.  
  
 **-FtpPort** *ftp_port*  
 Номер порта службы FTP распространителя. Если не указан, используется порт службы FTP по умолчанию (21).  
  
 **-FtpUserName**  *ftp_user_name*  
 Имя пользователя для соединения со службой FTP. Если не указано, то будет использовано имя **anonymous** .  
  
 **-HistoryVerboseLevel** [ **0** | **1** | **2** | **3** ]  
 Указывает объем данных, регистрируемых в журнале во время операции распространения. Влияние на производительность, оказываемое ведением журнала, можно максимально уменьшить, выбрав значение **1**.  
  
|Значение HistoryVerboseLevel|Описание|  
|-------------------------------|-----------------|  
|**0**|Сообщения о ходе работы записываются либо в консоль, либо в выходной файл. Записи журнала не регистрируются в базе данных распространителя.|  
|**1**|По умолчанию. Всегда обновлять предыдущее сообщение журнала с таким же состоянием (запуск, выполнение, успех и т. д.). Если предыдущих сообщений с таким состоянием нет, то вставить новую запись.|  
|**2**|Если есть сообщения о таких событиях, как состояние простоя или долго выполняемое задание, то обновить предыдущие записи, в противном случае вставить новые записи журнала.|  
|**3**|Если сообщения не о состоянии простоя, то всегда вставлять новые записи.|  
  
 **-Hostname** *host_name*  
 Имя узла, используемое при соединении с издателем. Длина параметра не должна превышать 128 символов Юникода.  
  
 **-KeepAliveMessageInterval** *keep_alive_message_interval_seconds*  
 Количество секунд до того, как поток журнала проверяет наличие соединений, ожидающих ответа от сервера. Это значение можно уменьшить, чтобы во время проверки при выполнении длительной пакетной операции агент распространителя не был помечен как подозрительный. Значение по умолчанию — **300** секунд.  
  
 **-LoginTimeOut** *login_time_out_seconds*  
 Время ожидания входа в секундах. Значение по умолчанию составляет **15** секунд.  
  
 **-MaxBcpThreads** *number_of_threads*  
 Указывает число операций массового копирования, которые можно проводить параллельно. Максимальное число потоков и соединений ODBC, которые существуют одновременно, равно меньшему из **MaxBcpThreads** и числа запросов на массовое копирование, которые появляются в транзакции синхронизации в базе данных распространителя. Значение**MaxBcpThreads** должно быть больше **0** и не имеет жестко запрограммированного максимума. Значение по умолчанию равно числу процессоров, умноженному на **2** . Максимальное значение равно **8**. Применение моментального снимка, созданного в издателе в режиме одновременного моментального снимка, производится в один поток, независимо от значения, указанного в параметре **MaxBcpThreads**.  
  
 **-MaxDeliveredTransactions** *number_of_transactions*  
 Определяет максимальное число транзакций по запросу и принудительных транзакций, применяемых к подписчикам за одну синхронизацию. Значение **0** говорит о том, что максимальное число транзакций неограниченно. Другие значения могут использоваться подписчиками для сокращения длительности процесса синхронизации, запущенного с издателя.  
  
> [!NOTE]  
>  Если указаны и аргумент -MaxDeliveredTransactions, и аргумент -Continuous, то агент распространителя доставляет указанное число транзакций, а затем останавливается (независимо от того, что указан аргумент -Continuous). После завершения задания необходимо перезапустить агент распространителя.  
  
 **-MessageInterval**  *message_interval*  
 Интервал времени, использующийся для ведения журнала. Событие записывается в журнал при достижении одного из следующих параметров.  
  
-   Значение **TransactionsPerHistory** достигается после записи последнего события в журнал.  
  
-   Значение **MessageInterval** достигается после записи последнего события в журнал.  
  
 При отсутствии реплицируемой транзакции на источнике агент передает распространителю сообщение об отсутствии транзакции. Данный параметр определяет период ожидания агента до передачи следующего сообщения об отсутствии транзакции. Агенты всегда передают сообщение об отсутствии транзакции, если на источнике после ранее обработанных реплицируемых транзакций не обнаруживается доступных транзакций. Значение по умолчанию — 60 секунд.  
  
 **-OledbStreamThreshold** *oledb_stream_threshold*  
 Указывает минимальный размер (в байтах) данных больших двоичных объектов, ниже которого их привязка будет выполняться в виде потока. Для использования этого параметра необходимо указать значение **-UseOledbStreaming** . Значение может находиться в диапазоне от 400 до 1048576, значение по умолчанию — 16384.  
  
 **-Output** *output_path_and_file_name*  
 Путь к выходному файлу агента. Если имя файла не указано, данные выводятся на консоль. Если указанный файл существует, то выходные данные добавляются в конец файла.  
  
 **-OutputVerboseLevel** [ **0**| **1**| **2**]  
 Указывает, должны ли выводимые данные быть подробными. Если уровень подробностей равен **0**, выводятся только сообщения об ошибках. Если уровень подробностей равен **1**, выводятся все сообщения отчета о состоянии. Если уровень подробностей равен **2** (по умолчанию), выводятся и сообщения об ошибках, и сообщения отчета о состоянии, что удобно для отладки.  
  
 **-PacketSize** *packet_size*  
 Размер пакета в байтах. Значение по умолчанию равно 4 096 байт.  
  
 **-PollingInterval** *polling_interval*  
 Определяет частоту (в секундах) опроса базы данных распространителя о реплицируемых транзакциях. Значение по умолчанию — 5 секунд.  
  
 **-ProfileName** *profile_name*  
 Указывает профиль агента, из которого берутся параметры агента. Если **ProfileName** имеет значение NULL, профиль агента отключен. Если значение **ProfileName** не указано, используется профиль по умолчанию для агентов этого типа. Дополнительные сведения см. в статье [Профили агента репликации](../../../relational-databases/replication/agents/replication-agent-profiles.md).  
  
 **-Publication**  *publication*  
 Имя публикации. Этот параметр допустим только в том случае, если в данной публикации моментальный снимок всегда доступен для новых или повторно инициализированных подписок.  
  
 **-QueryTimeOut** *query_time_out_seconds*  
 Время ожидания запроса в секундах. Значение по умолчанию — 1800 секунд.  
  
 **-QuotedIdentifier** *quoted_identifier*  
 Указывает символ, применяемый для идентификаторов, заключенных в кавычки. Первый символ значения указывает значение, используемое агентом распространителя. Если параметр **QuotedIdentifier** указан без значения, то агент распространителя использует пробел. Если параметр **QuotedIdentifier** не указан, то агент распространителя использует заключенный в кавычки идентификатор, поддерживаемый подписчиком.  
  
 **-SkipErrors** *native_error_id* [**:***...n*]  
 Список с разделителями-двоеточиями, перечисляющий коды ошибок, которые этот агент должен пропускать.  
  
 **-SubscriberDatabasePath** *subscriber_database_path*  
 Путь к базе данных Jet (MDB-файл) при значении **SubscriberType** равном **2** (позволяет соединиться с базой данных Jet без указания имени источника данных ODBC (DSN)).  
  
 **-SubscriberLogin** *subscriber_login*  
 Имя входа подписчика. Данный параметр должен быть указан, если значение **SubscriberSecurityMode** равно **0** (при проверке подлинности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Authentication).  
  
 **-SubscriberPassword** *subscriber_password*  
 Пароль подписчика. Данный параметр должен быть указан, если значение **SubscriberSecurityMode** равно **0** (при проверке подлинности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Authentication).  
  
 **-SubscriberSecurityMode** [ **0**| **1**]  
 Определяет режим безопасности подписчика. Значение **1** означает проверку подлинности Windows (по умолчанию), а значение [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 0 **— проверку подлинности** .  
  
 **-SubscriberType** [ **0**| **1**| **3**]  
 Указывает тип соединения с подписчиком, используемый агентом распространителя.  
  
|Значение SubscriberType|Описание|  
|--------------------------|-----------------|  
|**0**|[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]|  
|**1**|Источник данных ODBC|  
|**3**|OLE DB, источник данных|  
  
 **-SubscriptionStreams** [**0**|**1**|**2**|...**64**]  
 Число соединений на каждого агента распространителя для параллельного применения пакетов изменений на подписчике при сохранении многих характеристик транзакций, имеющихся для однопоточного выполнения. Для издателя [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] поддерживается диапазон значений от 1 до 64. Этот параметр поддерживается только тогда, когда издатель и распространитель выполняются на [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] и более поздних версиях. Этот параметр не поддерживается или должен быть равен 0 для подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , издателей Oracle и одноранговых подписок.  
  
> [!NOTE]  
>  Если одному из соединений не удается осуществить выполнение или фиксацию, все подключения прекратят выполнение текущего пакета, и агент будет использовать одиночный поток для повторных попыток выполнения поврежденных пакетов. Перед завершением фазы выполнения повторной попытки могут существовать временные несоответствия транзакций на подписчике. После успешной фиксации всех поврежденных пакетов подписчик возвращается в состояние согласованности транзакций.  
  
> [!IMPORTANT]  
>  При указании в параметре **-SubscriptionStreams**значения 2 и более порядок получения транзакций у подписчика может отличаться от порядка, в котором они были выполнены у издателя. Если это приводит к нарушениям ограничений при синхронизации, то следует параметром NOT FOR REPLICATION отключить принудительное выполнение ограничений во время синхронизации. Дополнительные сведения см. в статье [Управление поведением триггеров и ограничений во время синхронизации (программирование репликации на языке Transact-SQL)](../../../relational-databases/replication/control-behavior-of-triggers-and-constraints-in-synchronization.md).  
  
> [!NOTE]  
>  Потоки подписки не работают для статей, настроенных для доставки [!INCLUDE[tsql](../../../includes/tsql-md.md)]. Для использования потоков подписки настройте в статьях доставку вызовов хранимых процедур.  
  
 **-SubscriptionTableName** *subscription_table*  
 Имя таблицы подписки, созданной или используемой в заданном подписчике. Если не указано, используется таблица [MSreplication_subscriptions (Transact-SQL)](../../../relational-databases/system-tables/msreplication-subscriptions-transact-sql.md). Этот параметр следует использовать СУБД, не поддерживающих длинные имена файлов.  
  
 **-SubscriptionType** [ **0**| **1**| **2**]  
 Определяет тип подписки для распространения. Значение **0** указывает на подписку по запросу, значение **1** — на принудительную подписку, а значение **2** — на анонимную подписку.  
  
 **-TransactionsPerHistory** [ **0**| **1**|... **10000**]  
 Указывает интервал транзакций для регистрации журналов. Сообщение записывается в журнал, как только число зафиксированных транзакций после последней записи в журнал превысило значение этого параметра. Значение по умолчанию — 100. **0** означает бесконечное значение **TransactionsPerHistory**. See the preceding **–MessageInterval**parameter.  
  
 **-UseDTS**  
 Должен быть указан в качестве параметра для публикации, для которой разрешено преобразование данных.  
  
 **-UseInprocLoader**  
 Повышает производительность исходного моментального снимка, заставляя агент распространителя использовать команду BULK INSERT при применении файлов моментальных снимков к подписчику. Это устаревший параметр, несовместимый с типом данных XML. Этот параметр может использоваться, если не выполняется репликация XML-данных. Этот параметр нельзя использовать с моментальными снимками в символьном формате или для подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . При использовании этого параметра учетная запись службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] на подписчике должна иметь разрешение на чтение каталога, в котором находятся BCP-файлы данных моментальных снимков. Если этот параметр не указан, то агент (для подписчиков, отличных от[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ) или драйвер ODBC, загружаемый агентом (для подписчиков [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ), считывает его из файлов, поэтому контекст безопасности учетной записи службы [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не используется.  
  
 **-UseOledbStreaming**  
 Если этот параметр указан, то разрешает привязку двоичных данных больших объектов в виде потока. Задать размер (в байтах), при превышении которого будет использоваться поток, можно с помощью параметра **-OledbStreamThreshold** . Параметр**UseOledbStreaming** включен по умолчанию. **UseOledbStreaming** записывает данные в папку **C:\Program Files\Microsoft SQL Server\\<версия\>\COM**.  
  
## <a name="remarks"></a>Замечания  
  
> [!IMPORTANT]  
>  Если агент [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] настроен для запуска от учетной записи пользователя не домена (по умолчанию), а локальной системы, то служба имеет доступ только к локальному компьютеру. Если агент распространителя, запускаемый агентом [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , настроен для входа в [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]с проверкой подлинности Windows, то работа агента слияния завершится ошибкой. Значением по умолчанию является проверка подлинности [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Дополнительные сведения об изменении учетных записей безопасности см. в разделе [View and Modify Replication Security Settings](../../../relational-databases/replication/security/view-and-modify-replication-security-settings.md).  
  
 Чтобы запустить агент распространителя, выполните в командной строке **distrib.exe** . Дополнительные сведения см. в статье [Основные понятия исполняемых файлов агента репликации](../../../relational-databases/replication/concepts/replication-agent-executables-concepts.md).  
  
## <a name="change-history"></a>Журнал изменений  
  
|Обновленное содержимое|  
|---------------------|  
|Добавлен параметр **-ExtendedEventConfigFile** .|  
  
## <a name="see-also"></a>См. также:  
 [Администрирование агента репликации](../../../relational-databases/replication/agents/replication-agent-administration.md)  
  
  

