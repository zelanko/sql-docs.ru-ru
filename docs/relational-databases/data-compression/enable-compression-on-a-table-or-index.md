---
title: Включение сжатия таблицы или индекса | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.reviewer: ''
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.technology: performance
ms.topic: conceptual
f1_keywords:
- sql13.swb.compwiz.compressiontype.f1
- sql13.swb.compwiz.outputoptions.f1
- sql13.swb.compwiz.summary.f1
- sql13.swb.compwiz.scriptfileoption.f1
- sql13.swb.compwiz.progress.f1
- sql13.swb.compwiz.welcome.f1
- sql13.swb.compwiz.createjob.f1
- sql13.swb.compwiz.selectaction.f1
helpviewer_keywords:
- data compression wizard
- compression [SQL Server], enable
ms.assetid: b7442cff-e616-475a-9c5a-5a765089e5f2
author: MikeRayMSFT
ms.author: mikeray
monikerRange: '>= aps-pdw-2016 || = azuresqldb-current || = azure-sqldw-latest || >= sql-server-2016 || = sqlallproducts-allversions'
ms.openlocfilehash: 83cb5bb61d64cab7dc9d45b5aae871a863368f3f
ms.sourcegitcommit: b2e81cb349eecacee91cd3766410ffb3677ad7e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "68007165"
---
# <a name="enable-compression-on-a-table-or-index"></a>Включение сжатия таблицы или индекса

[!INCLUDE[appliesto-ss-asdb-asdw-pdw-md](../../includes/appliesto-ss-asdb-asdw-pdw-md.md)]

  В этом разделе описано включение таблицы или индекса в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../includes/tsql-md.md)].  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Чтобы включить сжатие таблицы или индекса с использованием:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   В системных таблицах не может быть включено сжатие.  
  
-   Если таблица является кучей, то операция перестроения в режиме ONLINE будет однопотоковой. Используйте режим OFFLINE для выполнения многопотоковых операций перестроения кучи. Дополнительную информацию о сжатии данных см. в разделе [Сжатие данных](../../relational-databases/data-compression/data-compression.md).  
  
-   Если у таблицы есть невыровненные индексы, изменить настройку сжатия отдельной секции невозможно.  
  
###  <a name="Security"></a> безопасность  
  
####  <a name="Permissions"></a> Permissions  
 Необходимо разрешение ALTER на таблицу или индекс.  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
#### <a name="to-enable-compression-on-a-table-or-index"></a>Чтобы включить сжатие таблицы или индекса:  
  
1.  В обозревателе объектов разверните базу данных, в которой содержится таблица, подлежащая сжатию, а затем разверните папку **Таблицы** .  
  
2.  Чтобы сжать индекс, разверните таблицу, содержащую нужный индекс, затем разверните папку **Индексы** .  
  
3.  Щелкните правой кнопкой мыши таблицу или индекс для сжатия, выберите **хранение**, а затем **Управление сжатием...**  
  
4.  В мастере сжатия данных на странице **Добро пожаловать в мастер сжатия данных** нажмите кнопку **Далее**.  
  
5.  На странице **Выбор типа сжатия** выберите тип сжатия, который будет применен к каждой выбранной секции таблицы или индекса. По завершении нажмите кнопку **Далее**.  
  
     Следующие параметры доступны на странице **Выбор типа сжатия** :  
  
     флажок**Использовать один тип сжатия для всех секций**  
     Выберите этот вариант, чтобы задать одинаковые параметры для всех секций. Он включает флажок выбора и делает недоступным столбец **Тип сжатия** в сетке. При его выборе в списке рядом появляются параметры: **Нет**, **Строка**и **Страница**.  
  
     **Номер секции**  
     Перечисляет каждую секцию в таблице или индексе. Столбец доступен только для чтения.  
  
     **Тип сжатия**  
     Выберите параметры сжатия для каждой секции. Вариант недоступен, если выбран параметр **Использовать один и тот же тип сжатия для всех секций** . Список параметров: **Нет**, **Строка**и **Страница**.  
  
     **Граница**  
     Отображает границу секции. Столбец доступен только для чтения.  
  
     **Количество строк**  
     Количество строк в данной секции. Столбец доступен только для чтения.  
  
     **Текущий размер**  
     Текущий размер, занимаемый секцией в мегабайтах (МБ). Столбец доступен только для чтения.  
  
     **Запрошенное сжатое пространство**  
     После нажатия кнопки **Вычислить**в этом столбце будет показан приблизительный размер каждой секции после сжатия на основе значения в столбце **Тип сжатия** . Столбец доступен только для чтения.  
  
     **Вычислить**  
     Нажмите эту кнопку, чтобы получить размер каждой секции после сжатия на основе значения в столбце **Тип сжатия** .  
  
6.  На странице **Выбор выходного параметра** укажите способ завершения сжатия. Выберите **Создать скрипт** для создания скрипта SQL на основе данных на предыдущих страницах мастера. Выберите **Запустить немедленно** , чтобы создать новую секционированную таблицу после завершения работ со всеми оставшимися страницами мастера. Выберите **Расписание** , чтобы создать новую секционированную таблицу в заранее заданное время в будущем.  
  
     При выборе **Создать скрипт**в **Параметры скрипта**будут доступны следующие параметры:  
  
     **Вывести скрипт в файл**  
     Создание скрипта как SQL-файла. Введите имя и местоположение файла в поле **Имя файла** или щелкните **Обзор** , чтобы открыть диалоговое окно **Расположение файла скрипта** . В разделе **Сохранить как**выберите **Текст в Юникоде** или **Текст ANSI**.  
  
     **Вывести скрипт в буфер обмена**  
     Сохранение скрипта в буфере обмена.  
  
     **Вывести скрипт в новое окно запроса**  
     Скрипт создается в новом окне редактора запросов. Это параметр выбирается по умолчанию.  
  
     При выборе **Расписание**щелкните **Изменить расписание**.  
  
    1.  В диалоговом окне **Создание расписания задания** в поле **Имя** введите имя расписания задания.  
  
    2.  В списке **Тип расписания** выберите тип расписания:  
  
        -   **Запускать автоматически при запуске агента SQL Server**  
  
        -   **Запускать при бездействии процессоров**  
  
        -   **Повторяющееся**. Выберите этот параметр, если новая секционированная таблица регулярно обновляется с учетом новых данных.  
  
        -   **Однократно**. Это параметр выбирается по умолчанию.  
  
    3.  Установите или снимите флажок **Включен** , чтобы включить или отключить расписание.  
  
    4.  При выборе **Повторяющееся**:  
  
        1.  В разделе **Частота**в списке **Выполняется** укажите частоту выполнения:  
  
            -   При выборе **Ежедневно**в поле **Выполняется каждые** укажите частоту повторного выполнения расписания задания в днях.  
  
            -   При выборе **Еженедельно**в поле **Выполняется каждые** укажите частоту повторного выполнения расписания задания в неделях. Выберите день или дни недели, в которые выполняется расписание задания.  
  
            -   При выборе **Ежемесячно**щелкните **День** или **Определенный**.  
  
                -   При выборе **День**введите дату месяца, в которую должно выполняться расписание задания, и укажите частоту повторного выполнения расписания задания в месяцах. Например, если требуется, чтобы расписание задания выполнялось 15 числа каждого второго месяца, выберите **День** и введите в первом поле 15 и 2 — во втором поле. Обратите внимание, что число, введенное во втором поле, не должно превышать 99.  
  
                -   При выборе **Определенный**выберите определенный день недели в месяце, в котором должно выполняться расписание задания, и укажите частоту повторного выполнения расписания задания в месяцах. Например, если требуется, чтобы расписание задания выполнялось в последний день недели каждого второго месяца, выберите **День**, затем **последний** в первом списке и **рабочий день** во втором списке, а потом введите "2" во втором поле. Еще можно выбрать **первый**, **второй**, **третий**или **четвертый**, а также конкретные дни недели (например, воскресенье или среду) в первых двух списках. Обратите внимание, что число, введенное в последнем поле, не должно превышать 99.  
  
        2.  В поле **Сколько раз в день**укажите частоту повторного выполнения расписания задания в день запуска расписания задания:  
  
            -   При выборе **Выполнять раз в**укажите определенное время дня для запуска расписания задания в поле **Выполнять раз в** . Укажите время дня: час, минуту и секунду.  
  
            -   При выборе **Выполняется каждые**укажите частоту выполнения задания в выбранный день в поле **Частота**. Например, если требуется, чтобы расписание задания выполнялось каждые 2 часа в день запуска расписания задания, выберите **Выполняется кажд.** , введите "2" в первом поле, а затем выберите в списке **часы**. В этом списке также можно выбрать **минуты** и **секунды**. Обратите внимание, что число, введенное в первом поле, не должно превышать 100.  
  
                 В поле **Начинать в** введите время для начала запуска расписания задания. В поле **Заканчивать в** введите время для завершения повторного выполнения расписания задания. Укажите время дня: час, минуту и секунду.  
  
        3.  В разделе **Длительность**, в области **Дата начала**введите дату начала запуска расписания задания. Выберите **Дата окончания** или **Без даты окончания** , чтобы указать дату завершения выполнения расписания задания. При выборе **Дата окончания**введите дату завершения запуска расписания задания.  
  
    5.  При выборе значения **Однократно**в **Однократное выполнение**в поле **Дата** введите дату запуска расписания задания. В поле **Время** введите время запуска расписания задания. Укажите время дня: час, минуту и секунду.  
  
    6.  В разделе **Сводка**в **Описание**проверьте правильность всех параметров расписания задания.  
  
    7.  Нажмите кнопку **ОК**.  
  
     После завершения работы с этой страницей нажмите кнопку **Далее**.  
  
7.  На странице **Просмотр сводки** в разделе **Просмотр выбранных параметров**разверните все доступные параметры, чтобы проверить правильность всех настроек сжатия. Если все настройки правильные, нажмите кнопку **Готово**.  
  
8.  Страница **Выполнение мастера сжатия** используется для мониторинга сведений о состоянии действий мастера создания секций. В зависимости от действий, выбранных в мастере, страница выполнения может содержать одно или несколько действий. В верхнем поле показано общее состояние мастера и число полученных им сообщений о состоянии, предупреждений и сообщений об ошибках.  
  
     На странице **Выполнение мастера сжатия** доступны следующие параметры.  
  
     **Сведения**  
     Сведения о событии, состоянии и любых сообщениях, которые возвращены в результате действий мастера.  
  
     **Действие**  
     Задает тип и имя каждого действия.  
  
     **Состояние**  
     Указывает, вернуло ли действие мастера в целом значение **Успешно** или **Ошибка**.  
  
     **Сообщение**  
     Любые сообщения об ошибках или предупреждения от процесса.  
  
     **Отчет**  
     Создание отчета, содержащего результаты мастера создания секций. Доступные параметры: **Просмотреть отчет**, **Сохранить отчет в файл**, **Копировать отчет в буфер обмена**и **Отправить отчет по электронной почте**.  
  
     **Просмотреть отчет**  
     Открытие диалогового окна **Просмотр отчета** , которое содержит текстовый отчет о работе мастера создания секций.  
  
     **Сохранить отчет в файл**  
     Открытие диалогового окна **Сохранить отчет как** .  
  
     **Копировать отчет в буфер обмена**  
     Копирование результатов отчета о работе мастера в буфер обмена.  
  
     **Отправить отчет по электронной почте**  
     Копирование результатов отчета о состоянии мастера в сообщение электронной почты.  
  
     Завершив выбор параметров, нажмите кнопку **Закрыть**.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-enable-compression-on-a-table"></a>Чтобы включить сжатие таблицы  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].  
  
2.  На стандартной панели выберите пункт **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**. В примере сначала выполняется хранимая процедура `sp_estimate_data_compression_savings` для получения оценки размера объекта, если был выбран параметр сжатия ROW. Затем в примере включается сжатие ROW во всех секциях указанной таблицы.  
  
    ```  
    USE AdventureWorks2012;  
    GO  
    EXEC sp_estimate_data_compression_savings 'Production', 'TransactionHistory', NULL, NULL, 'ROW' ;  
  
    ALTER TABLE Production.TransactionHistory REBUILD PARTITION = ALL  
    WITH (DATA_COMPRESSION = ROW);   
    GO  
    ```  
  
#### <a name="to-enable-compression-on-an-index"></a>Чтобы включить сжатие индекса  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].  
  
2.  На стандартной панели выберите пункт **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**. В примере сначала формируется запрос к представлению каталога `sys.indexes` для получения имени и `index_id` для каждого индекса таблицы `Production.TransactionHistory` . Затем выполняется хранимая процедура `sp_estimate_data_compression_savings`, которая возвращает значение предполагаемого размера индекса с указанным ID, если был выбран параметр сжатия PAGE. В конце в примере перестраивается индекс ID 2 (`IX_TransactionHistory_ProductID`), с указанием типа сжатия PAGE.  
  
    ```  
    USE AdventureWorks2012;   
    GO  
    SELECT name, index_id  
    FROM sys.indexes  
    WHERE OBJECT_NAME (object_id) = N'TransactionHistory';  
  
    EXEC sp_estimate_data_compression_savings   
        @schema_name = 'Production',   
        @object_name = 'TransactionHistory',  
        @index_id = 2,   
        @partition_number = NULL,   
        @data_compression = 'PAGE' ;   
  
    ALTER INDEX IX_TransactionHistory_ProductID ON Production.TransactionHistory REBUILD PARTITION = ALL WITH (DATA_COMPRESSION = PAGE);  
    GO  
    ```  
  
 Дополнительные сведения см. в разделах [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md) и [ALTER INDEX (Transact-SQL)](../../t-sql/statements/alter-index-transact-sql.md).  
  
## <a name="see-also"></a>См. также:  
 [Сжатие данных](../../relational-databases/data-compression/data-compression.md)   
 [sp_estimate_data_compression_savings (Transact-SQL)](../../relational-databases/system-stored-procedures/sp-estimate-data-compression-savings-transact-sql.md)  
  
  
