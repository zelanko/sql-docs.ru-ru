---
title: sp_trace_setevent (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- sp_trace_setevent_TSQL
- sp_trace_setevent
dev_langs:
- TSQL
helpviewer_keywords:
- sp_trace_setevent
ms.assetid: 7662d1d9-6d0f-443a-b011-c901a8b77a44
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 7d1f047fed74a212358ef7c1af61034d021661ef
ms.sourcegitcommit: f7ac1976d4bfa224332edd9ef2f4377a4d55a2c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85892594"
---
# <a name="sp_trace_setevent-transact-sql"></a>Хранимая процедура sp_trace_setevent (Transact-SQL)
[!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

  Добавляет или удаляет событие или столбец событий в трассировке. **sp_trace_setevent** может выполняться только для существующих трассировок, которые остановлены (*Status* имеет значение **0**). Если эта хранимая процедура выполняется для трассировки, которая не существует или имеет *статус* , отличный от **0**, возвращается ошибка.  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../includes/ssnotedepfutureavoid-md.md)] Вместо этого используйте расширенные события.  
  
 ![Значок ссылки на раздел](../../database-engine/configure-windows/media/topic-link.gif "Значок ссылки на раздел") [Синтаксические обозначения в Transact-SQL](../../t-sql/language-elements/transact-sql-syntax-conventions-transact-sql.md)  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
sp_trace_setevent [ @traceid = ] trace_id   
          , [ @eventid = ] event_id  
          , [ @columnid = ] column_id  
          , [ @on = ] on  
```  
  
## <a name="arguments"></a>Аргументы  
`[ @traceid = ] trace_id`Идентификатор изменяемой трассировки. *trace_id* имеет **тип int**и не имеет значения по умолчанию. Пользователь использует это *trace_id* значение для выявления, изменения и управления трассировкой.  
  
`[ @eventid = ] event_id`Идентификатор события, которое необходимо включить. *event_id* имеет **тип int**и не имеет значения по умолчанию.  
  
 Эта таблица содержит список событий, которые можно добавить или удалить из трассировки.  
  
|Номер события|Имя события.|Описание|  
|------------------|----------------|-----------------|  
|0-9|Зарезервированное|Зарезервированное|  
|10|RPC:Completed|Возникает при завершении удаленного вызова процедуры (RPC).|  
|11|RPC:Starting|Возникает при запуске вызова удаленной процедуры RPC.|  
|12|SQL:BatchCompleted|Возникает при завершении пакета языка [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|13|SQL:BatchStarting|Возникает при запуске пакета языка [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|14|Аудит входа в систему|Возникает, когда пользователь успешно входит в систему [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|15|Audit Logout|Возникает, когда пользователь выходит из системы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|16|Внимание|Возникает при событиях, требующих внимания, например запросах клиента на прерывание или разрыв соединения клиента.|  
|17|ExistingConnection|Обнаруживает всю деятельность пользователей, соединенных с [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] до начала трассировки.|  
|18|Audit Server Starts and Stops|Возникает при изменении состояния службы [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|19|DTCTransaction|Отслеживает [!INCLUDE[msCoName](../../includes/msconame-md.md)] координатор распределенных транзакций (MS DTC) координированные транзакции между двумя или более базами данных.|  
|20|Audit Login Failed|Показывает, что попытка входа клиента в систему [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] завершилась неудачно.|  
|21|EventLog|Показывает, что события были записаны в журнал приложений Windows.|  
|22|ErrorLog|Показывает, что связанные с ошибками события были записаны в журнал ошибок сервера [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .|  
|23|Lock:Released|Указывает, что была снята блокировка ресурса, например страницы.|  
|24|Lock:Acquired|Указывает, что была установлена блокировка ресурса, например страницы данных.|  
|25|Lock:Deadlock|Указывает, что две одновременно выполняемые транзакции взаимно блокируют друг друга, пытаясь установить несовместимые блокировки ресурсов, принадлежащих другой транзакции.|  
|26|Lock:Cancel|Показывает, что запрос на блокировку ресурса был отменен (например, из-за взаимоблокировки).|  
|27|Lock:Timeout|Показывает, что запрос на блокировку некоторого ресурса, например страницы, превысил время ожидания, поскольку данный ресурс был блокирован другой транзакцией. Время ожидания определяется @LOCK_TIMEOUT функцией @ и может быть задано с помощью инструкции set LOCK_TIMEOUT.|  
|28|Degree of Parallelism Event (используется с версии 7.0)|Возникает перед выполнением инструкций SELECT, INSERT и UPDATE.|  
|29-31|Зарезервированное|Вместо него используется событие 28.|  
|32|Зарезервированное|Зарезервированное|  
|33|Исключение|Указывает, что в сервере [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]произошло исключение.|  
|34|SP:CacheMiss|Указывает, что хранимая процедура не найдена в процедурном кэше.|  
|35|SP:CacheInsert|Указывает, что элемент вставлен в процедурный кэш.|  
|36|SP:CacheRemove|Указывает, что элемент удален из процедурного кэша.|  
|37|SP:Recompile|Указывает, что была выполнена повторная компиляция хранимой процедуры.|  
|38|SP:CacheHit|Указывает, что хранимая процедура найдена в процедурном кэше.|  
|39|Не рекомендуется|Не рекомендуется|  
|40|SQL:StmtStarting|Возникает при запуске инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|41|SQL:StmtCompleted|Возникает при завершении инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|42|SP:Starting|Указывает, что запущена хранимая процедура.|  
|43|SP:Completed|Указывает, что выполнение хранимой процедуры завершено.|  
|44|SP:StmtStarting|Указывает, что в хранимой процедуре начато выполнение инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|45|SP:StmtCompleted|Указывает, что выполнение инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] в хранимой процедуре завершено.|  
|46|Object:Created|Указывает на создание объекта, например с помощью инструкций CREATE INDEX, CREATE TABLE или CREATE DATABASE.|  
|47|Object:Deleted|Указывает на удаление объекта, например с помощью инструкций DROP INDEX или DROP TABLE.|  
|48|Зарезервированное||  
|49|Зарезервированное||  
|50|SQL Transaction|Отслеживает инструкции языка [!INCLUDE[tsql](../../includes/tsql-md.md)] BEGIN, COMMIT, SAVE и ROLLBACK TRANSACTION.|  
|51|Scan:Started|Указывает, что был начат просмотр таблицы или индекса.|  
|52|Scan:Stopped|Указывает, что просмотр таблицы или индекса завершилось.|  
|53|CursorOpen|Указывает, что в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] с помощью API-функций ODBC, OLE DB или DB-Library был открыт курсор.|  
|54|TransactionLog|Следит за записью транзакций в журнал транзакций.|  
|55|Hash Warning|Указывает, что операция хэширования (например, Hash Join, Hash Aggregate, Hash Union и Hash Distinct), которая не выполняется в буферной секции, обратилась к альтернативному плану. Это может происходить из-за глубины рекурсии, неравномерного смещения данных, флагов трассировки или подсчета битов.|  
|56-57|Зарезервированное||  
|58|Auto Stats|Указывает, что произошло автоматическое обновление статистики индекса.|  
|59|Lock:Deadlock Chain|Создается для каждого события, приводящего к взаимоблокировке.|  
|60|Lock:Escalation|Указывает, что блокировка более мелких фрагментов данных была преобразована в блокировку более крупных фрагментов данных (например, блокировка страницы была укрупнена или преобразована в блокировку таблицы или блокировку HoBT).|  
|61|OLE DB Errors|Показывает, что произошла ошибка OLE DB.|  
|62-66|Зарезервированное||  
|67|Execution Warnings|Показывает все предупреждения, которые были выданы за время выполнения инструкции или хранимой процедуры [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|68|Showplan Text (Unencoded)|Показывает дерево плана выполнения для текущей инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|69|Sort Warnings|Показывает операции сортировки, которые не помещаются в памяти. Сюда не входят операции сортировки, предполагающие создание индексов, а только операции сортировки в запросе (например, предложение ORDER BY инструкции SELECT).|  
|70|CursorPrepare|Показывает, что курсор в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] подготовлен для использования API-функциями ODBC, OLE DB или DB-Library.|  
|71|Prepare SQL|API-функции ODBC, OLE DB или DB-Library подготовили одну или несколько инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)] для использования.|  
|72|Exec Prepared SQL|API-функции ODBC, OLE DB или DB-Library выполнили одну или несколько инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|73|Unprepare SQL|API-функции ODBC, OLE DB или DB-Library отменили готовность (удалили) одной или нескольких подготовленных инструкций [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|74|CursorExecute|Выполнен курсор, подготовленный в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] с помощью API-функций ODBC, OLE DB или DB-Library.|  
|75|CursorRecompile|Курсор, открытый в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] с помощью API-функций ODBC или DB-Library, был повторно скомпилирован явным образом или вследствие изменения схемы.<br /><br /> Срабатывает как для курсоров ANSI, так и для курсоров, не являющихся курсорами ANSI.|  
|76|CursorImplicitConversion|Курсор в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] преобразуется [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из одного типа в другой.<br /><br /> Срабатывает как для курсоров ANSI, так и для курсоров, не являющихся курсорами ANSI.|  
|77|CursorUnprepare|API -функции ODBC, OLE DB или DB-Library отменяют готовность курсора (удаляют), подготовленного в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)].|  
|78|CursorClose|Закрыт курсор, предварительно открытый в инструкции [!INCLUDE[tsql](../../includes/tsql-md.md)] с помощью API-функций ODBC, OLE DB или DB-Library.|  
|79|Missing Column Statistics|Недоступны статистические данные столбцов, которые были бы полезны оптимизатору.|  
|80|Missing Join Predicate|Выполняется запрос, не имеющий предиката соединения. Это может привести к длительному выполнению запроса.|  
|81|Server Memory Change|Объем памяти, используемый [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], увеличился или уменьшился на 1 мегабайт (МБ) либо на 5% от максимального объема памяти, в зависимости от того, какая величина больше.|  
|82-91|User Configurable (0-9)|Данные событий, определяемые пользователем.|  
|92|Data File Auto Grow|Указывает, что сервер автоматически увеличил файл данных.|  
|93|Log File Auto Grow|Указывает, что сервер автоматически расширил файл журнала.|  
|94|Data File Auto Shrink|Указывает, что сервер автоматически сжал файл данных.|  
|95|Log File Auto Shrink|Указывает, что сервер автоматически сжал файл журнала.|  
|96|Showplan Text|Показывает дерево плана запроса для инструкции SQL из оптимизатора запросов. Обратите внимание, что столбец **TextData** не содержит инструкцию Showplan для этого события.|  
|97|Showplan All|Выводит план запроса со всеми подробностями процесса компиляции для выполненной инструкции SQL. Обратите внимание, что столбец **TextData** не содержит инструкцию Showplan для этого события.|  
|98|Showplan Statistics Profile|Выводит план запроса со всеми подробностями времени выполнения для выполненной инструкции SQL. Обратите внимание, что столбец **TextData** не содержит инструкцию Showplan для этого события.|  
|99|Зарезервированное||  
|100|RPC Output Parameter|Выводит выходные значения параметров для каждого вызова RPC.|  
|101|Зарезервированное||  
|102|Аудит GDR области базы данных|Возникает каждый раз, когда пользователь выдает GRANT, DENY, REVOKE в качестве разрешения инструкции в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для действий, связанных только с базой данных, например для предоставления разрешения на базу данных.|  
|103|Audit Object GDR Event|Возникает каждый раз, когда пользователь [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] выдает разрешения GRANT, DENY, REVOKE на объект.|  
|104|Audit AddLogin Event|Происходит при [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] добавлении или удалении имени входа; для **sp_addlogin** и **sp_droplogin**.|  
|105|Audit Login GDR Event|Происходит при добавлении или удалении право на вход в Windows; для **sp_grantlogin**, **sp_revokelogin**и **sp_denylogin**.|  
|106|Audit Login Change Property Event|Происходит при изменении свойства имени входа, за исключением паролей. для **sp_defaultdb** и **sp_defaultlanguage**.|  
|107|Audit Login Change Password Event|Возникает при изменении пароля имени входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].<br /><br /> Пароли не записываются.|  
|108|Audit Add Login to Server Role Event|Происходит при добавлении или удалении имени входа из предопределенной роли сервера. для **sp_addsrvrolemember**и **sp_dropsrvrolemember**.|  
|109|Audit Add DB User Event|Происходит при добавлении или удалении имени входа в качестве пользователя базы данных (Windows или [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ) в базе данных; для **sp_grantdbaccess**, **sp_revokedbaccess**, **sp_adduser**и **sp_dropuser**.|  
|110|Audit Add Member to DB Role Event|Происходит при добавлении или удалении имени входа в качестве пользователя базы данных (фиксированного или определяемого пользователем) в базе данных; для **sp_addrolemember**, **sp_droprolemember**и **sp_changegroup**.|  
|111|Audit Add Role Event|Происходит при добавлении или удалении имени входа в базу данных в качестве пользователя базы данных. для **sp_addrole** и **sp_droprole**.|  
|112|Audit App Role Change Password Event|Возникает при изменении пароля роли приложения.|  
|113|Audit Statement Permission Event|Возникает при использовании разрешения инструкции (например, CREATE TABLE).|  
|114|Audit Schema Object Access Event|Возникает при использовании объектного разрешения (например, SELECT), как успешном, так и неуспешном.|  
|115|Audit Backup/Restore Event|Возникает при выполнении команды BACKUP или RESTORE.|  
|116|Audit DBCC Event|Возникает при выполнении консольной команды.|  
|117|Audit Change Audit Event|Возникает при изменениях трассировки аудита.|  
|118|Audit Object Derived Permission Event|Возникает при выполнении команд CREATE, ALTER и DROP в отношении объектов.|  
|119|OLEDB Call Event|Возникает, когда поставщик OLE DB вызывает распределенные запросы и удаленные хранимые процедуры.|  
|120|OLEDB QueryInterface Event|Происходит, когда OLE DB вызовы **QueryInterface** выполняются для распределенных запросов и удаленных хранимых процедур.|  
|121|OLEDB DataRead Event|Возникает при вызове запроса данных к поставщику OLE DB.|  
|122|Showplan XML|Возникает при выполнении инструкции SQL. Включите это событие для идентификации операторов Showplan. Каждое событие хранится в правильно оформленном XML-документе. Обратите внимание, что **двоичный** столбец для этого события содержит закодированную инструкцию Showplan. Для просмотра инструкции Showplan откройте трассировку в приложении SQL Server Profiler.|  
|123|SQL:FullTextQuery|Возникает при выполнении полнотекстового запроса.|  
|124|Broker:Conversation|Сообщает о состоянии диалога компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|125|Deprecation Announcement|Возникает при использовании возможности, которая будет удалена из будущей версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|126|Deprecation Final Support|Возникает при использовании возможности, которая будет удалена из следующего основного выпуска [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].|  
|127|Exchange Spill Event|Происходит, когда буферы обмена в параллельном плане запроса временно записаны в базу данных **tempdb** .|  
|128|Audit Database Management Event|Возникает при создании, изменении и удалении базы данных.|  
|129|Audit Database Object Management Event|Возникает при выполнении инструкций CREATE, ALTER или DROP в отношении таких объектов базы данных, как схема.|  
|130|Audit Database Principal Management Event|Возникает при создании, изменении или удалении из базы данных таких участников, как пользователь.|  
|131|Audit Schema Object Management Event|Возникает при создании, изменении и удалении серверных объектов.|  
|132|Audit Server Principal Impersonation Event|Возникает при наличии в области действия сервера олицетворения, например EXECUTE AS LOGIN.|  
|133|Audit Database Principal Impersonation Event|Возникает при наличии в области действия базы данных олицетворения, например EXECUTE AS USER или SETUSER.|  
|134|Audit Server Object Take Ownership Event|Возникает при изменении владельца объектов в области действия сервера.|  
|135|Audit Database Object Take Ownership Event|Возникает при изменении владельца объектов в области действия базы данных.|  
|136|Broker:Conversation Group|Происходит, когда компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)] создает новую группу сообщений или удаляет существующую.|  
|137|Blocked Process Report|Возникает, если процесс блокирован дольше, чем указанное время. Не включает системные процессы или процессы, ожидающие ресурсы, для которых невозможно определить состояние взаимоблокировки. Используйте **sp_configure** , чтобы настроить порог и частоту создания отчетов.|  
|138|Broker:Connection|Сообщает о состоянии транспортного соединения, управляемого компонентом [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|139|Broker:Forwarded Message Sent|Происходит, когда компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)] перенаправляет сообщение.|  
|140|Broker:Forwarded Message Dropped|Происходит, когда компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)] удаляет сообщение, предназначенное для перенаправления.|  
|141|Broker:Message Classify|Возникает при определении компонентом [!INCLUDE[ssSB](../../includes/sssb-md.md)] маршрута сообщения.|  
|142|Broker:Transmission|Показывает, что в транспортном уровне компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] возникла ошибка. На источник ошибки указывает ее номер и значения состояния.|  
|143|Broker:Queue Disabled|Указывает, что было обнаружено опасное сообщение, поскольку в очереди компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)] произошло пять последовательных откатов транзакций. Это событие содержит идентификаторы базы данных и очереди, в которой находится опасное сообщение.|  
|144-145|Зарезервированное||  
|146|Showplan XML Statistics Profile|Возникает при выполнении инструкции SQL. Идентифицирует операторы Showplan и выводит все данные процесса компиляции. Обратите внимание, что **двоичный** столбец для этого события содержит закодированную инструкцию Showplan. Для просмотра инструкции Showplan откройте трассировку в приложении SQL Server Profiler.|  
|148|Deadlock Graph|Возникает в том случае, если попытка получить блокировку отменяется потому, что эта попытка была частью взаимоблокировки и была выбрана в качестве жертвы. Предоставляет описание взаимоблокировки в формате XML.|  
|149|Broker:Remote Message Acknowledgement|Возникает при отправке или получении компонентом [!INCLUDE[ssSB](../../includes/sssb-md.md)] подтверждения сообщения.|  
|150|Trace File Close|Происходит при закрытии файла трассировки во время операции переключения на файл продолжения.|  
|151|Зарезервированное||  
|152|Audit Change Database Owner|Возникает при использовании инструкции ALTER AUTHORIZATION для изменения владельца базы данных и проверке разрешений на это действие.|  
|153|Audit Schema Object Take Ownership|Возникает при использовании инструкции ALTER AUTHORIZATION для присвоения владельца объекту и проверке разрешений на это действие.|  
|154|Зарезервированное||  
|155|FT:Crawl Started|Возникает при запуске полнотекстового сканирования (заполнения). Используется для проверки, принят ли сканирующий запрос задачами-исполнителями.|  
|156|FT:Crawl Stopped|Возникает при остановке полнотекстового сканирования (заполнения). Остановка происходит при успешном завершении сканирования или возникновении неустранимой ошибки.|  
|157|FT:Crawl Aborted|Возникает при обнаружении исключения во время полнотекстового сканирования. Обычно приводит к остановке полнотекстового сканирования.|  
|158|Audit Broker Conversation|Уведомляет о сообщениях аудита, связанных с безопасностью диалога компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|159|Audit Broker Login|Уведомляет о сообщениях аудита, связанных с безопасностью транспорта компонента [!INCLUDE[ssSB](../../includes/sssb-md.md)].|  
|160|Broker:Message Undeliverable|Возникает, если компоненту [!INCLUDE[ssSB](../../includes/sssb-md.md)] не удается получить сообщение, которое должно быть доставлено службе.|  
|161|Broker:Corrupted Message|Происходит, когда компонент [!INCLUDE[ssSB](../../includes/sssb-md.md)] получает поврежденное сообщение.|  
|162|User Error Message|Выводит сообщения об ошибках, которые пользователь видит в случае ошибки или исключения.|  
|163|Broker:Activation|Возникает, если монитор очереди запускает хранимую процедуру активации, отправляет уведомление QUEUE_ACTIVATION или по завершению хранимой процедуры активации, запущенной монитором очереди.|  
|164|Object:Altered|Возникает при изменении объекта базы данных.|  
|165|Performance statistics|Возникает, если скомпилированный план запроса кэшируется впервые, повторно компилируется или удаляется из кэша плана.|  
|166|SQL:StmtRecompile|Возникает при повторной компиляции на уровне инструкции.|  
|167|Database Mirroring State Change|Возникает при изменении состояния зеркальной базы данных.|  
|168|Showplan XML For Query Compile|Возникает при компиляции инструкции SQL. Выводит все данные процесса компиляции. Обратите внимание, что **двоичный** столбец для этого события содержит закодированную инструкцию Showplan. Для просмотра инструкции Showplan откройте трассировку в приложении SQL Server Profiler.|  
|169|Showplan All For Query Compile|Возникает при компиляции инструкции SQL. Выводит все данные процесса компиляции. Используется для идентификации операторов Showplan.|  
|170|Audit Server Scope GDR Event|Указывает, что возникло событие «предоставления», «запрещения» или «отмены» для разрешений в области действия сервера, например такое, как создание имени входа.|  
|171|Audit Server Object GDR Event|Указывает, что возникло событие «предоставления», «запрещения» или «отмены» разрешения для объекта схемы, например для таблицы или функции.|  
|172|Audit Database Object GDR Event|Указывает, что возникло событие «предоставления», «запрещения» или «отмены» разрешения для объектов базы данных, например для сборки или схемы.|  
|173|Audit Server Operation Event|Возникает при использовании таких операций аудита безопасности, как изменение параметров, ресурсов, внешнего доступа или проверки подлинности.|  
|175|Audit Server Alter Trace Event|Возникает при проверке инструкцией наличия разрешения ALTER TRACE.|  
|176|Audit Server Object Management Event|Возникает при создании, изменении и удалении серверных объектов.|  
|177|Audit Server Principal Management Event|Возникает при создании, изменении и удалении участников [системы безопасности] на уровне сервера.|  
|178|Audit Database Operation Event|Возникает при таких операциях базы данных, как уведомление запроса контрольной точки или подписки.|  
|180|Audit Database Object Access Event|Возникает при доступе к таким объектам базы данных, как схема.|  
|181|TM: начало выполнения транзакции|Возникает при запуске запроса BEGIN TRANSACTION.|  
|182|TM: начало транзакции завершено|Возникает при завершении запроса BEGIN TRANSACTION.|  
|183|TM: повышение уровня запуска транзакций|Возникает при запуске запроса PROMOTE TRANSACTION.|  
|184|TM: повышение уровня транзакции завершено|Возникает при завершении запроса PROMOTE TRANSACTION.|  
|185|TM: запуск фиксации транзакций|Возникает при запуске запроса COMMIT TRANSACTION.|  
|186|TM: завершена фиксация транзакции|Возникает при завершении запроса COMMIT TRANSACTION.|  
|187|TM: запуск отката транзакции|Возникает при запуске запроса ROLLBACK TRANSACTION.|  
|188|TM: откат транзакции завершен|Возникает при завершении запроса ROLLBACK TRANSACTION.|  
|189|Блокировка: время ожидания (время ожидания > 0)|Возникает при истечении времени ожидания запроса на блокировку ресурса, например страницы.|  
|190|Отчет о состоянии: операция с индексами в сети|Сообщает о ходе выполнения операции построения в сети индекса при работающем процессе построения.|  
|191|TM: запуск сохранения транзакции|Возникает при запуске запроса SAVE TRANSACTION.|  
|192|TM: завершено сохранение транзакции|Возникает при завершении запроса SAVE TRANSACTION.|  
|193|Background Job Error|Возникает при аварийном завершении фонового задания.|  
|194|OLEDB Provider Information|Возникает, если запускается распределенный запрос, который собирает сведения, относящиеся к соединению поставщика.|  
|195|Mount Tape|Возникает при получении запроса на монтирование ленты.|  
|196|Assembly Load|Возникает при запросе на загрузку сборки среды CLR.|  
|197|Зарезервированное||  
|198|XQuery Static Type|Возникает при выполнении выражения языка XQuery. Этот класс событий представляет статический тип выражения XQuery.|  
|199|QN: subscription|Возникает, когда регистрация запроса не может быть подписана. Столбец **TextData** содержит сведения о событии.|  
|200|QN: parameter table|Сведения об активных подписках хранятся во внутренней таблице параметров. Этот класс событий возникает, если создается или удаляется таблица параметров. Обычно такие таблицы создаются или удаляются при перезапуске базы данных. Столбец **TextData** содержит сведения о событии.|  
|201|QN: template|Шаблон запроса представляет класс запросов на подписку. Как правило, запросы того же класса идентичны за исключением значений их параметров. Это событие возникает, если новый запрос на подписку принадлежит существующему классу (Match), новому классу (Create) или классу Drop, который указывает на очистку шаблонов классов запросов, не имеющих активных подписок. Столбец **TextData** содержит сведения о событии.|  
|202|QN: dynamics|Отслеживает внутреннюю деятельность уведомлений запросов. Столбец **TextData** содержит сведения о событии.|  
|212|Bitmap Warning|Указывает, что в запросе отключена фильтрация по битовым картам.|  
|213|Database Suspect Data Page|Указывает, что страница добавляется в таблицу **suspect_pages** в **базе данных msdb**.|  
|214|CPU Threshold Exceeded|Указывает, что регулятор ресурсов обнаружил запрос, превышающий пороговое значение загрузки ЦП (заданное в параметре REQUEST_MAX_CPU_TIME_SEC).|  
|215|PreConnect:Starting|Указывает на запуск триггера LOGON или функции-классификатора регулятора ресурсов.|  
|216|PreConnect:Completed|Указывает на завершение работы триггера LOGON или функции-классификатора регулятора ресурсов.|  
|217|Plan Guide Successful|Указывает, что в SQL Server успешно создан план выполнения для запроса или пакета, в котором содержится структура плана.|  
|218|Plan Guide Unsuccessful|Указывает, что SQL Server не удалось создать план выполнения для запроса или пакета, в котором содержится структура плана. SQL Server выполнил попытку создать план выполнения для этого запроса или пакета без применения структуры плана. Эту проблему могла вызвать недопустимая структура плана. Структуры планов можно проверить при помощи системной функции sys.fn_validate_plan_guide.|  
|235|Audit Fulltext||  
  
`[ @columnid = ] column_id`Идентификатор столбца, добавляемого для события. *column_id* имеет **тип int**и не имеет значения по умолчанию.  
  
 В следующей таблице приводится список столбцов, которые могут добавляться для события.  
  
|Номер столбца|Имя столбца|Описание|  
|-------------------|-----------------|-----------------|  
|1|**TextData**|Текстовое значение, зависящее от класса событий, фиксируемых при трассировке.|  
|2|**BinaryData**|Значение типа Binary, зависящее от класса событий, фиксируемых при трассировке.|  
|3|**DatabaseID**|Идентификатор базы данных, указанной в инструкции USE *Database* , или база данных по умолчанию, если для данного соединения инструкция USE *базы* данных не выполнялась.<br /><br /> Значение для базы данных можно определить с помощью функции DB_ID.|  
|4|**TransactionID**|Назначенный системой идентификатор транзакции.|  
|5|**LineNumber**|Содержит номер строки, в которой имеется ошибка. Для событий, в которых задействованы инструкции языка [!INCLUDE[tsql](../../includes/tsql-md.md)] , например **SP:StmtStarting**, столбец **LineNumber** содержит номер строки инструкции в хранимой процедуре или пакете.|  
|6|**NTUserName**|Имя пользователя [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows.|  
|7|**NTDomainName**|Домен Windows, к которому принадлежит пользователь.|  
|8|**HostName**|Имя клиентского компьютера, отправившего запрос.|  
|9|**ClientProcessID**|Идентификатор, присвоенный клиентским компьютером процессу, в котором работает клиентское приложение.|  
|10|**ApplicationName**|Имя клиентского приложения, установившего соединение с экземпляром [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Этот столбец заполняется значениями, передаваемыми приложением, а не отображаемым именем программы.|  
|11|**LoginName**|Имя входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для клиента.|  
|12|**SPID**|Идентификатор процесса сервера, который [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] присвоил процессу, связанному с клиентом.|  
|13|**Длительность**|Длительность события (в микросекундах). Этот столбец данных не заполняется событием Hash Warning.|  
|14|**StartTime**|Время начала события, если оно доступно.|  
|15|**EndTime**|Время окончания события. Этот столбец не заполняется для классов событий запуска, таких как **SQL:BatchStarting** или **SP:Starting**. Он также не заполняется событием **Hash Warning** .|  
|16|**Буферизует**|Число логических чтений диска, выполненное сервером для данного события. Этот столбец не заполняется событием **Lock: Released** .|  
|17|**Дает**|Число логических обращений к дискам на запись, выполненное сервером для данного события.|  
|18|**ЦП**|Объем времени ЦП (в миллисекундах), использованного событием.|  
|19|**Разрешения**|Представляет битовую карту разрешений. Используется событием Security Auditing.|  
|20|**Серьезность**|Степень серьезности исключения.|  
|21|**EventSubClass**|Тип подкласса события. Этот столбец данных заполняется не для всех классов событий.|  
|22|**ИД**|Идентификатор объекта, назначенный системой.|  
|23|**Успешно**|Успех попытки использования разрешений. Применяется для аудита.<br /><br /> **1** = успешное завершение**0** = сбой|  
|24|**индексид**|Идентификатор индекса объекта, связанного с событием. Чтобы определить идентификатор индекса для объекта, используйте столбец **indid** в системной таблице **sysindexes** .|  
|25|**IntegerData**|Целочисленное значение, зависящее от класса событий, перехватываемых при трассировке.|  
|26|**ServerName**|Имя экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , *ServerName* или *servername\instancename*, для которого выполняется трассировка.|  
|27|**EventClass**|Тип класса событий, который записывается в настоящий момент.|  
|28|**ObjectType**|Тип объекта, например: таблица, функция или хранимая процедура.|  
|29|**NestLevel**|Уровень вложенности, на котором выполняется хранимая процедура. См. раздел [@ @NESTLEVEL &#40;TRANSACT-SQL&#41;](../../t-sql/functions/nestlevel-transact-sql.md).|  
|30|**Состояние**|Состояние сервера в случае ошибки.|  
|31|**Ошибка**|Номер ошибки.|  
|32|**Режим**|Режим полученной блокировки. Этот столбец не заполняется событием **Lock: Released** .|  
|33|**Дескриптор**|Дескриптор объекта, относящегося к событию.|  
|34|**ObjectName**|Имя объекта, к которому выполняется доступ.|  
|35|**DatabaseName**|Имя базы данных, указанной в инструкции USE *Database* .|  
|36|**FileName**|Логическое имя изменяемого файла.|  
|37|**OwnerName**|Имя владельца для объекта ссылки.|  
|38|**RoleName**|Имя базы данных или роли сервера, к которым получает доступ инструкция.|  
|39|**TargetUserName**|Пользовательское имя цели некоторой операции.|  
|40|**DBUserName**|Имя пользовательской базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] для клиента.|  
|41|**LoginSid**|Идентификатор безопасности вошедшего в систему пользователя.|  
|42|**TargetLoginName**|Имя входа цели некоторой операции.|  
|43|**TargetLoginSid**|Идентификатор SID имени входа, которое является целью некоторой операции.|  
|44|**ColumnPermissions**|Состояние разрешений на уровне столбцов. Используется событием Security Auditing.|  
|45|**LinkedServerName**|Имя связанного сервера.|  
|46|**ProviderName**|Имя поставщика OLE DB.|  
|47|**MethodName**|Имя метода OLE DB.|  
|48|**RowCounts**|Количество строк в пакете.|  
|49|**RequestID**|Идентификатор запроса, содержащего инструкцию.|  
|50|**XactSequence**|Токен, описывающий текущую транзакцию.|  
|51|**EventSequence**|Порядковый номер этого события.|  
|52|**BigintData1**|значение **bigint** , которое зависит от класса событий, фиксируемых при трассировке.|  
|53|**BigintData2**|значение **bigint** , которое зависит от класса событий, фиксируемых при трассировке.|  
|54|**GUID**|Значение идентификатора GUID, зависящее от класса события, захваченного при трассировке.|  
|55|**IntegerData2**|Целое число, значение которого зависит от класса событий, захваченного при трассировке.|  
|56|**ObjectID2**|Идентификатор связанного объекта или сущности, если он доступен.|  
|57|**Type**|Целое число, значение которого зависит от класса событий, захваченного при трассировке.|  
|58|**OwnerID**|Тип объекта-владельца блокировки. Только для событий блокировки.|  
|59|**ParentName**|Имя схемы, в которой находится объект.|  
|60|**IsSystem**|Указывает, произошло событие в системном или в пользовательском процессе.<br /><br /> **1** = система<br /><br /> **0** = пользователь.|  
|61|**Offset**|Начальное смещение инструкции в пределах хранимой процедуры или пакета.|  
|62|**SourceDatabaseID**|Идентификатор базы данных, в которой находится источник объекта.|  
|63|**SqlHandle**|64-разрядная версия хэша, основанная на тексте нерегламентированного запроса или базы данных и на идентификаторе объекта SQL. Это значение может быть передано в **sys. dm_exec_sql_text ()** для получения связанного текста SQL.|  
|64|**SessionLoginName**|Имя входа пользователя, который инициировал сеанс. Например, при подключении к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] под именем **Имя_входа1** и при выполнении инструкции под именем **Имя_входа2**поле **SessionLoginName** будет содержать **Имя_входа1**, а поле **LoginName** — **Имя_входа2**. В данном столбце отображаются имена входа [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и Windows.|  
  
 **[ @on =]** *вкл* .  
 Указывает, следует ли привести событие в состояние ON (1) или OFF (0). параметр *On* имеет значение **bit**и не имеет значения по умолчанию.  
  
 Если параметр *On* имеет значение **1**, а *column_id* имеет значение null, то событие устанавливается в значение on и все столбцы очищаются. Если *column_id* не равно null, то для этого события в столбце устанавливается значение ON.  
  
 Если параметр *On* имеет значение **0**, а *column_id* имеет значение null, то событие отключено и все столбцы очищаются. Если *column_id* не равно null, столбец будет отключен.  
  
 В этой таблице показано ** \@ взаимодействие между и** ** \@ columnid**.  
  
|@on|@columnid|Результат|  
|---------|---------------|------------|  
|ON (**1**)|NULL|Событие включено.<br /><br /> Все столбцы очищены.|  
||NOT NULL|Столбец включен для указанного события.|  
|OFF (**0**)|NULL|Событие выключено.<br /><br /> Все столбцы очищены.|  
||NOT NULL|Столбец выключен для указанного события.|  
  
## <a name="return-code-values"></a>Значения кода возврата  
 В следующей таблице описаны значения кодов, которые могут быть возвращены пользователю при завершении хранимой процедуры.  
  
|Код возврата|Описание|  
|-----------------|-----------------|  
|0|Нет ошибки.|  
|1|Неизвестная ошибка.|  
|2|Трассировка в данный момент выполняется. Изменение трассировки в это время приведет к ошибке.|  
|3|Указанное событие недопустимо. Возможно, событие не существует или не соответствует ни одной хранимой процедуре.|  
|4|Указан недопустимый столбец.|  
|9|Указан недопустимый дескриптор трассировки.|  
|11|Указанный столбец используется для внутренних целей и не может быть удален.|  
|13|Нехватка памяти. Возвращается, когда для выполнения указанного действия недостаточно памяти.|  
|16|Недопустимая функция для данной трассировки.|  
  
## <a name="remarks"></a>Комментарии  
 **sp_trace_setevent** выполняет многие действия, ранее выполненные расширенными хранимыми процедурами, доступными в более ранних версиях служб [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Используйте **sp_trace_setevent** вместо следующего:  
  
-   **xp_trace_addnewqueue**  
  
-   **xp_trace_eventclassrequired;**  
  
-   **xp_trace_seteventclassrequired.**  
  
 Пользователи должны выполнять **sp_trace_setevent** для каждого столбца, добавляемого для каждого события. При каждом выполнении, если параметр ** \@ On** имеет значение **1**, **sp_trace_setevent** добавляет указанное событие в список событий трассировки. Если параметр ** \@ On** имеет значение **0**, **sp_trace_setevent** удаляет указанное событие из списка.  
  
 Параметры всех хранимых процедур трассировки SQL (**sp_trace_xx**) строго типизированы. Если эти аргументы указываются с неправильными типами данных входных параметров, как указано в описании их аргументов, хранимая процедура возвратит ошибку.  
  
 Пример использования хранимых процедур трассировки см. в разделе [Создание трассировки (Transact-SQL)](../../relational-databases/sql-trace/create-a-trace-transact-sql.md).  
  
## <a name="permissions"></a>Разрешения  
 Пользователь должен иметь разрешение ALTER TRACE.  
  
## <a name="see-also"></a>См. также  
 [sys. fn_trace_geteventinfo &#40;Transact-SQL&#41;](../../relational-databases/system-functions/sys-fn-trace-geteventinfo-transact-sql.md)   
 [sys. fn_trace_getinfo &#40;Transact-SQL&#41;](../../relational-databases/system-functions/sys-fn-trace-getinfo-transact-sql.md)   
 [sp_trace_generateevent &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sp-trace-generateevent-transact-sql.md)   
 [Справочник по классам событий SQL Server](../../relational-databases/event-classes/sql-server-event-class-reference.md)   
 [Трассировка SQL](../../relational-databases/sql-trace/sql-trace.md)  
  
  
