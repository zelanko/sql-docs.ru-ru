---
title: Создание связей по внешнему ключу | Документация Майкрософт
ms.custom: ''
ms.date: 07/25/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.suite: sql
ms.technology: table-view-index
ms.tgt_pltfrm: ''
ms.topic: conceptual
helpviewer_keywords:
- relationships [SQL Server], creating
ms.assetid: 867a54b8-5be4-46e6-9702-49ae6dabf67c
caps.latest.revision: 21
author: stevestein
ms.author: sstein
manager: craigg
monikerRange: = azuresqldb-current || >= sql-server-2016 || = sqlallproducts-allversions
ms.openlocfilehash: 67760c658b27bcddff443a943c65d725e23f44e7
ms.sourcegitcommit: 1740f3090b168c0e809611a7aa6fd514075616bf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2018
---
# <a name="create-foreign-key-relationships"></a>Создание связей по внешнему ключу
[!INCLUDE[tsql-appliesto-ss2016-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2016-asdb-xxxx-xxx-md.md)]

 > Материалы по предыдущим версиям SQL Server см. в разделе [Создание связей по внешнему ключу](https://msdn.microsoft.com/en-US/library/ms189049(SQL.120).aspx).


  В данном разделе описывается создание связей внешнего ключа в [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../includes/tsql-md.md)]. Связь создается между двумя таблицами, чтобы связать строки одной таблицы со строками другой.    
     
##  <a name="BeforeYouBegin"></a> Подготовка к началу работы Пределы и ограничения
 
-   Ограничение внешнего ключа не обязательно должно быть связано только с ограничением первичного ключа в другой таблице. Кроме того, это ограничение может быть определено для ссылки на столбцы с ограничением UNIQUE в другой таблице.    
    
-   Если столбцу, имеющему ограничение внешнего ключа, задается значение, отличное от NULL, такое же значение должно существовать и в указываемом столбце; в противном случае будет возвращено сообщение о нарушении внешнего ключа. Для обеспечения проверки всех значений сложного ограничения внешнего ключа задайте параметр NOT NULL для всех столбцов, участвующих в индексе.    
    
-   Ограничения FOREIGN KEY могут ссылаться только на таблицы в пределах той же базы данных на том же сервере. Межбазовую ссылочную целостность необходимо реализовать посредством триггеров. Дополнительные сведения см. в разделе [CREATE TRIGGER (Transact-SQL)](../../t-sql/statements/create-trigger-transact-sql.md).    
    
-   Ограничения FOREIGN KEY могут ссылаться на другие столбцы той же таблицы. Это называется самовызовом.    
    
-   Ограничение FOREIGN KEY, определенное на уровне столбцов, может содержать только один ссылочный столбец. Этот столбец должен принадлежать к тому же типу данных, что и столбец, для которого определяется ограничение.    
    
-   Ограничение FOREIGN KEY, определенное на уровне таблицы, должно содержать такое же число ссылочных столбцов, какое содержится в списке столбцов в ограничении. Тип данных каждого ссылочного столбца должен также совпадать с типом соответствующего столбца в списке столбцов.    
    
-   Компонент [!INCLUDE[ssDE](../../includes/ssde-md.md)] не имеет стандартного предела на количество ограничений FOREIGN KEY, содержащихся в таблице, ссылающейся на другие таблицы, или на количество ограничений FOREIGN KEY в других таблицах, ссылающихся на указанную таблицу. Тем не менее фактическое количество ограничений FOREIGN KEY, доступных для использования, ограничивается конфигурацией оборудования, базы данных и приложения.  Максимальное количество таблиц и столбцов, на которые может ссылаться таблица в качестве внешних ключей (исходящих ссылок), равно 253. [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] увеличивает ограничение на количество других таблиц и столбцов, которые могут ссылаться на столбцы в одной таблице (входящие ссылки), с 253 до 10 000.  (Требуется уровень совместимости не менее 130.) Увеличение имеет следующие ограничения:    
    
    -   Превышение 253 ссылок на внешние ключи поддерживается только для операций DELETE и UPDATE DML. Операции MERGE не поддерживаются.    
    
    -   Таблица со ссылкой внешнего ключа на саму себя по-прежнему ограничена 253 ссылками на внешние ключи.    
    
    -   Превышение 253 ссылок на внешние ключи в настоящее время недоступно для индексов columnstore, оптимизированных для памяти таблиц или Stretch Database.    
    
-   Ограничения FOREIGN KEY не применяются к временным таблицам.    
    
-   Если внешний ключ определен на столбце определяемого пользователем типа данных CLR, реализация этого типа должна поддерживать двоичную сортировку. Дополнительные сведения об определяемых пользователем типах данных CLR см. в разделе [Определяемые пользователем типы данных CLR](../../relational-databases/clr-integration-database-objects-user-defined-types/clr-user-defined-types.md).    
    
-   Столбец типа **varchar(max)** может участвовать в ограничении FOREIGN KEY только при условии, что первичный ключ, на который он ссылается, также имеет тип данных **varchar(max)**.    
    

    
##   <a name="permissions"></a>Разрешения    
 Создание новой таблицы с внешним ключом требует разрешения CREATE TABLE в базе данных и разрешения ALTER на схему, в которой создается таблица.    
    
 Создание внешнего ключа в существующей таблице требует разрешения ALTER на таблицу.    
       
    
## <a name="create-a-foreign-key-relationship-in-table-designer"></a>Создание связи по внешнему ключу в конструкторе таблиц 
####  <a name="using-sql-server-management-studio"></a>Использование среды SQL Server Management Studio    
    
1.  В обозревателе объектов щелкните правой кнопкой мыши таблицу, которая будет содержать внешний ключ для связи, и выберите пункт **Конструктор**.    
    
     Таблица откроется в окне **Конструктор таблиц**.    
    
2.  В меню **конструктора таблиц** выберите пункт **Связи**.    
    
3.  В диалоговом окне **Связи внешнего ключа** щелкните **Добавить**.    
    
     Связь появится в списке **Выбранные связи** с именем, установленным системой, в формате FK_\<*tablename*>_\<*tablename*>, где *tablename* — это имя таблицы внешнего ключа.    
    
4.  Щелкните нужную связь в списке **Выбранные связи** .    
    
5.  Щелкните **Спецификация таблиц и столбцов** в сетке справа и нажмите кнопку с многоточием (**...**) справа от свойства.    
    
6.  В диалоговом окне **Таблицы и столбы** в раскрывающемся списке **Первичный ключ** выберите таблицу, которая будет находиться на стороне первичного ключа связи.    
    
7.  В сетке внизу выберите столбцы, составляющие первичный ключ таблицы. В соседней ячейке сетки слева от каждого столбца выберите соответствующий столбец внешнего ключа таблицы внешнего ключа.    
    
     **Конструктор таблиц** автоматически предлагает имя для связи. Чтобы его изменить, отредактируйте содержимое текстового поля **Имя связи** .    
    
8.  Нажмите кнопку **OК** , чтобы создать связь.    
       
## <a name="create-a-foreign-key-in-a-new-table"></a>Создание внешнего ключа в новой таблице  
####  <a name="using-transact-sql"></a>Использование Transact-SQL   
    
1.  В **обозревателе объектов** подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].    
    
2.  На стандартной панели выберите пункт **Создать запрос**.    
    
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**. В этом примере создается таблица и определяется ограничение внешнего ключа для столбца `TempID` , ссылающегося на столбец `SalesReasonID` в таблице `Sales.SalesReason` . Предложения ON DELETE CASCADE и ON UPDATE CASCADE используются для обеспечения распространения изменений, вносимых в таблицу `Sales.SalesReason` на таблицу `Sales.TempSalesReason` .    
    
    ```    
    USE AdventureWorks2012;    
    GO    
    CREATE TABLE Sales.TempSalesReason (TempID int NOT NULL, Name nvarchar(50),     
    CONSTRAINT PK_TempSales PRIMARY KEY NONCLUSTERED (TempID),     
    CONSTRAINT FK_TempSales_SalesReason FOREIGN KEY (TempID)     
        REFERENCES Sales.SalesReason (SalesReasonID)     
        ON DELETE CASCADE    
        ON UPDATE CASCADE    
    );GO    
    
    ```    
    
## <a name="create-a-foreign-key-in-an-existing-table"></a>Создание внешнего ключа в существующей таблице 
#### <a name="using-transasct-sql"></a>Использование Transasct-SQL   
    
1.  В **обозревателе объектов** подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)].    
    
2.  На стандартной панели выберите пункт **Создать запрос**.    
    
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**. В этом примере создается внешний ключ для столбца `TempID`, ссылающийся на столбец `SalesReasonID` в таблице `Sales.SalesReason`.    
    
    ```    
    USE AdventureWorks2012;    
    GO    
    ALTER TABLE Sales.TempSalesReason     
    ADD CONSTRAINT FK_TempSales_SalesReason FOREIGN KEY (TempID)     
        REFERENCES Sales.SalesReason (SalesReasonID)     
        ON DELETE CASCADE    
        ON UPDATE CASCADE    
    ;    
    GO    
    
    ```    
    
     Дополнительные сведения см. в разделах [ALTER TABLE (Transact-SQL)](../../t-sql/statements/alter-table-transact-sql.md), [CREATE TABLE (Transact-SQL)](../../t-sql/statements/create-table-transact-sql.md) и [table_constraint (Transact-SQL)](../../t-sql/statements/alter-table-table-constraint-transact-sql.md).    
    
  
