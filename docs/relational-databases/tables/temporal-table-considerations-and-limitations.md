---
title: Рекомендации и ограничения для темпоральной таблицы | Документация Майкрософт
ms.custom: ''
ms.date: 09/12/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: c8a21481-0f0e-41e3-a1ad-49a84091b422
author: CarlRabeler
ms.author: carlrab
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 516159955d7e4d69d52f1f462c818e3c005f30b3
ms.sourcegitcommit: b2e81cb349eecacee91cd3766410ffb3677ad7e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "70958336"
---
# <a name="temporal-table-considerations-and-limitations"></a>Рекомендации и ограничения для темпоральной таблицы

[!INCLUDE[tsql-appliesto-ss2016-asdb-xxxx-xxx-md](../../includes/tsql-appliesto-ss2016-asdb-xxxx-xxx-md.md)]

Из-за характера системного управления версиями существуют некоторые рекомендации и ограничения, которые следует учитывать при работе с темпоральными таблицами.

При работе с темпоральными таблицами нужно принимать во внимание следующее:

- Для темпоральной таблицы следует определить первичный ключ, чтобы записи текущей таблицы и таблицы журнала коррелировали. Для таблицы журнала определять первичный ключ не нужно.
- Для столбцов периода SYSTEM_TIME, используемых для записи значений **SysStartTime** и **SysEndTime** , необходимо определить тип данных datetime2.
- Если при создании таблицы журнала указывается ее имя, следует также указать имя схемы и таблицы.
- По умолчанию таблица журнала сжимается с использованием метода **PAGE** .
- Если текущая таблица секционирована, таблица журнала создается в файловой группе по умолчанию, так как конфигурация секционирования не реплицируется автоматически из текущей таблицы в таблицу журнала.
- Темпоральные таблицы и таблицы журнала не соответствуют типу **FILETABLE** и могут содержать столбцы любого поддерживаемого типа данных, отличного от **FILESTREAM** , так как **FILETABLE** и **FILESTREAM** позволяют обрабатывать данные вне [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Таким образом, системное управления версиями не гарантируется.
- Таблицу узлов или граничную таблицу нельзя создать как темпоральную или преобразовать в нее.
- Хотя темпоральные таблицы и поддерживают типы данных больших двоичных объектов, например **(n)varchar(max)** , **varbinary(max)** , **(n)text**и **image**, это приводит к значительным затратам на хранение и к снижению производительности из-за их размера. Таким образом, при проектировании системы следует использовать эти типы данных с осторожностью.
- Таблицу журнала нужно создавать в той же базе данных, в которой создавалась текущая таблица. Темпоральные запросы **Linked Server** не поддерживаются.
- Таблица журнала не может иметь ограничений (ограничения первичного и внешнего ключа, а также таблицы или столбца).
- Добавление индексированных представлений в темпоральные запросы (запросы, использующие предложение **FOR SYSTEM_TIME**) не поддерживается.
- Параметр ONLINE (**WITH (ONLINE = ON**) не влияет на **ALTER TABLE ALTER COLUMN** при использовании темпоральной таблицы с системным управлением версиями. Столбец ALTER не выполняется в оперативном режиме независимо от того, какое значение указано для параметра ONLINE.
- Инструкции**INSERT** и **UPDATE** не могут ссылаться на столбцы периода SYSTEM_TIME. Попытки вставить значения непосредственно в эти столбцы будут блокироваться.
- **TRUNCATE TABLE** не поддерживается, если **SYSTEM_VERSIONING** имеет значение **ON**
- Запрещено изменять данные в таблице журнала напрямую.
- В текущей таблице запрещено использовать**ON DELETE CASCADE** и **ON UPDATE CASCADE** . Иными словами, если темпоральная таблица содержит ссылку на таблицы в связи по внешнему ключу (которая соответствует *parent_object_id* в sys.foreign_keys), запрещено использовать параметры CASCADE. Чтобы обойти это ограничение, воспользуйтесь логикой приложения или триггерами AFTER, которые позволяют обеспечить согласованность при удалении в таблице первичного ключа (соответствующую *referenced_object_id* в sys.foreign_keys). Если таблица первичного ключа является темпоральной, а ссылочная таблица — нет, это ограничение отсутствует.

  > [!NOTE]
  > Это ограничение применяется только к SQL Server 2016. Параметры CASCADE поддерживаются в [!INCLUDE[sqldbesa](../../includes/sqldbesa-md.md)] и SQL Server 2017, начиная с CTP версии 2.0.

- Триггеры**INSTEAD OF** запрещено использовать в текущей таблице или в таблице журнала, так как они могут сделать логику DML недопустимой. Триггеры**AFTER** разрешено использовать только в текущей таблице. Они блокируются в таблице журнала, чтобы не сделать логику DML недопустимой.
- Использование технологий репликации ограничено.

  - **Всегда включено** — полностью поддерживается.
  - **Запись и отслеживание измененных данных** — поддерживается только в текущей таблице.
  - **Репликация моментальных снимков и транзакций**— поддерживается только для одного издателя с выключенной технологией Temporal и одного подписчика с включенной технологией Temporal. В этом случае издатель используется для рабочей нагрузки OLTP, а подписчик — для рабочей нагрузки разгрузки отчетов (в том числе для запросов AS OF). Использование нескольких подписчиков не поддерживается, так как это может привести к несогласованности темпоральных данных из-за того, что каждый подписчик будет полагаться на локальные системные часы.
  - **Репликации слиянием** — не поддерживается в темпоральных таблицах.

- Обычные запросы влияют только на данные в текущей таблице. Чтобы запросить данные в таблице журнала, необходимо использовать темпоральный запрос. Они описаны далее в разделе "Запрос темпоральных данных" этой статьи.
- В оптимальной стратегии индексирования будет использоваться кластеризованный индекс columnstore и/или индекс rowstore сбалансированного дерева для текущей таблицы, а также кластеризованный индекс columnstore для таблицы журнала. Такая стратегия будет обеспечивать оптимальный размер и оптимальную производительность. При создании или использовании собственной таблицы журнала мы настоятельно советуем создать этот индекс, состоящий из столбцов периода, начиная с последних. Это позволит ускорить выполнение темпоральных запросов, а также запросов, выполняющихся в ходе проверки согласованности данных. Таблица журнала по умолчанию содержит кластеризованный индекс rowstore, созданный на основе столбцов периода (с конца или с начала). Мы советуем использовать хотя бы некластеризованный индекс rowstore.
- При создании таблицы журнала из текущей таблицы в нее не реплицируются следующие объекты и свойства:

  - определение периода;
  - определение идентификатора;
  - Индексы
  - Статистика
  - Проверочные ограничения
  - Триггеры
  - конфигурация секционирования;
  - Разрешения
  - предикаты безопасности на уровне строк.

- Таблицу журнала нельзя настроить в качестве текущей в цепочке таблиц журнала.

## <a name="see-also"></a>См. также:

- [Темпоральные таблицы](../../relational-databases/tables/temporal-tables.md)
- [Приступая к работе c темпоральными таблицами с системным управлением версиями](../../relational-databases/tables/getting-started-with-system-versioned-temporal-tables.md)
- [Проверка согласованности системной темпоральной таблицы](../../relational-databases/tables/temporal-table-system-consistency-checks.md)
- [Секционирование с помощью темпоральных таблиц](../../relational-databases/tables/partitioning-with-temporal-tables.md)
- [Безопасность темпоральной таблицы](../../relational-databases/tables/temporal-table-security.md)
- [Управление хранением данных журнала в темпоральных таблицах с системным управлением версиями](../../relational-databases/tables/manage-retention-of-historical-data-in-system-versioned-temporal-tables.md)
- [Темпоральные таблицы с системным управлением версиями и таблицы, оптимизированные для памяти](../../relational-databases/tables/system-versioned-temporal-tables-with-memory-optimized-tables.md)
- [Представления и функции метаданных для временной таблицы](../../relational-databases/tables/temporal-table-metadata-views-and-functions.md)
