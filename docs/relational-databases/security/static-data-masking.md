---
title: Статическое маскирование данных | Документация Майкрософт
ms.date: 11/05/2018
ms.prod: sql
ms.prod_service: database-engine, sql-database
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
ms.assetid: a62f4ff9-2953-42ca-b7d8-1f8f527c4d66
author: egranet
ms.author: aliceku
manager: ajayj
monikerRange: =azuresqldb-current||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: cec6c79fadb5ef2a63145fff3efe0df3c8cd0f9d
ms.sourcegitcommit: 467b2c708651a3a2be2c45e36d0006a5bbe87b79
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2019
ms.locfileid: "53980460"
---
# <a name="static-data-masking"></a>Статическое маскирование данных
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../includes/appliesto-ss-asdb-xxxx-xxx-md.md)]

Статическое маскирование данных — это компонент предварительной версии 5 [SQL Server Management Studio](../../ssms/sql-server-management-studio-ssms.md) 18.0 и более поздних версий. Последнюю предварительную версию SQL Server Management Studio можно скачать [здесь](../../ssms/download-sql-server-management-studio-ssms.md). 

![Статическое маскирование данных](../../relational-databases/security/media/sql-static-data-masking/static_data_masking_intro_image.PNG)


## <a name="what-is-static-data-masking"></a>Что такое статическое маскирование данных? 
Статическое маскирование данных — это функция SQL Server Management Studio, которая позволяет пользователям создать маскированную копию базы данных. Она предназначена для организаций, которым требуется совместно использовать данные, в том числе конфиденциальные, как между командами, так и вместе с другими организациями. 

Благодаря замене конфиденциальных данных (данные до маскирования) новыми данными (данные после маскирования) статическое маскирование данных упрощает следующие сценарии: 
- разработка и тестирование; 
- аналитика и бизнес-отчеты; 
- Устранение неполадок 
- предоставление доступа к базе данных консультанту, исследовательской группе или другим третьим лицам. 

В приведенном ниже примере показано, как работает статическое маскирование данных. До маскирования столбец содержит номера социального страхования (SSN). После маскирования первые пять цифр в каждом номере заменяются случайными цифрами.

| Номер социального страхования (до маскирования)   | Номер социального страхования (после маскирования)  |
| ------------- | ------------- |
| 140-38-9110 | 302-92-9110 |
| 463-34-5535 | 189-70-5535 |
| 116-30-8733 | 201-01-8733 |
| 209-36-1971 | 683-10-1971 |
| 372-38-6948 | 372-38-6948 |
| 267-64-2334 | 100-03-2334 |
| 523-93-4176 | 582-20-4176 |
| 573-91-5137 | 730-20-5137 |
| 612-72-1026 | 369-40-1026 |

Пользователи функции статического маскирования данных могут выбрать одну из нескольких функций маскирования. В зависимости от выбранной функции данные до и после маскирования могут быть тесно связаны или абсолютно не связаны. Если функция выполняет смешение, данные после маскирования будут тесно связаны с данными до маскирования. 

| Номер социального страхования (до маскирования) | Номер социального страхования (после маскирования) |
| ------------- | ------------- |
| 140-38-9110 | 612-72-1026 |  
| 463-34-5535 | 372-38-6948 | 
| 116-30-8733 | 523-93-4176 |
| 209-36-1971 | 209-36-1971 | 
| 372-38-6948 | 140-38-9110 |
| 267-64-2334 | 463-34-5535 | 
| 523-93-4176 | 573-91-5137 | 
| 573-91-5137 | 267-64-2334 | 
| 612-72-1026 | 116-30-8733 |

Если функция выполняет замену на значение NULL, данные после маскирования будут не связаны с данными до маскирования. 
 
| Номер социального страхования (до маскирования) | Номер социального страхования (после маскирования) |
| ------------- | ------------- |
| 140-38-9110 | NULL |  
| 463-34-5535 | NULL | 
| 116-30-8733 | NULL |
| 209-36-1971 | NULL | 
| 372-38-6948 | NULL |
| 267-64-2334 | NULL | 
| 523-93-4176 | NULL | 
| 573-91-5137 | NULL | 
| 612-72-1026 | NULL |

## <a name="how-does-static-data-masking-work"></a>Принципы работы статического маскирования данных
Статическое маскирование данных выполняется на уровне столбцов. Пользователи выбирают столбцы для маскирования и для каждого выбранного столбца указывают функцию маскирования. Доступно несколько функций маскирования. Они подробно описываются в разделе [Функции маскирования](#masking-functions). 

Затем функция статического маскирования данных создает копию базы данных. Для базы данных SQL Azure копирование выполняется с помощью [функции копирования](https://azure.microsoft.com/blog/static-data-masking-preview/). Для SQL Server оно осуществляется с помощью операции резервного копирования и последующей операции восстановления. Далее данные маскирования в каждом столбце начинают заменяться данными после маскирования посредством выбранной функции маскирования. 

Замена осуществляется на уровне хранилища. Поэтому по завершении статического маскирования данных получить данные до маскирования из маскированной копии базы данных невозможно.

## <a name="how-to-guide"></a>Руководство

Ниже приведены пошаговые инструкции по выполнению статического маскирования данных. 
 
1. Запустите среду SQL Server Management Studio. Подключитесь к базе данных. В области **Обозреватель объектов** слева разверните папку "Базы данных". Щелкните правой кнопкой мыши базу данных, которую нужно маскировать. Выберите пункт **Задачи**. Выберите пункт **Маскировать базу данных... (предварительная версия)**.
 
 ![Меню задач](../../relational-databases/security/media/sql-static-data-masking/task_data_masking.PNG)
 
2. Появится окно настройки маскирования. В нем будут показаны все таблицы в базе данных. Таблицы представлены по схемам, а внутри схемы упорядочены по алфавиту. 
 
 ![Пользовательский интерфейс](../../relational-databases/security/media/sql-static-data-masking/ui_dropdown.PNG)
 
3. Щелкните значок раскрывающегося списка рядом с именем таблицы, чтобы открыть список всех ее столбцов. Для каждого столбца указан его тип, а также то, допускает ли он значения NULL. Допускающий значение NULL столбец — это столбец, который может принимать значения NULL. 
 
 ![Раскрывающийся список таблицы](../../relational-databases/security/media/sql-static-data-masking/ui_dropdown_column.png)
 
4. Выберите все столбцы, которые необходимо маскировать, и требуемую функцию маскирования. Доступные типы маскирования: **смешение**, **групповое смешение**, маскирование **одним значением**, маскирование **значениями NULL** и маскирование **составными строками**. 
 
 ![Раскрывающийся список функций маскирования](../../relational-databases/security/media/sql-static-data-masking/masking_functions.PNG)
 
 Примечание. Большинство функций маскирования имеют дополнительные параметры. Для маскирования смешением статическое маскирование данных предоставляет параметр по умолчанию. Для маскирования групповым смешением, маскирования одним значением и маскирования составными строками пользователю необходимо настроить параметры. Чтобы изменить или указать параметры конфигурации, щелкните параметр **Настройка...** и укажите в открывшемся диалоговом окне (альтернативное) значение для параметра. Подробное описание каждой функции маскирования см. в разделе [Функции маскирования](#masking-functions).
 
 ![Кнопка настройки функций маскирования](../../relational-databases/security/media/sql-static-data-masking/masking_functions_configure.png)
 
 Выбранные настройки маскирования автоматически проверяются на наличие ошибок и предупреждений, связанных с конфигурацией и схемой.  Если обнаружены ошибки или предупреждения, слева появляется значок. Чтобы получить подробные сведения, наведите на него указатель. 
 
 В примере ниже пользователь выбрал маскирование значениями NULL для столбца, который не допускает значения NULL (ограничение NOT NULL).
 
 ![Ошибка проверки](../../relational-databases/security/media/sql-static-data-masking/validation_mechanism_error_message.PNG)
 
 В примере ниже пользователь выбрал маскирование групповым смешением для одного столбца. Так как для группового смешения требуется по крайней мере два столбца, появляется предупреждение. 
 
 ![Предупреждение проверки](../../relational-databases/security/media/sql-static-data-masking/validation_warning.PNG)
 
5. Конфигурацию маскирования можно сохранить в XML-файле для дальнейшего использования.  Хотя настройка функций маскирования для баз данных SQL Azure и локальных баз данных выполняется одинаково, некоторые сохраняемые свойства (например, путь к файлу резервной копии) немного различаются. Чтобы сохранить конфигурацию, нажмите кнопку **Сохранить конфигурацию**, укажите имя файла и нажмите кнопку "Сохранить".  Чтобы загрузить существующий файл конфигурации, нажмите кнопку **Загрузить конфигурацию**. Файлы конфигурации рекомендуется использовать для таблиц с большим количеством столбцов. 
 
 ![Файл конфигурации](../../relational-databases/security/media/sql-static-data-masking/load_save_config.PNG)
 
6. Функция статического маскирования данных создает в папке **Документы** пользователя вложенную папку с именем "Статическое маскирование данных", в которую помещает файлы журнала. Они могут быть полезны при отладке. Имя файла журнала указывается в нижней части окна конфигурации. 
  
 
7. Если вы выполняете статическое маскирование данных в локальной базе данных, производятся операции резервного копирования и восстановления (только для SQL Server). На этапе **Шаг 2. Клонирование расположения BAK-файла** укажите расположение на сервере, где будет сохранен файл резервной копии. 

## <a name="masking-functions"></a>Функции маскирования

### <a name="null-masking"></a>Маскирование значениями NULL

При маскировании значениями NULL все значения в столбце заменяются значениями NULL. Если столбец не допускает значения NULL, будет возвращена ошибка. 

### <a name="single-value-masking"></a>Маскирование одним значением

При маскировании одним значением все значения в столбце заменяются одним фиксированным значением, указанным пользователем. Формат входных данных должен поддерживать преобразование в тип выбранного столбца. Чтобы указать значение, щелкните **Настроить...**, задайте значение и нажмите кнопку **ОК**. 

![Параметр маскирования одним значением](../../relational-databases/security/media/sql-static-data-masking/single_value_parameter.PNG)


### <a name="shuffle-masking"></a>Маскирование смешением

Все значения в строках столбца меняются местами. Новые данные не генерируются. Маскирование смешением позволяет сохранять значения NULL в столбце. Для этого щелкните **Настроить...** и установите флажок "Не менять положение значений NULL".

![Параметр маскирования смешением](../../relational-databases/security/media/sql-static-data-masking/shuffle_parameter.PNG)

Ниже приведен пример маскирования смешением с изменением и сохранением положений значений NULL.


| Номер социального страхования (до маскирования) | Номер социального страхования (после маскирования со смешением значений NULL) | Номер социального страхования (после маскирования без смешения значений NULL) |
| ------------- | ------------- | ------------- |
| 116-30-8733 | 612-72-1026 | 463-34-5535 |
| 140-38-9110 | NULL | 573-91-5137  |
| 209-36-1971 | 523-93-4176 | 140-38-9110 |
| NULL | 209-36-1971 | NULL |
| 463-34-5535 | 140-38-9110 | 116-30-8733  |
| 523-93-4176 | 463-34-5535 | 612-72-1026  |
| NULL | 573-91-5137 | NULL |
| 573-91-5137 | NULL | 523-93-4176 |
| 612-72-1026  | 116-30-8733  | 209-36-1971 |  

### <a name="group-shuffle-masking"></a>Маскирование групповым смешением
При групповом смешении несколько столбцов объединяются в группу. Значения смешиваются в пределах всех столбцов из группы смешения. Пользователю необходимо указать имя группы смешения, щелкнув **Настроить...**.

![Параметр маскирования групповым смешением](../../relational-databases/security/media/sql-static-data-masking/group_shuffle_parameter.PNG)

Групповое смешение производится в пределах одной таблицы. Если одно и то же имя группы смешения используется в нескольких таблицах, смешение в каждой группе производится отдельно. Имя группы должно быть одинаковым для каждого столбца, включаемого в группу. В нем учитывается регистр. В одной таблице может быть несколько групп смешения (с разными именами). 

### <a name="string-composite-masking"></a>Маскирование составными строками

При маскировании составными строками создаются случайные строки по шаблону. Эта функция предназначена для случаев, когда допустимы только значения, соответствующие определенному строковому шаблону. Например, номера социального страхования (SSN) в США имеют формат 123-45-6789. Синтаксис маскирования составными строками указывается в диалоговом окне, в котором пользователь вводит шаблон.

![Параметр маскирования составными строками](../../relational-databases/security/media/sql-static-data-masking/string_composite.PNG)

Для маскирования составными строками предлагаются три примера шаблонов, которые можно протестировать, щелкнув их. Если щелкнуть шаблон "Номер телефона", поле шаблона автоматически заполнится формулой, необходимой для создания случайных номеров телефона.

![Пример параметра маскирования составными строками](../../relational-databases/security/media/sql-static-data-masking/string_composite_phone_example.PNG)

Маскирование составными строками также имеет расширенный режим, который позволяет заменять часть имеющихся данных строками, созданными по шаблону. Заменяемая часть строки определяется группой записи в регулярном выражении. Например, в адресе электронной почты может заменяться имя пользователя, но сохраняться домен. В номере телефона может сохраняться код города. Дополнительные сведения о регулярных выражениях см. [здесь](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference).

![Пример параметра расширенного маскирования составными строками](../../relational-databases/security/media/sql-static-data-masking/string_composite_advanced.PNG)

Маскирование составными строками, в том числе в расширенном режиме, можно использовать только для столбцов, имеющих [тип данных](../../t-sql/data-types/data-types-transact-sql.md) char, varchar, text, nchar, nvarchar или ntext.

## <a name="limitations"></a>Ограничения 

Статическое маскирование данных имеет указанные ниже ограничения.

- Статическое маскирование данных не поддерживает базы данных с [временными таблицами](../../relational-databases/tables/temporal-tables.md).

- Статическое маскирование данных не маскирует таблицы, [оптимизированные для памяти](../../relational-databases/in-memory-oltp/introduction-to-memory-optimized-tables.md).

- Статическое маскирование данных не маскирует [вычисляемые столбцы](../../relational-databases/tables/specify-computed-columns-in-a-table.md) и столбцы [идентификаторов](../../t-sql/statements/create-table-transact-sql-identity-property.md).

- Статическое маскирование данных не поддерживает базы данных SQL Azure с гипермасштабированием.

- Статическое маскирование данных не поддерживает типы данных geometry и geography. 

Кроме того, на возможности статического маскирования данных налагаются три ограничения.

- Статическое маскирование данных не обновляет [статистику гистограмм](../../relational-databases/statistics/statistics.md). Поэтому после применения статического маскирования данных в статистике гистограмм маскированной копии базы данных могут по-прежнему содержаться конфиденциальные данные. Чтобы избежать этого, можно выполнить инструкцию [UPDATE STATISTICS](../../t-sql/statements/update-statistics-transact-sql.md). 

- Если функция статического маскирования данных возвращает ошибку, все операции маскирования приостанавливаются. Копия базы данных не удаляется и может содержать конфиденциальную информацию. В случае ошибки статического маскирования данных удаление копии базы данных возлагается на пользователя. 

- После применения статического маскирования данных в [файлах данных](../../relational-databases/databases/database-files-and-filegroups.md) и [файле журнала](../../relational-databases/logs/the-transaction-log-sql-server.md) в невыделенной памяти могут по-прежнему сохраняться конфиденциальные данные (только для SQL Server). При наличии доступа к файлам данных и файлу журнала эти конфиденциальные данные можно извлечь с помощью редактора шестнадцатеричных данных.

## <a name="see-also"></a>См. также:  
 [Динамическое маскирование данных](../../relational-databases/security/dynamic-data-masking.md)   
 [Начало работы со статическим маскированием данных в базе данных SQL](https://azure.microsoft.com/documentation/articles/sql-database-static-data-masking-get-started/)  
