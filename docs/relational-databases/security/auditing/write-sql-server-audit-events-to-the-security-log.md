---
title: "Запись событий подсистемы аудита SQL Server в журнал безопасности | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "database-engine"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "журналы [SQL Server], журнал безопасности"
  - "аудит на уровне сервера [SQL Server]"
  - "аудиты [SQL Server], запись в журнал безопасности"
  - "журналы безопасности [SQL Server]"
ms.assetid: 6fabeea3-7a42-4769-a0f3-7e04daada314
caps.latest.revision: 19
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 19
---
# Запись событий подсистемы аудита SQL Server в журнал безопасности
  В среде с повышенной безопасностью подходящим местом для записи событий доступа к объектам является журнал безопасности Windows. Другие местонахождения аудита поддерживаются, но они более уязвимы для вторжения злоумышленников.  
  
 Для записи событий аудита сервера [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] в журнал безопасности Windows существует два основных требования.  
  
-   Параметр аудита доступа к объектам должен быть настроен для записи событий. Программа политики аудита (`auditpol.exe`) предоставляет доступ к ряду внутренних параметров политик в категории **Аудит доступа к объектам**. Чтобы позволить [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] проводить аудит доступа к объектам, нужно настроить параметр **формируется приложением** .  
  
-   Для записи в журнал безопасности Windows учетная запись, из-под которой выполняется служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , должна иметь разрешение **Создание аудитов безопасности** . По умолчанию этим разрешением обладают учетные записи и Locale Service и Network Service. Если служба [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] выполняется от имени одной из этих учетных записей, данный шаг не требуется.  
  
 Политика аудита Windows может повлиять на аудит [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , если включена запись в журнал безопасности Windows, при этом существует опасность потери событий, если политика аудита настроена неправильно. Обычно журнал безопасности Windows перезаписывает более старые события. В результате сохраняются самые последние события. Однако, если журнал безопасности Windows не настроен на перезапись более старых событий, при заполнении журнала безопасности система создаст событие Windows 1104 (журнал заполнен). После этого:  
  
-   Последующие события безопасности не будут регистрироваться  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не сможет установить, что система не регистрирует события в журнале безопасности, в результате чего возможна потеря событий аудита  
  
-   После того как администратор настроит журнал безопасности, режим записи в журнал вернется в нормальное состояние.  
  
 **В этом разделе**  
  
-   **Перед началом работы выполните следующие действия.**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Чтобы записывать события подсистемы аудита SQL Server в журнал безопасности:**  
  
     [Настройте параметр аудита доступа к объектам в Windows с помощью средства auditpol](#auditpolAccess)  
  
     [Настройте параметр аудита доступа к объектам в Windows с помощью средства secpol](#secpolAccess)  
  
     [Предоставьте разрешения на создание аудитов безопасности конкретной учетной записи с помощью средства secpol](#secpolPermission)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
 Администраторы компьютера с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] должны учитывать, что локальные параметры журнала безопасности могут быть переопределены политикой домена. В этом случае политика домена может перезаписывать параметр подкатегории (**auditpol /get /subcategory:"application generated"**). Это может повлиять на способность [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] регистрировать события, причем будет невозможно определить, что события, для которых [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] пытается провести аудит, не регистрируются.  
  
###  <a name="Security"></a> Безопасность  
  
####  <a name="Permissions"></a> Разрешения  
 Для настройки этих параметров необходимо быть администратором Windows.  
  
##  <a name="auditpolAccess"></a> Настройка параметра аудита доступа к объектам в Windows с помощью средства auditpol  
  
1.  Откройте командную строку с правами администратора.  
  
    1.  В меню **Пуск** последовательно укажите пункты **Все программы**, **Стандартные**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите пункт **Запуск от имени администратора**.  
  
    2.  В диалоговом окне **Контроль учетных записей** нажмите кнопку **Продолжить**.  
  
2.  Выполните следующую инструкцию для включения аудита из [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].  
  
    ```  
    auditpol /set /subcategory:"application generated" /success:enable /failure:enable  
    ```  
  
3.  Закройте окно командной строки.  
  
##  <a name="secpolAccess"></a> Предоставление разрешения на создание аудитов безопасности конкретной учетной записи с помощью средства secpol  
  
1.  В любой версии операционной системы Windows в меню **Пуск** выберите пункт **Выполнить**.  
  
2.  Введите **secpol.msc** , а затем нажмите кнопку **ОК**. В диалоговом окне **Управление доступом на уровне пользователей** нажмите кнопку **Продолжить**.  
  
3.  В средстве «Локальная политика безопасности» разверните узел **Настройки безопасности**, разверните узел **Локальные политики**, а затем щелкните **Назначение прав пользователя**.  
  
4.  На панели результатов дважды щелкните **Создание аудитов безопасности**.  
  
5.  На вкладке **Параметр локальной безопасности** нажмите кнопку **Добавить пользователя или группу**.  
  
6.  В диалоговом окне **Выбор: пользователи, компьютеры или группы** либо введите имя учетной записи, например **домен1\пользователь1**, а затем нажмите кнопку **ОК**, либо нажмите кнопку **Дополнительно...** и найдите нужную учетную запись.  
  
7.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
8.  Закройте средство политики безопасности.  
  
9. Перезапустите [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , чтобы включить этот параметр.  
  
##  <a name="secpolPermission"></a> Настройка параметра аудита доступа к объектам в Windows с помощью средства secpol  
  
1.  Если операционная система имеет более раннюю версию, чем [!INCLUDE[wiprlhext](../../../includes/wiprlhext-md.md)] или Windows Server 2008, в меню **Пуск** выберите пункт **Выполнить**.  
  
2.  Введите **secpol.msc** , а затем нажмите кнопку **ОК**. В диалоговом окне **Управление доступом на уровне пользователей** нажмите кнопку **Продолжить**.  
  
3.  В средстве «Локальная политика безопасности» разверните узел **Настройки безопасности**, разверните узел **Локальные политики**, а затем **Политика аудита**.  
  
4.  На панели результатов дважды щелкните **Аудит доступа к объектам**.  
  
5.  На вкладке **Параметр локальной безопасности** в области **Вести аудит следующих попыток доступа** выберите оба параметра: **Успешно** и **Ошибка**.  
  
6.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
7.  Закройте средство политики безопасности.  
  
## См. также:  
 [Подсистема аудита SQL Server (компонент Database Engine)](../../../relational-databases/security/auditing/sql-server-audit-database-engine.md)  
  
  