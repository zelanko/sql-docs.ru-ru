---
title: Создание аудита сервера и спецификации аудита сервера
description: Узнайте, как создать аудит SQL Server и спецификацию аудита сервера с помощью SQL Server Management Studio (SSMS) или Transact-SQL (T-SQL).
ms.custom: seo-lt-2019
ms.date: 10/16/2019
ms.prod: sql
ms.prod_service: security
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
f1_keywords:
- sql13.SWB.SQLAUDIT.FILTER.F1
- sql13.swb.sqlaudit.general.f1
- sql13.swb.sqlaudit.srvaudit.general.f1
helpviewer_keywords:
- server audit [SQL Server]
- audits [SQL Server], specification
ms.assetid: 6624b1ab-7ec8-44ce-8292-397edf644394
author: VanMSFT
ms.author: vanto
ms.openlocfilehash: 655adfa8cd08c0594b43d736bd2bf492d29278fc
ms.sourcegitcommit: 035ad9197cb9799852ed705432740ad52e0a256d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/31/2019
ms.locfileid: "75557859"
---
# <a name="create-a-server-audit-and-server-audit-specification"></a>Создание аудита сервера и спецификации аудита сервера
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  В данном разделе описывается процесс создания аудита сервера и спецификации аудита сервера в [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] с помощью среды [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] или [!INCLUDE[tsql](../../../includes/tsql-md.md)]. *Аудит* экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] или базы данных [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] включает в себя отслеживание и протоколирование событий, происходящих в системе. Объект *Подсистема аудита SQL Server* объединяет отдельные экземпляры действий или групп действий уровня сервера или базы данных, за которыми нужно проводить наблюдение. Аудит работает на уровне экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . На одном экземпляре [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] может существовать несколько аудитов. Объект *Спецификация аудита сервера* принадлежит аудиту. Для каждого аудита вы можете создать один объект спецификации аудита сервера, поскольку они оба создаются в области экземпляра [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] . Дополнительные сведения см. в статье [Подсистема аудита SQL Server (ядро СУБД)](../../../relational-databases/security/auditing/sql-server-audit-database-engine.md).  
  
 **В этом разделе**  
  
-   **Перед началом работы**  
  
     [Ограничения](#Restrictions)  
  
     [Безопасность](#Security)  
  
-   **Создание аудита сервера и спецификации аудита сервера с помощью:**  
  
     [Среда SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
##  <a name="BeforeYouBegin"></a> Перед началом  
  
###  <a name="Restrictions"></a> Ограничения  
  
-   Аудит должен существовать, прежде чем для него будет создана спецификация аудита сервера. Спецификация аудита сервера после создания находится в отключенном состоянии.  
  
-   Инструкция CREATE SERVER AUDIT относится к области транзакции. Если выполняется откат транзакции, происходит также откат этой инструкции.  
  
###  <a name="Security"></a> безопасность  
  
####  <a name="Permissions"></a> Permissions  
  
-   Чтобы создать, изменить или удалить аудит сервера, участникам требуется разрешение ALTER ANY SERVER AUDIT или CONTROL SERVER.  
  
-   Пользователи с разрешением ALTER ANY SERVER AUDIT могут создавать спецификации аудита сервера и привязывать их к любому аудиту.  
  
-   После того как создана спецификация аудита сервера, ее могут просмотреть участники с разрешениями CONTROL SERVER или ALTER ANY SERVER AUDIT, учетная запись sysadmin или участники, имеющие явный доступ к аудиту.  
  
##  <a name="SSMSProcedure"></a> Использование среды SQL Server Management Studio  
  
#### <a name="to-create-a-server-audit"></a>Создание аудита сервера  
  
1.  В обозревателе объектов раскройте папку **Безопасность** .  
  
2.  Щелкните правой кнопкой мыши папку **Аудиты** и выберите пункт **Создать аудит...** .  
  
     На странице **Общие** диалогового окна **Создание аудита** доступны следующие параметры.  
  
     **Имя аудита**  
     Имя аудита. Формируется автоматически при создании нового аудита, но может быть изменено.  
  
     **Задержка очереди (в миллисекундах)**  
     Определяет задержку в миллисекундах, после которой продолжается выполнение действий аудита.  Значение 0 соответствует синхронной доставке. Минимальное значение по умолчанию — **1000** (1 секунда). Максимальное значение составляет 2 147 483 647 (2 147 483,647 секунд или 24 дня, 20 часов, 31 минута и 23,647 секунд).  
  
     **При сбое журнала аудита:**  
     **Продолжить**  
     [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] работа продолжается. Записи аудита не сохраняются. Аудит продолжает попытки регистрации событий и будет возобновлен, если причина сбоя будет устранена. Выбор варианта **Продолжить** разрешает непроверенные действия, которые могут нарушать политики безопасности. Выберите этот параметр, если продолжение операции компонента [!INCLUDE[ssDE](../../../includes/ssde-md.md)] является более важным, чем сохранение полного аудита. Это параметр выбирается по умолчанию.  
  
     **Завершение работы сервера**  
     Приводит к остановке сервера, когда экземпляр сервера, который выполняет запись по назначению, не может записать данные в цель аудита. Имя входа, выполняющее эту команду, должно иметь разрешение **SHUTDOWN** . Если учетная запись не имеет этого разрешения, то функция завершится неуспешно и будет выдано сообщение об ошибке. Отсутствуют события аудита. Выберите этот параметр, если сбой аудита может нанести ущерб безопасности или целостности системы.  
  
     **Ошибка операции**  
     В случае если [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не может выполнить запись в журнал аудита, этот параметр вызывает завершение действий с базами данных с ошибкой, если в противном случае они бы привели к возникновению событий аудита. Отсутствуют события аудита. Действия, которые не вызывают события аудита, можно продолжить. Аудит продолжает попытки регистрации событий и будет возобновлен, если причина сбоя будет устранена. Выберите этот параметр, если обеспечение полного аудита более важно, чем полный доступ к компоненту [!INCLUDE[ssDE](../../../includes/ssde-md.md)].  
  
    > [!IMPORTANT]  
    >  Когда аудит находится в состоянии сбоя, выделенное административное соединение может продолжать выполнять подвергающиеся аудиту события.  
  
     Список**Назначение аудита**  
     Указывает цель для данных аудита. Возможные варианты — двоичный файл, журнал событий приложений Windows или журнал безопасности Windows. [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] не может выполнить запись в журнал безопасности Windows без настройки дополнительных параметров Windows. Дополнительные сведения см. в статье [Запись событий подсистемы аудита SQL Server в журнал безопасности](../../../relational-databases/security/auditing/write-sql-server-audit-events-to-the-security-log.md).  
  
     **Путь к файлу**  
     Указывает местоположение папки, в которую записываются данные аудита, если **Тип назначения аудита** — файл.  
  
     **Кнопка с многоточием (...)**  
     Открывает диалоговое окно **Поиск папки —** _имя\_сервера_, чтобы указать путь к файлу или создать папку, в которую записывается файл аудита.  
  
     **Максимальное количество файлов аудита:**  
     **Максимальное число файлов продолжения**  
     Указывает, что при достижении максимального числа файлов аудита самые старые файлы аудита перезаписываются новым содержимым.  
  
     **Максимальное число файлов**  
     Указывает, что при достижении максимального числа файлов аудита любое действие, которое вызывает создание дополнительных событий аудита, завершится с ошибкой.  
  
     Флажок**Неограниченное количество**  
     При установке флажка **Неограниченное количество** для параметра **Максимальное число файлов продолжения** отсутствует ограничение на число создаваемых файлов аудита. Флажок **Неограниченное количество** установлен по умолчанию и используется для параметров **Максимальное число файлов продолжения** и **Максимальное число файлов** .  
  
     Поле**Количество файлов**  
     Указывает количество создаваемых файлов аудита, до 2 147 483 647. Этот параметр доступен, только если флажок **Неограниченное количество** снят.  
  
     **Максимальный размер файла**  
     Определяет максимальный размер для файла аудита, в мегабайтах (МБ), гигабайтах (ГБ) или терабайтах (ТБ). Можно указать значение до 2 147 483 647 ТБ. Установка флажка в поле **Неограниченное количество** не налагает ограничения на размер файла. Флажок **Неограниченное количество** установлен по умолчанию.  
  
     Флажок**Резервирование места на диске**  
     Указывает, что пространство, заранее выделенное на диске, равно указанному максимальному размеру файла. Этот параметр можно использовать, только если не установлен флажок **Неограниченное количество** для параметра **Максимальный размер файла** . Это флажок по умолчанию не установлен.  
  
3.  Кроме того, на странице **Фильтр** введите предикат или предложение `WHERE` относительно аудита сервера для указания дополнительных параметров, недоступных на странице **Общие** . Заключите предикат в круглые скобки, например: `(object_name = 'EmployeesTable')`.  
  
4.  После завершения выбора параметров нажмите кнопку **ОК**.  
  
#### <a name="to-create-a-server-audit-specification"></a>Создание спецификации аудита сервера  
  
1.  В обозревателе объектов щелкните знак «плюс», чтобы развернуть папку **Безопасность** .  
  
2.  Щелкните правой кнопкой мыши папку **Спецификации аудита сервера** и выберите пункт **Создать спецификацию аудита сервера...** .  
  
     В диалоговом окне **Создание спецификации аудита сервера** доступны следующие параметры.  
  
     **Название**  
     Имя спецификации аудита сервера. Этот текст формируется автоматически во время создания новой спецификации аудита сервера, однако он доступен для изменения.  
  
     **Аудит**  
     Имя существующего аудита сервера. Введите имя аудита или выберите его из списка.  
  
     **Тип действия аудита**  
     Указывает группы действий аудита на уровне сервера и действия аудита для захвата. Список групп действий аудита на уровне сервера и действий аудита, а также описание содержащихся в них событий см. в статье [Действия и группы действий подсистемы аудита SQL Server](../../../relational-databases/security/auditing/sql-server-audit-action-groups-and-actions.md).  
  
     **Схема объекта**  
     Отображает схему для указанного **Имени объекта**.  
  
     **Имени объекта**  
     Имя объекта для аудита. Доступно только для действий аудита и неприменимо к группам аудита.  
  
     **Кнопка с многоточием (...)**  
     Открывает диалоговое окно **Выбор объектов** для просмотра и выбора доступного объекта на основе указанного **Типа действия аудита**.  
  
     **Имя участника**  
     Учетная запись для фильтрации аудита для объекта, подвергнутого аудиту.  
  
     **Кнопка с многоточием (...)**  
     Открывает диалоговое окно **Выбор объектов** для просмотра и выбора доступного объекта с учетом указанного параметра **Имя объекта**.  
  
3.  По завершении нажмите кнопку **ОК**.  
  
##  <a name="TsqlProcedure"></a> Использование Transact-SQL  
  
#### <a name="to-create-a-server-audit"></a>Создание аудита сервера  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../../includes/ssde-md.md)].  
  
2.  На стандартной панели выберите пункт **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**.  
  
    ```  
    -- Creates a server audit called "HIPAA_Audit" with a binary file as the target and no options.  
    CREATE SERVER AUDIT HIPAA_Audit  
        TO FILE ( FILEPATH ='\\SQLPROD_1\Audit\' );  
    ```  
  
#### <a name="to-create-a-server-audit-specification"></a>Создание спецификации аудита сервера  
  
1.  В **обозревателе объектов**подключитесь к экземпляру компонента [!INCLUDE[ssDE](../../../includes/ssde-md.md)].  
  
2.  На стандартной панели выберите пункт **Создать запрос**.  
  
3.  Скопируйте следующий пример в окно запроса и нажмите кнопку **Выполнить**.  
  
    ```  
    /*Creates a server audit specification called "HIPAA_Audit_Specification" that audits failed logins for the SQL Server audit "HIPAA_Audit" created above.  
    */  
  
    CREATE SERVER AUDIT SPECIFICATION HIPAA_Audit_Specification  
    FOR SERVER AUDIT HIPAA_Audit  
        ADD (FAILED_LOGIN_GROUP);  
    GO  
    -- Enables the audit.   
  
    ALTER SERVER AUDIT HIPAA_Audit  
    WITH (STATE = ON);  
    GO  
    ```  
  
 Дополнительные сведения см. в статьях [CREATE SERVER AUDIT (Transact-SQL)](../../../t-sql/statements/create-server-audit-transact-sql.md) и [CREATE SERVER AUDIT SPECIFICATION (Transact-SQL)](../../../t-sql/statements/create-server-audit-specification-transact-sql.md).  
  
  
