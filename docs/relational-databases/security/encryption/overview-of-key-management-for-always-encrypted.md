---
title: "Общие сведения об управлении ключами для постоянного шифрования | Документация Майкрософт"
ms.custom: 
ms.date: 07/20/2016
ms.prod: sql-non-specified
ms.prod_service: database-engine, sql-database
ms.service: 
ms.component: security
ms.reviewer: 
ms.suite: sql
ms.technology:
- dbe-security
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 07a305b1-4110-42f0-b7aa-28a4e32e912a
caps.latest.revision: 
author: stevestein
ms.author: sstein
manager: craigg
ms.workload: On Demand
ms.openlocfilehash: fbe87e904a8e46ae19d6dcb06600352a29949dc2
ms.sourcegitcommit: 37f0b59e648251be673389fa486b0a984ce22c81
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2018
---
# <a name="overview-of-key-management-for-always-encrypted"></a>Overview of Key Management for Always Encrypted
[!INCLUDE[appliesto-ss-asdb-xxxx-xxx-md](../../../includes/appliesto-ss-asdb-xxxx-xxx-md.md)]


Функция [постоянного шифрования](../../../relational-databases/security/encryption/always-encrypted-database-engine.md) использует два типа ключей шифрования для защиты данных: один ключ для шифрования данных, а другой — для шифрования ключа, который шифрует данные. Ключ шифрования столбца шифрует данные, главный ключ столбца шифрует ключ шифрования столбца. В этой статье приведен подробный обзор процесса управления этими ключами.

При обсуждении постоянного шифрования и управления ключами важно понимать различие между фактическими криптографическими ключами и объектами метаданных, *описывающими* ключи. Для обозначения фактических криптографических ключей служат термины **ключ шифрования столбца** и **главный ключ столбца** . Применительно к **описаниям** ключа постоянного шифрования в базе данных используются **метаданные ключа шифрования столбца** и *метаданные главного ключа шифрования* .

- ***Ключи шифрования столбцов*** — это ключи шифрования содержимого, используемые для шифрования данных. Как следует из названия, ключи шифрования столбцов применяются для шифрования данных в столбцах базы данных. С помощью одного и того же ключа шифрования столбца можно зашифровать один или несколько столбцов или можно использовать несколько ключей шифрования столбцов, если этого требует приложение. Ключи шифрования столбцов являются зашифрованными. В базе данных хранятся только зашифрованные значения ключей шифрования столбцов (в составе метаданных ключа шифрования столбца). Метаданные ключа шифрования столбца хранятся в представлениях каталога [sys.column_encryption_keys (Transact-SQL)](../../../relational-databases/system-catalog-views/sys-column-encryption-keys-transact-sql.md) и [sys.column_encryption_key_values (Transact-SQL)](../../../relational-databases/system-catalog-views/sys-column-encryption-key-values-transact-sql.md) . Длина ключей шифрования столбцов, используемых с алгоритмом AES-256, составляет 256 бит.


- ***Главные ключи столбцов*** используются для защиты путем шифрования ключей шифрования столбцов. Главные ключи столбцов должны храниться в надежном хранилище ключей, например хранилище сертификатов Windows, хранилище ключей Azure или аппаратном модуле безопасности. В базе данных содержатся только метаданные о главных ключах столбцов (тип хранилища ключей и местоположение). Метаданные главного ключа столбца хранятся в представлении каталога [sys.column_master_keys (Transact-SQL)](../../../relational-databases/system-catalog-views/sys-column-master-keys-transact-sql.md) .  

Важно отметить, что метаданные ключа в системе базы данных не содержат главных ключей столбцов с открытым текстом или ключей шифрования столбцов с открытым текстом. Базы данных содержат только сведения о типе и расположении главных ключей столбцов и зашифрованные значения ключей шифрования столбцов. Это означает, что ключи с открытым текстом никогда не попадают в систему базы данных, что гарантирует безопасность данных, защищенных с помощью постоянного шифрования, даже в случае компрометации базы данных. Чтобы исключить доступ системы базы данных к ключам с открытым текстом, средства управления ключами следует запускать на компьютере, отличном от компьютера с базой данных. Подробные сведения см. в разделе [Вопросы безопасности для управления ключами](#SecurityForKeyManagement) ниже.

Так как база данных содержит только зашифрованные данные (в столбцах, защищенных функцией постоянного шифрования) и не имеет доступа к ключам с открытым текстом, она не может расшифровать данные. Это означает, что запросы к всегда зашифрованным столбцам будут возвращать зашифрованные значения, поэтому клиентские приложения, которые должны шифровать или расшифровывать защищенные данные, должны иметь доступ к главному ключу столбца и связанным ключам шифрования столбцов. Дополнительные сведения см. в разделе [Постоянное шифрование (разработка клиентских приложений)](../../../relational-databases/security/encryption/always-encrypted-client-development.md).



## <a name="key-management-tasks"></a>Задачи управления ключами

Процесс управления ключами можно разделить на следующие высокоуровневые задачи:

- **Подготовка ключа** — создание физических ключей в надежном хранилище ключей (например, в хранилище сертификатов Windows, хранилище ключей Azure или аппаратном модуле безопасности), шифрование ключей шифрования столбцов с помощью главных ключей столбцов и создание метаданных для обоих типов ключей в базе данных.

- **Смена ключа** — периодическая замена существующего ключа новым ключом. Смена ключа может потребоваться в случае его компрометации или для обеспечения соответствия политикам или нормам организации, предусматривающим смену ключей шифрования. 


## <a name="KeyManagementRoles"></a> Роли в управлении ключами

Существует две разных роли пользователей, управляющих ключами, — администраторы безопасности и администраторы баз данных (DBA).

- **Администратор безопасности** создает ключи шифрования столбцов и главные ключи столбцов и управляет хранилищами ключей, содержащими главные ключи столбцов. Для выполнения этих задач администратор безопасности должен иметь доступ к ключам и хранилищам ключей. Ему не требуется доступ к базе данных.
- **Администратор баз данных** управляет метаданными о ключах в базе данных. Для выполнения основных задач по управлению ключами администратор базы данных должен управлять метаданными в базе данных. Ему не требуется доступ к ключам или хранилищу ключей с главными ключами столбцов.

С учетом указанных выше ролей существует два разных способа реализации задач управления ключами для постоянного шифрования — *с разделением ролей*и *без разделения ролей*. В зависимости от потребностей организации можно выбрать процесс управления ключами, лучше всего соответствующий вашим требованиям.

## <a name="managing-keys-with-role-separation"></a>Управление ключами с разделением ролей
При управлении ключами постоянного шифрования с разделением ролей предполагается, что роли администратора безопасности и администратора баз данных назначены разным людям. Процесс управления ключами с разделением ролей гарантирует, что администраторы баз данных не имеют доступа к ключам или хранилищам ключей с фактическими ключами, а администраторы безопасности не имеют доступа к базе данных, содержащей конфиденциальные данные. Управление ключами с разделением ролей рекомендуется в том случае, если вам нужно обеспечить невозможность доступа администраторов баз данных к конфиденциальным данным. 

**Примечание.** Администраторы безопасности создают ключи с открытым текстом и работают с ними, поэтому они не должны выполнять свои задачи на компьютерах, где размещена система базы данных, или компьютерах, к которым могут получить доступ администраторы баз данных или потенциальные злоумышленники. 

## <a name="managing-keys-without-role-separation"></a>Управление ключами без разделения ролей
При управлении ключами постоянного шифрования без разделения ролей роли администратора безопасности и администратора баз данных могут быть назначены одному человеку. Это значит, что он должен иметь доступ к ключам, хранилищам ключей и метаданным ключей и управлять ими. Управление ключами без разделения ролей может быть рекомендуемым вариантом для организаций, использующих модель разработки и операций, или если база данных размещается в облаке и основная цель заключается в ограничении доступа администраторов облака (но не локальных администраторов баз данных) к конфиденциальным данным.



## <a name="tools-for-managing-always-encrypted-keys"></a>Средства для управления ключами постоянного шифрования

Для управления ключами постоянного шифрования можно использовать [среду SQL Server Management Studio (SSMS)](https://msdn.microsoft.com/library/ms174173.aspx) и [PowerShell](../../scripting/sql-server-powershell.md).

- **SQL Server Management Studio (SSMS)** предоставляет диалоговые окна и мастеры для выполнения задач, касающихся доступа к хранилищу ключей и доступа к базе данных, поэтому среда SSMS не поддерживает разделение ролей, но упрощает процесс настройки ключей. Дополнительные сведения об управлении ключами с помощью среды SSMS см. в разделе:
    - [Подготовка главных ключей столбцов](../../../relational-databases/security/encryption/configure-always-encrypted-using-sql-server-management-studio.md#provisioncmk)
    - [Подготовка ключей шифрования столбцов](../../../relational-databases/security/encryption/configure-always-encrypted-using-sql-server-management-studio.md#provisioncek)
    - [Смена главных ключей столбцов](../../../relational-databases/security/encryption/configure-always-encrypted-using-sql-server-management-studio.md#rotatecmk)
    - [Смена ключей шифрования столбцов](../../../relational-databases/security/encryption/configure-always-encrypted-using-sql-server-management-studio.md#rotatecek)


- **SQL Server PowerShell** содержит командлеты для управления ключами постоянного шифрования с разделением ролей и без разделения ролей. Дополнительные сведения см. в разделе:
    - [Настройка ключей постоянного шифрования с помощью PowerShell](../../../relational-databases/security/encryption/configure-always-encrypted-keys-using-powershell.md)
    - [Смена ключей постоянного шифрования с помощью PowerShell](../../../relational-databases/security/encryption/rotate-always-encrypted-keys-using-powershell.md)


## <a name="SecurityForKeyManagement"></a> Вопросы безопасности для управления ключами

Основной целью постоянного шифрования является обеспечение безопасности конфиденциальных данных, хранящихся в базе данных, даже в случае компрометации системы базы данных или среды ее размещения. Далее приведены примеры атак на систему безопасности и использования постоянного шифрования для препятствия утечке важных данных.

- Злонамеренный пользователь базы данных с высоким уровнем привилегий, например администратор базы данных, выполняющий запросы к столбцам конфиденциальных данных.
- Злонамеренный администратор компьютера с экземпляром SQL Server, проверяющий память процесса SQL Server или файлы дампа процесса SQL Server.
- Злонамеренный оператор ЦОД, выполняющий запросы к базе данных клиента, изучающий файлы дампа SQL Server или проверяющий память компьютера, размещающего данные клиента в облаке.
- Вредоносные программы, запущенные на компьютере, содержащем базу данных.

Чтобы обеспечить эффективное использование постоянного шифрования для защиты от такого рода атак, необходимо так организовать процесс управления ключами, чтобы главные ключи столбцов и ключи шифрования столбцов, а также учетные данные для хранилища ключей, содержащего главные ключи столбцов, были недоступны для потенциальных злоумышленников. Ниже приведен ряд обязательных для выполнения рекомендаций.

- Никогда не создавайте главные ключи столбцов или ключи шифрования столбцов на компьютере с базой данных. Ключи следует создавать на отдельном компьютере, который либо выделен для управления ключами, либо является компьютером с приложениями, которым доступ к ключам требуется в любом случае. Это означает, что **никогда не следует запускать средства, используемые для создания ключей, на компьютере с базой данных** , так как если злоумышленник получит доступ к компьютеру, используемому для подготовки или обслуживания ключей постоянного шифрования, он может получить ключи, даже если они появляются в памяти этого средства на короткое время.
- Чтобы исключить возможность случайного раскрытия главных ключей столбцов или ключей шифрования столбцов в процессе управления ключами, перед определением и реализацией этого процесса крайне важно идентифицировать потенциальных злоумышленников и угрозы безопасности. Например, если требуется, чтобы администраторы баз данных не имели доступа к конфиденциальным данным, то эти администраторы не могут отвечать за создание ключей. Однако администратор баз данных *может* управлять метаданными ключей в базе данных, так как метаданные не содержат ключей с открытым текстом.

## <a name="next-steps"></a>Next Steps

- [Создание и хранение главных ключей столбцов (постоянное шифрование)](../../../relational-databases/security/encryption/create-and-store-column-master-keys-always-encrypted.md)
- [Настройка ключей постоянного шифрования с помощью PowerShell](../../../relational-databases/security/encryption/configure-always-encrypted-keys-using-powershell.md)
- [Смена ключей постоянного шифрования с помощью PowerShell](../../../relational-databases/security/encryption/rotate-always-encrypted-keys-using-powershell.md)
- [Настройка функции Always Encrypted с помощью SQL Server Management Studio](../../../relational-databases/security/encryption/configure-always-encrypted-using-sql-server-management-studio.md)

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Always Encrypted (ядро СУБД)](../../../relational-databases/security/encryption/always-encrypted-database-engine.md)
- [Always Encrypted (Client Development)](../../../relational-databases/security/encryption/always-encrypted-client-development.md)
- [Руководство по использованию мастера постоянного шифрования (хранилище ключей Azure)](https://azure.microsoft.com/documentation/articles/sql-database-always-encrypted-azure-key-vault/)
- [Руководство по использованию мастера постоянного шифрования (хранилище сертификатов Windows)](https://azure.microsoft.com/documentation/articles/sql-database-always-encrypted/)




