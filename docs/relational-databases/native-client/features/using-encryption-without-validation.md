---
title: Использование шифрования без проверки | Документация Майкрософт
ms.custom: ''
ms.date: 12/21/2017
ms.prod: sql
ms.reviewer: ''
ms.suite: sql
ms.technology: native-client
ms.tgt_pltfrm: ''
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], encryption
- cryptography [SQL Server Native Client]
- SQLNCLI, encryption
- encryption [SQL Server Native Client]
- SQL Server Native Client, encryption
ms.assetid: f4c63206-80bb-4d31-84ae-ccfcd563effa
author: MightyPen
ms.author: genemi
manager: craigg
monikerRange: '>= aps-pdw-2016 || = azuresqldb-current || = azure-sqldw-latest || >= sql-server-2016 || = sqlallproducts-allversions'
ms.openlocfilehash: e3e910e17e57c3030cda8698da52e1d851daa1dd
ms.sourcegitcommit: f8ce92a2f935616339965d140e00298b1f8355d7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2018
ms.locfileid: "37429543"
---
# <a name="using-encryption-without-validation"></a>Использование шифрования без проверки
[!INCLUDE[appliesto-ss-asdb-asdw-pdw-md](../../../includes/appliesto-ss-asdb-asdw-pdw-md.md)]
[!INCLUDE[SNAC_Deprecated](../../../includes/snac-deprecated.md)]

[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] всегда шифрует сетевые пакеты, связанные со входом в систему. Если сертификат не был предоставлен на сервере при запуске, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] создает самозаверенный сертификат, который используется для шифрования пакетов входа.  

Самозаверяющие сертификаты не гарантируют безопасности. Зашифрованные подтверждения основан на NT LAN Manager (NTLM). Настоятельно рекомендуется обеспечить подтверждаемого сертификата на сервере SQL Server для безопасного подключения к сети. Безопасности транспортного уровня (TLS) можно сделать только с проверки сертификата.

Приложения могут также запрашивать шифрование всего сетевого трафика путем использования ключевых слов строк соединения или свойств соединения. Ключевые слова являются «Encrypt» для ODBC и OLE DB, при использовании строки поставщика с **IDbInitialize::Initialize**, или «Use Encryption for Data» для ADO и OLE DB при использовании строки инициализации с **IDataInitialize** . Это также можно настроить с [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager с помощью **принудительное шифрование протокола** , а затем по настройке клиента на прием зашифрованных соединений. По умолчанию для шифрования всего сетевого трафика соединения требуется, чтобы сертификат присутствовал на сервере. Установив клиента, чтобы доверять сертификату на сервере, может стать уязвимым для атак man-in--middle. При развертывании подтверждаемого сертификата на сервере, убедитесь, что в настройках клиента о доверии сертификата значение FALSE.

Сведения о ключевых словах строки подключения, см. в разделе [Using Connection String Keywords with SQL Server Native Client](../../../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md).  
  
 Чтобы включить шифрование для использования в том случае, если сертификат не была настроена на сервере, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager можно использовать для того, и **принудительное шифрование протокола** и **доверять сертификату сервера**  параметры. В этом случае шифрование будет использовать самозаверяющий сертификат сервера, не проверяя наличия подтверждаемого сертификата сервера.  
  
 Приложения могут также использовать ключевое слово «TrustServerCertificate» или его атрибут связанного соединения, чтобы гарантировать применение шифрования. Параметры приложения никогда не снижают уровень безопасности, установленный клиентским диспетчером конфигурации [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], но могут повысить его. Например если **принудительное шифрование протокола** не установлен клиент, приложение может само запросить шифрование. Чтобы гарантировать применение шифрования, даже если сертификат сервера не был предоставлен, приложение может запросить шифрование и ключевое слово «TrustServerCertificate». Однако если ключевое слово «TrustServerCertificate» не включено в конфигурации клиента, предоставление сертификата сервера по-прежнему необходимо. В следующей таблице описываются все случаи:  
  
|Параметр «Принудительное шифрование протокола» на клиенте|Параметр «Доверять сертификату сервера» на клиенте|Строка соединения или атрибут соединения «Шифрование/использовать шифрование для данных»|Строка соединения или атрибут соединения «Надежный сертификат сервера»|Результат|  
|----------------------------------------------|---------------------------------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|------------|  
|Нет|Недоступно|Нет (по умолчанию)|Не учитывается|Шифрование отсутствует.|  
|Нет|Недоступно|Да|Нет (по умолчанию)|Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.|  
|Нет|Недоступно|Да|Да|Шифрование производится всегда, однако при этом может использоваться самозаверяющий сертификат сервера.|  
|Да|Нет|Не учитывается|Не учитывается|Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.|  
|Да|Да|Нет (по умолчанию)|Не учитывается|Шифрование производится всегда, однако при этом может использоваться самозаверяющий сертификат сервера.|  
|Да|Да|Да|Нет (по умолчанию)|Шифрование применяется только при наличии подтверждаемого сертификата сервера, в противном случае попытка соединения завершается неудачно.|  
|Да|Да|Да|Да|Шифрование производится всегда, однако при этом может быть использован самозаверяющий сертификат сервера.|  
||||||

> [!CAUTION]
> Только в приведенной выше таблице содержит указания на поведение системы с различными конфигурациями. Безопасное подключение Убедитесь, что на клиенте и сервере обязательное использование шифрования. Также убедитесь, что сервер имеет подтверждаемого сертификата и что **TrustServerCertificate** на клиентском компьютере установлено значение FALSE.

## <a name="sql-server-native-client-ole-db-provider"></a>Поставщик OLE DB для собственного клиента SQL Server  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Поставщика OLE DB для собственного клиента поддерживает шифрование без проверки путем добавления SSPROP_INIT_TRUST_SERVER_CERTIFICATE данных свойства инициализации источника, которое реализовано в наборе свойств DBPROPSET_SQLSERVERDBINIT набор. Кроме того, добавлено новое ключевое слово строки соединения «TrustServerCertificate». Оно принимает значения «yes» и «no», значение по умолчанию — «no». При использовании компонентов службы оно принимает значения true и false, значение по умолчанию — false.  
  
 Дополнительные сведения о усовершенствования, внесенные в наборе свойств DBPROPSET_SQLSERVERDBINIT, см. в разделе [свойства инициализации и авторизации](../../../relational-databases/native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).  
  
## <a name="sql-server-native-client-odbc-driver"></a>Драйвер ODBC для собственного клиента SQL Server  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Драйвер ODBC собственного клиента поддерживает шифрование без проверки с помощью расширения [SQLSetConnectAttr](../../../relational-databases/native-client-odbc-api/sqlsetconnectattr.md) и [SQLGetConnectAttr](../../../relational-databases/native-client-odbc-api/sqlgetconnectattr.md) функции. Добавлен параметр SQL_COPT_SS_TRUST_SERVER_CERTIFICATE, который может принимать значения SQL_TRUST_SERVER_CERTIFICATE_YES или SQL_TRUST_SERVER_CERTIFICATE_NO, где SQL_TRUST_SERVER_CERTIFICATE_NO является значением по умолчанию. Кроме того, добавлено новое ключевое слово строки соединения «TrustServerCertificate». Оно принимает значения «yes» и «no», значение по умолчанию — «no».  
  
## <a name="see-also"></a>См. также  
 [Компоненты SQL Server Native Client](../../../relational-databases/native-client/features/sql-server-native-client-features.md)  
  
  
