---
title: Преобразования из C в SQL | Документация Майкрософт
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- conversions [ODBC], C to SQL
ms.assetid: 7ac098db-9147-4883-8da9-a58ab24a0d31
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: 298e16b814251cf0068436cb5c1a6331aef8c1b4
ms.sourcegitcommit: 75f767c7b1ead31f33a870fddab6bef52f99906b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87332420"
---
# <a name="datetime-data-type-conversions-from-c-to-sql"></a>Преобразования типа данных datetime из C в SQL
[!INCLUDE[SQL Server Azure SQL Database Synapse Analytics PDW ](../../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

  В этом разделе перечислены проблемы, которые следует учитывать при преобразовании из типов C в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] типы даты-времени.  
  
 Преобразования, описанные в следующей таблице, относятся к преобразованиям, совершаемым на клиенте. В случаях, когда клиент задает точность доли секунды для параметра, отличающегося от того, который определен на сервере, преобразование клиента может быть выполнено, но сервер возвратит ошибку при вызове **SQLExecute** или **склексекутедирект** . В частности, ODBC обрабатывает любое усечение доли секунды в качестве ошибки, в то время как [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] поведение является округленным. Например, Округление выполняется при переходе с **datetime2 (6)** на **datetime2 (2)**. Значения столбцов даты-времени округляются до 1/300 секунды, а в значениях типа smalldatetime сервер устанавливает для секунд значение, равное нулю.  
  
|   | SQL_TYPE_DATE | SQL_TYPE_TIME | SQL_SS_TIME2 | SQL_TYPE_TIMESTAMP | SQL_SS_TIMSTAMPOFFSET | SQL_CHAR | SQL_WCHAR |
| - | ------------- | ------------- | ------------ | ------------------ | --------------------- | -------- | --------- |
| **SQL_C_DATE** |1|-|-|1,6|1,5,6|1,13|1,13|  
| **SQL_C_TIME** |-|1|1|1,7|1, 5, 7|1,13|1,13|  
| **SQL_C_SS_TIME2** |-|1,3|1,10|1,7|1, 5, 7|1,13|1,13|  
| **SQL_C_BINARY(SQL_SS_TIME2_STRUCT)** |Недоступно|Недоступно|1,10,11|Недоступно|Недоступно|Недоступно|Недоступно|  
| **SQL_C_TYPE_TIMESTAMP** |1,2|1,3,4|1,4,10|1,10|1,5,10|1,13|1,13|  
| **SQL_C_SS_TIMESTAMPOFFSET** |1,2,8|1,3,4,8|1,4,8,10|1,8,10|1,10|1,13|1,13|  
| **SQL_C_BINARY(SQL_SS_TIMESTAMPOFFSET_STRUCT)** |Недоступно|Недоступно|Недоступно|Недоступно|1,10,11|Недоступно|Недоступно|  
| **SQL_C_CHAR/SQL_WCHAR (date)** |9|9|9|9,6|9,5,6|Недоступно|Недоступно|  
| **SQL_C_CHAR/SQL_WCHAR (time2)** |9|9, 3|9,10|9,7,10|9,5,7,10|Недоступно|Недоступно|  
| **SQL_C_CHAR/SQL_WCHAR (datetime)** |9,2|9, 3, 4|9,4,10|9,10|9,5,10|Недоступно|Недоступно|  
| **SQL_C_CHAR/SQL_WCHAR (datetimeoffset)** |9,2,8|9, 3, 4, 8|9,4,8,10|9,8,10|9,10|Недоступно|Недоступно|  
| **SQL_C_BINARY(SQL_DATE_STRUCT)** |1,11|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|  
| **SQL_C_BINARY(SQL_TIME_STRUCT)** |Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|  
| **SQL_C_BINARY(SQL_TIMESTAMP_STRUCT)** |Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|Недоступно|  
  
## <a name="key-to-symbols"></a>Расшифровка символов  
  
-   **-**: Преобразование не поддерживается. Создается запись диагностики с кодом SQLSTATE 07006 и сообщением «Нарушение атрибута ограниченного типа данных».  
  
-   **1**: Если указанные данные недопустимы, создается диагностическая запись с кодом SQLSTATE 22007 и сообщением «Недопустимый формат даты и времени».  
  
-   **2**: поля времени должны быть равны нулю, либо создается диагностическая запись с кодом SQLSTATE 22008 и сообщением «Частичное усечение».  
  
-   **3**: доли секунды должны быть равны нулю, либо создается диагностическая запись с кодом SQLSTATE 22008 и сообщением «Частичное усечение».  
  
-   **4**: компонент даты игнорируется.  
  
-   **5**: для часового пояса задано значение часового пояса клиента.  
  
-   **6**: время задано равным нулю.  
  
-   **7**: дата установлена на текущую дату.  
  
-   **8**: время преобразуется из часового пояса клиента в UTC. Если во время этого преобразования возникла ошибка, создается запись диагностики с кодом SQLSTATE 22008 и сообщением «Переполнение поля datetime».  
  
-   **9**: строка анализируется и преобразуется в значение Date, DateTime, DateTimeOffset или time в зависимости от первого обнаруженного символа пунктуации и наличия оставшихся компонентов. Затем строка преобразуется в целевой тип согласно правилам, описанным в приведенной выше таблице для типа исходных данных, который выясняется в процессе анализа. Если во время синтаксического анализа обнаружена ошибка, то создается диагностическая запись с кодом SQLSTATE 22018 и сообщением «Недопустимое значение символа для спецификации преобразования». Для параметров типа datetime и smalldatetime, если значение года выходит за пределы допустимого диапазона, создается диагностическая запись с кодом SQLSTATE 22007 и сообщением «Недопустимый формат даты и времени».  
  
     Значение datetimeoffset после преобразования во времени в формате UTC должно находиться в пределах диапазона, даже если преобразование во времени в формате UTC не требуется. Причина этого заключается в том, что поток табличных данных и сервер всегда нормализуют время в значениях datetimeoffset для времени в формате UTC, поэтому клиент должен проверять, что значение времени после преобразования во времени в формате UTC находится в пределах поддерживаемого диапазона. Если переданы недопустимые для поддерживаемого диапазона времени в формате UTC данные, то создается диагностическая запись с кодом SQLSTATE 22007 и сообщением «Недопустимый формат даты и времени».  
  
-   **10**. Если происходит усечение с потерей данных, создается диагностическая запись с кодом SQLSTATE 22008 и сообщением «Недопустимый формат времени». Эта ошибка также возникает в том случае, если значение выходит за пределы диапазона, который может быть представлен диапазоном времени в формате UTC, используемым сервером.  
  
-   **11**: Если длина байта данных не равна размеру структуры, требуемой для типа SQL, создается диагностическая запись с кодом SQLSTATE 22003 и сообщением «числовое значение вне диапазона».  
  
-   **12**: Если длина байта данных равна 4 или 8, данные отправляются на сервер в необработанном формате TDS с типом данных Byte или DateTime. Если байтовая длина данных в точности равна размеру структуры SQL_TIMESTAMP_STRUCT, данные преобразуются в формат потока табличных данных для типа datetime2.  
  
-   **13**. Если происходит усечение с потерей данных, создается диагностическая запись с кодом SQLSTATE 22001 и сообщением «строка данных, усеченные справа».  
  
     Количество долей секунды (шкала) определяется по размеру целевого столбца в соответствии со следующей таблицей.  
  
    |   | Подразумеваемый масштаб | Подразумеваемый масштаб |
    | - | ------------- | ------------- |
    | **Тип** | 0 | 1.. 9 |  
    |**SQL_C_TYPE_TIMESTAMP** |19|21..29|  
  
     Однако для типа SQL_C_TYPE_TIMESTAMP, если доли секунды можно представить в трех разрядах без потери данных, и размер столбца больше или равен 23, для дробной доли секунды создаются ровно три разряда. Это поведение обеспечивает обратную совместимость с приложениями, разработанными в расчете на более старые драйверы ODBC.  
  
     Для размеров столбцов, превышающих диапазон таблицы, подразумевается масштаб 9. Это преобразование должно учитывать доли секунд с точностью до девяти значащих цифр — максимум, поддерживаемый ODBC.  
  
     Если для столбца установлен размер, равный нулю, в ODBC это означает неограниченный размер для символьных типов переменной длины (9 разрядов там, где не работает правило трех разрядов для типа SQL_C_TYPE_TIMESTAMP). Задать размер столбца, равный нулю, для символьных типов фиксированной длины будет ошибкой.  
  
-   **Н/д**: существующее [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] и более раннее поведение сохраняется.  
  
## <a name="see-also"></a>См. также:  
 [Улучшения даты и времени &#40;ODBC&#41;](../../relational-databases/native-client-odbc-date-time/date-and-time-improvements-odbc.md)  
  
  
