---
description: MSSQLSERVER_3023
title: MSSQLSERVER_3023
ms.custom: ''
ms.date: 08/20/2020
ms.prod: sql
ms.reviewer: ramakoni1, pijocoder, suresh-kandoth, Masha
ms.technology: supportability
ms.topic: language-reference
helpviewer_keywords:
- 3023 (Database Engine error)
ms.assetid: ''
author: suresh-kandoth
ms.author: ramakoni
ms.openlocfilehash: 0197c7e5b75164615572e4041a5b348a4d5abcc4
ms.sourcegitcommit: ead0b8c334d487a07e41256ce5d6acafa2d23c9d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2020
ms.locfileid: "92418795"
---
# <a name="mssqlserver_3023"></a>MSSQLSERVER_3023
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

## <a name="details"></a>Сведения

|attribute|Значение|
|---|---|
|Название продукта|SQL Server|
|Идентификатор события|3023|
|Источник события|MSSQLSERVER|
|Компонент|SQLEngine|
|Символическое имя|DB_IN_USE_DUMP|
|Текст сообщения|Резервное копирование и операции с файлами (такие как ALTER DATABASE ADD FILE) в базе данных должны быть сериализованы. Повторите инструкцию после завершения текущей операции резервного копирования или операции с файлами.|
||

## <a name="explanation"></a>Пояснение

Вы пытаетесь выполнить команду резервного копирования, сжатия или изменения базы данных в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и получаете следующие сообщения:

> Сообщение 3023, уровень 16, состояние 2, строка 1  
Резервное копирование и операции с файлами (такие как ALTER DATABASE ADD FILE) в базе данных должны быть сериализованы. Повторите инструкцию после завершения текущей операции резервного копирования или операции с файлами.

> Сообщение 3013, уровень 16, состояние 1, строка 1  
Процесс BACKUP DATABASE завершается аварийно.

Кроме того, в журнале ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] есть сообщения наподобие следующих:

> Ошибка резервного копирования \<Datetime>: 3041, серьезность: 16, состояние: 1.  
Резервное копирование \<Datetime>. BACKUP не выполнила команду BACKUP DATABASE MyDatabase WITH DIFFERENTIAL. Проверьте дополнительные сообщения в журнале приложения резервного копирования.

Вы также можете заметить, что эти команды возвращают `wait_type = LCK_M_U` и `wait_resource = DATABASE: <id> [BULKOP_BACKUP_DB]` при просмотре их состояния в различных динамических административных представлениях, например `sys.dm_exec_requests` или `sys.dm_os_waiting_tasks`.

## <a name="possible-causes"></a>Возможные причины

Существует ряд правил в отношении того, какие операции разрешены или запрещены в процессе полного резервного копирования базы данных. Ниже приведен ряд примеров.

- Одновременно может выполняться только одно резервное копирование данных (в процессе полного резервного копирования разностное или добавочное резервное копирование выполняться не может).
- Одновременно может выполняться только одно резервное копирование журналов (резервное копирование журналов разрешено во время полного резервного копирования базы данных).
- Во время резервного копирования в базу данных нельзя добавлять файлы или удалять их из базы данных.
- Во время резервного копирования базы данных нельзя сжимать файлы.
- Во время резервного копирования в модель восстановления можно вносить лишь некоторые изменения.

При выполнении любой из этих конфликтующих операций команды будут сталкиваться с ожиданиями блокировки, как указано в разделе "Пояснение" для сообщений 3023 и 3041.

## <a name="user-action"></a>Рекомендуемые действия

Проверьте расписания различных операций по обслуживанию базы данных и скорректируйте их таким образом, чтобы эти операции или команды не конфликтовали друг с другом.

## <a name="more-information"></a>Дополнительные сведения

[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] регистрирует время начала и окончания резервного копирования в базе данных `msdb`. Вы можете проверить журнал резервного копирования, чтобы определить, происходило ли полное резервное копирование базы данных в тот момент, когда была предпринята попытка добавочного резервного копирования, что привело к ошибке. В этом вам может помочь следующий запрос:

```sql
select database_name, type, backup_start_date, backup_finish_date
from msdb.dbo.backupset
order by database_name, type, backup_start_date, backup_finish_date
go
```

Можно также использовать событие **User Error Message** в трассировке профилировщика SQL или расширенное событие **error_reported** для отслеживания передачи сообщений 3023 приложению, которое инициировало резервное копирование или другую команду обслуживания.
