---
description: MSSQLSERVER_5180
title: MSSQLSERVER_5180
ms.custom: ''
ms.date: 08/20/2020
ms.prod: sql
ms.reviewer: ramakoni1, pijocoder, suresh-kandoth, Masha
ms.technology: supportability
ms.topic: language-reference
helpviewer_keywords:
- 5180 (Database Engine error)
ms.assetid: ''
author: rgward
ms.author: ramakoni
ms.openlocfilehash: cbdc30c1e05d50bb20df3f9e3ebf54097c770743
ms.sourcegitcommit: ead0b8c334d487a07e41256ce5d6acafa2d23c9d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2020
ms.locfileid: "92418826"
---
# <a name="mssqlserver_5180"></a>MSSQLSERVER_5180
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]

## <a name="details"></a>Сведения

|attribute|Значение|
|---|---|
|Название продукта|SQL Server|
|Идентификатор события|5180|
|Источник события|MSSQLSERVER|
|Компонент|SQLEngine|
|Символическое имя|DSK_BAD_FCB_FILEID|
|Текст сообщения|Невозможно открыть файл FCB из-за недопустимого идентификатора %d в базе данных "%.*ls". Проверьте местоположение этого файла. Выполните инструкцию DBCC CHECKDB.|
||

## <a name="explanation"></a>Пояснение

Запрос или операция могут завершиться ошибкой 5180, когда [!INCLUDE[ssDENoVersion](../../includes/ssdenoversion_md.md)] ссылается на недопустимый идентификатор файла. Пример:

> Сообщение 5180, уровень 22, состояние 1, строка 1  
Невозможно открыть файл FCB из-за недопустимого идентификатора %d в базе данных "%.*ls". Проверьте местоположение этого файла. Выполните инструкцию DBCC CHECKDB.

Так как ошибка имеет уровень серьезности 22, сеанс пользователя будет отключен. Это сообщение об ошибке записывается в журнал ошибок [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и в журнал событий приложений Windows с EventID = 5180.

## <a name="possible-causes"></a>Возможные причины

[!INCLUDE[ssDENoVersion](../../includes/ssdenoversion-md.md)] ссылается на идентификаторы файлов в различных ситуациях, в первую очередь при ссылке на идентификатор страницы (так как идентификатор файла является первой частью идентификатора страницы). Если по какой-либо причине идентификатор файла имеет значение меньше нуля или не является допустимым в базе данных (не относится к числу допустимых идентификаторов файлов, перечисленных в системных представлениях каталога, таких как sys.database_files), может произойти ошибка 5180.

Одной из возможных причин является то, что хранимый идентификатор файла недопустим. Так как перенаправляемая запись в строке ссылается на другую страницу, при обращении к этой странице может возникнуть ошибка 5180, если идентификатор файла недопустим. Это приведет к ошибке повреждения базы данных на странице с перенаправляемой записью. (В данном примере `DBCC CHECKDB` выдаст сообщение 8993.)

Другой пример — недопустимый идентификатор файла как часть идентификатора страницы, который хранится в заголовке страницы для следующего или предыдущего идентификатора страницы. Это поле используется для связывания ряда страниц, например в кластеризованном индексе. Если идентификатор файла является недопустимым для предыдущей или следующей страницы, то, когда ядру необходимо сослаться на него для перехода к следующей или предыдущей странице, может возникнуть ошибка 5180. (В данном примере `DBCC CHECKDB` выдает сообщение 8981.)

Если проблема не связана с недопустимым идентификатором файла из-за повреждения сохраненного идентификатора страницы, то она может быть в [!INCLUDE[ssDENoVersion](../../includes/ssdenoversion-md.md)].

## <a name="user-action"></a>Рекомендуемые действия

При возникновении этой ошибки следует выполнить `DBCC CHECKDB` для базы данных, как указано в сообщении. При обнаружении ошибок следует выполнить восстановление из известной удачной резервной копии. Если восстановление из резервной копии невозможно, другой вариант — воспользоваться параметром восстановления команды `DBCC CHECKDB`, как рекомендуется в ее выходных данных. В большинстве случаев восстановление после ошибки этого типа приводит к потере данных. Дополнительные сведения о причинах повреждений баз данных см. в следующей статье: [Устранение ошибок согласованности базы данных, обнаруженных командой DBCC CHECKDB](https://support.microsoft.com/kb/2015748).

Если `DBCC CHECKDB` не сообщает об ошибках, но проблема повторяется, обратитесь за помощью в службу технической поддержки Майкрософт. Будьте готовы предоставить запрос, который вызывает ошибку 5180. Сведения о том, как определить запрос, при выполнении которого произошла ошибка, см. в разделе [Дополнительные сведения](#more-information).

## <a name="more-information"></a>Дополнительные сведения

Блок управления файлами (FCB) — это внутренняя структура памяти, которая отслеживает важные сведения о файле, связанном с базой данных. Идентификатор файла однозначно определяет FCB для базы данных. Если ядро сервера пытается сослаться на недопустимый идентификатор файла, структуру FCB найти не удается, из-за чего происходит ошибка 5180.

Чтобы узнать, при выполнении какого запроса возникла ошибка, можно использовать указанные ниже методы.

- В версии [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 2008 и более поздних проверьте, есть ли в сеансе system_health запись об ошибке, которая должна включать текст запроса. Дополнительные сведения о сеансе system_health см. в следующем ресурсе: [Поддержка SQL Server 2008. Сеанс system_health](https://techcommunity.microsoft.com/t5/sql-server-support/supporting-sql-server-2008-the-system-health-session/ba-p/315509).
- Используйте профилировщик [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и зарегистрируйте события `SQL:BatchStarting`, `RPC:Starting` и события исключений. Найдите запрос, предшествующий событию исключения 5180 для сеанса, связанного с событием исключения.
