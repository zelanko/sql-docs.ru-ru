---
title: Использование резервных копий журнала транзакций (SQL Server) | Документация Майкрософт
description: В этой статье описывается применение резервных копий журналов транзакций в процессе восстановления базы данных SQL Server по модели полного восстановления или восстановления с неполным протоколированием.
ms.custom: ''
ms.date: 10/23/2019
ms.prod: sql
ms.prod_service: backup-restore
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restoring [SQL Server], log backups
- transaction log backups [SQL Server], applying backups
- online restores [SQL Server], log backups
- transaction log backups [SQL Server], quantity needed for restore sequence
- backups [SQL Server], log backups
ms.assetid: 9b12be51-5469-46f9-8e86-e938e10aa3a1
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: f70156f5f725b10af712d0d5e898367715e46394
ms.sourcegitcommit: 4d3896882c5930248a6e441937c50e8e027d29fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82834548"
---
# <a name="apply-transaction-log-backups-sql-server"></a>Применение резервных копий журналов транзакций (SQL Server)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Этот раздел относится только к модели полного восстановления и модели восстановления с неполным протоколированием.  
  
 В этом разделе описано применение резервных копий журнала транзакции в процессе восстановления базы данных [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .  
 
##  <a name="requirements-for-restoring-transaction-log-backups"></a><a name="Requirements"></a> Требования к восстановлению резервных копий журналов транзакций  
 Для применения резервной копии журнала транзакций необходимо выполнить следующие требования.  
  
-   **Достаточное количество резервных копий журналов для последовательности восстановления:** Чтобы провести полную последовательность восстановления, в резервных копиях журнала должно быть достаточно записей. Необходимые резервные копии журнала, включая при необходимости [резервные копии конца журнала](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) , должны быть доступны перед запуском последовательности восстановления.  
  
-   **Правильный порядок восстановления:**  Сначала необходимо восстановить предыдущую полную или разностную резервную копию базы данных. После этого в хронологическом порядке необходимо восстановить все журналы транзакций, созданные после указанной полной или разностной резервной копии. Если резервная копия журнала транзакций в этой цепочке журналов утрачена или повреждена, то восстановить можно только журналы транзакций до отсутствующего журнала.  
  
-   **База данных еще не восстановлена:**  Базу данных нельзя восстановить до тех пор, пока не будет применен последний журнал транзакций. Если база данных восстанавливается после восстановления одной из промежуточных резервных копий журнала транзакций, расположенной перед концом цепочки журналов, базу данных после этой точки можно восстановить без перезапуска всей последовательности восстановления, начинающейся с полной резервной копии базы данных.  
  
    > [!TIP]
    > Рекомендуется восстановить все резервные копии журналов (`RESTORE LOG *database_name* WITH NORECOVERY`). Затем, после восстановления последней резервной копии журнала, восстановите базу данных в отдельной операции (`RESTORE DATABASE *database_name* WITH RECOVERY`).  
  
##  <a name="recovery-and-transaction-logs"></a><a name="RecoveryAndTlogs"></a> Журналы восстановления и транзакций  
 После завершения операции восстановления и восстановления базы данных выполняется процесс восстановления для обеспечения целостности базы данных. Дополнительные сведения о процессе восстановления см. в статье [Обзор процессов восстановления (SQL Server)](../../relational-databases/backup-restore/restore-and-recovery-overview-sql-server.md#TlogAndRecovery).
 
 После завершения процесса восстановления база данных переходит в режим "в сети", и к ней больше невозможно применить резервные копии журнала транзакций. Например, серия резервных копий журнала транзакций содержит долго выполняющуюся транзакцию. Начало транзакции записано в первой резервной копии журнала транзакций, а конец транзакции записан во второй резервной копии журнала транзакций. В первой резервной копии журнала транзакций нет записи об операции фиксации или отката. Если операция восстановления запускается при применении первой резервной копии журнала транзакций, то долго выполняющаяся транзакция рассматривается как незавершенная, а изменения в данных, записанные в первой резервной копии журнала транзакций, будут отменены. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] не позволяет применять вторую резервную копию журнала транзакций.  
  
> [!NOTE]
> В некоторых обстоятельствах при восстановлении журнала можно явно добавить файл.  
  
##  <a name="use-log-backups-to-restore-to-the-failure-point"></a><a name="PITrestore"></a> Использование резервных копий журнала для восстановления до точки сбоя  
 Предполагается такая последовательность событий.  
  
|Time|Событие|  
|----------|-----------|  
|8:00|Создание резервной копии базы данных для создания полной резервной копии базы данных.|  
|Полдень|Резервное копирование журнала транзакций.|  
|16:00|Резервное копирование журнала транзакций.|  
|18:00|Создание резервной копии базы данных для создания полной резервной копии базы данных.|  
|20:00|Резервное копирование журнала транзакций.|  
|21:45|Произошел сбой.|  
  
> Объяснение этого примера последовательности резервных копий см. в разделе [Резервные копии журналов транзакций (SQL Server)](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md).  
  
 Чтобы восстановить базу данных до ее состояния в 21:45 (точка сбоя), может быть использована любая из следующих альтернативных процедур.  

 **Вариант 1. Восстановление базы данных с помощью последней полной резервной копии базы данных**  
  
1.  Создайте резервную копию заключительного фрагмента активного журнала транзакций на момент точки сбоя.  
  
2.  Не восстанавливайте полную резервную копию базы данных, резервной копии базы данных от 18:00. Вместо этого восстановите последнюю полную резервную копию, созданную в 18:00:00 а затем примените резервную копию журнала и резервную копию заключительного фрагмента журнала, созданные в 20:00:00.  
  
 **Вариант 2. Восстановление базы данных с использованием более ранней полной резервной копии базы данных**  
  
> Этот вариант можно использовать в том случае, если проблема не позволяет воспользоваться полной резервной копии базы данных от 18:00. Этот процесс занимает больше времени, чем восстановление полной резервной копии базы данных от 18:00.  
  
1.  Создайте резервную копию заключительного фрагмента активного журнала транзакций на момент точки сбоя.  
  
2.  Восстановите полную резервную копию базы данных от 8:00, а затем последовательно восстановите все четыре резервные копии журнала транзакций. Это позволяет произвести накат всех завершенных транзакций вплоть до 21:45.  
  
     Этот вариант указывает на избыточную безопасность, предлагаемую цепочкой резервных копий журнала транзакций в серии полных резервных копий базы данных.  
  
> В некоторых случаях журналы транзакций могут также использоваться для восстановления базы данных на определенный момент времени. Дополнительные сведения см. в разделе [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](../../relational-databases/backup-restore/restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Related tasks  
 **Использование резервной копии журнала транзакций**  
  
-   [Восстановление резервной копии журнала транзакций (SQL Server)](../../relational-databases/backup-restore/restore-a-transaction-log-backup-sql-server.md)  
  
 **Восстановление до нужной точки восстановления**  
  
-   [Восстановление базы данных до точки сбоя в модели полного восстановления (Transact-SQL)](../../relational-databases/backup-restore/restore-database-to-point-of-failure-full-recovery.md)  
  
-   [Восстановление базы данных SQL Server до определенного момента времени (модель полного восстановления)](../../relational-databases/backup-restore/restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md)  
  
-   <xref:Microsoft.SqlServer.Management.Smo.Restore.SqlRestore%2A> (SMO)  
  
-   [Восстановление связанных баз данных, которые содержат помеченную транзакцию](../../relational-databases/backup-restore/recovery-of-related-databases-that-contain-marked-transaction.md)  
  
-   [Восстановление до номера LSN (SQL Server)](../../relational-databases/backup-restore/recover-to-a-log-sequence-number-sql-server.md)  
  
 **Восстановление базы данных после восстановления резервных копий с параметром WITH NORECOVERY**  
  
-   [Восстановление базы данных без восстановления данных (Transact-SQL)](../../relational-databases/backup-restore/recover-a-database-without-restoring-data-transact-sql.md)  
  
## <a name="see-also"></a>См. также раздел  
 [Журнал транзакций (SQL Server)](../../relational-databases/logs/the-transaction-log-sql-server.md)     
 [Руководство по архитектуре журнала транзакций SQL Server и управлению им](../../relational-databases/sql-server-transaction-log-architecture-and-management-guide.md)      
  
