---
title: Восстановление в сети (SQL Server) | Документация Майкрософт
description: В выпуске SQL Server Enterprise в некоторых случаях можно восстановить данные по файлу, странице или поэтапному восстановлению, пока база данных остается в сети.
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: backup-restore
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- online restores [SQL Server]
- online restores [SQL Server], about online restores
ms.assetid: 7982a687-980a-4eb8-8e9f-6894148e7d8c
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: d5d371a8d94b49a40fa105f06457519a03ed7ac5
ms.sourcegitcommit: 4d3896882c5930248a6e441937c50e8e027d29fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82829798"
---
# <a name="online-restore-sql-server"></a>Восстановление в сети (SQL Server)
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]
  Восстановление в сети поддерживается только в выпуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise. В настоящем выпуске восстановление файлов, страниц или поэтапное восстановление выполняется по умолчанию в режиме «в сети». Этот раздел относится только к базам данных, содержащим несколько файлов или файловых групп, а также (для простой модели восстановления) к файловым группам, доступным только для чтения.  
  
 Восстановление данных из копии, когда база данных находится в режиме «в сети», называется *восстановлением в сети*. Считается, что база данных находится в режиме «в сети», если первичная файловая группа находится в режиме «в сети», даже если одна или несколько вторичных файловых групп находится в режиме «вне сети». Если база данных находится в режиме «в сети», то файл можно восстановить при любой модели восстановления. Кроме того, при использовании модели полного восстановления можно восстанавливать страницы, когда база данных находится в режиме «в сети».  
  
> [!NOTE]  
>  В выпуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise восстановление в сети выполняется автоматически и не требует участия пользователя. Если восстановление в сети не требуется, то перед началом восстановления можно перевести базу данных в режим «вне сети». Дополнительные сведения см. в разделе [Перевод базы данных или файла в режим «вне сети»](#taking_db_or_file_offline)ниже в этом разделе.  
  
 Во время восстановления в сети файлов все файлы и соответствующие файловые группы находятся в режиме «вне сети». Если какой-либо файл при запуске восстановления в сети находится в режиме «в сети», то первая инструкция восстановления переводит файловую группу этого файла в режим «вне сети». Во время восстановления страниц в сети, наоборот, в режиме «вне сети» находится только страница.  
  
 Любой сценарий восстановления в сети состоит из следующих основных шагов.  
  
1.  Восстановление данных.  
  
2.  Восстановление журнала с параметром WITH RECOVERY для восстановления последнего журнала. Восстановленные данные переводятся в режим «в сети».  

 Иногда невозможно выполнить откат незафиксированной транзакции, поскольку данные, требующие отката, во время запуска восстановления в сети находятся в режиме «вне сети». В этом случае транзакция откладывается. Дополнительные сведения см. в разделе [Отложенные транзакции (SQL Server)](../../relational-databases/backup-restore/deferred-transactions-sql-server.md).  
  
> [!NOTE]  
>  Если в базе данных используется модель восстановления с неполным протоколированием, то перед запуском восстановления в сети рекомендуется переключиться на модель полного восстановления. Дополнительные сведения см. в разделе [Просмотр или изменение модели восстановления базы данных (SQL Server)](../../relational-databases/backup-restore/view-or-change-the-recovery-model-of-a-database-sql-server.md).  
  
> [!IMPORTANT]  
>  Если резервные копии создавались при наличии нескольких носителей, присоединенных к серверу, то в процессе восстановления в сети должно быть доступно то же самое количество носителей.  
  
> [!CAUTION]  
>  При использовании резервных копий моментальных снимков нельзя выполнять **Online Restore**. Дополнительные сведения о **резервном копировании путем создания моментального снимка**см. в статье [Резервные копии моментальных снимков файлов для файлов базы данных в Azure](../../relational-databases/backup-restore/file-snapshot-backups-for-database-files-in-azure.md).  
  
## <a name="log-backups-for-online-restore"></a>Создание резервных копий журналов для восстановления в сети  
 При восстановлении в сети точкой восстановления служит точка, в которой восстанавливаемые данные в последний раз переводились в режим «вне сети» или режим «только для чтения». Должны быть доступны все резервные копии журналов транзакций до этой точки восстановления включительно. Как правило, чтобы захватить точку восстановления, необходимо использовать для восстановления резервную копию журналов после этой точки. Единственным исключением является восстановление данных в сети, предназначенных только для чтения, из резервной копии данных, которая сделана после перевода данных в режим «только для чтения». В этом случае резервная копия журналов не требуется.  
  
 Обычно резервное копирование этих журналов транзакций можно выполнить, когда база данных находится в режиме «в сети», даже после запуска последовательности восстановления. Выбор времени создания последней резервной копии журналов зависит от свойств восстанавливаемого файла.  
  
-   Для файла в сети, предназначенного только для чтения, можно использовать необходимую для восстановления последнюю резервную копию журналов, которая требуется до первой последовательности восстановления или во время нее. Для файловой группы только для чтения резервные копии журналов могут и не требоваться, если после переключения этой группы в режим «только для чтения» была создана резервная копия данных или разностная резервная копия.  
  
    > [!NOTE]  
    >  Приведенные выше сведения также относятся ко всем файлам вне сети.  
  
-   Особым случаем является файл, доступный для чтения и записи, который находился в режиме «в сети» при получении первой инструкции восстановления и который автоматически был переведен этой инструкцией в режим «вне сети». В этом случае следует создать резервные копии журналов во время первой *последовательности восстановления* (последовательности из одной и нескольких инструкций RESTORE, которые восстанавливают данные, выполняют накат и восстанавливают данные по журналу). Обычно такое резервное копирование журналов должно выполняться после восстановления всех полных резервных копий и до восстановления данных. Но если для определенной файловой группы существует несколько резервных копий файлов, то ближайшей точкой восстановления журналов будет время, когда файловая группа была переведена в режим «вне сети». Такое резервное копирование журналов после восстановления захватывает точку, в которой файл был переведен в режим «вне сети». Резервное копирование после восстановления данных является необходимым, поскольку [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] не может использовать журнал «в сети» для восстановления «в сети».  
  
    > [!NOTE]  
    >  Кроме того, можно вручную перевести файл в режим «вне сети» до последовательности восстановления. Дополнительные сведения см. в разделе «Перевод базы данных или файла в режим «вне сети» ниже в этом разделе.  
  
##  <a name="taking-a-database-or-file-offline"></a><a name="taking_db_or_file_offline"></a> Перевод базы данных или файла в режим «вне сети»  
 Если восстановление в сети не требуется, то перед началом последовательности восстановления базу данных можно перевести в режим «вне сети» следующими способами.  
  
-   При любой модели восстановления базу данных можно перевести в режим «вне сети» с помощью следующей инструкции [ALTER DATABASE](../../t-sql/statements/alter-database-transact-sql.md) :  
  
     ALTER DATABASE *имя_базы_данных* SET OFFLINE  
  
-   Кроме того, при модели полного восстановления можно принудительно перевести восстановление файла или страницы в режим «вне сети» с помощью следующей инструкции [BACKUP LOG](../../t-sql/statements/backup-transact-sql.md) , переводящей базу данных в состояние восстановления:  
  
     BACKUP LOG *имя_базы_данных* WITH NORECOVERY.  
  
 Пока база данных остается в режиме «вне сети», все операции автономного восстановления.  
  
## <a name="examples"></a>Примеры  
  
> [!NOTE]  
>  Синтаксис последовательности восстановления в сети тот же самый, что и в случае последовательности восстановления вне сети.  
  
-   [Пример. Поэтапное восстановление базы данных &#40;простая модель восстановления&#41;](../../relational-databases/backup-restore/example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [Пример. Поэтапное восстановление отдельных файловых групп &#40;простая модель восстановления&#41;](../../relational-databases/backup-restore/example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
-   [Пример. Оперативное восстановление доступного только для чтения файла &#40;простая модель восстановления&#41;](../../relational-databases/backup-restore/example-online-restore-of-a-read-only-file-simple-recovery-model.md)  
  
-   [Пример. Поэтапное восстановление базы данных &#40;модель полного восстановления&#41;](../../relational-databases/backup-restore/example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [Пример. Поэтапное восстановление только некоторых файловых групп &#40;модель полного восстановления&#41;](../../relational-databases/backup-restore/example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
-   [Пример. Оперативное восстановление файла, доступного для чтения и записи &#40;модель полного восстановления&#41;](../../relational-databases/backup-restore/example-online-restore-of-a-read-write-file-full-recovery-model.md)  
  
-   [Пример. Оперативное восстановление файла, доступного только для чтения &#40;модель полного восстановления&#41;](../../relational-databases/backup-restore/example-online-restore-of-a-read-only-file-full-recovery-model.md)  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> Связанные задачи  
  
-   [Восстановление файлов и файловых групп (SQL Server)](../../relational-databases/backup-restore/restore-files-and-filegroups-sql-server.md)  
  
-   [Восстановление страниц (SQL Server)](../../relational-databases/backup-restore/restore-pages-sql-server.md)  
  
-   [Управление таблицей suspect_pages (SQL Server)](../../relational-databases/backup-restore/manage-the-suspect-pages-table-sql-server.md)  
  
-   [Восстановление базы данных без восстановления данных (Transact-SQL)](../../relational-databases/backup-restore/recover-a-database-without-restoring-data-transact-sql.md)  
  
-   [Удаление уничтоженных файловых групп (SQL Server)](../../relational-databases/backup-restore/remove-defunct-filegroups-sql-server.md)  
  
## <a name="see-also"></a>См. также:  
 [Восстановления файлов (модель полного восстановления)](../../relational-databases/backup-restore/file-restores-full-recovery-model.md)   
 [Восстановление файлов (простая модель восстановления)](../../relational-databases/backup-restore/file-restores-simple-recovery-model.md)   
 [Восстановление страниц (SQL Server)](../../relational-databases/backup-restore/restore-pages-sql-server.md)   
 [Поэтапное восстановление (SQL Server)](../../relational-databases/backup-restore/piecemeal-restores-sql-server.md)   
 [Обзор процессов восстановления (SQL Server)](../../relational-databases/backup-restore/restore-and-recovery-overview-sql-server.md)  
  
  
