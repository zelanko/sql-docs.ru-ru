---
title: sys.dm_exec_query_optimizer_info (Transact-SQL) | Документы Microsoft
ms.custom: ''
ms.date: 03/15/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.service: ''
ms.component: dmv's
ms.reviewer: ''
ms.suite: sql
ms.technology:
- database-engine
ms.tgt_pltfrm: ''
ms.topic: language-reference
f1_keywords:
- dm_exec_query_optimizer_info_TSQL
- dm_exec_query_optimizer_info
- sys.dm_exec_query_optimizer_info_TSQL
- sys.dm_exec_query_optimizer_info
dev_langs:
- TSQL
helpviewer_keywords:
- sys.dm_exec_query_optimizer_info dynamic management view
ms.assetid: 1d72cef1-22d8-4ae0-91db-6694fe918c9e
caps.latest.revision: 30
author: stevestein
ms.author: sstein
manager: craigg
ms.workload: Inactive
monikerRange: '>= aps-pdw-2016 || = azuresqldb-current || = azure-sqldw-latest || >= sql-server-2016 || = sqlallproducts-allversions'
ms.openlocfilehash: 8744cd8041f08d0b846b388bf0c06e01b2713220
ms.sourcegitcommit: 7a6df3fd5bea9282ecdeffa94d13ea1da6def80a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2018
---
# <a name="sysdmexecqueryoptimizerinfo-transact-sql"></a>sys.dm_exec_query_optimizer_info (Transact-SQL)
[!INCLUDE[tsql-appliesto-ss2008-all-md](../../includes/tsql-appliesto-ss2008-all-md.md)]

  Возвращает подробные статистики по операциям оптимизатора запросов [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Это представление можно использовать для настройки рабочей нагрузки при обнаружении проблем, связанных с оптимизацией запросов, или для улучшения производительности обработки запросов. Например, можно использовать общее число оптимизаций, значение затрачиваемого времени и значение конечной стоимости для сравнения с оптимизацией запросов текущей рабочей нагрузки и любыми изменениями во время процесса настройки. Некоторые счетчики предоставляют данные, которые могут быть использованы только для внутренней диагностики [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Эти счетчики помечены атрибутом «Только для внутреннего использования.».  
  
> [!NOTE]  
>  Вызов его из [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)] или [!INCLUDE[ssPDW](../../includes/sspdw-md.md)], используйте имя **sys.dm_pdw_nodes_exec_query_optimizer_info**.  
  
|Название|Тип данных|Описание|  
|----------|---------------|-----------------|  
|**Счетчик**|**nvarchar(4000)**|Имя события статистики оптимизатора.|  
|**occurrence**|**bigint**|Количество вхождений события оптимизации для этого счетчика.|  
|**value**|**float**|Среднее значение свойства для вхождения события.|  
|**pdw_node_id**|**int**|**Применяется к**: [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)], [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]<br /><br /> Идентификатор для узла, это распределение.|  
  
## <a name="permissions"></a>Разрешения  

На [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)], требуется `VIEW SERVER STATE` разрешение.   
На [!INCLUDE[ssSDS_md](../../includes/sssds-md.md)], требуется `VIEW DATABASE STATE` разрешение в базе данных.   
    
## <a name="remarks"></a>Замечания  
 **sys.dm_exec_query_optimizer_info** содержит следующие свойства (счетчики). Все значения частотности рассматриваются совокупно и при перезапуске системы устанавливаются в 0. Все значения полей значений при перезапуске системы устанавливаются в NULL. Все значения значимых столбцов, по которым определяется среднее, используют значение частотности из той же строки, что и знаменатель в вычислении среднего. Все оптимизации запросов измеряются, когда [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] определяет наличие изменений в **dm_exec_query_optimizer_info**, включая обоих пользователей и сформированные системой запросы. Выполнение кэшированного плана не изменяет значений в **dm_exec_query_optimizer_info**, оптимизация значимыми являются только.  
  
|Счетчик|Применяемость|Значение|  
|-------------|----------------|-----------|  
|оптимизации|Общее число операций оптимизации.|Неприменимо|  
|затраченное время|Общее число операций оптимизации.|Среднее время, затраченное на оптимизацию отдельной инструкции (запроса), в секундах.|  
|окончательные затраты|Общее число операций оптимизации.|Средняя оценка затрат для оптимизированного плана во внутренних единицах затрат.|  
|обычный план|Только для внутреннего использования.|Только для внутреннего использования.|  
|задачи|Только для внутреннего использования.|Только для внутреннего использования.|  
|без плана|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0 time|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 0 tasks|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1 time|Только для внутреннего использования.|Только для внутреннего использования.|  
|search 1 tasks|Только для внутреннего использования.|Только для внутреннего использования.|  
|поиск 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|время поиска 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|задачи поиска 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|gain stage 0 to stage 1|Только для внутреннего использования.|Только для внутреннего использования.|  
|выигрыш при переходе от стадии 1 к стадии 2|Только для внутреннего использования.|Только для внутреннего использования.|  
|timeout|Только для внутреннего использования.|Только для внутреннего использования.|  
|превышение предела памяти|Только для внутреннего использования.|Только для внутреннего использования.|  
|инструкции insert|Количество операций оптимизации для инструкций INSERT.|Неприменимо|  
|инструкции delete|Количество операций оптимизации для инструкций DELETE.|Неприменимо|  
|инструкции update|Количество операций оптимизации для инструкций UPDATE.|Неприменимо|  
|содержащие вложенный запрос|Количество операций оптимизации для запросов, содержащих как минимум один вложенный запрос.|Неприменимо|  
|сбой устранения вложенности|Только для внутреннего использования.|Только для внутреннего использования.|  
|таблицы|Общее число операций оптимизации.|Среднее число таблиц, на которые ссылается оптимизированный запрос.|  
|указания|Количество раз, когда было задано указание. Список указаний включает: указания запросов JOIN, группы, UNION и FORCE ORDER, параметр набора FORCE PLAN и указания по соединению.|Неприменимо|  
|указание упорядочивания|Количество раз, когда было задано указание принудительного упорядочивания.|Неприменимо|  
|указание соединения|Количество раз, когда по указанию соединения принудительно вызывался алгоритм соединения.|Неприменимо|  
|обращение к представлению|Количество раз, когда производилось обращение к представлению в запросе.|Неприменимо|  
|удаленный запрос|Количество операций оптимизации, при которых запрос обращался как минимум к одному удаленному источнику данных, например к таблице с четырехкомпонентным именем или результату инструкции OPENROWSET.|Неприменимо|  
|максимальное DOP|Общее число операций оптимизации.|Среднее эффективное значение MAXDOP для оптимизированного плана. По умолчанию эффективное значение MAXDOP определяется **максимальная степень параллелизма** server configuration option и может быть переопределена для конкретного запроса значением указания запроса MAXDOP.|  
|максимальный уровень рекурсии|Количество операций оптимизации, в которых был задан уровень MAXRECURSION больше 0 в рамках указания запроса.|Средний уровень MAXRECURSION в операциях оптимизации, для которых был задан максимальный уровень рекурсии в рамках указания запроса.|  
|загруженные индексированные представления|Только для внутреннего использования.|Только для внутреннего использования.|  
|сопоставленные индексированные представления|Количество операций оптимизации, в которых было сопоставлено одно или несколько индексированных представлений.|Среднее количество сопоставленных представлений.|  
|использованные индексированные представления|Количество операций оптимизации, для которых в выходном плане было использовано одно или несколько индексированных представлений после согласования.|Среднее количество использованных представлений.|  
|обновленные индексированные представления|Количество операций оптимизации DML-инструкции, выдающих план, обслуживающий одно или несколько индексированных представлений.|Среднее количество обслуженных представлений.|  
|запрос динамического курсора|Количество операций оптимизации, для которых был указан запрос динамического курсора.|Неприменимо|  
|запрос быстрого перемещения курсора вперед|Количество операций оптимизации, для которых был указан запрос однопроходного курсора.|Неприменимо|  
|merge stmt|Количество операций оптимизации для инструкций MERGE.|Неприменимо|  
  
## <a name="examples"></a>Примеры  
  
### <a name="a-viewing-statistics-on-optimizer-execution"></a>A. Просмотр статистики выполнения оптимизатора  
 Каковы текущие статистики выполнения оптимизатора для данного экземпляра [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]?  
  
```  
SELECT * FROM sys.dm_exec_query_optimizer_info;  
```  
  
### <a name="b-viewing-the-total-number-of-optimizations"></a>Б. Просмотр общего количества операций оптимизации  
 Количество выполняемых операций оптимизации.  
  
```  
SELECT occurrence AS Optimizations FROM sys.dm_exec_query_optimizer_info  
WHERE counter = 'optimizations';  
```  
  
### <a name="c-average-elapsed-time-per-optimization"></a>В. Среднее время, затраченное на операцию оптимизации  
 Каково среднее время, затраченное на операцию оптимизации?  
  
```  
SELECT ISNULL(value,0.0) AS ElapsedTimePerOptimization  
FROM sys.dm_exec_query_optimizer_info WHERE counter = 'elapsed time';  
```  
  
### <a name="d-fraction-of-optimizations-that-involve-subqueries"></a>Г. Доля операций оптимизации, в которых задействованы вложенные запросы  
 Доля оптимизированных запросов, содержащих вложенные запросы.  
  
```  
SELECT (SELECT CAST (occurrence AS float) FROM sys.dm_exec_query_optimizer_info WHERE counter = 'contains subquery') /  
       (SELECT CAST (occurrence AS float)   
        FROM sys.dm_exec_query_optimizer_info WHERE counter = 'optimizations')  
        AS ContainsSubqueryFraction;  
```  
  
## <a name="see-also"></a>См. также  
 [Динамические административные представления и функции (Transact-SQL)](~/relational-databases/system-dynamic-management-views/system-dynamic-management-views.md)   
 [Динамические административные представления и функции, связанные с выполнением &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/execution-related-dynamic-management-views-and-functions-transact-sql.md)  
  
  


