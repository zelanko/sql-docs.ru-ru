---
description: sys.dm_os_schedulers (Transact-SQL)
title: sys.dm_os_schedulers (Transact-SQL) | Документация Майкрософт
ms.custom: ''
ms.date: 03/13/2017
ms.prod: sql
ms.prod_service: database-engine, sql-database, sql-data-warehouse, pdw
ms.reviewer: ''
ms.technology: system-objects
ms.topic: language-reference
f1_keywords:
- dm_os_schedulers
- sys.dm_os_schedulers_TSQL
- sys.dm_os_schedulers
- dm_os_schedulers_TSQL
dev_langs:
- TSQL
helpviewer_keywords:
- sys.dm_os_schedulers dynamic management view
ms.assetid: 3a09d81b-55d5-416f-9cda-1a3a5492abe0
author: markingmyname
ms.author: maghan
monikerRange: '>=aps-pdw-2016||=azuresqldb-current||=azure-sqldw-latest||>=sql-server-2016||=sqlallproducts-allversions||>=sql-server-linux-2017||=azuresqldb-mi-current'
ms.openlocfilehash: b6055413a3ff32882e86c65dd69353e44b2353bb
ms.sourcegitcommit: 2991ad5324601c8618739915aec9b184a8a49c74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/11/2020
ms.locfileid: "97332998"
---
# <a name="sysdm_os_schedulers-transact-sql"></a>sys.dm_os_schedulers (Transact-SQL)
[!INCLUDE [sql-asdb-asdbmi-asa-pdw](../../includes/applies-to-version/sql-asdb-asdbmi-asa-pdw.md)]

  Возвращает по одной строке для каждого планировщика [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], сопоставленного с отдельным процессором. Используйте это представление для мониторинга состояния планировщика или для определения отклонившихся от расписания задач. Дополнительные сведения о планировщиках см. в разделе [пошаговое описание архитектуры потоков и задач](../../relational-databases/thread-and-task-architecture-guide.md).  
  
> [!NOTE]  
>  Чтобы вызвать эту функцию из [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)] или [!INCLUDE[ssPDW](../../includes/sspdw-md.md)] , используйте имя **sys.dm_pdw_nodes_os_schedulers**.  
  
|Имя столбца|Тип данных|Описание|  
|-----------------|---------------|-----------------|  
|scheduler_address|**varbinary(8)**|Адрес памяти планировщика. Не допускает значение NULL.|  
|parent_node_id|**int**|Идентификатор узла, к которому относится планировщик; этот узел еще называют родительским. Он является узлом с неоднородным доступом к памяти (NUMA). Не допускает значение NULL.|  
|scheduler_id|**int**|Идентификатор планировщика. Все планировщики, используемые для выполнения обычных запросов, имеют идентификаторы меньше 1048576. Планировщики с идентификаторами, равными 255 или превышающими это значение, используются внутренними механизмами [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], такими как планировщик выделенных административных соединений. Не допускает значение NULL.|  
|cpu_id|**smallint**|Идентификатор ЦП, присвоенный планировщику.<br /><br /> Не допускает значение NULL.<br /><br /> **Примечание.** 255 не указывает сходство, которое было в нем [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] . Дополнительные сведения о сходстве см. в разделе [sys.dm_os_threads &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-os-threads-transact-sql.md) .|  
|status|**nvarchar(60)**|Указывает состояние планировщика. Может иметь одно из следующих значений:<br /><br /> — СКРЫТО В СЕТИ<br />-СКРЫТО В АВТОНОМНОМ РЕЖИМЕ<br />— ВИДИМЫЙ В СЕТИ<br />— ВИДИМЫЙ ВНЕ СЕТИ<br />— ВИДИМЫЙ В СЕТИ (DAC)<br />— HOT_ADDED<br /><br /> Не допускает значение NULL.<br /><br /> Планировщики с состоянием HIDDEN используются для обработки внутренних запросов компонента [!INCLUDE[ssDE](../../includes/ssde-md.md)]. Планировщики с состоянием VISIBLE — для обработки пользовательских запросов.<br /><br /> Планировщики с состоянием OFFLINE соответствуют процессорам, находящимся в маске схожести в режиме вне сети и поэтому не используемым для обработки запросов. Планировщики с состоянием ONLINE соответствуют процессорам, находящимся в маске схожести в режиме в сети и поэтому доступным для обработки потоков.<br /><br /> Состояние DAC указывает на то, что планировщик выполняется через выделенное административное соединение.<br /><br /> Состояние HOT ADDED указывает, что планировщики были добавлены в ответ на событие ЦП с поддержкой горячей замены.|  
|is_online|**bit**|Если [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] настроен на использование лишь некоторых доступных на сервере процессоров, некоторые планировщики могут быть сопоставлены с процессорами, не указанными в маске схожести. Если это так, то этот столбец вернет 0. Это значение означает, что планировщик не используется для обработки запросов или пакетов.<br /><br /> Не допускает значение NULL.|  
|is_idle|**bit**|1 = планировщик находится в состоянии простоя. В настоящий момент не запущен ни один из исполнителей. Не допускает значение NULL.|  
|preemptive_switches_count|**int**|Число переключений в режим с вытеснением исполнителей, обслуживаемых данным планировщиком.<br /><br /> Чтобы выполнить код, внешний по отношению к [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (например, расширенную хранимую процедуру или распределенный запрос), поток должен выйти из-под управления планировщика, работающего в режиме без вытеснения. Для этого исполнитель переходит в режим с вытеснением.|  
|context_switches_count|**int**|Число переключений контекста, выполненных на данном планировщике. Не допускает значение NULL.<br /><br /> Чтобы предоставить возможность выполнения другим исполнителям, работающий в настоящий момент исполнитель должен освободить планировщик или переключить контекст.<br /><br /> **Примечание.** Если Рабочая роль выдает планировщик и помещает себя в готовую к работе очередь, а затем не находит других рабочих ролей, работник выбирает себя. В этом случае обновляется значение yield_count, но не context_switches_count.|  
|idle_switches_count|**int**|Число ситуаций, в которых планировщик ожидал события, находясь в состоянии простоя. Это значение аналогично значению context_switches_count. Не допускает значение NULL.|  
|current_tasks_count|**int**|Количество задач, ассоциированных в настоящий момент с данным планировщиком. Этот счетчик включает:<br /><br /> — Задачи, ожидающие выполнения исполнителя.<br />— Задачи, ожидающие или выполняемые в данный момент (в ПРИОСТАНОВЛЕНном или ГОТОВом состоянии).<br /><br /> При завершении задачи этот счетчик уменьшается. Не допускает значение NULL.|  
|runnable_tasks_count|**int**|Количество исполнителей с назначенными задачами, которые ожидают назначения в очереди готовых к работе. Не допускает значение NULL.|  
|current_workers_count|**int**|Количество исполнителей, ассоциированных с данным планировщиком. В их число входят исполнители, которым не назначена никакая задача. Не допускает значение NULL.|  
|active_workers_count|**int**|Количество активных исполнителей. Активный исполнитель никогда не работает в режиме с вытеснением; он должен иметь связанную с ним задачу и либо работает, либо готов к выполнению, либо приостановлен. Не допускает значение NULL.|  
|work_queue_count|**bigint**|Число задач в очереди на выполнение. Это задачи, ожидающие исполнителя, который бы их выполнил. Не допускает значение NULL.|  
|pending_disk_io_count|**int**|Число операций ввода-вывода, ожидающих завершения. Каждый планировщик имеет список незавершенных операций ввода-вывода, проверяя при каждом переключении контекста, не завершены ли они. Этот счетчик увеличивается при поступлении запроса и уменьшается при завершении обработки запроса. Он не характеризует состояние операций ввода-вывода. Не допускает значение NULL.|  
|load_factor|**int**|Внутреннее значение, характеризующее нагрузку на планировщик. Оно используется для распределения задач между планировщиками. Это значение может оказаться полезным при отладке в случае неравномерного распределения нагрузки между планировщиками. Решение о маршрутизации выполняется в зависимости от загрузки планировщика. Кроме того, для определения наилучшего источника ресурсов в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] используется фактор нагрузки на узлы и планировщики. Когда задача помещается в очередь, фактор нагрузки увеличивается. Когда задача завершается, фактор нагрузки уменьшается. Факторы нагрузки помогают операционной системе [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] эффективнее выполнять балансирование нагрузки. Не допускает значение NULL.|  
|yield_count|**int**|Внутреннее значение, характеризующее ход выполнения работы на данном планировщике. Это значение используется монитором планировщиков для определения того, вовремя ли исполнитель уступает право на выполнение другим исполнителям. Оно не свидетельствует о передаче управления новому исполнителю. Не допускает значение NULL.|  
|last_timer_activity|**bigint**|Время последней проверки очереди таймера планировщиком (в тактах ЦП). Не допускает значение NULL.|  
|failed_to_create_worker|**bit**|Это значение устанавливается в 1, если на данном планировщике не удалось создать новый исполнитель. Как правило, это происходит из-за недостатка памяти. Допускает значение NULL.|  
|active_worker_address|**varbinary(8)**|Адрес активного в настоящий момент исполнителя в памяти. Допускает значение NULL. Дополнительные сведения см. в разделе [sys.dm_os_workers &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-os-workers-transact-sql.md).|  
|memory_object_address|**varbinary(8)**|Адрес объекта памяти планировщика. Не допускает значения NULL.|  
|task_memory_object_address|**varbinary(8)**|Адрес объекта памяти задачи. Не допускает значение NULL. Дополнительные сведения см. в разделе [sys.dm_os_memory_objects &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-os-memory-objects-transact-sql.md).|  
|quantum_length_us|**bigint**|[!INCLUDE[ssInternalOnly](../../includes/ssinternalonly-md.md)] Отображает такт планировщика, используемый SQLOS.|  
| total_cpu_usage_ms |**bigint**|**Область применения**: [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] и более поздних версий <br><br> Общая нагрузка на ЦП, потребляемая этим планировщиком, о которых сообщает работники, не использующие прерывание. Не допускает значение NULL.|
|total_cpu_idle_capped_ms|**bigint**|[!INCLUDE[ssInternalOnly](../../includes/ssinternalonly-md.md)] Указывает, что регулирование на основе [цели уровня обслуживания](/azure/sql-data-warehouse/what-is-a-data-warehouse-unit-dwu-cdwu#service-level-objective)всегда будет равно 0 для версий, отличных от Azure [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Допускает значение NULL.|
|total_scheduler_delay_ms|**bigint**|**Область применения**: [!INCLUDE[ssSQL15](../../includes/sssql15-md.md)] и более поздних версий <br><br> Время между одним исполнителем и другим переключением в. Может быть вызвано тем, что работники с вытеснением задерживает планирование следующей неприоритетной рабочей роли или из-за потоков планирования ОС из других процессов. Не допускает значение NULL.|
|ideal_workers_limit|**int**|**Область применения**: [!INCLUDE[sql-server-2019](../../includes/sssqlv15-md.md)] и более поздних версий <br><br> Количество рабочих ролей в идеале должно быть в планировщике. Если текущие работники превышают предел из-за несбалансированной загрузки задачи, то после того, как они станут неактивными, они будут обрезаны. Не допускает значение NULL.|
|pdw_node_id|**int**|**Применимо к**: [!INCLUDE[ssSDWfull](../../includes/sssdwfull-md.md)] , [!INCLUDE[ssPDW](../../includes/sspdw-md.md)]<br /><br /> Идентификатор узла, на котором находится данное распределение.|  
  
## <a name="permissions"></a>Разрешения
В [!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)] необходимо `VIEW SERVER STATE` разрешение.   
В базах данных SQL Basic, S0 и S1, а также для баз данных в эластичных пулах `Server admin` `Azure Active Directory admin` требуется учетная запись или. Для всех остальных целей службы базы данных SQL `VIEW DATABASE STATE` разрешение требуется в базе данных.   

## <a name="examples"></a>Примеры  
  
### <a name="a-monitoring-hidden-and-nonhidden-schedulers"></a>A. Наблюдение за скрытыми и видимыми планировщиками  
 Следующий запрос выводит состояние исполнителей и задач в [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] по всем планировщикам. Этот запрос был выполнен на компьютере со следующей конфигурацией:  
  
-   два процессора (ЦП)  
  
-   два узла NUMA  
  
-   один ЦП на узел NUMA  
  
-   маска схожести `0x03`  
  
```sql  
SELECT  
    scheduler_id,  
    cpu_id,  
    parent_node_id,  
    current_tasks_count,  
    runnable_tasks_count,  
    current_workers_count,  
    active_workers_count,  
    work_queue_count  
  FROM sys.dm_os_schedulers;  
```  
  
 [!INCLUDE[ssResult](../../includes/ssresult-md.md)]  
  
```  
scheduler_id cpu_id parent_node_id current_tasks_count  
------------ ------ -------------- -------------------  
0            1      0              9                    
257          255    0              1                    
1            0      1              10                   
258          255    1              1                    
255          255    32             2                    
  
runnable_tasks_count current_workers_count  
-------------------- ---------------------  
0                    11                     
0                    1                      
0                    18                     
0                    1                      
0                    3                      
  
active_workers_count work_queue_count  
-------------------- --------------------  
6                    0  
1                    0  
8                    0  
1                    0  
1                    0  
```  
  
 Вывод содержит следующие сведения.  
  
-   Существует пять планировщиков. Два планировщика имеют значение идентификатора < 1048576. Планировщики с ИДЕНТИФИКАТОРом >= 1048576 называются скрытыми планировщиками. Планировщик `255` предусматривает применение выделенного административного соединения (DAC). Имеется по одному планировщику выделенного административного соединения (DAC) на каждый экземпляр. Мониторы использования ресурсов, координирующие загрузку памяти, используют планировщики `257` и `258`, по одному на каждый узел NUMA.  
  
-   Вывод содержит 23 активные задачи. Эти задачи включают как пользовательские запросы, так и задачи управления ресурсами, запущенные сервером [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Примерами задач [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] являются RESOURCE MONITOR (одна на каждый узел NUMA), LAZY WRITER (одна на каждый узел NUMA), LOCK MONITOR, CHECKPOINT и LOG WRITER.  
  
-   Узел NUMA `0` сопоставлен ЦП `1`, а узел NUMA `1` сопоставлен ЦП `0`. [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] обычно сначала использует узел NUMA, отличный от узла 0.  
  
-   При значении `runnable_tasks_count`, равном `0`, активные выполняемые задачи отсутствуют. Однако могут присутствовать активные сеансы.  
  
-   С планировщиком `255`, представляющим выделенное административное соединение (DAC), связано `3` исполнителя. Эти исполнители выделяются при запуске [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] и не изменяются. Они используются только для обработки запросов выделенного административного соединения (DAC) . Две задачи этого планировщика представляют собой диспетчер соединений и простаивающий исполнитель.  
  
-   `active_workers_count` представляет всех рабочих ролей, которые имеют связанные задачи и выполняются в режиме без вытеснений. Некоторые задачи, например средства прослушивания сети, запускаются планировщиком в режиме с вытеснением.  
  
-   Скрытые планировщики не обрабатывают стандартные запросы пользователей. Исключением является планировщик выделенного административного соединения (DAC). Этот планировщик имеет один поток для обработки запросов.  
  
### <a name="b-monitoring-nonhidden-schedulers-in-a-busy-system"></a>Б. Наблюдение за видимыми планировщиками в загруженной системе  
 Следующий запрос демонстрирует состояние чрезмерно загруженных видимых планировщиков, при котором имеется больше запросов, чем могут обработать доступные исполнители. В данном примере задачи назначены 256 исполнителям. Некоторые задачи ожидают назначения исполнителю. Небольшое число готовых к запуску задач неявно подразумевает, что множество задач ожидают выделения ресурса.  
  
> [!NOTE]  
>  Состояние исполнителей можно получить путем запроса к представлению sys.dm_os_workers. Дополнительные сведения см. в разделе [sys.dm_os_workers &#40;Transact-SQL&#41;](../../relational-databases/system-dynamic-management-views/sys-dm-os-workers-transact-sql.md).  
  
 Запрос:  
  
```sql  
SELECT  
    scheduler_id,  
    cpu_id,  
    current_tasks_count,  
    runnable_tasks_count,  
    current_workers_count,  
    active_workers_count,  
    work_queue_count  
  FROM sys.dm_os_schedulers  
  WHERE scheduler_id < 255;  
```  
  
 [!INCLUDE[ssResult](../../includes/ssresult-md.md)]  
  
```  
scheduler_id current_tasks_count runnable_tasks_count  
------------ ------------------- --------------------  
0            144                 0                     
1            147                 1                     
  
current_workers_count active_workers_count work_queue_count  
--------------------- -------------------- --------------------  
128                   125                  16  
128                   126                  19  
```  
  
 Для сравнения: следующий результат показывает множество готовых к выполнению задач, ни одна из которых не ожидает назначения исполнителю. Значение `work_queue_count` равно `0` для обоих планировщиков.  
  
```  
scheduler_id current_tasks_count runnable_tasks_count  
------------ ------------------- --------------------  
0            107                 98                    
1            110                 100                   
  
current_workers_count active_workers_count work_queue_count  
--------------------- -------------------- --------------------  
128                   104                  0  
128                   108                  0  
```  
  
## <a name="see-also"></a>См. также:  
 [SQL Server динамические административные представления, связанные с операционной системой &#40;&#41;Transact-SQL ](../../relational-databases/system-dynamic-management-views/sql-server-operating-system-related-dynamic-management-views-transact-sql.md)  
