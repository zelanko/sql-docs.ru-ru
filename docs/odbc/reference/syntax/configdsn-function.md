---
title: Функция ConfigDSN | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- ConfigDSN
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- ConfigDSN
helpviewer_keywords:
- ConfigDSN [ODBC]
ms.assetid: 01ced74e-c575-4a25-83f5-bd7d918123f8
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: fbae126c819088bd277621b207454503a86c8955
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "81306045"
---
# <a name="configdsn-function"></a>Функция ConfigDSN
**Соответствия**  
 Введенная версия: ODBC 1,0  
  
 **Сводка**  
 **ConfigDSN** добавляет, изменяет или удаляет источники данных из системных сведений. Может появиться запрос на ввод сведений о подключении. Это может быть библиотека DLL драйвера или отдельная библиотека DLL установки.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL ConfigDSN(  
     HWND     hwndParent,  
     WORD     fRequest,  
     LPCSTR   lpszDriver,  
     LPCSTR   lpszAttributes);  
```  
  
## <a name="arguments"></a>Аргументы  
 *хвндпарент*  
 Входной Маркер родительского окна. Функция не отображает никакие диалоговые окна, если этот маркер имеет значение null.  
  
 *фрекуест*  
 Входной Тип запроса. Аргумент *фрекуест* должен содержать одно из следующих значений:  
  
 ODBC_ADD_DSN. Добавьте новый источник данных.  
  
 ODBC_CONFIG_DSN: Настройка (изменение) существующего источника данных.  
  
 ODBC_REMOVE_DSN: удалите существующий источник данных.  
  
 *лпсздривер*  
 Входной Описание драйвера (обычно имя связанной СУБД), представленное пользователям вместо физического имени драйвера.  
  
 *лпсзаттрибутес*  
 Входной Список атрибутов в виде пар «ключевое слово-значение» с удвоенным нулем. Дополнительные сведения см. в разделе "Комментарии".  
  
## <a name="returns"></a>Результаты  
 Функция возвращает TRUE, если она успешна, и FALSE в случае сбоя.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **ConfigDSN** возвращает значение false, связанное * \*значение пферроркоде* отправляется в буфер ошибок установщика путем вызова **склпостинсталлереррор** и может быть получен вызовом **склинсталлереррор**. В следующей таблице перечислены значения * \*пферроркоде* , которые могут быть возвращены **склинсталлереррор** , и объясняется каждый из них в контексте этой функции.  
  
|*\*пферроркоде*|Error|Описание|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_INVALID_HWND|Недопустимый маркер окна|Недопустимый аргумент *хвндпарент* .|  
|ODBC_ERROR_INVALID_KEYWORD_VALUE|Недопустимые пары "ключевое слово-значение"|Аргумент *лпсзаттрибутес* содержал синтаксическую ошибку.|  
|ODBC_ERROR_INVALID_NAME|Недопустимое имя драйвера или транслятора|Недопустимый аргумент *лпсздривер* . Не удалось найти его в реестре.|  
|ODBC_ERROR_INVALID_REQUEST_TYPE|Недопустимый тип запроса|Аргумент *фрекуест* не является одним из следующих:<br /><br /> ODBC_ADD_DSN ODBC_CONFIG_DSN ODBC_REMOVE_DSN|  
|ODBC_ERROR_REQUEST_FAILED|Сбой *запроса*|Не удалось выполнить операцию, запрошенную аргументом *фрекуест* .|  
|ODBC_ERROR_DRIVER_SPECIFIC|Ошибка, относящаяся к драйверу или транслятору|Ошибка конкретного драйвера, для которой не определена Ошибка установщика ODBC. Аргумент *сзеррор* в вызове функции **склпостинсталлереррор** должен содержать сообщение об ошибке конкретного драйвера.|  
  
## <a name="comments"></a>Комментарии  
 **ConfigDSN** получает сведения о соединении из библиотеки DLL установщика в виде списка атрибутов в виде пар "ключевое слово-значение". Каждая пара завершается нулевым байтом, а весь список завершается нулевым байтом. (То есть, в конце списка отмечаются два нуль-байта.) Пробелы не допускаются вокруг знака равенства в паре "ключевое слово-значение". **ConfigDSN** может принимать ключевые слова, которые не являются допустимыми ключевыми словами для **SQLBrowseConnect** и **SQLDriverConnect**. **ConfigDSN** не обязательно поддерживает все ключевые слова, которые являются допустимыми ключевыми словами для **SQLBrowseConnect** и **SQLDriverConnect**. (**ConfigDSN** не принимает ключевое слово **Driver** .) Ключевые слова, используемые функцией **ConfigDSN** , должны поддерживать все параметры, необходимые для повторного создания источника данных с помощью функции автоматической установки установщика. Если использование значений **ConfigDSN** и значений строки подключения одинаковы, то следует использовать те же ключевые слова.  
  
 Как и в **SQLBrowseConnect** и **SQLDriverConnect**, ключевые слова и их значения не должны содержать **[]{}(),;? = \*! @** символов, а значение ключевого слова **DSN** не может состоять только из пробелов. Из-за грамматики в реестре ключевые слова и имена источников данных не могут\\содержать символ обратной косой черты ().  
  
 **ConfigDSN** должен вызвать **склвалиддсн** , чтобы проверить длину имени источника данных и убедиться, что в имя не включены недопустимые символы. Если имя источника данных длиннее SQL_MAX_DSN_LENGTH или содержит недопустимые символы, **склвалиддсн** возвращает ошибку, а **ConfigDSN** возвращает ошибку. Длина имени источника данных также проверяется с помощью **склвритедснтоини**.  
  
 Например, чтобы настроить источник данных, для которого требуется идентификатор пользователя, пароль и имя базы данных, приложение установки может передать следующие пары "ключевое слово-значение":  
  
```  
DSN=Personnel Data\0UID=Smith\0PWD=Sesame\0DATABASE=Personnel\0\0  
```  
  
 Дополнительные сведения об этих ключевых словах см. в разделе [SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md) и документация каждого драйвера.  
  
 Чтобы отобразить диалоговое окно, *хвндпарент* не должно иметь значение null.  
  
## <a name="adding-a-data-source"></a>Добавление источника данных  
 Если имя источника данных передается в **ConfigDSN** в *лпсзаттрибутес*, **ConfigDSN** проверяет допустимость имени. Если имя источника данных совпадает с существующим именем источника данных, а *хвндпарент* имеет значение null, **ConfigDSN** перезаписывает существующее имя. Если он соответствует существующему имени и *хвндпарент* не равен null, **ConfigDSN** запрашивает у пользователя перезапись существующего имени.  
  
 Если *лпсзаттрибутес* содержит достаточно информации для подключения к источнику данных, **ConfigDSN** может добавить источник данных или отобразить диалоговое окно, с помощью которого пользователь может изменить сведения о соединении. Если *лпсзаттрибутес* не содержит достаточно сведений для подключения к источнику данных, **ConfigDSN** должен определить необходимые сведения. Если *хвндпарент* не равно null, отображается диалоговое окно для получения сведений от пользователя.  
  
 Если **ConfigDSN** отображает диалоговое окно, оно должно отображать все сведения о соединении, переданные в него в *лпсзаттрибутес*. В частности, если в него было передано имя источника данных, **ConfigDSN** отображает это имя, но не позволяет пользователю изменить его. **ConfigDSN** может предоставлять значения по умолчанию для сведений о соединении, не переданных в него в *лпсзаттрибутес*.  
  
 Если **ConfigDSN** не удается получить полные сведения о соединении для источника данных, возвращается значение false.  
  
 Если **ConfigDSN** может получить полные сведения о соединении для источника данных, он вызывает **склвритедснтоини** в библиотеке DLL установщика, чтобы добавить новую спецификацию источника данных в файл ODBC. ini (или в реестр). **Склвритедснтоини** добавляет имя источника данных в раздел [источники данных ODBC], создает раздел "Спецификация источника данных" и добавляет в качестве значения ключевое слово **Driver** с описанием драйвера. **ConfigDSN** вызывает **склвритеприватепрофилестринг** в библиотеке DLL установщика для добавления дополнительных ключевых слов и значений, используемых драйвером.  
  
## <a name="modifying-a-data-source"></a>Изменение источника данных  
 Чтобы изменить источник данных, необходимо передать имя источника данных в **ConfigDSN** в *лпсзаттрибутес*. **ConfigDSN** проверяет, что имя источника данных находится в файле ODBC. ini (или в реестре).  
  
 Если *хвндпарент* имеет значение null, **ConfigDSN** использует сведения в *лпсзаттрибутес* для изменения информации в файле ODBC. ini (или в реестре). Если *хвндпарент* не равно null, **ConfigDSN** отображает диалоговое окно, используя сведения в *лпсзаттрибутес*; сведения, отсутствующие в *лпсзаттрибутес*, используются в сведениях о системе. Пользователь может изменить сведения, прежде чем **ConfigDSN** сохранит их в сведениях о системе.  
  
 Если имя источника данных было изменено, **ConfigDSN** сначала вызывает **склремоведснфромини** в библиотеке DLL установщика, чтобы удалить существующую спецификацию источника данных из файла ODBC. ini (или реестра). Затем он выполняет действия, описанные в предыдущем разделе, чтобы добавить новую спецификацию источника данных. Если имя источника данных не изменилось, **ConfigDSN** вызывает **склвритеприватепрофилестринг** в библиотеке DLL установщика для внесения любых других изменений. **ConfigDSN** не может удалить или изменить значение ключевого слова **Driver** .  
  
## <a name="deleting-a-data-source"></a>Удаление источника данных  
 Чтобы удалить источник данных, необходимо передать имя источника данных в **ConfigDSN** в *лпсзаттрибутес*. **ConfigDSN** проверяет, что имя источника данных находится в файле ODBC. ini (или в реестре). Затем он вызывает **склремоведснфромини** в библиотеке DLL установщика для удаления источника данных.  
  
## <a name="note"></a>Примечание
 При написании версии этой подпрограммы в Юникоде она должна называться **конфигдснв**с аргументами ЛПКВСТР вместо LPCSTR.
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Добавление, изменение или удаление источника данных|[SQLConfigDataSource](../../../odbc/reference/syntax/sqlconfigdatasource-function.md)|  
|Получение значения из файла ODBC. ini или реестра|[SQLGetPrivateProfileString](../../../odbc/reference/syntax/sqlgetprivateprofilestring-function.md)|  
|Удаление источника данных по умолчанию|[склремоведефаултдатасаурце](../../../odbc/reference/syntax/sqlremovedefaultdatasource-function.md)|  
|Удаление имени источника данных из ODBC. ini (или реестра)|[склремоведснфромини](../../../odbc/reference/syntax/sqlremovedsnfromini-function.md)|  
|Добавление имени источника данных в ODBC. ini (или в реестр)|[склвритедснтоини](../../../odbc/reference/syntax/sqlwritedsntoini-function.md)|  
|Запись значения в файл ODBC. ini или в реестр|[склвритеприватепрофилестринг](../../../odbc/reference/syntax/sqlwriteprivateprofilestring-function.md)|
