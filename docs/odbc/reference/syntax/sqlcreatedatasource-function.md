---
title: Функция Склкреатедатасаурце | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLCreateDataSource
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLCreateDataSource
helpviewer_keywords:
- SQLCreateDataSource function [ODBC]
ms.assetid: 76ee851a-dca9-40cc-8e9e-eb3f74e560ee
author: MightyPen
ms.author: genemi
ms.openlocfilehash: 0b3a6fced096c779b5ab91bf4e5b6a3f0a66e5f1
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68121389"
---
# <a name="sqlcreatedatasource-function"></a>Функция SQLCreateDataSource
**Соответствия**  
 Введенная версия: ODBC 2,0  
  
 **Сводка**  
 **Склкреатедатасаурце** отображает диалоговое окно, с помощью которого пользователь может добавить источник данных.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
BOOL SQLCreateDataSource(  
     HWND    hwnd,  
     LPSTR   lpszDS);  
```  
  
## <a name="arguments"></a>Аргументы  
 *HWND*  
 Входной Маркер родительского окна.  
  
 *лпсздс*  
 Входной Имя источника данных. *лпсздс* может быть пустым указателем или пустой строкой.  
  
## <a name="returns"></a>Возвращает  
 **Склкреатедатасаурце** возвращает значение true, если источник данных создан. В противном случае возвращается значение FALSE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **склкреатедатасаурце** возвращает значение false, связанное * \*значение пферроркоде* может быть получено путем вызова **склинсталлереррор**. В следующей таблице перечислены значения * \*пферроркоде* , которые могут быть возвращены **склинсталлереррор** , и объясняется каждый из них в контексте этой функции.  
  
|*\*пферроркоде*|Ошибка|Description|  
|---------------------|-----------|-----------------|  
|ODBC_ERROR_GENERAL_ERR|Общая ошибка установщика|Произошла ошибка, для которой не возникала конкретная ошибка установщика.|  
|ODBC_ERROR_INVALID_HWND|Недопустимый маркер окна|Аргумент *HWND* недопустим или имеет значение null.|  
|ODBC_ERROR_INVALID_DSN|Недопустимое имя DSN|Аргумент *лпсздс* содержал строку, недопустимую для имени DSN.|  
|ODBC_ERROR_REQUEST_FAILED|Сбой *запроса*|Сбой вызова **ConfigDSN** с параметром ODBC_ADD_DSN.|  
|ODBC_ERROR_LOAD_LIBRARY_FAILED|Не удалось загрузить драйвер или библиотеку установки переводчика|Не удалось загрузить библиотеку установки драйверов.|  
|ODBC_ERROR_USER_CANCELED|Операция отменена пользователем|Пользователь отменил создание нового источника данных.|  
|ODBC_ERROR_CREATE_DSN_FAILED|Не удалось создать запрошенное имя DSN|Не удалось подключиться к базе данных; вызов **SQLDriverConnect** для файлового DSN не вернул успешное соединение.<br /><br /> Не удалось выполнить запись в файл.|  
|ODBC_ERROR_OUT_OF_MEM|Недостаточно памяти|Установщику не удалось выполнить функцию из-за нехватки памяти.|  
  
## <a name="comments"></a>Комментарии  
 Если *HWND* имеет значение null, **склкреатедатасаурце** возвращает значение false. В противном случае откроется диалоговое окно **Создание нового источника данных** со страницей мастера для выбора типа источника данных, который должен быть настроен, как показано на следующем рисунке.  
  
 ![Диалоговое окно создания нового источника данных: выбор типа](../../../odbc/reference/syntax/media/ch23a.gif "CH23A")  
  
 Параметр по умолчанию — **Файловый источник данных**. После выбора источника данных и нажатия кнопки **Далее** отображается следующая страница мастера, содержащая список установленных драйверов.  
  
 ![Диалоговое окно создания нового источника данных: выбор драйвера](../../../odbc/reference/syntax/media/ch23b.gif "CH23B")  
  
 Если щелкнуть **Cancel (Отмена** ), диалоговое окно исчезнет, а **склкреатедатасаурце** возвращает FALSE с кодом ошибки ODBC_ERROR_USER_CANCELED. Если был выбран параметр **источник данных пользователя** или **системный источник данных** , кнопка **Дополнительно** будет недоступна.  
  
 При нажатии кнопки **Далее** произойдет одно из следующих действий в зависимости от выбранного типа источника данных.  
  
-   Если выбран **Файловый источник данных** , то для ввода имени файла отображается страница мастера.  
  
-   Если был выбран либо **источник данных пользователя** , либо **системный источник данных** , откроется страница мастера, отображающая тип источника данных и драйвер для проверки, и после нажатия кнопки **Готово** источник данных будет настроен.  
  
 Если на странице Мастер создания источника данных выбран вариант **Дополнительно** , откроется страница мастера для ввода сведений, относящихся к драйверу. В текстовом поле этого диалогового окна введите драйвер и ключевые слова, разделенные символами, как показано на следующем рисунке.  
  
 ![Диалоговое окно дополнительных настроек создания файлового DSN](../../../odbc/reference/syntax/media/ch23c.gif "CH23C")  
  
 Дополнительные ключевые слова, относящиеся к драйверу, можно найти в описании **SQLDriverConnect**. Разрешены все, кроме **DSN** .  
  
 Значение по умолчанию для параметра **проверить подключение** равно true. Это значение по умолчанию применяется, когда эта страница мастера активирована. При нажатии кнопки **ОК** строка, указанная в текстовом поле, и значение параметра **проверить это подключение** кэшируются. (При нажатии кнопки **Закрыть** или **Отмена** все вновь введенные сведения, относящиеся к драйверу, теряются, поскольку строка, указанная в текстовом поле, и значение параметра **проверить это подключение** не кэшируются.)  
  
 Если **Файловый источник данных** был выбран на первой странице мастера, то после выбора драйвера и ввода ключевых слов на странице мастера дополнительных параметров пользователю будет предложено ввести имя файла. Нажмите кнопку **Обзор** , чтобы найти имя файла. в этом случае каталог по умолчанию в поле **Обзор** задается сочетанием пути, указанного параметром коммонфиледир в HKEY_LOCAL_MACHINE \софтваре\микрософт\виндовс\куррентверсион и "одбк\датасаурцес". (Если Коммонфиледир имел значение «C:\Program Files\Common Files», каталогом по умолчанию будет «C:\Program Files\Common Филес\одбк\дата sources».)  
  
 После того как имя файла было введено и нажато **Next** , введенное имя файла проверяется на допустимость стандартных правил именования файлов операционной системы. Если имя файла недопустимо, окно сообщения об ошибке уведомляет пользователя о том, что указано недопустимое имя файла. Когда пользователь подтверждает окно сообщения, фокус возвращается на страницу мастера, в которой указано имя файла. Если имя файла является допустимым, откроется страница мастера, на которой показаны выбранные пары "ключевое слово-значение" для проверки, как показано на следующем рисунке.  
  
 ![Диалоговое окно создания нового источника данных: проверка](../../../odbc/reference/syntax/media/ch23d.gif "CH23D")  
  
 Если в качестве типа источника данных был выбран параметр « **Готово** » и « **Файловый источник данных** », а для параметра « **проверить это подключение** » задано значение true, **SQLDriverConnect** вызывается с ключевыми словами **SaveFile** и **Driver** . Аргумент *DriverCompletion* имеет значение SQL_DRIVER_COMPLETE. Имя файла для ключевого слова **SaveFile** — это имя, которое было указано или выбрано, а имя драйвера для ключевого слова **Driver** — это имя, которое было выбрано. Если строка подключения, относящаяся к драйверу, указана на странице "Расширенный мастер", эта строка добавляется после ключевого слова **Driver** .  
  
 Если **SQLDriverConnect** возвращает SQL_SUCCESS, диспетчер драйверов создал файл DSN. **Склкреатедатасаурце** возвращает значение true. Если **SQLDriverConnect** не возвращает SQL_SUCCESS, в окне предупреждающего сообщения будет указано, что не удалось установить соединение с источником данных. Можно создать имя DSN с минимальными сведениями о соединении. Это окно сообщения позволяет пользователю либо отменить, либо продолжить создание файлового имени источника данных.  
  
 Если пользователь решит продолжить создание имени DSN, этот процесс продолжит работу, как если бы для параметра **проверить это подключение** было установлено значение false. Если пользователь выбирает отмену, возвращается значение FALSE для **склкреатедатасаурце** с кодом ошибки ODBC_ERROR_CREATE_DSN_FAILED.  
  
 Если в качестве типа источника данных был выбран " **Файловый источник данных** ", а для параметра " **проверить это подключение** " ЗАДАНо значение "false", Файловый DSN создается с помощью ключевого слова **Driver** и пользовательской строки подключения (если таковая имеется) на странице мастера "Дополнительно". Если создание файла прошло успешно, возвращается значение TRUE для **склкреатедатасаурце**. Если не удалось создать файл, в окне сообщения об ошибке будет выведено сообщение о том, что в операционной системе была возвращена ошибка. Возвращается значение FALSE для **склкреатедатасаурце** с кодом ошибки ODBC_ERROR_CREATE_DSN_FAILED. Дополнительные сведения о файловых источниках данных см. в разделе [подключение с помощью файловых источников данных](../../../odbc/reference/develop-app/connecting-using-file-data-sources.md)или см. [SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md).  
  
 Если в качестве типа источника данных был выбран **Пользовательский** или **системный источник данных** , **ConfigDSN** в библиотеке установки драйвера вызывается с параметром ODBC_ADD_DSN *фрекуест*. Дополнительные сведения см. в разделе [ConfigDSN](../../../odbc/reference/syntax/configdsn-function.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Тема|См. следующие документы.|  
|---------------------------|---------|  
|Управление источниками данных|[SQLManageDataSources](../../../odbc/reference/syntax/sqlmanagedatasources.md)|
