---
title: Функция SQLGetDiagRec | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLGetDiagRec
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLGetDiagRec
helpviewer_keywords:
- SQLGetDiagRec function [ODBC]
ms.assetid: ebdbac93-3d68-438f-8416-ef1f08e04269
author: MightyPen
ms.author: genemi
ms.openlocfilehash: c404cbb1f29adbdcb49ef6bed8bb57a047f64f3b
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "67911321"
---
# <a name="sqlgetdiagrec-function"></a>Функция SQLGetDiagRec
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 3,0: ISO 92  
  
 **Сводка**  
 **SQLGetDiagRec** возвращает текущие значения нескольких полей диагностической записи, которые содержат ошибки, предупреждения и сведения о состоянии. В отличие от **SQLGetDiagField**, которая возвращает одно диагностическое поле на вызов, **SQLGetDiagRec** возвращает несколько часто используемых полей диагностической записи, включая SQLSTATE, собственный код ошибки и текст диагностического сообщения.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLGetDiagRec(  
     SQLSMALLINT     HandleType,  
     SQLHANDLE       Handle,  
     SQLSMALLINT     RecNumber,  
     SQLCHAR *       SQLState,  
     SQLINTEGER *    NativeErrorPtr,  
     SQLCHAR *       MessageText,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   TextLengthPtr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *HandleType*  
 Входной Идентификатор типа обработчика, описывающий тип обработчика, для которого требуются диагностические сведения. Должна быть одной из следующих:  
  
-   SQL_HANDLE_DBC  
  
-   SQL_HANDLE_DBC_INFO_TOKEN  
  
-   SQL_HANDLE_DESC  
  
-   SQL_HANDLE_ENV  
  
-   SQL_HANDLE_STMT  
  
 SQL_HANDLE_DBC_INFO_TOKENный обработчик используется только диспетчером драйверов и драйвером. Приложения не должны использовать этот тип обработчика. Дополнительные сведения о SQL_HANDLE_DBC_INFO_TOKEN см. [в разделе Разработка осведомленности о пуле подключений в драйвере ODBC](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md).  
  
 *Справиться*  
 Входной Маркер для структуры диагностических данных типа, указанного параметром *параметром handletype*. Если *параметром handletype* имеет SQL_HANDLE_ENV, то *Handle* может быть либо общим, либо несовместно используемым обработчиком среды.  
  
 *рекнумбер*  
 Входной Указывает запись состояния, из которой приложение ищет сведения. Записи состояния нумеруются с 1.  
  
 *SQLState*  
 Проверки Указатель на буфер, в котором возвращается код SQLSTATE из пяти символов (и завершается значение NULL) для диагностической записи *рекнумбер*. Первые два символа указывают класс; следующие три указывают на подкласс. Эти сведения содержатся в поле диагностики SQL_DIAG_SQLSTATE. Дополнительные сведения см. в разделе [SQLSTATE](../../../odbc/reference/develop-app/sqlstates.md).  
  
 *нативиррорптр*  
 Проверки Указатель на буфер, в котором возвращается код собственной ошибки, относящийся к источнику данных. Эти сведения содержатся в поле диагностики SQL_DIAG_NATIVE.  
  
 *MessageText*  
 Проверки Указатель на буфер, в который возвращается текстовая строка диагностического сообщения. Эти сведения содержатся в поле диагностики SQL_DIAG_MESSAGE_TEXT. Сведения о формате строки см. в разделе [диагностические сообщения](../../../odbc/reference/develop-app/diagnostic-messages.md).  
  
 Если *MessageText* имеет значение null, то *текстленгсптр* будет возвращать общее количество символов (исключая символ завершения null для символьных данных), доступный для возврата в буфер, на который указывает *MessageText*.  
  
 *BufferLength*  
 Входной Длина буфера **MessageText* в символах. Отсутствует максимальная длина текста диагностического сообщения.  
  
 *текстленгсптр*  
 Проверки Указатель на буфер, в котором возвращается общее число символов (за исключением числа символов, необходимых для завершающего символа null), доступных для возврата в * \*MessageText*. Если число возвращаемых символов больше *BufferLength*, текст диагностического сообщения в * \*MessageText* усекается до *BufferLength* минус длину символа завершения null.  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 **SQLGetDiagRec** не выполняет запись диагностических записей для себя. Он использует следующие возвращаемые значения, чтобы сообщить результат своего выполнения.  
  
-   SQL_SUCCESS: функция успешно вернула диагностические сведения.  
  
-   SQL_SUCCESS_WITH_INFO: \*буфер *MessageText* слишком мал для размещения запрошенного диагностического сообщения. Диагностические записи не были созданы. Чтобы определить, что произошло усечение, приложение должно сравнить *BufferLength* с фактическим числом доступных байтов, которое записывается в **стрингленгсптр*.  
  
-   SQL_INVALID_HANDLE: маркер, указанный *параметром handletype* и *Handle* , не является допустимым маркером.  
  
-   SQL_ERROR: произошла одна из следующих ошибок:  
  
    -   *Рекнумбер* был отрицательным или 0.  
  
    -   *BufferLength* меньше нуля.  
  
    -   При использовании асинхронного уведомления асинхронная операция с этим маркером не была завершена.  
  
-   SQL_NO_DATA: *рекнумбер* превышает число записей диагностики, существовавших для указанного в Handle маркера *.* Функция также возвращает SQL_NO_DATA для любого положительного *рекнумбер* , если отсутствуют диагностические записи для *обработчика*.  
  
## <a name="comments"></a>Комментарии  
 Приложение обычно вызывает **SQLGetDiagRec** , когда предыдущий вызов функции ODBC вернул SQL_ERROR или SQL_SUCCESS_WITH_INFO. Однако поскольку любая функция ODBC может отправлять несколько диагностических записей каждый раз при вызове, приложение может вызвать **SQLGetDiagRec** после любого вызова функции ODBC. Приложение может вызвать **SQLGetDiagRec** несколько раз, чтобы вернуть некоторые или все записи в структуре диагностических данных. ODBC накладывает ограничения на количество диагностических записей, которые могут храниться в любой момент времени.  
  
 **SQLGetDiagRec** нельзя использовать для возврата полей из заголовка структуры диагностических данных. (Аргумент *рекнумбер* должен быть больше 0.) Для этой цели приложение должно вызывать **SQLGetDiagField** .  
  
 **SQLGetDiagRec** извлекает только диагностические сведения, которые недавно связаны с маркером, указанным в аргументе *Handle* . Если приложение вызывает другую функцию ODBC, за исключением **SQLGetDiagRec**, **SQLGetDiagField**или **SqlError**, то теряются все диагностические данные из предыдущих вызовов одного и того же обработчика.  
  
 Приложение может сканировать все диагностические записи путем циклов, увеличивая *рекнумбер*, пока **SQLGetDiagRec** возвращает SQL_SUCCESS. Вызовы **SQLGetDiagRec** являются необратимыми для полей заголовков и записей. Приложение может снова вызвать **SQLGetDiagRec** в дальнейшем для получения поля из записи, если в промежуточной версии не была вызвана никакая другая функция, кроме **SQLGetDiagRec**, **SQLGetDiagField**или **SqlError**. Приложение также может получить количество диагностических записей, доступных с помощью вызова **SQLGetDiagField** , чтобы получить значение поля SQL_DIAG_NUMBER, а затем вызвать **SQLGetDiagRec** , который встречается много раз.  
  
 Описание полей структуры диагностических данных см. в разделе [SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md). Дополнительные сведения см. в статьях [Использование SQLGetDiagRec и SQLGetDiagField](../../../odbc/reference/develop-app/using-sqlgetdiagrec-and-sqlgetdiagfield.md) и [Реализация SQLGetDiagRec и SQLGetDiagField](../../../odbc/reference/develop-app/implementing-sqlgetdiagrec-and-sqlgetdiagfield.md).  
  
 Вызов API, отличного от выполняемого асинхронно, приведет к формированию HY010 "ошибка последовательности функций". Однако запись об ошибке не может быть получена до завершения асинхронной операции.  
  
## <a name="handletype-argument"></a>Параметром handletype, аргумент  
 С каждым типом обработчика может быть связана диагностическая информация. Аргумент *параметром handletype* обозначает тип обработчика аргумента *Handle* .  
  
 Некоторые поля заголовков и записей не могут быть возвращены для дескрипторов среды, соединения, инструкции и дескрипторов. Эти дескрипторы, для которых поле неприменимо, указаны в разделах "поля заголовка" и "поля записи" в [SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md).  
  
 Вызов **SQLGetDiagRec** возвратит SQL_INVALID_HANDLE, если *параметром handletype* имеет SQL_HANDLE_SENV, который обозначает общий обработчик среды. Однако если *параметром handletype* имеет SQL_HANDLE_ENV, то *обработчик* может быть либо общим, либо несовместно используемым обработчиком среды.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Тема|См. следующие документы.|  
|---------------------------|---------|  
|Получение поля диагностической записи или поля заголовка диагностики|[Функция SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)   
 [Образец программы ODBC](../../../odbc/reference/sample-odbc-program.md)
