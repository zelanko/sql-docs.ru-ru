---
title: Функция SQLGetDiagRec | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLGetDiagRec
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLGetDiagRec
helpviewer_keywords:
- SQLGetDiagRec function [ODBC]
ms.assetid: ebdbac93-3d68-438f-8416-ef1f08e04269
author: MightyPen
ms.author: genemi
manager: craigg
ms.openlocfilehash: c4606c9f525517d51312fc9a105076691dcda682
ms.sourcegitcommit: 61381ef939415fe019285def9450d7583df1fed0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47683032"
---
# <a name="sqlgetdiagrec-function"></a>Функция SQLGetDiagRec
**Соответствие стандартам**  
 Версия была введена: ODBC 3.0 соответствует стандартам: ISO-92  
  
 **Сводка**  
 **SQLGetDiagRec** возвращает текущие значения нескольких полей диагностики записи, которая содержит сведения об ошибках, предупреждения и состоянии. В отличие от **SQLGetDiagField**, который возвращает одно поле диагностики для каждого вызова, **SQLGetDiagRec** возвращает несколько часто используемых полей диагностики записи, включая значение SQLSTATE, машинный код ошибки, и текст диагностическое сообщение.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
  
SQLRETURN SQLGetDiagRec(  
     SQLSMALLINT     HandleType,  
     SQLHANDLE       Handle,  
     SQLSMALLINT     RecNumber,  
     SQLCHAR *       SQLState,  
     SQLINTEGER *    NativeErrorPtr,  
     SQLCHAR *       MessageText,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   TextLengthPtr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *HandleType*  
 [Вход] Идентификатор типа дескриптора, описывающий тип маркера, для которого требуются диагностики. Должна быть одной из следующих:  
  
-   SQL_HANDLE_DBC  
  
-   SQL_HANDLE_DBC_INFO_TOKEN  
  
-   SQL_HANDLE_DESC  
  
-   SQL_HANDLE_ENV  
  
-   ЗНАЧЕНИЕ SQL_HANDLE_STMT  
  
 Дескриптор SQL_HANDLE_DBC_INFO_TOKEN используется только для диспетчера драйверов и драйверов. Приложения не должны использовать этот тип дескриптора. Дополнительные сведения о SQL_HANDLE_DBC_INFO_TOKEN, см. в разделе [драйвера ODBC с поддержкой пула подключений разработка](../../../odbc/reference/develop-driver/developing-connection-pool-awareness-in-an-odbc-driver.md).  
  
 *Дескриптор*  
 [Вход] Дескриптор для структуры диагностических данных, тип, указанный *HandleType*. Если *HandleType* является SQL_HANDLE_ENV, *обрабатывать* можно использовать общий или дескриптор среды с монопольным доступом.  
  
 *RecNumber*  
 [Вход] Указывает запись состояния, из которого приложение ищет сведения. Записи состояния нумеруются от 1.  
  
 *SQLState*  
 [Выход] Указатель на буфер, в которую будет возвращен код SQLSTATE пяти символов (и завершающий нуль-символ) для записи диагностики *RecNumber*. Первые два символа обозначения класса; следующие три указывают подкласса. Эта информация содержится в поле SQL_DIAG_SQLSTATE диагностики. Дополнительные сведения см. в разделе [SQLSTATE](../../../odbc/reference/develop-app/sqlstates.md).  
  
 *NativeErrorPtr*  
 [Выход] Указатель на буфер, в которую будет возвращен машинный код ошибки, относящиеся к источнику данных. Эта информация содержится в поле SQL_DIAG_NATIVE диагностики.  
  
 *MessageText*  
 [Выход] Указатель на буфер, в которую будет возвращен текстовая строка диагностическое сообщение. Эта информация содержится в поле SQL_DIAG_MESSAGE_TEXT диагностики. Формат строки, см. в разделе [диагностические сообщения](../../../odbc/reference/develop-app/diagnostic-messages.md).  
  
 Если *MessageText* имеет значение NULL, *TextLengthPtr* по-прежнему возвращает общее число символов (включая знак завершения null для символьных данных) для возврата в буфере, на которые указывают *MessageText*.  
  
 *BufferLength*  
 [Вход] Длина **MessageText* буфера в символах. Нет не Максимальная длина текста диагностическое сообщение.  
  
 *TextLengthPtr*  
 [Выход] Указатель на буфер, в которую будет возвращено общее число символов (за исключением количество символов, необходимых для символа завершения null) для возврата в  *\*MessageText*. Если количество символов, доступных для возврата превышает *BufferLength*, диагностическое сообщение текст в  *\*MessageText* усекается до *BufferLength* минус длина знак завершения null.  
  
## <a name="returns"></a>Возвращает  
 Значение SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, значение SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 **SQLGetDiagRec** не размещайте диагностические записи для себя. Сообщить о результате свое выполнение является он использует следующие возвращаемые значения:  
  
-   Значение SQL_SUCCESS, указывая: Функция успешно возвращено диагностические сведения.  
  
-   SQL_SUCCESS_WITH_INFO: \* *MessageText* буфер слишком мал для хранения запрошенного диагностическое сообщение. Диагностические записи не были созданы. Чтобы определить, что возникло усечение, приложение необходимо сравнить *BufferLength* фактическое число доступных байтов, которые написаны для **StringLengthPtr*.  
  
-   SQL_INVALID_HANDLE: Дескриптор обозначается *HandleType* и *обрабатывать* не является допустимым дескриптором.  
  
-   SQL_ERROR: Одной из следующих причин:  
  
    -   *RecNumber* был отрицательным или 0.  
  
    -   *BufferLength* меньше нуля.  
  
    -   Если вы используете асинхронное уведомление, асинхронные операции для дескриптора не завершена.  
  
-   Значение SQL_NO_DATA: *RecNumber* поданных единиц превысил количество диагностических записей, которые существовали для дескриптор, указанный в *обработки.* Функция также возвращает значение SQL_NO_DATA для любой положительных *RecNumber* Если нет диагностических записей для *обрабатывать*.  
  
## <a name="comments"></a>Комментарии  
 Приложение обычно вызывает **SQLGetDiagRec** после предыдущего вызова функции ODBC вернул значение SQL_ERROR или SQL_SUCCESS_WITH_INFO. Тем не менее, поскольку любая функция ODBC можно разместить ноль или более записей диагностики при каждом вызове, приложение может вызвать **SQLGetDiagRec** после любого вызова функции ODBC. Приложение может вызвать **SQLGetDiagRec** несколько раз, чтобы вернуть некоторые или все записи в структуре диагностических данных. ODBC не предусмотрено ограничение на количество диагностических записей, которые могут храниться в любой момент времени.  
  
 **SQLGetDiagRec** не может использоваться для возврата поля из заголовка структуры диагностических данных. ( *RecNumber* аргумент должен быть больше 0.) Приложение должно вызвать **SQLGetDiagField** для этой цели.  
  
 **SQLGetDiagRec** получает диагностические сведения, наиболее недавно связанной с дескриптором, указанный в *обрабатывать* аргумент. Если приложение вызывает другую функцию ODBC, за исключением **SQLGetDiagRec**, **SQLGetDiagField**, или **SQLError**, любые диагностические сведения из предыдущих вызовов на том же дескрипторе теряется.  
  
 Приложения могут сканировать все диагностические записи, циклическую обработку, увеличивая *RecNumber*, при условии, что **SQLGetDiagRec** возвращает значение SQL_SUCCESS. Вызовы **SQLGetDiagRec** были неразрушающими полях заголовка и записи. Приложение может вызвать **SQLGetDiagRec** еще раз позже для извлечения полей из записи так же долго, так как не другую функцию, за исключением **SQLGetDiagRec**, **SQLGetDiagField**, или **SQLError**, был вызван до этого времени. Приложение также можно получить, вызвав количество общее число доступных диагностических записей **SQLGetDiagField** для извлечения значения из поля SQL_DIAG_NUMBER, а затем вызвав **SQLGetDiagRec**количество раз.  
  
 Описание полей структуры диагностических данных, см. в разделе [SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md). Дополнительные сведения см. в разделе [использование SQLGetDiagRec и SQLGetDiagField](../../../odbc/reference/develop-app/using-sqlgetdiagrec-and-sqlgetdiagfield.md) и [реализация SQLGetDiagRec и SQLGetDiagField](../../../odbc/reference/develop-app/implementing-sqlgetdiagrec-and-sqlgetdiagfield.md).  
  
 Вызов API-Интерфейс, отличный от того, который выполняется асинхронно создаст HY010 «Function ошибка последовательности». Тем не менее не удалось получить запись об ошибке, до завершения асинхронной операции.  
  
## <a name="handletype-argument"></a>Аргумент HandleType  
 Каждый тип дескриптора может иметь диагностические сведения, связанные с ней. *HandleType* аргумент обозначает тип дескриптора *обрабатывать* аргумент.  
  
 Некоторые поля заголовка и записи, нельзя вернуть для среды, подключения, инструкции и дескриптора дескрипторов. Эти дескрипторы, для которых поле неприменимо указаны в разделах «заголовок» и «Запись поля» в [SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md).  
  
 Вызов **SQLGetDiagRec** возвращает SQL_INVALID_HANDLE, если *HandleType* является SQL_HANDLE_SENV, который используется для обозначения дескриптор совместно используемой среде. Тем не менее если *HandleType* является SQL_HANDLE_ENV, *обрабатывать* можно использовать общий или дескриптор среды с монопольным доступом.  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Получение полей диагностики записи или диагностики заголовка|[Функция SQLGetDiagField](../../../odbc/reference/syntax/sqlgetdiagfield-function.md)|  
  
## <a name="see-also"></a>См. также  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)   
 [Образец программы ODBC](../../../odbc/reference/sample-odbc-program.md)
