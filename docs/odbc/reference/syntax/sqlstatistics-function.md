---
title: Функция SQLStatistics | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLStatistics
apilocation:
- sqlsrv32.dll
apitype: dllExport
f1_keywords:
- SQLStatistics
helpviewer_keywords:
- SQLStatistics function [ODBC]
ms.assetid: 45210682-cfea-4e5d-9951-bcf1cbe10f41
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: c2a5ef0b0e54e17a2dc091a98efc972fa608ef15
ms.sourcegitcommit: e042272a38fb646df05152c676e5cbeae3f9cd13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "81302948"
---
# <a name="sqlstatistics-function"></a>SQLStatistics, функция
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 1,0: ISO 92  
  
 **Сводка**  
 **SQLStatistics** получает список статистики по одной таблице и индексам, связанным с таблицей. Драйвер возвращает сведения в виде результирующего набора.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLStatistics(  
     SQLHSTMT        StatementHandle,  
     SQLCHAR *       CatalogName,  
     SQLSMALLINT     NameLength1,  
     SQLCHAR *       SchemaName,  
     SQLSMALLINT     NameLength2,  
     SQLCHAR *       TableName,  
     SQLSMALLINT     NameLength3,  
     SQLUSMALLINT    Unique,  
     SQLUSMALLINT    Reserved);  
```  
  
## <a name="arguments"></a>Аргументы  
 *статеменсандле*  
 Входной Маркер инструкции.  
  
 *CatalogName*  
 Входной Имя каталога. Если драйвер поддерживает каталоги для некоторых таблиц, но не для других, например, когда драйвер извлекает данные из разных СУБД, пустая строка ("") указывает на таблицы, не имеющие каталогов. *CatalogName* не может содержать шаблон поиска строки.  
  
 Если атрибуту инструкции SQL_ATTR_METADATA_ID присвоено значение SQL_TRUE, *CatalogName* рассматривается как идентификатор и его регистр не важен. Если это SQL_FALSE, *CatalogName* является обычным аргументом. он обрабатывается буквально, и его регистр важен. Дополнительные сведения см. [в разделе аргументы в функциях каталога](../../../odbc/reference/develop-app/arguments-in-catalog-functions.md).  
  
 *NameLength1*  
 Входной Длина в символах **CatalogName*.  
  
 *SchemaName*  
 Входной Имя схемы. Если драйвер поддерживает схемы для некоторых таблиц, но не для других, например, когда драйвер извлекает данные из разных СУБД, пустая строка ("") указывает на те таблицы, которые не имеют схем. *SchemaName* не может содержать шаблон поиска строки.  
  
 Если атрибуту инструкции SQL_ATTR_METADATA_ID присвоено значение SQL_TRUE, то объект *SchemaName* рассматривается как идентификатор и его регистр не важен. Если это SQL_FALSE, то *SchemaName* является обычным аргументом. он обрабатывается буквально, и его регистр важен.  
  
 *NameLength2*  
 Входной Длина в символах **SchemaName*.  
  
 *TableName*  
 Входной Имя таблицы. Этот аргумент не может быть пустым указателем. *SchemaName* не может содержать шаблон поиска строки.  
  
 Если атрибут инструкции SQL_ATTR_METADATA_ID имеет значение SQL_TRUE, *TableName* рассматривается как идентификатор и его регистр не важен. Если это SQL_FALSE, то *TableName* является обычным аргументом; он обрабатывается буквально, и его регистр важен.  
  
 *NameLength3*  
 Входной Длина в символах **TableName*.  
  
 *Однозначно*  
 Входной Тип индекса: SQL_INDEX_UNIQUE или SQL_INDEX_ALL.  
  
 *Reserved*  
 Входной Указывает важность столбцов количества элементов и страниц в результирующем наборе. Следующие параметры влияют на возвращение только столбцов КРАТности и страниц. сведения об индексе возвращаются, даже если количество элементов и страниц не возвращается.  
  
 SQL_ENSURE запрашивает, что драйвер безусловно получает статистику. (Драйверы, которые соответствуют только стандарту Open Group Standard и не поддерживают расширения ODBC, не смогут поддерживать SQL_ENSURE.)  
  
 SQL_QUICK запрашивает, что драйвер извлекает КРАТность и страницы только в том случае, если они легко доступны с сервера. В этом случае драйвер не гарантирует актуальность значений. (Приложения, написанные в стандарте Open Group, всегда будут получать SQL_QUICK поведение из драйверов, совместимых с ODBC *3. x*.)  
  
## <a name="returns"></a>Результаты  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_STILL_EXECUTING, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLStatistics** возвращает SQL_ERROR или SQL_SUCCESS_WITH_INFO, связанное значение SQLSTATE может быть получено путем вызова **SQLGetDiagRec** с *параметром handletype* SQL_HANDLE_STMT и *маркером* *статеменсандле*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые функцией **SQLStatistics** , и объясняется каждый из них в контексте этой функции. Нотация "(DM)" предшествует описаниям SQLSTATE, возвращаемым диспетчером драйверов. Код возврата, связанный с каждым значением SQLSTATE, имеет SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Error|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение для конкретного драйвера. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|08S01|Сбой канала связи|Канал связи между драйвером и источником данных, к которому был подключен драйвер, был неудачен до завершения обработки функции.|  
|24 000|Недопустимое состояние курсора|В *статеменсандле*был открыт курсор, а также был вызван **SQLFetch** или **SQLFetchScroll** . Эта ошибка возвращается диспетчером драйверов, если **SQLFetch** или **SQLFetchScroll** не вернул SQL_NO_DATA и возвращается драйвером, если **SQLFetch** или **SQLFetchScroll** вернул SQL_NO_DATA.<br /><br /> В *статеменсандле*был открыт курсор, но **SQLFetch** или **SQLFetchScroll** не был вызван.|  
|40001|Сбой сериализации|Выполнен откат транзакции из-за взаимоблокировки ресурсов с другой транзакцией.|  
|40003|Неизвестное завершение инструкции|Не удалось выполнить связанное соединение во время выполнения этой функции, и состояние транзакции не может быть определено.|  
|HY000|Общая ошибка|Произошла ошибка, для которой нет определенного SQLSTATE и для которого не определен SQLSTATE для конкретной реализации. Сообщение об ошибке, возвращаемое функцией **SQLGetDiagRec** в буфере * \*MessageText* , описывает ошибку и ее причину.|  
|HY001|Ошибка выделения памяти|Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Operation canceled|Асинхронная обработка включена для *статеменсандле*. Функция была вызвана и до ее завершения была вызвана **SQLCancel** или **склканцелхандле** для *Статеменсандле*, а затем в *статеменсандле*был вызвана функция.<br /><br /> Функция была вызвана и до ее завершения была вызвана **SQLCancel** или **склканцелхандле** в *статеменсандле* из другого потока многопоточного приложения.|  
|HY009|Недопустимое использование пустого указателя|Аргумент *TableName* был пустым указателем.<br /><br /> Атрибуту инструкции SQL_ATTR_METADATA_ID было присвоено значение SQL_TRUE, аргумент *CatalogName* был пустым указателем, а SQL_CATALOG_NAME *инфотипе* возвращает, что эти имена каталогов поддерживаются.<br /><br /> (DM) атрибуту инструкции SQL_ATTR_METADATA_ID было присвоено значение SQL_TRUE, а аргумент *SchemaName* — пустой указатель.|  
|HY010|Ошибка последовательности функций|(DM) вызвана асинхронно исполняемая функция для маркера соединения, связанного с *статеменсандле*. Эта асинхронная функция все еще выполнялась при вызове функции **SQLStatistics** .<br /><br /> (DM) **SQLExecute**, **SQLExecDirect**или **SQLMoreResults** были вызваны для *статеменсандле* и возвращены SQL_PARAM_DATA_AVAILABLE. Эта функция была вызвана до получения данных для всех потоковых параметров.<br /><br /> (DM) вызывается асинхронно исполняемая функция (не эта одна) для *статеменсандле* и все еще выполнялась при вызове этой функции.<br /><br /> (DM) **SQLExecute**, **SQLExecDirect**, **SQLBulkOperations**или **SQLSetPos** были вызваны для *статеменсандле* и возвращены SQL_NEED_DATA. Эта функция была вызвана перед отправкой данных для всех параметров или столбцов данных, выполняемых во время выполнения.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как не удалось получить доступ к базовым объектам памяти, возможно, из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение одного из аргументов длины имени меньше 0, но не равно SQL_NTS.<br /><br /> Значение одного из аргументов длины имени превышает максимальную длину для соответствующего имени.|  
|HY100|Тип параметра уникальности выходит за пределы допустимого диапазона|(DM) указано недопустимое *уникальное* значение.|  
|HY101|Тип параметра точности вне допустимого диапазона|(DM) указано недопустимое *зарезервированное* значение.|  
|HY117|Подключение приостановлено из-за неизвестного состояния транзакции. Допускаются только функции отключения и только для чтения.|(DM) Дополнительные сведения о состоянии SUSPENDED см. в разделе [функция SQLEndTran](../../../odbc/reference/syntax/sqlendtran-function.md).|  
|HYC00|Необязательная функция не реализована|Указан каталог, а драйвер или источник данных не поддерживает каталоги.<br /><br /> Указана схема, и драйвер или источник данных не поддерживают схемы.<br /><br /> Сочетание текущих параметров атрибутов SQL_ATTR_CONCURRENCY и SQL_ATTR_CURSOR_TYPE не поддерживалось драйвером или источником данных.<br /><br /> Атрибуту инструкции SQL_ATTR_USE_BOOKMARKS было присвоено значение SQL_UB_VARIABLE, а атрибуту инструкции SQL_ATTR_CURSOR_TYPE задан тип курсора, для которого драйвер не поддерживает закладки.|  
|HYT00|Время ожидания истекло|Время ожидания запроса истекло до того, как источник данных вернул запрошенный результирующий набор. Период ожидания задается через **SQLSetStmtAttr**, SQL_ATTR_QUERY_TIMEOUT.|  
|HYT01|Время ожидания подключения истекло|Время ожидания соединения истекло до ответа источника данных на запрос. Время ожидания соединения задается через **SQLSetConnectAttr**, SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, связанный с *статеменсандле* , не поддерживает функцию.|  
|IM017|Опрос отключен в режиме асинхронного уведомления|При использовании модели уведомления опрос отключен.|  
|IM018|**Склкомплетеасинк** не был вызван для завершения предыдущей асинхронной операции с этим обработчиком.|Если предыдущий вызов функции в обработчике возвращает SQL_STILL_EXECUTING и если включен режим уведомления, то для обработки после обработки и завершения операции необходимо вызвать **склкомплетеасинк** .|  
  
## <a name="comments"></a>Комментарии  
 **SQLStatistics** возвращает сведения об одной таблице в виде стандартного результирующего набора, упорядоченного по NON_UNIQUE, типу, INDEX_QUALIFIER, INDEX_NAME и ORDINAL_POSITION. Результирующий набор объединяет статистические данные (в столбцах количество элементов и страниц результирующего набора) для таблицы со сведениями о каждом индексе. Сведения об использовании этих сведений см. в разделе [использование данных каталога](../../../odbc/reference/develop-app/uses-of-catalog-data.md).  
  
 Чтобы определить фактическую длину столбцов TABLE_CAT, TABLE_SCHEM, TABLE_NAME и COLUMN_NAME, приложение может вызвать **SQLGetInfo** с параметрами SQL_MAX_CATALOG_NAME_LEN, SQL_MAX_SCHEMA_NAME_LEN, SQL_MAX_TABLE_NAME_LEN и SQL_MAX_COLUMN_NAME_LEN.  
  
> [!NOTE]  
>  Дополнительные сведения об общем использовании, аргументах и возвращаемых данных функций каталога ODBC см. в разделе [функции каталога](../../../odbc/reference/develop-app/catalog-functions.md).  
  
 Следующие столбцы были переименованы для ODBC *3. x*. Изменения имени столбца не влияют на обратную совместимость, так как приложения привязаны по номеру столбца.  
  
|Столбец ODBC 2,0|Столбец ODBC *3. x*|  
|---------------------|-----------------------|  
|TABLE_QUALIFIER|TABLE_CAT|  
|TABLE_OWNER|TABLE_SCHEM|  
|SEQ_IN_INDEX|ORDINAL_POSITION|  
|COLLATION|ASC_OR_DESC|  
  
 В следующей таблице перечислены столбцы результирующего набора. Дополнительные столбцы, которые выходят за пределы столбца 13 (FILTER_CONDITION), могут быть определены драйвером. Приложение должно получить доступ к столбцам, относящимся к драйверу, выполнив подсчет с конца результирующего набора вместо того, чтобы задавать явную порядковую точку. Дополнительные сведения см. в разделе [данные, возвращаемые функциями каталога](../../../odbc/reference/develop-app/data-returned-by-catalog-functions.md).  
  
|Имя столбца|Номер столбца|Тип данных|Комментарии|  
|-----------------|-------------------|---------------|--------------|  
|TABLE_CAT (ODBC 1,0)|1|Varchar|Имя каталога таблицы, к которой применяется статистика или индекс; Значение NULL, если неприменимо к источнику данных. Если драйвер поддерживает каталоги для некоторых таблиц, но не для других, например, когда драйвер извлекает данные из разных СУБД, он возвращает пустую строку ("") для таблиц, не имеющих каталогов.|  
|TABLE_SCHEM (ODBC 1,0)|2|Varchar|Имя схемы таблицы, к которой применяется статистика или индекс; Значение NULL, если неприменимо к источнику данных. Если драйвер поддерживает схемы для некоторых таблиц, но не для других, например, когда драйвер извлекает данные из разных СУБД, он возвращает пустую строку ("") для тех таблиц, которые не имеют схем.|  
|TABLE_NAME (ODBC 1,0)|3|Varchar, не РАВНый NULL|Имя таблицы таблицы, к которой применяется статистика или индекс.|  
|NON_UNIQUE (ODBC 1,0)|4|Smallint|Указывает, допускает ли индекс дублирование значений:<br /><br /> SQL_TRUE, если значения индекса могут быть неуникальными.<br /><br /> SQL_FALSE, если значения индекса должны быть уникальными.<br /><br /> Если тип имеет значение SQL_TABLE_STAT, возвращается NULL.|  
|INDEX_QUALIFIER (ODBC 1,0)|5|Varchar|Идентификатор, используемый для уточнения имени индекса, выполняющего **DROP INDEX**; Значение NULL возвращается, если квалификатор индекса не поддерживается источником данных или если тип — SQL_TABLE_STAT. Если в этом столбце возвращается значение, отличное от NULL, оно должно использоваться для уточнения имени индекса в операторе **DROP INDEX** . в противном случае для уточнения имени индекса следует использовать TABLE_SCHEM.|  
|INDEX_NAME (ODBC 1,0)|6|Varchar|Имя индекса; Если тип имеет значение SQL_TABLE_STAT, возвращается NULL.|  
|ТИП (ODBC 1,0)|7|Smallint, не NULL|Тип возвращаемых данных:<br /><br /> SQL_TABLE_STAT обозначает статистику для таблицы (в столбце Количество элементов или страниц).<br /><br /> SQL_INDEX_BTREE указывает индекс сбалансированного дерева.<br /><br /> SQL_INDEX_CLUSTERED указывает на кластеризованный индекс.<br /><br /> SQL_INDEX_CONTENT указывает индекс содержимого.<br /><br /> SQL_INDEX_HASHED указывает на хэшированный индекс.<br /><br /> SQL_INDEX_OTHER указывает другой тип индекса.|  
|ORDINAL_POSITION (ODBC 1,0)|8|Smallint|Порядковый номер столбца в индексе (начиная с 1); Если тип имеет значение SQL_TABLE_STAT, возвращается NULL.|  
|COLUMN_NAME (ODBC 1,0)|9|Varchar|Имя столбца. Если столбец основан на выражении, например о заработной ПЛАТе и ПРЕИМУЩЕСТВАх, выражение возвращается; Если выражение не может быть определено, возвращается пустая строка. Если тип имеет значение SQL_TABLE_STAT, возвращается NULL.|  
|ASC_OR_DESC (ODBC 1,0)|10|Char(1)|Порядок сортировки для столбца: "A" для возрастания; "D" для нисходящей; Возвращается значение NULL, если последовательность сортировки столбцов не поддерживается источником данных или если тип имеет значение SQL_TABLE_STAT.|  
|КОЛИЧЕСТВО ЭЛЕМЕНТОВ (ODBC 1,0)|11|Целое число|Количество элементов таблицы или индекса; число строк в таблице, если тип SQL_TABLE_STAT; число уникальных значений в индексе, если тип не SQL_TABLE_STAT; Если значение недоступно из источника данных, возвращается значение NULL.|  
|СТРАНИЦЫ (ODBC 1,0)|12|Целое число|Количество страниц, используемых для хранения индекса или таблицы; число страниц для таблицы, если тип имеет значение SQL_TABLE_STAT; число страниц для индекса, если тип не SQL_TABLE_STAT; Значение NULL возвращается, если значение недоступно из источника данных или если оно неприменимо к источнику данных.|  
|FILTER_CONDITION (ODBC 2,0)|13|Varchar|Если индекс является отфильтрованным, это условие фильтра, например ОКЛАД > 30000; Если условие фильтра не может быть определено, это пустая строка.<br /><br /> NULL если индекс не является фильтруемым, он не может определить, является ли индекс отфильтрованным индексом, или тип — SQL_TABLE_STAT.|  
  
 Если строка в результирующем наборе соответствует таблице, драйвер задает тип для SQL_TABLE_STAT и задает NON_UNIQUE, INDEX_QUALIFIER, INDEX_NAME, ORDINAL_POSITION, COLUMN_NAME и ASC_OR_DESC в NULL. Если количество элементов или страниц в источнике данных недоступно, драйвер устанавливает для них значение NULL.  
  
## <a name="code-example"></a>Пример кода  
 Пример кода подобной функции см. в разделе [SQLColumns](../../../odbc/reference/syntax/sqlcolumns-function.md).  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Привязка буфера к столбцу в результирующем наборе|[SQLBindCol, функция](../../../odbc/reference/syntax/sqlbindcol-function.md)|  
|Отмена обработки инструкции|[Функция SQLCancel](../../../odbc/reference/syntax/sqlcancel-function.md)|  
|Выборка одной строки или блока данных в прямом направлении.|[Функция SQLFetch](../../../odbc/reference/syntax/sqlfetch-function.md)|  
|Выборка блока данных или прокрутка результирующего набора|[Функция SQLFetchScroll](../../../odbc/reference/syntax/sqlfetchscroll-function.md)|  
|Возврат столбцов внешних ключей|[Функция SQLForeignKeys](../../../odbc/reference/syntax/sqlforeignkeys-function.md)|  
|Возвращение столбцов первичного ключа|[Функция SQLPrimaryKeys](../../../odbc/reference/syntax/sqlprimarykeys-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
