---
description: Функция SQLBrowseConnect
title: Функция SQLBrowseConnect | Документация Майкрософт
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLBrowseConnect
apilocation:
- sqlsrv32.dll
- odbc32.dll
apitype: dllExport
f1_keywords:
- SQLBrowseConnect
helpviewer_keywords:
- SQLBrowseConnect function [ODBC]
ms.assetid: b7f1be66-e6c7-4790-88ec-62b7662103c0
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 712dbb366e25098c7956ffbb9c8733a437339297
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88499637"
---
# <a name="sqlbrowseconnect-function"></a>Функция SQLBrowseConnect
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 1,0: ODBC  
  
 **Сводка**  
 **SQLBrowseConnect** поддерживает итеративный метод обнаружения и перечисления атрибутов и значений атрибутов, необходимых для подключения к источнику данных. Каждый вызов **SQLBrowseConnect** возвращает последовательные уровни атрибутов и значений атрибутов. Когда перечисляются все уровни, соединение с источником данных завершается, и **SQLBrowseConnect**возвращается полная строка подключения. Код возврата SQL_SUCCESS или SQL_SUCCESS_WITH_INFO указывает, что указаны все сведения о соединении, и приложение теперь подключено к источнику данных.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLBrowseConnect(  
     SQLHDBC         ConnectionHandle,  
     SQLCHAR *       InConnectionString,  
     SQLSMALLINT     StringLength1,  
     SQLCHAR *       OutConnectionString,  
     SQLSMALLINT     BufferLength,  
     SQLSMALLINT *   StringLength2Ptr);  
```  
  
## <a name="arguments"></a>Аргументы  
 *коннектионхандле*  
 [Input] Дескриптор подключения  
  
 *Строка подключения*  
 Входной Просмотр строки подключения запроса (см. раздел "аргумент*onconnectionstring* " в разделе "Comments").  
  
 *StringLength1*  
 Входной Длина ** строки* в символах.  
  
 *Строка подключения*  
 Проверки Указатель на символьный буфер, в котором возвращается строка подключения к результату обзора (см. раздел "аргумент of*ConnectionString* " в "Comments").  
  
 Если параметру *ConnectionString* присвоено значение null, *StringLength2Ptr* будет возвращать общее количество символов (исключая символ завершения null для символьных данных), доступных для возврата в буфер, на который указывает параметр *ConnectionString*.  
  
 *BufferLength*  
 Входной Длина (в символах) буфера*ConnectionString* *.  
  
 *StringLength2Ptr*  
 Проверки Общее число символов (исключая нулевое завершение), доступных для возврата в \* *ConnectionString*. Если число возвращаемых символов больше или равно значению *BufferLength*, строка подключения в параметре \* *ConnectionString* усекается до *BufferLength* , а длина символа завершения null не превышает длину.  
  
## <a name="returns"></a>Возвращаемое значение  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_NEED_DATA, SQL_ERROR, SQL_INVALID_HANDLE или SQL_STILL_EXECUTING.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLBrowseConnect** возвращает SQL_ERROR, SQL_SUCCESS_WITH_INFO или SQL_NEED_DATA, связанное значение SQLSTATE может быть получено путем вызова **SQLGetDiagRec** с *параметром handletypeом* SQL_HANDLE_STMT и *маркером коннектионхандле*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые функцией **SQLBrowseConnect** , и объясняется каждый из них в контексте этой функции. Нотация "(DM)" предшествует описаниям SQLSTATE, возвращаемым диспетчером драйверов. Код возврата, связанный с каждым значением SQLSTATE, имеет SQL_ERROR, если не указано иное.  
  
|SQLSTATE|Ошибка|Описание|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение для конкретного драйвера. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01004|Строковые данные, усеченные справа|Буферная \* *строка* не достаточно велика, чтобы вернуть всю строку подключения к результату обзора, поэтому строка была усечена. Буфер **StringLength2Ptr* содержит длину строки подключения неусеченного результата поиска. (Функция возвращает SQL_NEED_DATA.)|  
|01S00|Недопустимый атрибут строки подключения|В строке подключения к запросу на просмотр (*onconnectionstring*) было указано недопустимое ключевое слово Attribute. (Функция возвращает SQL_NEED_DATA.)<br /><br /> Ключевое слово Attribute было указано в строке подключения для запроса на просмотр (*onconnectionstring*), которая не применяется к текущему уровню соединения. (Функция возвращает SQL_NEED_DATA.)|  
|01S02|Значение изменено|Драйвер не поддерживал указанное значение аргумента *ValuePtr* в **SQLSetConnectAttr** и заменял аналогичное значение. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|08001|Клиенту не удалось установить подключение|Драйверу не удалось установить соединение с источником данных.|  
|08002|Имя подключения используется|(DM) указанное соединение уже было использовано для установления соединения с источником данных, а соединение было открыто.|  
|08004|Сервер отклонил подключение|Источник данных отклонил установку соединения для определенных реализацией причин.|  
|08S01|Сбой канала связи|Не удалось установить связь между драйвером и источником данных, к которому драйвер пытался подключиться, прежде чем функция завершила обработку.|  
|28000|Недопустимая спецификация авторизации|Либо идентификатор пользователя, либо строка авторизации, либо оба значения, как указано в строке подключения "Обзор запроса" (*onconnectionstring*), нарушают ограничения, определенные источником данных.|  
|HY000|Общая ошибка|Произошла ошибка, для которой нет определенного SQLSTATE и для которого не определен SQLSTATE для конкретной реализации. Сообщение об ошибке, возвращаемое функцией **SQLGetDiagRec** в буфере * \* MessageText* , описывает ошибку и ее причину.|  
|HY001|Ошибка выделения памяти|(DM) диспетчеру драйверов не удалось выделить память, необходимую для поддержки выполнения или завершения функции.<br /><br /> Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY008|Operation canceled|Асинхронная операция была отменена путем вызова [функции склканцелхандле](../../../odbc/reference/syntax/sqlcancelhandle-function.md). Затем в *коннектионхандле*была вызвана исходная функция.<br /><br /> Операция была отменена путем вызова **склканцелхандле** для *коннектионхандле* из другого потока многопоточного приложения.|  
|HY010|Ошибка последовательности функций|(DM) вызывается асинхронно исполняемая функция (не эта одна) для *коннектионхандле* и все еще выполнялась при вызове этой функции.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как не удалось получить доступ к базовым объектам памяти, возможно, из-за нехватки памяти.|  
|HY090|Недопустимая длина строки или буфера|(DM) значение, указанное для аргумента *StringLength1* , было меньше 0 и не равно SQL_NTS.<br /><br /> (DM) значение, указанное для аргумента *BufferLength* , было меньше 0.|  
|HY114|Драйвер не поддерживает асинхронное выполнение функции на уровне соединения|(DM). приложение включило асинхронную операцию для этого обработчика соединения перед подключением. Однако драйвер не поддерживает асинхронные операции с маркером соединения.|  
|HYT00|Время ожидания истекло|Время ожидания входа истекло до завершения соединения с источником данных. Период ожидания задается через **SQLSetConnectAttr**, SQL_ATTR_LOGIN_TIMEOUT.|  
|HYT01|Время ожидания подключения истекло|Время ожидания соединения истекло до ответа источника данных на запрос. Время ожидания соединения задается через **SQLSetConnectAttr**, SQL_ATTR_CONNECTION_TIMEOUT.|  
|IM001|Драйвер не поддерживает эту функцию|(DM) драйвер, соответствующий указанному имени источника данных, не поддерживает функцию.|  
|IM002|Источник данных не найден, драйвер по умолчанию не указан|(DM) имя источника данных, указанное в строке подключения к запросу на просмотр (*onconnectionstring*), не найдено в сведениях о системе и не содержит спецификацию драйвера по умолчанию.<br /><br /> (DM) источник данных ODBC и сведения о драйвере по умолчанию не найдены в сведениях о системе.|  
|IM003|Не удалось загрузить указанный драйвер|(DM) драйвер, указанный в спецификации источника данных в сведениях о системе или указанный в ключевом слове **Driver** , не найден или не может быть загружен по какой-либо другой причине.|  
|IM004|Сбой **функцию SQLAllocHandle** драйвера на SQL_HANDLE _ENV|(DM) во время **SQLBrowseConnect**диспетчер драйверов вызвал функцию **функцию SQLAllocHandle** драйвера с *параметром handletype* SQL_HANDLE_ENV и драйвер вернул ошибку.|  
|IM005|Сбой **функцию SQLAllocHandle** драйвера на SQL_HANDLE_DBC|(DM) во время **SQLBrowseConnect**диспетчер драйверов вызвал функцию **функцию SQLAllocHandle** драйвера с *параметром handletype* SQL_HANDLE_DBC и драйвер вернул ошибку.|  
|IM006|Сбой **SQLSetConnectAttr** драйвера|(DM) во время **SQLBrowseConnect**диспетчер драйверов вызвал функцию **SQLSetConnectAttr** драйвера, а драйвер вернул ошибку.|  
|IM009|Не удалось загрузить библиотеку DLL для перевода|Драйверу не удалось загрузить библиотеку DLL преобразования, указанную для источника данных или подключения.|  
|IM010|Слишком длинное имя источника данных|(DM) значение атрибута для ключевого слова DSN длиннее SQL_MAX_DSN_LENGTH символов.|  
|IM011|Слишком длинное имя драйвера|(DM) значение атрибута для ключевого слова DRIVER длиннее 255 символов.|  
|IM012|Ошибка синтаксиса ключевого слова DRIVER|(DM) пара "ключевое слово-значение" для ключевого слова DRIVER содержит синтаксическую ошибку.|  
|IM014|Указанное имя источника данных содержит несоответствие архитектуры драйвера и приложения|(DM) 32-разрядное приложение использует имя DSN, которое подключается к 64-разрядному драйверу; или наоборот.|  
|IM017|Опрос отключен в режиме асинхронного уведомления|При использовании модели уведомления опрос отключен.|  
|IM018|**Склкомплетеасинк** не был вызван для завершения предыдущей асинхронной операции с этим обработчиком.|Если предыдущий вызов функции в обработчике возвращает SQL_STILL_EXECUTING и если включен режим уведомления, то для обработки после обработки и завершения операции необходимо вызвать **склкомплетеасинк** .|  
|S1118|Драйвер не поддерживает асинхронное уведомление|Если драйвер не поддерживает асинхронное уведомление, нельзя задать SQL_ATTR_ASYNC_DBC_EVENT или SQL_ATTR_ASYNC_DBC_RETCODE_PTR.|  
  
## <a name="inconnectionstring-argument"></a>Аргумент onconnectionstring  
 Строка подключения для запроса на просмотр имеет следующий синтаксис:  
  
 *Connection-строка* :: = *атрибут*[ `;` ] &#124; соединение с *атрибутом* `;` *-строка*;<br>
 *атрибут::* = *атрибут-ключевое слово* `=` *-значение* &#124; `DRIVER=` [ `{` ]*атрибут-значение*[ `}` ]<br>
 *Attribute-ключевое_слово* :: = `DSN` &#124; `UID` &#124; `PWD` &#124; *драйвера-Attribute-ключевоеслово*<br>
 *атрибут-value* :: = *символьная строка*<br>
 *драйвер-defined-Attribute-ключевое слово* :: = *идентификатор*<br>
  
 где *символьная строка* содержит ноль или более символов; *идентификатор* содержит один или несколько символов; *ключевое слово Attribute-* не учитывает регистр; *атрибут — значение* может быть чувствительным к регистру; и значение ключевого слова **DSN** не состоит только из пробелов. Из-за грамматики в строке соединения и файла инициализации, ключевых слов и значений атрибутов, содержащих символы **[] {} (),;? \* =! @** следует избегать. Из-за грамматики в системных сведениях ключевые слова и имена источников данных не могут содержать символ обратной косой черты ( \\ ). Для ODBC 2. драйвер *x* , для значения атрибута ключевого слова Driver требуются фигурные скобки.  
  
 Если в строке подключения к запросу просмотра повторяются любые ключевые слова, драйвер использует значение, связанное с первым вхождением ключевого слова. Если ключевые слова **DSN** и **Driver** включены в ту же строку подключения запроса на просмотр, то диспетчер драйверов и драйвер используют любое ключевое слово, которое отображается первым.  
  
 Сведения о том, как приложение выбирает источник данных или драйвер, см. [в разделе Выбор источника данных или драйвера](../../../odbc/reference/develop-app/choosing-a-data-source-or-driver.md).  
  
## <a name="outconnectionstring-argument"></a>Аргумент of ConnectionString  
 Строка подключения к результату обзора представляет собой список атрибутов соединения. Атрибут Connection состоит из ключевого слова Attribute и соответствующего значения атрибута. Строка подключения к результату обзора имеет следующий синтаксис:  
  
 *Connection-строка* :: = *атрибут*[ `;` ] &#124; соединение с *атрибутом* `;` *-строка*<br>
 *Attribute::* = [ `*` ]*атрибут-ключевое слово* `=` *-значение*<br>
 *Attribute — ключевое слово* :: = *ODBC-attribute-ключевое_слово* &#124; *драйвер-defined-Attribute-ключевоеслово*<br>
 *ODBC-Attribute-ключевое_слово* = { `UID` &#124; `PWD` } [ `:` *локализованный идентификатор*] *драйвер-defined-Attribute-ключевое_слово* :: = *идентификатор*[ `:` *локализованный идентификатор*] *атрибут-value* :: = `{` *атрибут-значение-список* `}` &#124; `?` (фигурные скобки являются литеральными, они возвращаются драйвером).<br>
 *атрибут-Value-List* :: = *символьная строка* [ `:` *локализованная строка символов*] &#124; *символьная строка* [ `:` *локализованная строка символов*] `,` *атрибут-Value-List*<br>
  
 где *символьная строка* и *локализованная строка символов* содержат ноль или более символов; *идентификатор* и *локализованный идентификатор* содержат один или несколько символов; *ключевое слово Attribute-* не учитывает регистр; *значения атрибута* и могут быть чувствительны к регистру. Из-за грамматики в строке соединения и файла инициализации, ключевых слов, локализованных идентификаторов и значений атрибутов, содержащих символы **[] {} (),;? \* =! @** следует избегать. Из-за грамматики в системных сведениях ключевые слова и имена источников данных не могут содержать символ обратной косой черты ( \\ ).  
  
 Синтаксис строки подключения к результатам обзора используется в соответствии со следующими семантическими правилами:  
  
-   Если звездочка ( \* ) предшествует *ключевому слову атрибута*, *атрибут* является необязательным и может быть пропущен при следующем вызове метода **SQLBrowseConnect**.  
  
-   Ключевые слова атрибута **UID** и **PWD** имеют то же значение, что и в **SQLDriverConnect**.  
  
-   *Определяемый драйвером ключевое слово-Attribute* — это тип атрибута, для которого может быть указано значение атрибута. Например, это может быть **сервер**, **база данных**, **узел**или **СУБД**.  
  
-   Ключевые слова *ODBC-Attribute* и *Driver* -ключевое_слово содержат локализованную или удобную для пользователя версию ключевого слова. Это может быть использовано приложениями в качестве метки в диалоговом окне. Однако для передачи строки запроса на просмотр драйверу необходимо использовать **UID**, **PWD**или только *идентификатор* .  
  
-   {*Attribute-Value-List*} является перечислением фактических значений, допустимых для соответствующего *ключевого слова Attribute*. Обратите внимание, что фигурные скобки ( {} ) не указывают список вариантов; они возвращаются драйвером. Например, это может быть список имен серверов или список имен баз данных.  
  
-   Если *атрибут-value* является одиночным вопросительным знаком (?), то одно значение соответствует *ключевому слову Attribute*. Например, UID = Джонс; PWD = Sesame.  
  
-   Каждый вызов **SQLBrowseConnect** возвращает только сведения, необходимые для удовлетворения следующего уровня процесса подключения. Драйвер связывает сведения о состоянии с маркером соединения, чтобы контекст всегда определялся при каждом вызове.  
  
## <a name="using-sqlbrowseconnect"></a>Использование SQLBrowseConnect  
 Для **SQLBrowseConnect** требуется выделенное соединение. Диспетчер драйверов загружает драйвер, указанный в параметре или соответствующий имени источника данных, указанному в строке подключения первоначального просмотра запроса. сведения о том, когда это происходит, см. в разделе "Комментарии" в [функции SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md). Драйвер может установить подключение к источнику данных во время процесса обзора. Если **SQLBrowseConnect** возвращает SQL_ERROR, незавершенные соединения завершаются, и подключение возвращается в неподключенное состояние.  
  
> [!NOTE]  
>  **SQLBrowseConnect** не поддерживает пулы подключений. Если **SQLBrowseConnect** вызывается при включении пула соединений, будет возвращено значение SQLState HY000 (общая ошибка).  
  
 Когда **SQLBrowseConnect** вызывается в первый раз при подключении, строка подключения к запросу на просмотр должна содержать ключевое слово **DSN** или ключевое слово **Driver** . Если строка подключения к запросу на просмотр содержит ключевое слово **DSN** , диспетчер драйверов находит соответствующую спецификацию источника данных в сведениях о системе:  
  
-   Если диспетчер драйверов находит соответствующую спецификацию источника данных, загружается связанная библиотека DLL драйвера. драйвер может получить сведения об источнике данных из сведений о системе.  
  
-   Если диспетчеру драйверов не удается найти соответствующую спецификацию источника данных, он находит спецификацию источника данных по умолчанию и загружает связанную библиотеку DLL драйвера. драйвер может получить сведения о источнике данных по умолчанию из сведений о системе. Значение по умолчанию передается драйверу для имени DSN.  
  
-   Если диспетчеру драйверов не удается найти соответствующую спецификацию источника данных и отсутствует спецификация источника данных по умолчанию, она возвращает SQL_ERROR с SQLSTATE IM002 (источник данных не найден, а драйвер по умолчанию не указан).  
  
 Если строка подключения к запросу на просмотр содержит ключевое слово **Driver** , диспетчер драйверов загружает указанный драйвер. Он не пытается нахождение источника данных в сведениях о системе. Поскольку ключевое слово **Driver** не использует информацию из системных сведений, драйвер должен определить достаточно ключевых слов, чтобы драйвер мог подключаться к источнику данных, используя только сведения в строках подключения к запросу на просмотр.  
  
 При каждом вызове **SQLBrowseConnect**приложение указывает значения атрибута подключения в строке подключения запроса на просмотр. Драйвер возвращает последовательные уровни атрибутов и значений атрибутов в строке подключения обзора результатов. Он возвращает SQL_NEED_DATA, если в строке подключения к запросу на просмотр еще не перечислены атрибуты соединения. Приложение использует содержимое строки подключения к результату обзора для создания строки подключения к запросу обзора для следующего вызова **SQLBrowseConnect**. Все обязательные атрибуты (не предшествующие звездочкой в аргументе *ConnectionString* ) должны включаться в следующий вызов **SQLBrowseConnect**. Обратите внимание, что приложение не может использовать содержимое предыдущих строк подключения к обзору при построении текущей строки подключения для запроса обзора. то есть он не может указывать разные значения для атрибутов, заданных на предыдущих уровнях.  
  
 При перечислении всех уровней соединения и связанных с ними атрибутов драйвер возвращает SQL_SUCCESS, подключение к источнику данных завершено, и в приложение возвращается полная строка подключения. Строка подключения подходит для использования в сочетании с **SQLDriverConnect**с параметром SQL_DRIVER_NOPROMPT для установления другого соединения. Невозможно использовать полную строку соединения в другом вызове **SQLBrowseConnect**. Если **SQLBrowseConnect** были вызваны снова, вся последовательность вызовов должна быть повторена.  
  
 **SQLBrowseConnect** также возвращает SQL_NEED_DATA при наличии восстанавливаемых, устранимых ошибок во время процесса просмотра; Например, недопустимый пароль или ключевое слово атрибута, предоставленное приложением. Если возвращается значение SQL_NEED_DATA и строка подключения к результату обзора не изменяется, то произошла ошибка и приложение может вызвать **SQLGetDiagRec** , чтобы вернуть значение SQLSTATE для ошибок времени просмотра. Это позволяет приложению исправить атрибут и продолжить просмотр.  
  
 Приложение может завершить процесс просмотра в любое время, вызвав **SQLDisconnect**. Драйвер прекратит все незавершенные подключения и возвратит подключение к неподключенному состоянию.  
  
 Если в обработчике соединения включены асинхронные операции, **SQLBrowseConnect** также может возвращать SQL_STILL_EXECUTING. Когда он возвращает SQL_NEED_DATA, приложение должно использовать **SQLDisconnect** для отмены процесса просмотра. Если **SQLBrowseConnect** возвращает SQL_STILL_EXECUTING, приложение должно использовать **склканцелхандле** для отмены выполняемой операции. Вызов **склканцелхандле** после возвращения функцией SQL_NEED_DATA не оказывает никакого воздействия.  
  
 Дополнительные сведения см. [в разделе Подключение с помощью SQLBrowseConnect](../../../odbc/reference/develop-app/connecting-with-sqlbrowseconnect.md).  
  
 Если драйвер поддерживает **SQLBrowseConnect**, раздел ключевого слова Driver в сведениях о системе для драйвера должен содержать ключевое слово **коннектфунктионс** со третьим символом, равным «Y».  
  
## <a name="code-example"></a>Пример кода  
  
> [!NOTE]  
>  При подключении к поставщику источника данных, который поддерживает проверку подлинности Windows, следует указать `Trusted_Connection=yes` в строке подключения вместо сведений об идентификаторе пользователя и пароле.  
  
 В следующем примере приложение вызывает **SQLBrowseConnect** несколько раз. Каждый раз, когда **SQLBrowseConnect** возвращает SQL_NEED_DATA, он передает обратно сведения о необходимых данных в \* *ConnectionString*. Приложение передает *ConnectionString* в свою обычную **жетусеринпут** (не показано). **Жетусеринпут** анализирует данные, создает и отображает диалоговое окно, а также возвращает сведения, введенные пользователем в параметре \* *onconnectionstring*. Приложение передает сведения о пользователе в драйвер при следующем вызове **SQLBrowseConnect**. После того как приложение предоставило все необходимые сведения для подключения драйвера к источнику данных, **SQLBrowseConnect** возвращает SQL_SUCCESS и приложение продолжает работу.  
  
 Более подробный пример подключения к драйверу SQL Server путем вызова **SQLBrowseConnect**см. в разделе [пример просмотра SQL Server](../../../odbc/reference/develop-app/sql-server-browsing-example.md).  
  
 Например, для подключения к источнику данных Sales могут возникнуть следующие действия. Сначала приложение передает следующую строку в **SQLBrowseConnect**:  
  
```  
"DSN=Sales"  
```  
  
 Диспетчер драйверов загружает драйвер, связанный с данными о продажах источника данных. Затем он вызывает функцию **SQLBrowseConnect** драйвера с теми же аргументами, которые он получил из приложения. Драйвер возвращает следующую строку в * параметре*ConnectionString*:  
  
```  
"HOST:Server={red,blue,green};UID:ID=?;PWD:Password=?"  
```  
  
 Приложение передает эту строку в подпрограммы **жетусеринпут** , которая создает диалоговое окно, предлагающее пользователю выбрать красный, синий или зеленый сервер и ввести идентификатор пользователя и пароль. Подпрограммы передает следующие указанные пользователем сведения обратно в \* *onconnectionstring*, которое приложение передает в **SQLBrowseConnect**:  
  
```  
"HOST=red;UID=Smith;PWD=Sesame"  
```  
  
 **SQLBrowseConnect** использует эти сведения для подключения к Red Server в качестве Smith с паролем Sesame, а затем возвращает следующую строку в * of*ConnectionString*:  
  
```  
"*DATABASE:Database={SalesEmployees,SalesGoals,SalesOrders}"  
```  
  
 Приложение передает эту строку в подпрограммы **жетусеринпут** , которая создает диалоговое окно, предлагающее пользователю выбрать базу данных. Пользователь выбирает емпдата, и приложение в последний раз вызывает **SQLBrowseConnect** с этой строкой:  
  
```  
"DATABASE=SalesOrders"  
```  
  
 Это последний фрагмент информации, который необходим драйверу для подключения к источнику данных. **SQLBrowseConnect** возвращает SQL_SUCCESS, а * in*ConnectionString* содержит завершенную строку подключения:  
  
```cpp  
// SQLBrowseConnect_Function.cpp  
// compile with: odbc32.lib  
#include <windows.h>  
#include <sqltypes.h>  
#include <sqlext.h>  
  
#define BRWS_LEN 100  
SQLHENV henv;  
SQLHDBC hdbc;  
SQLHSTMT hstmt;  
SQLRETURN retcode;  
SQLCHAR szConnStrIn[BRWS_LEN], szConnStrOut[BRWS_LEN];  
SQLSMALLINT cbConnStrOut;  
  
void GetUserInput(SQLCHAR * szConnStrOut, SQLCHAR * szConnStrIn) {}  
  
int main() {  
   // Allocate the environment handle.  
   retcode = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &henv);        
   if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
      // Set the version environment attribute.  
      retcode = SQLSetEnvAttr(henv, SQL_ATTR_ODBC_VERSION, (SQLPOINTER*)SQL_OV_ODBC3, 0);  
      if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
  
         // Allocate the connection handle.  
         retcode = SQLAllocHandle(SQL_HANDLE_DBC, henv, &hdbc);  
         if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO) {  
            // Call SQLBrowseConnect until it returns a value other than SQL_NEED_DATA   
            // (pass data source name the first time).  If SQL_NEED_DATA is returned, call GetUserInput   
            // (not shown) to build a dialog from the values in szConnStrOut.  The user-supplied values   
            // are returned in szConnStrIn, which is passed in the next call to SQLBrowseConnect.  
  
            strcpy_s((char*)szConnStrIn, _countof(szConnStrIn), "DSN=Sales");  
            do {  
               retcode = SQLBrowseConnect(hdbc, szConnStrIn, SQL_NTS,  
                  szConnStrOut, BRWS_LEN, &cbConnStrOut);  
               if (retcode == SQL_NEED_DATA)  
                  GetUserInput(szConnStrOut, szConnStrIn);  
            } while (retcode == SQL_NEED_DATA);  
  
            if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO){  
  
               // Allocate the statement handle.  
               retcode = SQLAllocHandle(SQL_HANDLE_STMT, hdbc, &hstmt);  
  
               if (retcode == SQL_SUCCESS || retcode == SQL_SUCCESS_WITH_INFO)  
                  // Process data after successful connection  
                  SQLFreeHandle(SQL_HANDLE_STMT, hstmt);  
               SQLDisconnect(hdbc);  
            }  
         }  
         SQLFreeHandle(SQL_HANDLE_DBC, hdbc);  
      }  
   }  
   SQLFreeHandle(SQL_HANDLE_ENV, henv);  
}  
```  
  
## <a name="related-functions"></a>Связанные функции  
  
|Сведения о|См.|  
|---------------------------|---------|  
|Выделение маркера подключения|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Подключение к источнику данных|[Функция SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md)|  
|Отключение от источника данных|[Функция SQLDisconnect](../../../odbc/reference/syntax/sqldisconnect-function.md)|  
|Соединение с источником данных с помощью строки подключения или диалогового окна|[Функция SQLDriverConnect](../../../odbc/reference/syntax/sqldriverconnect-function.md)|  
|Возвращение описаний и атрибутов драйверов|[Функция SQLDrivers](../../../odbc/reference/syntax/sqldrivers-function.md)|  
|Освобождение маркера подключения|[SQLFreeHandle, функция](../../../odbc/reference/syntax/sqlfreehandle-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)
