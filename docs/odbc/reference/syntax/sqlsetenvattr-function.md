---
title: Функция SQLSetEnvAttr | Документация Майкрософт
ms.custom: ''
ms.date: 07/18/2019
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
apiname:
- SQLSetEnvAttr
apilocation:
- sqlsrv32.dll
- odbc32.dll
apitype: dllExport
f1_keywords:
- SQLSetEnvAttr
helpviewer_keywords:
- SQLSetEnvAttr function [ODBC]
ms.assetid: 0343241c-4b15-4d4b-aa2b-2e8ab5215cd2
author: MightyPen
ms.author: genemi
ms.openlocfilehash: b69b08a5004252f9016fbc616e9198179db31fb1
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2020
ms.locfileid: "68343076"
---
# <a name="sqlsetenvattr-function"></a>SQLSetEnvAttr, функция
**Соответствия**  
 Представленная версия: соответствие стандартам ODBC 3,0: ISO 92  
  
 **Сводка**  
 **SQLSetEnvAttr** задает атрибуты, которые управляют аспектами сред.  
  
## <a name="syntax"></a>Синтаксис  
  
```cpp  
  
SQLRETURN SQLSetEnvAttr(  
     SQLHENV      EnvironmentHandle,  
     SQLINTEGER   Attribute,  
     SQLPOINTER   ValuePtr,  
     SQLINTEGER   StringLength);  
```  
  
## <a name="arguments"></a>Аргументы  
 *енвиронменсандле*  
 Входной Маркер среды.  
  
 *attribute*  
 Входной Заданный атрибут, указанный в комментариях.  
  
 *ValuePtr*  
 Входной Указатель на значение, которое должно быть связано с *атрибутом*. В зависимости от значения *атрибута* *ValuePtr* будет 32-разрядным целым числом или указывать на строку символов, завершающуюся нулем.  
  
 *StringLength*  
 Входной Если *ValuePtr* указывает на символьную строку или двоичный буфер, этот аргумент должен иметь длину **ValuePtr*. Для символьных строковых данных этот аргумент должен содержать число байтов в строке.  
  
 Если *ValuePtr* является целым числом, *StringLength* игнорируется.  
  
## <a name="returns"></a>Возвращает  
 SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, SQL_ERROR или SQL_INVALID_HANDLE.  
  
## <a name="diagnostics"></a>Диагностика  
 Когда **SQLSetEnvAttr** возвращает SQL_ERROR или SQL_SUCCESS_WITH_INFO, связанное значение SQLSTATE может быть получено путем вызова **SQLGetDiagRec** с *параметром handletype* SQL_HANDLE_ENV и *маркером* *енвиронменсандле*. В следующей таблице перечислены значения SQLSTATE, обычно возвращаемые функцией **SQLSetEnvAttr** , и объясняется каждый из них в контексте этой функции. Нотация "(DM)" предшествует описаниям SQLSTATE, возвращаемым диспетчером драйверов. Код возврата, связанный с каждым значением SQLSTATE, имеет SQL_ERROR, если не указано иное. Если драйвер не поддерживает атрибут среды, ошибка может быть возвращена только во время подключения.  
  
|SQLSTATE|Ошибка|Description|  
|--------------|-----------|-----------------|  
|01000|Общее предупреждение|Информационное сообщение для конкретного драйвера. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|01S02|Значение параметра изменено|Драйвер не поддерживал значение, указанное в *ValuePtr* , и заменяло аналогичное значение. (Функция возвращает SQL_SUCCESS_WITH_INFO.)|  
|HY000|Общая ошибка|Произошла ошибка, для которой нет определенного SQLSTATE и для которого не определен SQLSTATE для конкретной реализации. Сообщение об ошибке, возвращаемое функцией **SQLGetDiagRec** в буфере * \*MessageText* , описывает ошибку и ее причину.|  
|HY001|Ошибка выделения памяти|Драйверу не удалось выделить память, необходимую для поддержки выполнения или завершения функции.|  
|HY009|Недопустимое использование пустого указателя|Аргумент атрибута определил атрибут среды, которому требовалось строковое значение, а аргумент *ValuePtr* был пустым указателем.|  
|HY010|Ошибка последовательности функций|(DM) в *енвиронменсандле*был выделен маркер подключения.<br /><br /> (DM) **SQL_ATTR_ODBC_VERSION** не задано с параметром **SQLSetEnvAttr** , а *атрибут* не равен **SQL_ATTR_ODBC_VERSION**. Не нужно явно задавать **SQL_ATTR_ODBC_VERSION** , если используется **склаллочандлестд**.|  
|HY013|Ошибка управления памятью|Не удалось обработать вызов функции, так как не удалось получить доступ к базовым объектам памяти, возможно, из-за нехватки памяти.|  
|HY024|Недопустимое значение атрибута|При наличии указанного значения *атрибута* в *ValuePtr*было указано недопустимое значение.|  
|HY090|Недопустимая длина строки или буфера|Аргумент *StringLength* меньше 0, но не был SQL_NTS.|  
|HY092|Недопустимый идентификатор атрибута или параметра|(DM) значение, указанное для *атрибута* Argument, недопустимо для версии ODBC, поддерживаемой драйвером.|  
|HY117|Подключение приостановлено из-за неизвестного состояния транзакции. Допускаются только функции отключения и только для чтения.|(DM) Дополнительные сведения о состоянии SUSPENDED см. в разделе [функция SQLEndTran](../../../odbc/reference/syntax/sqlendtran-function.md).|  
|HYC00|Необязательная функция не реализована|Значение, указанное для *атрибута* Argument, было допустимым атрибутом среды ODBC для версии ODBC, поддерживаемой драйвером, но не поддерживается драйвером.<br /><br /> (DM) аргумент *атрибута* был SQL_ATTR_OUTPUT_NTS, а *ValuePtr* — SQL_FALSE.|  
  
## <a name="comments"></a>Комментарии  
 Приложение может вызвать **SQLSetEnvAttr** , только если в среде не выделено ни одного маркера подключения. Все атрибуты среды, успешно заданные приложением для среды, сохраняются до тех пор, пока в среде не будет вызван **SQLFreeHandle** . В ODBC *3. x*можно одновременно выделить более одного маркера среды.  
  
 Формат данных, устанавливаемых через *ValuePtr* , зависит от указанного *атрибута*. **SQLSetEnvAttr** будет принимать сведения об атрибутах в одном из двух разных форматов: строку символов, завершающуюся нулем, или 32-разрядное целое число. Формат каждого из них отмечен в описании атрибута.  
  
 Атрибуты среды, специфичные для драйвера, отсутствуют.  
  
 Не удается задать атрибуты соединения при вызове **SQLSetEnvAttr**. При попытке сделать это будет возвращено значение SQLSTATE HY092 (недопустимый идентификатор атрибута или параметра).  
  
|*attribute*|Содержимое *ValuePtr*|  
|-----------------|-------------------------|  
|SQL_ATTR_CONNECTION_POOLING (ODBC 3,8)|32-битное значение SQLUINTEGER, которое включает или отключает использование пулов соединений на уровне среды. Используются следующие значения:<br /><br /> SQL_CP_OFF = пулы подключений отключены. Это значение используется по умолчанию.<br /><br /> SQL_CP_ONE_PER_DRIVER = для каждого драйвера поддерживается один пул подключений. Каждое подключение в пуле связано с одним драйвером.<br /><br /> SQL_CP_ONE_PER_HENV = один пул подключений поддерживается для каждой среды. Каждое подключение в пуле связано с одной средой.<br /><br /> SQL_CP_DRIVER_AWARE = используйте функцию "осведомленность о пуле подключений" драйвера, если она доступна. Если драйвер не поддерживает информирование о пуле подключений, SQL_CP_DRIVER_AWARE игнорируется и используется SQL_CP_ONE_PER_HENV. Дополнительные сведения см. в статье [Организация пулов соединений с учетом драйверов](../../../odbc/reference/develop-app/driver-aware-connection-pooling.md). В среде, в которой некоторые драйверы поддерживаются и некоторые драйверы не поддерживают сведения о пуле подключений, SQL_CP_DRIVER_AWARE может включить функцию осведомленности о пуле подключений для этих вспомогательных драйверов, но она эквивалентна установке для SQL_CP_ONE_PER_HENV на Эти драйверы не поддерживают функцию "осведомленность о пуле подключений".<br /><br /> Пул соединений включается путем вызова **SQLSetEnvAttr** , чтобы задать SQL_CP_ONE_PER_DRIVER или SQL_CP_ONE_PER_HENV атрибута SQL_ATTR_CONNECTION_POOLING. Этот вызов необходимо выполнить до того, как приложение выделит общую среду, для которой будет включен пул соединений. Обработчику среды в вызове **SQLSetEnvAttr** присваивается значение null, что делает SQL_ATTR_CONNECTION_POOLING атрибутом уровня процесса. После включения пула соединений приложение выделяет неявную общую среду путем вызова **функцию SQLAllocHandle** с аргументом *инпусандле* , для которого задано значение SQL_HANDLE_ENV.<br /><br /> После включения пула соединений и выбора совместно используемой среды для приложения SQL_ATTR_CONNECTION_POOLING не может быть сброшена для этой среды, так как при задании этого атрибута **SQLSetEnvAttr** вызывается с помощью нулевого обработчика среды. Если этот атрибут задан, а в общей среде уже включен пул соединений, атрибут влияет только на общие среды, которые будут выделены в дальнейшем.<br /><br /> Кроме того, можно включить использование пулов подключений в среде. Обратите внимание на следующие сведения о пуле соединений с окружением.<br /><br /> — Включение пулов соединений с маркером NULL является атрибутом уровня процесса. Впоследствии выделенные среды будут общей средой и будут наследовать параметр пулов соединений на уровне процесса.<br />— После выделения среды приложение по-прежнему может изменить его настройки пула соединений.<br />— Если включен пул соединений с окружением, а драйвер подключения использует пул драйверов, предпочтение осуществляется пулом сред.<br /><br /> SQL_ATTR_CONNECTION_POOLING реализована в диспетчере драйверов. Драйверу не требуется реализовывать SQL_ATTR_CONNECTION_POOLING. Приложения ODBC 2,0 и 3,0 могут устанавливать этот атрибут среды.<br /><br /> Дополнительные сведения см. в статье [Организация пулов соединений ODBC](../../../odbc/reference/develop-app/driver-manager-connection-pooling.md).|  
|SQL_ATTR_CP_MATCH (ODBC 3,0)|32-битное значение SQLUINTEGER, определяющее, как соединение выбирается из пула соединений. При вызове **SQLConnect** или **SQLDriverConnect** диспетчер драйверов определяет, какое подключение повторно используется из пула. Диспетчер драйверов пытается сопоставить параметры соединения в вызове, а атрибуты соединения, заданные приложением, с ключевыми словами и атрибутами соединения в пуле. Значение этого атрибута определяет уровень точности соответствующего критерия.<br /><br /> Для задания значения этого атрибута используются следующие значения:<br /><br /> SQL_CP_STRICT_MATCH = повторно используются только соединения, которые точно соответствуют параметрам соединения в вызове, и атрибуты соединения, заданные приложением. Это значение используется по умолчанию.<br /><br /> SQL_CP_RELAXED_MATCH = можно использовать соединения с соответствующими ключевыми словами строки подключения. Ключевые слова должны совпадать, но не все атрибуты соединения должны совпадать.<br /><br /> Дополнительные сведения о том, как диспетчер драйверов выполняет сопоставление при подключении к соединению с пулом, см. в разделе [SQLConnect](../../../odbc/reference/syntax/sqlconnect-function.md). Дополнительные сведения о пулах соединений см. в разделе Использование [пулов соединений ODBC](../../../odbc/reference/develop-app/driver-manager-connection-pooling.md).|  
|SQL_ATTR_ODBC_VERSION (ODBC 3,0)|32-разрядное целое число, определяющее, ведет ли определенная функциональность поведение ODBC *2. x* или поведение ODBC *3. x* . Для задания значения этого атрибута используются следующие значения:<br /><br /> SQL_OV_ODBC3_80 = диспетчер драйверов и драйвер, которые демонстрируют следующее поведение ODBC 3,8:<br /><br /> — Драйвер возвращает и ожидает коды ODBC *3. x* для даты, времени и метки времени.<br />— Драйвер возвращает коды ODBC *3. x* SQLSTATE при вызове **SqlError**, **SQLGetDiagField**или **SQLGetDiagRec** .<br />— Аргумент *CatalogName* в вызове **SQLTables** принимает шаблон поиска.<br />— Диспетчер драйверов поддерживает расширяемость типов данных C. Дополнительные сведения о расширяемости типов данных C см. [в разделе Типы данных c в ODBC](../../../odbc/reference/develop-app/c-data-types-in-odbc.md).<br /><br /> Дополнительные сведения см. [в статье новые возможности ODBC 3,8](../../../odbc/reference/what-s-new-in-odbc-3-8.md).<br /><br /> SQL_OV_ODBC3 = диспетчер драйверов и драйвер демонстрируют следующее поведение ODBC *3. x* :<br /><br /> — Драйвер возвращает и ожидает коды ODBC *3. x* для даты, времени и метки времени.<br />— Драйвер возвращает коды ODBC *3. x* SQLSTATE при вызове **SqlError**, **SQLGetDiagField**или **SQLGetDiagRec** .<br />— Аргумент *CatalogName* в вызове **SQLTables** принимает шаблон поиска.<br />— Диспетчер драйверов не поддерживает расширяемость типов данных C.<br /><br /> SQL_OV_ODBC2 = диспетчер драйверов и драйвер демонстрируют следующее поведение ODBC *2. x* . Это особенно полезно для приложения ODBC *2. x* , работающего с драйвером ODBC *3. x* .<br /><br /> — Драйвер возвращает и ожидает коды ODBC *2. x* для даты, времени и метки времени.<br />— Драйвер возвращает коды ODBC *2. x* SQLSTATE при вызове **SqlError**, **SQLGetDiagField**или **SQLGetDiagRec** .<br />— Аргумент *CatalogName* в вызове **SQLTables** не принимает шаблон поиска.<br />— Диспетчер драйверов не поддерживает расширяемость типов данных C.<br /><br /> Приложение должно задать этот атрибут среды перед вызовом любой функции, имеющей аргумент СКЛХЕНВ, или вызов вернет значение SQLSTATE HY010 (ошибка последовательности функций). Это зависит от конкретного драйвера, существует ли дополнительное поведение для этих флагов среды.<br /><br /> Дополнительные сведения см. в разделе [объявление версии ODBC приложения](../../../odbc/reference/develop-app/declaring-the-application-s-odbc-version.md) и [изменений поведения](../../../odbc/reference/develop-app/behavioral-changes.md).|  
|SQL_ATTR_OUTPUT_NTS (ODBC 3,0)|32-разрядное целое число, определяющее, как драйвер возвращает строковые данные. Если SQL_TRUE, драйвер возвращает строковые данные, заканчивающиеся нулем. Если SQL_FALSE, драйвер не возвращает строковые данные, заканчивающиеся нулем.<br /><br /> По умолчанию этот атрибут имеет значение SQL_TRUE. Вызов **SQLSetEnvAttr** для присвоения ему значения SQL_TRUE возвращает SQL_SUCCESS. Вызов **SQLSetEnvAttr** для присвоения ему значения SQL_FALSE возвращает SQL_ERROR и SQLSTATE HYC00 (необязательный компонент не реализован).|  
  
## <a name="related-functions"></a>Связанные функции  
  
|Тема|См. следующие документы.|  
|---------------------------|---------|  
|Выделение маркера|[Функция SQLAllocHandle](../../../odbc/reference/syntax/sqlallochandle-function.md)|  
|Возврат значения атрибута среды|[Функция SQLGetEnvAttr](../../../odbc/reference/syntax/sqlgetenvattr-function.md)|  
  
## <a name="see-also"></a>См. также:  
 [Справочник по API ODBC](../../../odbc/reference/syntax/odbc-api-reference.md)   
 [Файлы заголовков ODBC](../../../odbc/reference/install/odbc-header-files.md)   
 [Новые возможности ODBC 3.8](../../../odbc/reference/what-s-new-in-odbc-3-8.md)
