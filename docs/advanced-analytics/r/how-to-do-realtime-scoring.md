---
title: Как создавать прогнозы и прогнозы с помощью моделей машинного обучения в SQL Server | Документация Майкрософт
description: Используйте rxPredict или sp_rxPredict для оценки в реальном времени или ПРОГНОЗИРОВАНИЯ T-SQL для собственного оценки для создания прогнозов и прогнозирования R и Pythin в машинного обучения SQL Server.
ms.prod: sql
ms.technology: machine-learning
ms.date: 08/30/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 8d1ff524a0f033c4e47d7fe7f4e366cb00f2f7b5
ms.sourcegitcommit: b7fd118a70a5da9bff25719a3d520ce993ea9def
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46712476"
---
# <a name="how-to-generate-forecasts-and-predictions-using-machine-learning-models-in-sql-server"></a>Как создавать прогнозы и прогнозы с помощью моделей машинного обучения в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Использование существующей модели для прогнозирования или прогноз результатов для новых входных данных — это основная задача в машинном обучении. В этой статье перечисляет подходы для создания прогнозов в SQL Server. Среди подходы методологий внутренней обработки для высокоскоростной прогнозов, где скорость основан на добавочные сокращение на выполняются зависимости времени. Меньшим числом зависимостей означает ускорить прогнозирование.

С помощью инфраструктуры внутренней обработки (в режиме реального времени или собственного оценки) поставляется с требования к библиотекам. Функции должны быть из библиотек Microsoft. В расширениях CLR или C++ не поддерживается кодом R или Python, вызывающие функции с открытым исходным кодом или сторонние.

В следующей таблице перечислены оценки платформ для прогнозирования и прогнозов. 

| Метод           | Интерфейс         | Требования к библиотекам | Скорости обработки |
|-----------------------|-------------------|----------------------|----------------------|
| Платформа расширяемости | [rxPredict (R)](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxpredict) <br/>[rx_predict (Python)](https://docs.microsoft.com/machine-learning-server/python-reference/revoscalepy/rx-predict) | Нет. Модели могут быть основаны на любую функцию R или Python | Сотен миллисекунд. <br/>Загрузка среды выполнения имеет фиксированные издержки, вычисление среднего значения для шести триста миллисекунд, прежде чем оцениваются все новые данные. |
| [В режиме реального времени оценки расширения CLR](../real-time-scoring.md) | [sp_rxPredict](https://docs.microsoft.com//sql/relational-databases/system-stored-procedures/sp-rxpredict-transact-sql) в сериализованной модели | R: RevoScaleR, MicrosoftML <br/>Python: revoscalepy, microsoftml | Десятки миллисекунд, в среднем. |
| [Собственным расширением оценки C++](../sql-native-scoring.md) | [Функция ПРОГНОЗИРОВАНИЯ T-SQL](https://docs.microsoft.com/sql/t-sql/queries/predict-transact-sql) в сериализованной модели | R: RevoScaleR <br/>Python: revoscalepy | Менее чем за 20 миллисекунд, в среднем. | 

Скорость обработки и не вещества выходных данных является функция отличительный. Если же функции и входные данные, результата оценки следует не зависят от подход, который можно использовать.

Модели должен быть создан с использованием поддерживаемых функций, а затем сериализовать в поток необработанных байтов, которые сохраняются на диске, или хранится в двоичном формате в базе данных. С помощью хранимой процедуры или T-SQL, можно загрузить и использовать двоичную модель без издержек на время запуска язык R или Python, в результате чего сократить время до завершения после формировать прогнозирующие оценки для новых входных данных.

Значимость расширения CLR и C++ — с учетом расположения, к компоненту database engine, сам. C++, которая означает, что модули, написанные на C++, запустите с меньшим числом зависимостей является собственным языком, компонента database engine. В противоположность этому расширения CLR зависят от .NET Core. 

Как можно догадаться, поддержка платформ зависит также от этих сред время выполнения. Расширения ядра базы данных в собственном запуск из любого места, реляционной базы данных поддерживается: Windows, Linux, Azure. Расширения CLR с необходимостью .NET Core в данный момент Windows только.

## <a name="scoring-overview"></a>Обзор оценки

_Оценки_ представляет собой двухэтапный процесс. Сначала необходимо указать уже обученной модели, для загрузки из таблицы. Во-вторых, передайте новые входные данные функции, для формирования прогноза значений (или _оценок_). Входные данные часто является запрос T-SQL, возвращая табличном, так и для одной строки. Можно выбрать для вывода одного столбца значение, представляющее вероятность или могут выдавать несколько значений, таких как доверительный интервал, ошибка или другим полезным дополнением к прогноза.

Шаг назад, процесс подготовки модели и затем вычисление оценок сводятся к таким образом:

1. Создайте модель, используя поддерживаемый алгоритм. Поддержка зависит от выбранного оценки методологии.
2. Обучение модели.
3. Сериализует модель с помощью специальных двоичный формат.
3. Сохраните модель в SQL Server. Как правило, это означает сохранение сериализованную модель в таблице SQL Server.
4. Вызовите функцию или хранимую процедуру, указав входные данные модели и данных в качестве параметров.

Если входных данных содержит несколько строк данных, обычно это быстрее для вставки значений прогноза в таблицу в ходе процесса оценки. Создание оценки обычно в сценарии, где получает входные значения из формы или запроса пользователя, а также возвращают оценку клиентскому приложению. Чтобы повысить производительность при создании последовательных оценок, SQL Server может кэшировать модели таким образом, чтобы его можно загрузить в память.

## <a name="compare-methods"></a>Сравнение методов

Чтобы сохранить целостность основные процессы ядра базы данных, в двухуровневую архитектуру, изолирующий обработки языка из реляционной СУБД обработки включена поддержка R и Python. Начиная с SQL Server 2016, корпорация Microsoft добавила расширения среды .NET framework, которая позволяет сценариям R, выполняемый из T-SQL. В SQL Server 2017 была добавлена интеграция Python. 

Платформа расширяемости поддерживает любой операции, которые можно выполнять с использованием R или Python, от простых функций для обучения сложных моделей машинного обучения. Тем не менее архитектура dual процесса требуется вызов внешнего процесса R или Python для каждого вызова, вне зависимости от сложности операции. Если рабочая нагрузка влечет за собой загрузки предварительно обученной модели из таблицы и оценку на основе его на основе данных уже в SQL Server, затраты на вызов внешних процессов приводит к увеличению задержки, может стать неприемлемой в некоторых случаях. Например мошенничества требуется для быстрой оценки должно остаться актуальным.

Для повышения скорости оценки для сценариев, таких как обнаружение мошенничества, SQL Server добавлена встроенных библиотек оценки как расширения C++ и средой CLR, которые позволяют избежать издержек при запуске процессов R и Python.

[**Оценки в реальном времени** ](../real-time-scoring.md) был первое решение для оценки высокой производительности. Появились в ранних версиях SQL Server 2017 и более поздних версий обновления для SQL Server 2016, оценки в реальном времени зависит от библиотек CLR, которые стоят R и Python, обработку функций, контролируемых корпорацией Майкрософт, в RevoScaleR, MicrosoftML (R), revoscalepy, а microsoftml (Python). Библиотеки CLR вызываются с помощью **sp_rxPredict** хранимой процедуры приводит к возникновению ошибки оценок из любого типа поддерживаемых модели без вызова среды выполнения R или Python.

[**Собственная Оценка** ](../sql-native-scoring.md) — это компонент SQL Server 2017, реализован как собственной библиотеки C++, но только для моделей RevoScaleR и revoscalepy. Самый быстрый и более безопасный подход, но поддерживает меньший набор функций, относительно других методологий.

## <a name="choose-a-scoring-method"></a>Выбор метода количественной оценки

Требования к платформе часто определяют, какие оценки методологии для использования.

| Версия продукта и платформы | Метод |
|------------------------------|-------------|
| SQL Server 2017 на Windows, SQL Server 2017 Linux и база данных Azure SQL | **Собственная Оценка** с ПРОГНОЗИРОВАНИЯ T-SQL |
| SQL Server 2017 (только Windows), SQL Server 2016 R Services с пакетом обновления 1 или выше | **Оценки в реальном времени** с пакетом обновления\_rxPredict хранимой процедуры |

Мы рекомендуем собственной оценки с помощью функции PREDICT. С помощью sp\_rxPredict необходимо включить интеграцию SQLCLR. Рассмотрите влияние на безопасность, прежде чем включать этот параметр.

## <a name="serialization-and-storage"></a>Сериализация и хранение

Чтобы использовать модель с любой из быстрой параметры оценки, сохраните модель с помощью специальных сериализованный формат, который был оптимизирован для размера и оценку эффективности.

+ Вызовите [rxSerializeModel](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxserializemodel) записываемый поддерживаемые модели для **необработанные** формат.
+ Вызовите [rxUnserializeModel](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxserializemodel)"для воссоздания модели для использования в другой код R, или для просмотра модели.

**С помощью SQL**

Из кода SQL, вы можете обучить модель с помощью [sp_execute_external_script](https://docs.microsoft.com//sql/relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql)и непосредственно вставлять обученных моделей в таблицу, в столбец типа **varbinary(max)**. Простой пример, см. в разделе [создания preditive модели в R](../tutorials/rtsql-create-a-predictive-model-r.md)

**С помощью языка R**

Из кода R, вызвать [rxWriteObject](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxwriteobject) функции из пакета RevoScaleR для записи модели непосредственно к базе данных. **RxWriteObject()** функции извлечения объектов R из источника данных ODBC, например SQL Server, или записи объектов в SQL Server. API моделируется простого хранилища значений ключей.
  
Если вы используете эту функцию, убедитесь, что для сериализации модели с помощью [rxSerializeModel](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxserializemodel) первого. Затем задайте *сериализации* аргумента в **rxWriteObject** значение FALSE, чтобы избежать повторения шага сериализации.

Сериализация модели в двоичный формат полезно, но не требуются при анализе прогнозы с помощью R и Python среды выполнения в структуре расширяемости. Можно сохранить модель в формате необработанных байтов в файл и затем считываются из файла в SQL Server. Этот параметр может быть полезен, если выполняется перемещение или копирование моделей между средами.

## <a name="scoring-in-related-products"></a>Оценки в связанные продукты

Если вы используете [изолированный сервер](r-server-standalone.md) или [Microsoft Machine Learning Server](https://docs.microsoft.com/machine-learning-server/what-is-machine-learning-server), у вас есть другие варианты, помимо хранимые процедуры и функции T-SQL для быстрого создания прогнозов. Изолированный сервер и сервер машинного обучения поддерживают понятие *веб-службы* для развертывания кода. Можно объединить R или Python предварительно обученной модели веб-службы, вызываемых во время выполнения для оценки новых входных данных. Дополнительные сведения см. в следующих статьях:

+ [Что такое веб-служб в Machine Learning Server](https://docs.microsoft.com/machine-learning-server/operationalize/concept-what-are-web-services)
+ [Что такое ввода в эксплуатацию](https://docs.microsoft.com/machine-learning-server/operationalize/concept-operationalize-deploy-consume)
+ [Развертывание модели Python в качестве веб-службы azureml модели management-sdk](https://docs.microsoft.com/machine-learning-server/operationalize/python/quickstart-deploy-python-web-service)
+ [Публикация в блоке кода R или модель в режиме реального времени в виде новой веб-службы](https://docs.microsoft.com/machine-learning-server/r-reference/mrsdeploy/publishservice)
+ [пакет mrsdeploy для R](https://docs.microsoft.com/machine-learning-server/r-reference/mrsdeploy/mrsdeploy-package)


## <a name="see-also"></a>См. также

+ [rxSerializeModel](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxserializemodel)  
+ [rxRealTimeScoring](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxrealtimescoring)
+ [SP rxPredict](https://docs.microsoft.com/sql/relational-databases/system-stored-procedures/sp-rxpredict-transact-sql)
+ [ПРОГНОЗИРОВАНИЕ T-SQL](https://docs.microsoft.com/sql/t-sql/queries/predict-transact-sql)