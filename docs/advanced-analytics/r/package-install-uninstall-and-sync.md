---
title: Синхронизация пакетов R из файловой системы - службы машинного обучения SQL Server
description: Обновление библиотеки R на SQL Server с более поздними версиями, файловой системе.
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 5b7141e1fe6256c7a7e21056d82f2d8fc4ad4faf
ms.sourcegitcommit: 85bfaa5bac737253a6740f1f402be87788d691ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/15/2018
ms.locfileid: "53431821"
---
# <a name="r-package-synchronization-for-sql-server"></a>Синхронизация пакетов R для SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

Версия RevoScaleR, входящий в состав SQL Server 2017 включает возможность синхронизировать коллекции пакетов R в файловой системе экземпляра и базы данных использования пакетов.

Этот компонент был предоставлен для упрощения резервного копирования коллекции пакет R, связанные с базами данных SQL Server. Используя эту возможность, администратор сможет восстановить не только базы данных, но все пакеты R, которые были использованы по обработке и анализу данных, работе с базой данных.

В этой статье описывается функция синхронизации пакета, а также способы использования [rxSyncPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsyncpackages) функцию для выполнения следующих задач:

+ Синхронизировать список пакетов для всей базы данных SQL Server

+ Синхронизация пакетов, используемых отдельным пользователем или группой пользователей

+ Если пользователь переходит на другой выпуск SQL Server, можно выполнить резервное копирование рабочей базы данных пользователя и восстановить его на новый сервер, и пакеты, для пользователя будут установлены в файловую систему на новом сервере, требуемые для R.

Например можно использовать синхронизацию пакета в следующих сценариях:

+ Администратор базы данных на новый компьютер восстановит экземпляр SQL Server и запрашивает у пользователей, чтобы подключиться от своих клиентов R и выполнить разрешение `rxSyncPackages` для обновления и восстановить свои пакеты.

+ Вы думаете, что пакет R в файловой системе поврежден, чтобы запустить `rxSyncPackages` на SQL Server.

## <a name="requirements"></a>Требования

Перед использованием пакета синхронизации, необходимо иметь соответствующую версию Microsoft R или сервер машинного обучения. Эта функция предоставляется в Microsoft R версия 9.1.0 или более поздней версии. 

Необходимо также включить [функцию управления пакетами](r-package-how-to-enable-or-disable.md) на сервере.

### <a name="determine-whether-your-server-supports-package-management"></a>Определить, поддерживает ли ваш сервер управления пакетами

Эта функция доступна в SQL Server 2017 CTP-версии 2 или более поздней версии.

Можно добавить эту функцию на экземпляре SQL Server 2016 путем обновления экземпляр, чтобы использовать последнюю версию Microsoft R. Дополнительные сведения см. в разделе [использования SqlBindR.exe для обновления SQL Server R Services](use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

### <a name="enable-the-package-management-feature"></a>Включить функцию управления пакетами

Для использования пакета синхронизации требуется включенное новые функции управления пакетами в экземпляре SQL Server, а также на отдельных баз данных. Дополнительные сведения см. в разделе [включить или отключить управление пакетами для SQL Server](r-package-how-to-enable-or-disable.md).

1. Администратор сервера включает эту функцию для экземпляра SQL Server.
2. Для каждой базы данных администратор предоставляет отдельным пользователям возможность установить или совместно использовать пакеты R, с помощью ролей базы данных.

Если это сделано, можно использовать функции RevoScaleR, такие как [rxInstallPackages](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxinstallpackages) для установки пакетов в базу данных.  Сведения о пользователях и пакеты, которые они могут использовать хранится в экземпляре SQL Server. 

Каждый раз при добавлении нового пакета с помощью функции управления пакетами, обе записи в SQL Server и в файловой системе обновляются. Эти сведения можно использовать для восстановления сведения о пакете для всей базы данных.

### <a name="permissions"></a>Разрешения

+ Тот, кто выполняет функцию синхронизации пакет должен быть участника на экземпляр SQL Server и базы данных, в котором хранятся пакеты безопасности.

+ Вызывающий эту функцию участник должен быть членом одной из этих ролей пакета управления: **rpkgs-shared** или **rpkgs-private**.

+ Для синхронизации пакеты, которые помечены как **общего**, человека, выполняющего функции необходимо быть членом **rpkgs-shared** роли и пакеты, которые перемещаются должны были установлены для общих ресурсов Библиотека области.

+ Синхронизация пакетов, которые помечены как **частных**, либо владелец пакета или администратор должен запустить функцию, и пакеты должно быть закрытым.

+ Чтобы синхронизировать пакеты, от имени других пользователей, владелец должен bhe членом **db_owner** роли базы данных.

## <a name="how-package-synchronization-works"></a>Как работает синхронизация пакета

Чтобы использовать синхронизацию пакета, вызовите [rxSyncPackages](https://docs.microsoft.com/r-server/r-reference/revoscaler/rxsyncpackages), который является новой функцией в [RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler). 

Для каждого вызова `rxSyncPackages`, необходимо указать экземпляр SQL Server и базы данных. Затем либо список пакетов для синхронизации, либо указать область пакета.

1. Создание контекста вычислений SQL Server с помощью `RxInSqlServer` функции. Если вы не укажете контекст вычисления, используется текущий контекст вычислений.

2. Укажите имя базы данных в экземпляре в указанном контексте вычислений. Пакеты, синхронизируются на базу данных.

3. Укажите требуемые пакеты для синхронизации с помощью аргумента области.

    Если вы используете **частного** области, только пакеты, принадлежащие указанному владельцу, синхронизируются. Если указать **общего** синхронизируются области, все открытые пакеты в базе данных. 
    
    При запуске функции без указания **частного** или **общего** область, синхронизируются все пакеты.

4. При успешном выполнении команды в базу данных, с указанной области и владельцем добавляются существующие пакеты в файловой системе.

    Если файловая система повреждена, пакеты восстанавливаются на основе списка, обслуживаемым в базе данных.

    Если компонент пакета управления не доступен в целевой базе данных, возникает ошибка: «Функция управления пакетами отключены на сервере SQL Server или версия устарела»

### <a name="example-1-synchronize-all-package-by-database"></a>Пример 1. Синхронизировать все пакет в базе данных

Этот пример возвращает все новые пакеты из локальной файловой системы и устанавливает пакеты в базе данных [TestDB]. Так как владелец не является специфичным, этот список включает все пакеты, установленные для частных и общих областей.

```R
connectionString <- "Driver=SQL Server;Server=myServer;Database=TestDB;Trusted_Connection=True;"
computeContext <- RxInSqlServer(connectionString = connectionString )
rxSyncPackages(computeContext=computeContext, verbose=TRUE)
```

### <a name="example-2-restrict-synchronized-packages-by-scope"></a>Пример 2. Ограничить синхронизированных пакетов по области

Следующие примеры синхронизировать только пакеты в заданной области.

```R
#Shared scope
rxSyncPackages(computeContext=computeContext, scope="shared", verbose=TRUE)

#Private scope
rxSyncPackages(computeContext=computeContext, scope="private", verbose=TRUE)
```

### <a name="example-3-restrict-synchronized-packages-by-owner"></a>Пример 3. Ограничить синхронизированных пакетов по владельцу

Ниже приведен пример, как синхронизировать только пакеты, которые были установлены для конкретного пользователя. В этом примере пользователь идентифицируется по имени входа SQL, *user1*.

```R
rxSyncPackages(computeContext=computeContext, scope="private", owner = "user1", verbose=TRUE))
```

## <a name="related-resources"></a>Связанные ресурсы

[Управление пакетами R для SQL Server](install-additional-r-packages-on-sql-server.md)
