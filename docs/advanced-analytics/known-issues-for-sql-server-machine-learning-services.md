---
title: Известные проблемы для языка R и интеграция Python — службы машинного обучения SQL Server
ms.prod: sql
ms.technology: machine-learning
ms.date: 12/13/2018
ms.topic: conceptual
author: HeidiSteen
ms.author: heidist
manager: cgronlun
ms.openlocfilehash: 6dc02c56bda3cdf904e0c53115d4fbbfcfafe9fc
ms.sourcegitcommit: ee76332b6119ef89549ee9d641d002b9cabf20d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2018
ms.locfileid: "53645533"
---
# <a name="known-issues-in-machine-learning-services"></a>Известные проблемы в службах машинного обучения
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

В этой статье описаны известные проблемы и ограничения при использовании компонентов машинного обучения, которые предоставляются в виде параметра в [SQL Server 2016 R Services](install/sql-r-services-windows-install.md) и [SQL Server 2017 службы машинного обучения с помощью R и Python](install/sql-machine-learning-services-windows-install.md).

## <a name="setup-and-configuration-issues"></a>Проблемы установки и настройки

Описание процессов и часто задаваемые вопросы, связанные с начальной установки и настройки, см. в разделе [вопросы и ответы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md). Он содержит сведения об обновлениях, side-by-side установки и установки новых компонентов R или Python.

### <a name="1-inconsistent-results-in-mkl-computations-due-to-missing-environment-variable"></a>1. Несогласованные результаты в вычислениях MKL из-за отсутствия переменной среды

**Применимо к:** R_SERVER двоичные файлы, 9.0, 9.1, 9.2 или 9.3.

R_SERVER использует Intel Math Kernel Library (MKL). Для вычислений, касающихся MKL несогласованные результаты может произойти, если в системе отсутствует переменной среды. 

Задайте переменную среды `'MKL_CBWR'=AUTO` для обеспечения условного числовой повторяемости R_SERVER. Дополнительные сведения см. в разделе [введение для условного числовой повторяемость (CNR)](https://software.intel.com/articles/introduction-to-the-conditional-numerical-reproducibility-cnr).

**Обходное решение**

1. На панели управления выберите **система и безопасность** > **системы** > **Дополнительные параметры системы**  >   **Переменные среды**.

2. Создайте новую переменную пользователем или системой. 

  + Задайте имя переменной «MKL_CBWR».
  + Значение «переменных» значение «AUTO».

3. Перезапустите R_SERVER. На сервере SQL Server можно перезапустить службу панели запуска SQL Server.

> [!NOTE]
> Если вы используете предварительную версию SQL Server 2019 в Linux, изменить или создать *.bash_profile* в домашнем каталоге пользователя, добавив строку `export MKL_CBWR="AUTO"`. Выполните этот файл, введя `source .bash_profile` в командной строке bash. Перезапустите R_SERVER, введя `Sys.getenv()` в командной строке R.

### <a name="2-r-script-runtime-error-sql-server-2017-cu5-cu7-regression"></a>2. Ошибка выполнения скрипта R (SQL Server 2017 CU5 CU7 Регрессия)

Для SQL Server 2017 в накопительный пакет обновления 5 по 7, выполняется Регрессия в **rlauncher.config** файла, где путь к файлу временный каталог содержит пробел. Эта Регрессия будет устранена в CU8.

Эта ошибка, доступные для просмотра во время запуска скрипта R содержит следующие сообщения:

> *Не удается связаться со средой выполнения для скрипта «R». Проверьте требования среды выполнения «R».*
>
> Сообщения STDERR из внешнего скрипта: 
>
> *Неустранимая ошибка: не удается создать «R_TempDir»*

**Обходное решение**

Примените CU8, когда она станет доступной. Кроме того, можно повторно создать **rlauncher.config** , выполнив **registerrext** с удаления или установить на командную строку с повышенными правами. 

```cmd
<SQLInstancePath>\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRExt.exe /uninstall /sqlbinnpath:<SQLInstanceBinnPath> /userpoolsize:0 /instance:<SQLInstanceName>

<SQLInstancePath>\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRExt.exe /install /sqlbinnpath:<SQLInstanceBinnPath> /userpoolsize:0 /instance:<SQLInstanceName>
```

В следующем примере показано команды с экземпляром по умолчанию «MSSQL14. MSSQLSERVER» установлен в «C:\Program Files\Microsoft SQL Server\":

```cmd
"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRext.exe" /uninstall /sqlbinnpath:"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn" /userpoolsize:0 /instance:MSSQLSERVER

"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\R_SERVICES\library\RevoScaleR\rxLibs\x64\RegisterRext.exe" /install /sqlbinnpath:"C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\Binn" /userpoolsize:0 /instance:MSSQLSERVER
```

### <a name="3-unable-to-install-sql-server-machine-learning-features-on-a-domain-controller"></a>3. Не удалось установить функции машинного обучения SQL Server на контроллере домена

При попытке установить SQL Server 2016 R Services или службы машинного обучения SQL Server 2017 на контроллере домена, программа установки завершается сбоем с этих ошибок:

> *Произошла ошибка во время установки компонента*
> 
> *Не удается найти группу с удостоверением*
> 
> *Код ошибки компонента: 0x80131509*

Сбой происходит, так как на контроллере домена службе не удается создать 20 локальные учетные записи, необходимые для выполнения машинного обучения. В общем случае не рекомендуется устанавливать SQL Server на контроллере домена. Дополнительные сведения см. в разделе [поддержки бюллетень 2032911](https://support.microsoft.com/help/2032911/you-may-encounter-problems-when-installing-sql-server-on-a-domain-cont).

### <a name="4-install-the-latest-service-release-to-ensure-compatibility-with-microsoft-r-client"></a>4. Установка последней версии службы для обеспечения совместимости с Microsoft R Client

Если вы установите последнюю версию Microsoft R Client и использовать его для выполнения R в SQL Server в удаленном контексте вычислений, может возникнуть ошибка следующего вида:

> *Вы используете версию 9.x.x клиента Microsoft R на компьютере, которая несовместима с Microsoft R Server версии 8.x.x. Скачайте и установите совместимую версию*.

SQL Server 2016 требует, что библиотеки R на стороне клиента точно соответствовать библиотеки R на сервере. Ограничение было позже, чем R Server 9.0.1 снято для выпусков. Тем не менее если эта ошибка возникает, проверьте версию библиотеки R, клиент и сервер используют и при необходимости обновите клиент в соответствии с версией сервера.

Версия R, которая устанавливается со службами R SQL Server обновляется каждый раз, когда установлен выпуск обновления SQL Server. Чтобы обеспечить наличие самых актуальных версий компонентов R, не забудьте установить все пакеты обновления.

Для обеспечения совместимости с клиентом Microsoft R 9.0.0 установить обновления, описанные в этом [статье службы поддержки](https://support.microsoft.com/kb/3210262).

Чтобы избежать проблем с пакетами R, можно также обновить версию библиотек R, установленных на сервере, изменив соглашении обслуживания, чтобы использовать политику поддержки современного жизненного цикла, как описано в разделе [разделу](#bkmk_sqlbindr). После этого, версия R, который устанавливается вместе с SQL Server обновляется по тому же расписанию, используемый для обновлений machine Learning Server (прежнее название — Microsoft R Server).

**Применимо к:** SQL Server 2016 R Services, с помощью R Server используется версия 9.0.0 или более ранней версии

### <a name="5-r-components-missing-from-cu3-setup"></a>5. Отсутствуют в программе установки CU3 компоненты R

Не использовать файлы установки R, которые должны быть включены в SQL Server были подготовлены ограниченное число виртуальных машин Azure. Проблема относится к виртуальным машинам, подготовленные в период с 2018-01-05 по 2018-01-23. Эта проблема также может повлиять на локальные установки, если вы применили обновление накопительным пакетом обновления 3 для SQL Server 2017 в период от 2018-01-05 2018-01-23.

Предоставлен выпуск обновления, включающий в себя правильную версию R установочные файлы.

+ [Накопительный пакет обновления 3 для SQL Server 2017 KB4052987](https://www.microsoft.com/download/details.aspx?id=56128).

Для установки компонентов и восстановления SQL Server 2017 CU3, необходимо удалить накопительным пакетом обновления 3, а затем повторно установить обновленную версию:

1. Загрузите обновленный файл установки CU3, включающий установщики R.
2. Удалите CU3. В панели управления найдите **удалить обновление**, а затем выберите «Исправление 3015 для SQL Server 2017 (KB4052987) (64-разрядная версия)». Выполните шаги для удаления.
3. Переустановите обновления CU3, дважды щелкнув обновление для только что загруженный KB4052987: `SQLServer2017-KB4052987-x64.exe`. Следуйте инструкциям по установке.

### <a name="6-unable-to-install-python-components-in-offline-installations-of-sql-server-2017-ctp-20-or-later"></a>6. Не удалось установить компоненты Python в автономной установке SQL Server 2017 CTP 2.0 или более поздней версии

При установке предварительной версии SQL Server 2017 на компьютере без доступа к Интернету, программа установки может завершиться ошибкой для отображения страницы, которые запрашиваются расположение загруженного компонентов Python. В таком случае можно установить компонент служб машинного обучения, но не компоненты Python.

Эта проблема исправлена в окончательной версии. Кроме того это ограничение не применяется для компонентов R.

**Применимо к:** SQL Server 2017 с помощью Python

### <a name="bkmk_sqlbindr"></a> Предупреждение о несовместимости версии при подключении к более старой версии SQL Server R Services, из клиента с помощью [!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)]

При выполнении кода R в контексте вычислений SQL Server 2016, может появиться следующая ошибка:

> *На компьютере используется версия 9.0.0 клиента Microsoft R, которая несовместима с Microsoft R Server версии 8.0.3. Скачайте и установите совместимую версию*.

Это сообщение отображается в том случае, если выполняется любое из следующих двух инструкций,

+ Вы установили R Server (изолированную версию) на клиентском компьютере с помощью мастера установки [!INCLUDE[ssSQLv14_md](../includes/sssqlv14-md.md)].
+ Вы установили Microsoft R Server с помощью [разделения установщика Windows](https://docs.microsoft.com/machine-learning-server/install/r-server-install-windows).

Чтобы убедиться, что сервер и клиент используют ту же версию, может потребоваться использовать _привязки_, поддерживаемых для Microsoft R Server 9.0 и более поздние версии, обновление компонентов R в экземплярах SQL Server 2016. Чтобы определить, если обновление поддерживается для вашей версии службы R, см. в разделе [обновления экземпляра служб R с помощью SqlBindR.exe](r/use-sqlbindr-exe-to-upgrade-an-instance-of-sql-server.md).

**Применимо к:** SQL Server 2016 R Services, с помощью R Server используется версия 9.0.0 или более ранней версии

### <a name="7-setup-for-sql-server-2016-service-releases-might-fail-to-install-newer-versions-of-r-components"></a>7. При установке выпусков служб SQL Server 2016 могут не установиться более новые версии компонентов R.

При установке накопительного пакета обновления или установки пакета обновления для SQL Server 2016 на компьютере, который не подключен к Интернету, мастер установки может не отобразить запрос, позволяющий обновить компоненты R с помощью скачанных файлов CAB. Эта ошибка обычно происходит при нескольких компонентов были установлены вместе с ядром СУБД.

Обойти это ограничение, можно установить выпуск служб с помощью командной строки и указав `MRCACHEDIRECTORY` аргумент, как показано в следующем примере, который устанавливает CU1 обновления:

`C:\<path to installation media>\SQLServer2016-KB3164674-x64.exe /Action=Patch /IACCEPTROPENLICENSETERMS /MRCACHEDIRECTORY=<path to CU1 CAB files>`

Чтобы получить последнюю установщиков, см. в разделе [Установка компонентов машинного обучения без доступа к Интернету](install/sql-ml-component-install-without-internet-access.md).

**Применимо к:** SQL Server 2016 R Services, с помощью R Server используется версия 9.0.0 или более ранней версии

### <a name="8-launchpad-services-fails-to-start-if-the-version-is-different-from-the-r-version"></a>8. Службы панели запуска не запускаются, если версия отличается от версии R

При установке служб R SQL Server отдельно от ядра СУБД, и имеют разные версии сборки, может появиться следующая ошибка в журнале системных событий:

> *Служба панели запуска SQL Server не удалось запуститься из-за следующей ошибки: Служба не ответила на запрос запуска или управления за отведенное время.*

Например Эта ошибка может возникать, если установить ядро базы данных с помощью версии, применить исправление, чтобы обновления ядра СУБД и добавьте компонент служб r., с помощью версии.

Чтобы избежать этой проблемы, используйте это служебная программа, например диспетчер файлов для сравнения версий Launchpad.exe с версией двоичных файлов SQL, например sqldk.dll. Все компоненты должны иметь тот же номер версии. Если вы обновляете один компонент, обязательно примените это же обновление ко всем остальным установленным компонентам.

Поиск панели запуска в `Binn` папку для экземпляра. Например, при установке по умолчанию SQL Server 2016, путь может выглядеть `C:\Program Files\Microsoft SQL Server\MSSQL.13.InstanceNameMSSQL\Binn`. 

### <a name="9-remote-compute-contexts-are-blocked-by-a-firewall-in-sql-server-instances-that-are-running-on-azure-virtual-machines"></a>9. Контексты удаленных вычислений блокируются брандмауэром в экземплярах SQL Server, работающие на виртуальных машинах Azure

Если вы установили [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] на виртуальной машине Windows Azure, вы может не сможете использовать контексты вычислений, для которых требуется рабочее пространство виртуальной машины. Объясняется это тем, что по умолчанию брандмауэр на виртуальных машинах Azure использует правило, которое блокирует сетевой доступ для локальных учетных записей пользователя r.

Чтобы избежать этого, на виртуальной Машине Azure, откройте **брандмауэр Windows в режиме повышенной безопасности**выберите **правила для исходящих подключений**и отключите следующее правило: **Блокировать сетевой доступ для локальных учетных записей R в экземпляре SQL Server MSSQLSERVER**. Вы можете также оставляет правило включено, но измените значение свойства безопасности на **Разрешить безопасное подключение**.

### <a name="10-implied-authentication-in-sqlexpress"></a>10. Неявная проверка подлинности в SQLEXPRESS

При выполнении заданий R на рабочей станции удаленного-обработки и анализа данных с использованием проверки подлинности Windows для интеграции SQL Server использует *неявной проверки подлинности* для создания локальных вызовов ODBC, которые могут потребоваться с помощью скрипта. Но эта функция не работала в сборке RTM экспресс-выпуска SQL Server.

Чтобы устранить эту проблему, рекомендуем произвести обновление до более позднего выпуска службы.

Если обновление не представляется возможным, обойти это ограничение, используйте имя входа SQL для выполнения удаленных заданий R, которые могут потребоваться внедренные вызовы ODBC.

**Применимо к:** Экспресс-выпуск SQL Server 2016 R Services

### <a name="11-performance-limits-when-libraries-used-by-sql-server-are-called-from-other-tools"></a>11. Ограничение производительности при вызове библиотек, используемый сервером SQL Server из других инструментов

Существует возможность вызова машинного обучения библиотек, которые устанавливаются для SQL Server из внешнего приложения, например RGui. Это может быть наиболее удобным способом для выполнения определенных задач, таких как установка новых пакетов, или выполнение нерегламентированных тестов на очень короткие примеры кода. Тем не менее за пределами SQL Server, производительность может быть ограничена. 

Например даже если вы используете Enterprise Edition SQL Server, R выполняется в однопотоковом режиме при выполнении кода R с помощью внешних средств. Чтобы получить преимущества производительности в SQL Server, инициировать подключение к SQL Server и использовать [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md) для вызова среды выполнения внешнего скрипта.

Как правило Избегайте вызова библиотеки машинного обучения, которые используются SQL Server из внешних средств. Если требуется отладка R или Python кода, обычно проще сделать это за пределами SQL Server. Чтобы получить те же библиотеки, которые находятся в SQL Server, можно установить Microsoft R Client [сервера SQL Server 2017 машинного обучения (изолированного)](install/sql-machine-learning-standalone-windows-install.md), или [SQL Server 2016 R Server (изолированный)](install/sql-r-standalone-windows-install.md).

### <a name="12-sql-server-data-tools-does-not-support-permissions-required-by-external-scripts"></a>12. SQL Server Data Tools не поддерживает разрешения, необходимые для выполнения внешних скриптов

При использовании Visual Studio или SQL Server Data Tools для публикации проекта базы данных, если любому участнику имеет разрешения, определенные для выполнения внешнего скрипта, может появиться ошибка следующего вида:

> *Модель TSQL: Ошибка при обратного проектирования базы данных. Разрешение не распознан и не был импортирован.*

В данный момент модель DACPAC не поддерживает разрешения, используемые службами R или служб машинного обучения, таких как предоставление ANY EXTERNAL SCRIPT или EXECUTE ANY EXTERNAL SCRIPT. Эта проблема будет исправлена в будущем выпуске.

Чтобы избежать этого выполнение предоставление дополнительной инструкций в скрипте после развертывания.

### <a name="13-external-script-execution-is-throttled-due-to-resource-governance-default-values"></a>13. Выполнение внешнего скрипта регулируется из-за значения по умолчанию для ресурсов управления

В выпуске Enterprise Edition можно использовать пулы ресурсов для управления внешними процессами скриптов. В некоторых ранних сборках выпуска максимальный объем памяти, который можно было выделять процессам R было на 20 процентов. Таким образом Если сервер имел 32 ГБ ОЗУ, исполняемые файлы R (RTerm.exe и BxlServer.exe) может использовать не более 6,4 ГБ в одном запросе.

Если вы сталкиваетесь с ограничениями ресурсов, проверьте текущее значение по умолчанию. Если 20% недостаточно, см. в документации [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] о том, как изменить это значение.

**Применимо к:** Службы R SQL Server 2016, Enterprise Edition

## <a name="r-script-execution-issues"></a>Проблемы выполнение скрипта R

Этот раздел содержит известные проблемы, характерные для R запускаются на SQL Server, а также некоторые проблемы, связанные с библиотеки R и инструменты, опубликованные корпорацией Майкрософт, включая RevoScaleR.

Другие известные проблемы, которые могут повлиять на решения R, см. в разделе [Machine Learning Server](https://docs.microsoft.com/machine-learning-server/resources-known-issues) сайта.

### <a name="1-access-denied-warning-when-executing-r-scripts-on-sql-server-in-a-non-default-location"></a>1. Отказано в доступе предупреждение при выполнении скриптов R на SQL Server в расположении по умолчанию не

Если экземпляр SQL Server был установлен в расположении по умолчанию, такие как за пределами `Program Files` папку, предупреждение, ACCESS_DENIED возникает при попытке запуска скриптов, которые устанавливают пакет. Пример:

> *В `normalizePath(path.expand(path), winslash, mustWork)` : путь [2] = «~ExternalLibraries/R/8/1»: Отказано в доступе*

Причина заключается в функцию R пытается считать путь что не выполняется, если встроенной группе пользователей **SQLRUserGroup**, не имеет доступа на чтение. Предупреждение, которое вызывается не блокирует выполнение текущего скрипта R, но предупреждение может многократно повторять каждый раз, когда пользователь запускает R script.

После установки SQL Server по умолчанию, эта ошибка возникает, так как все пользователи Windows разрешения на чтение `Program Files` папки.

Эта проблема ia устранена в будущем выпуске служб. Избежать этого, укажите группу **SQLRUserGroup**, с доступом на чтение для всех родительских папок `ExternalLibraries`.

### <a name="2-serialization-error-between-old-and-new-versions-of-revoscaler"></a>2. Ошибка сериализации между старой и новой версиях RevoScaleR

При передаче модели с помощью сериализованном формате с удаленным экземпляром SQL Server, может возникнуть ошибка: 

> *Ошибка в memDecompress (данных, тип = распаковки) Внутренняя ошибка в memDecompress(2) -3.*

Эта ошибка возникает в том случае, если вы сохранили модели с помощью последней версии функции сериализации, [rxSerializeModel](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxserializemodel), но экземпляр SQL Server, где десериализации модели имеет более старую версию API-интерфейсы RevoScaleR, из SQL Server 2017 накопительным пакетом обновления 2 или более ранней версии.

Чтобы избежать этого можно обновить экземпляр SQL Server 2017, накопительным пакетом обновления 3 или более поздней версии.

Ошибки отображаются не в том случае, если версия API или при перемещении модели, сохраненные с помощью более старой функции сериализации для сервера, который использует более новую версию API сериализации.

Другими словами необходимо используйте ту же версию RevoScaleR для операций сериализации и десериализации.

### <a name="3-real-time-scoring-does-not-correctly-handle-the-learningrate-parameter-in-tree-and-forest-models"></a>3. Оценки в реальном времени неправильно обрабатывает _значение learningRate_ параметр в моделях дерева и леса

При создании модели с помощью дерева принятия решений или метода леса принятия решений и укажите скорость обучения, могут появиться несогласованные результаты при использовании `sp_rxpredict` или SQL `PREDICT` функция, по сравнению с использованием `rxPredict`.

Причиной является ошибкой в API, которое моделирует процессы сериализации и ограничен `learningRate` параметр: например, в [rxBTrees](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxbtrees), или

Эта проблема будет устранена в будущем выпуске служб.

### <a name="4-limitations-on-processor-affinity-for-r-jobs"></a>4. Ограничения на соответствие процессоров для заданий R

В сборки первоначального выпуска SQL Server 2016 можно было задать сходство процессоров только для процессоров в первой k группе. Например если сервер является Двухпроцессорный компьютер с двумя k группами, для процессов R используются только процессоры из первой k группе. Это же ограничение действует при настройке регулирования ресурсов для заданий скриптов r.

Проблема исправлена в SQL Server 2016 с пакетом обновления 1 (SP1). Мы рекомендуем обновить до последней версии службы.

**Применимо к:** Версия SQL Server 2016 R Services RTM

### <a name="5-changes-to-column-types-cannot-be-performed-when-reading-data-in-a-sql-server-compute-context"></a>5. Изменение типов столбцов невозможно при считывании данных в контексте вычисления SQL Server.

Если в качестве контекста вычисления задан экземпляр SQL Server, вы не можете использовать аргумент _colClasses_ (или иные подобные аргументы) для изменения типа данных столбцов в коде R.

Например, следующая инструкция приведет к ошибке, если столбец CRSDepTimeStr уже не является целочисленным:

```R
data <- RxSqlServerData(
  sqlQuery = "SELECT CRSDepTimeStr, ArrDelay  FROM AirlineDemoSmall", 
  connectionString = connectionString, 
  colClasses = c(CRSDepTimeStr = "integer"))
```

В качестве решения можно переписать SQL-запрос, используйте CAST или CONVERT и представления данных в R с помощью правильного типа данных. Как правило производительности лучше при работе с данными с помощью SQL, а не путем преобразования данных в коде R.

**Применимо к:** SQL Server 2016 R Services

### <a name="6-limits-on-size-of-serialized-models"></a>6. Ограничения на размер сериализованного моделей

При сохранении модели в таблицу SQL Server, необходимо сериализовать модель и сохраните его в двоичном формате. Теоретически максимальный размер модели, которые могут быть сохранены с помощью этого метода составляет 2 ГБ, что максимальный размер столбцов varbinary в SQL Server.

Если вам нужно использовать модели большего размера, доступны следующие решения:

+ Выполните действия, чтобы уменьшить размер вашей модели. Некоторые пакеты R с открытым кодом включить немало информации в объект модели, а большая часть этой информации можно удалить для развертывания. 
+ Используйте Выбор компонентов для удаления ненужных столбцов.
+ Если вы используете алгоритм открытым исходным кодом, рассмотрите возможность похожая реализация с помощью соответствующего алгоритма в MicrosoftML или RevoScaleR. Эти пакеты оптимизированы для сценариев развертывания.
+ После того как были процессов оптимизации модели и размер уменьшен с помощью описанные выше шаги, см. в разделе Если [memCompress](https://www.rdocumentation.org/packages/base/versions/3.4.1/topics/memCompress) функции в базовый R можно использовать для уменьшения размера модели перед его передачей в SQL Server. Этот вариант подойдет, если модель находится близко к пределу 2 ГБ.
+ Для больших моделей можно использовать SQL Server [FileTable](../relational-databases/blob/filetables-sql-server.md) компонентов для сохранения моделей, а не с помощью столбцов varbinary.

    Для использования таблиц Filetable, необходимо добавить исключение брандмауэра, так как данные, хранящиеся в таблицах Filetable осуществляется с помощью драйвера файловой системы Filestream в SQL Server, а правила брандмауэра по умолчанию блокируют доступ к файлам по сети. Дополнительные сведения см. в разделе [Включение необходимых компонентов для FileTable](../relational-databases/blob/enable-the-prerequisites-for-filetable.md).

    После включения таблицы FileTable, записываемый в модели, вы получить путь из SQL с помощью API таблицы FileTable и затем записывать модели в нее из кода. При необходимости прочитать модель, можно получить путь из SQL и затем вызов модели, используя путь из скрипта. Дополнительные сведения см. в разделе [доступ к таблицам Filetable с помощью API-интерфейсов файла ввода-вывода](../relational-databases/blob/access-filetables-with-file-input-output-apis.md).

### <a name="7-avoid-clearing-workspaces-when-you-execute-r-code-in-a-includessnoversionincludesssnoversion-mdmd-compute-context"></a>7. Старайтесь не очищать рабочие области, при выполнении кода R в [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] контекста вычислений

Если вы используете команду R для очистки рабочей области объектов при выполнении кода R [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] контекст вычислений, или если Вы очищаете рабочую область как часть сценария R вызывается с помощью [sp_execute_external_script](../relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql.md), может появиться следующая ошибка : *рабочей области объекта revoScriptConnection не найден*

`revoScriptConnection` — это объект в рабочей области R, который содержит информацию о сеансе R, вызываемом из [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Но если код R содержит команду для очистки рабочей области (например, `rm(list=ls()))`), вся информация о сеансе и других объектах в рабочей области R также очищается.

Чтобы избежать этого, не рекомендуется беспорядочное очищать переменные и другие объекты при запуске R [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]. Несмотря на то, что очистка рабочих областей является распространенным, при работе в консоли R, он может иметь непредвиденные последствия.

* Для удаления конкретных переменных используйте R `remove` функция: например, `remove('name1', 'name2', ...)`
* Если нужно удалить несколько переменных, сохраните имена временных переменных в списке и периодически выполняйте сборку мусора.

### <a name="8-restrictions-on-data-that-can-be-provided-as-input-to-an-r-script"></a>8. Ограничения для данных, которые могут быть предоставлены как входные данные в сценарии R

Следующие типы результатов запросов невозможно использовать в сценарии R:

- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на столбцы AlwaysEncrypted;
  
- данные из запроса [!INCLUDE[tsql](../includes/tsql-md.md)] , который ссылается на маскированные столбцы.
  
     Если вам необходимо использовать скрытые данные в сценарии R, при необходимости можно создать копию данных во временной таблице и использовать эти данные.

### <a name="9-use-of-strings-as-factors-can-lead-to-performance-degradation"></a>9. Использование строк как факторов может привести к снижению производительности

Использование типа строковых переменных, как факторы могут значительно увеличить объем памяти, используемый для операций R. Это известная проблема с R в целом, и существует множество статей по этой теме. Например, см. в разделе [факторы не являются привилегированными r, Джон подключения, в R-блоггеры)](https://www.r-bloggers.com/factors-are-not-first-class-citizens-in-r/) или [stringsasfactors значения: Несанкционированный текст биографии, Роджер Peng](https://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography/). 

Несмотря на то, что проблема не относится к SQL Server, он может значительно повлиять на производительность кода R, выполняемый на SQl Server. Строки обычно хранятся в виде varchar или nvarchar и если много уникальных значений столбца строковых данных, процесс внутренне преобразования их в целые числа и обратно в строки с R, даже может привести к ошибкам выделения памяти.

Если не требуется абсолютно строковый тип данных для других операций сопоставления строковых значений в числовой (целое число) тип данных, как этап подготовки данных полезно с точки зрения производительности и масштабируемости.

Описание этой проблемы, а также другие советы, см. в разделе [производительности для служб R - оптимизация данных](r/r-and-data-optimization-r-services.md).

### <a name="10-arguments-varstokeep-and-varstodrop-are-not-supported-for-sql-server-data-sources"></a>10. Аргументы *varsToKeep* и *varsToDrop* не поддерживаются для источников данных SQL Server

При использовании функции rxDataStep для записи результатов в таблицу с помощью *varsToKeep* и *varsToDrop* — это удобный способ указания столбцы для включения или исключения как часть операции. Тем не менее эти аргументы не поддерживаются для источников данных SQL Server.

### <a name="11-limited-support-for-sql-data-types-in-spexecuteexternalscript"></a>11. Ограниченная поддержка для типов данных SQL в пакете обновления\_выполнение\_внешних\_сценария

Не все типы данных, которые поддерживаются в SQL можно использовать в R. В качестве решения можно привести неподдерживаемый тип данных для поддерживаемого типа данных перед их передачей в sp\_выполнение\_внешних\_скрипта.

Дополнительные сведения см. в разделе [R библиотеки и типы данных](r/r-libraries-and-data-types.md).

### <a name="12-possible-string-corruption-using-unicode-strings-in-varchar-columns"></a>12. Возможное повреждение строки с помощью строки Юникода в столбцах varchar

Передача данных в Юникоде в столбцах varchar из [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для R и Python может привести к повреждению строки. Это вызвано кодировку для эти строки в Юникоде [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] параметров сортировки может не соответствовать с кодировка UTF-8 по умолчанию, используемая в R и Python. 

Для отправки данных, отличные от ASCII строку из [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] для R и Python, используйте кодировку UTF-8 (в [!INCLUDE[sql-server-2019](../includes/sssqlv15-md.md)]) или использовать для того же типа nvarchar.

### <a name="13-only-one-value-of-type-raw-can-be-returned-from-spexecuteexternalscript"></a>13. Только одно значение типа `raw` могут быть возвращены из `sp_execute_external_script`

Если двоичный тип данных (R **необработанные** тип данных) возвращается из R, значение должны быть отправлены в блок выходных данных.

С данными типов, отличных от **необработанные**, может возвращать значения параметров, а также результаты хранимой процедуры, добавив ключевое слово OUTPUT. Дополнительные сведения см. в разделе [параметры](https://docs.microsoft.com/sql/relational-databases/stored-procedures/parameters).

Если вы хотите использовать несколько наборов выходных данных, которые включают значения типа **необработанные**, одно возможное решение — сделать несколько вызовов хранимой процедуры или отсылать результирующие наборы обратно [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] с помощью ODBC.

### <a name="14-loss-of-precision"></a>14. Потеря точности

Так как [!INCLUDE[tsql](../includes/tsql-md.md)] и R поддерживают различные типы данных, и числовых типов данных возможна потеря точности во время преобразования.

Дополнительные сведения о преобразовании неявный тип данных, см. в разделе [R библиотеки и типы данных](r/r-libraries-and-data-types.md).

### <a name="15-variable-scoping-error-when-you-use-the-transformfunc-parameter"></a>15. При использовании параметра transformFunc, ошибка области переменной

Чтобы преобразовать данные, при моделировании, можно передать *transformFunc* аргумент в функции, такие как `rxLinmod` или `rxLogit`. Тем не менее вложенные вызовы функций может привести к ошибкам области применения в контексте вычислений SQL Server, даже если вызовы правильно работают в локальном контексте вычисления.

> *Образец набора данных для анализа не содержащее переменных*

Например, предположим, что определены две функции `f` и `g`, в глобальной локальной среде, и `g` вызовы `f`. В распределенных или удаленных вызовах с использованием `g`, вызов `g` может завершиться с этой ошибкой, так как `f` не удается найти, даже если Вы передали `f` и `g` удаленному вызову.

При возникновении этой проблемы можно внедрить определение `f` в ваше определение `g`в любом месте перед тем, где `g` обычно вызывает `f`.

Пример:

```R
f <- function(x) { 2*x * 3 }
g <- function(y) {
              a <- 10 * y
               f(a)
}
```

Чтобы избежать этой ошибки, перепишите определение следующим образом:

```R
g <- function(y){
              f <- function(x) { 2*x +3}
              a <- 10 * y
              f(a)
}
```

### <a name="16-data-import-and-manipulation-using-revoscaler"></a>16. Импорт и обработка данных с помощью RevoScaleR

Когда **varchar** столбцы считываются из базы данных, пробелы отсечены. Чтобы избежать этого, добавьте перед и после строк символы, отличные от пробелов.

Если функции, такие как `rxDataStep` используются для создания таблицы базы данных, которые имеют **varchar** столбцов, ширина столбца вычисляется на основе образца данных. Если ширина может быть различным, может потребоваться дополнить все строки до одинаковой длины.

Использование преобразования для изменения типа данных переменной не поддерживается при повторном вызове `rxImport` или `rxTextToXdf` для импорта и дополнения строк с объединением нескольких входных файлов в один XDF-файл.

### <a name="17-limited-support-for-rxexec"></a>17. Ограниченная поддержка rxExec

В SQL Server 2016 `rxExec` функцию, которая предоставляется с RevoScaleR пакет может использоваться только в однопоточном режиме.

### <a name="18-increase-the-maximum-parameter-size-to-support-rxgetvarinfo"></a>18. Увеличение максимального размера параметра для поддержки rxGetVarInfo

При использовании наборов данных с очень большим количеством переменных (например, более 40 000), задать `max-ppsize` флаг при запуске R для использования функций, таких как `rxGetVarInfo`. Флаг `max-ppsize` указывает максимальный размер стека защиты указателей.

Если вы используете консоль R (например, RGui.exe или RTerm.exe), можно задать значение _max-ppsize_ 500 000, введя:

```R
R --max-ppsize=500000
```

### <a name="19-issues-with-the-rxdtree-function"></a>19. Проблемы с функцией rxDTree

Функция `rxDTree` в настоящее время не поддерживает преобразование в формулах. В частности, использование синтаксиса `F()` для создания факторов в режиме реального времени не поддерживается. Однако числовые данные автоматически сегментироваться.

Упорядоченные факторы обрабатываются так же, как факторы, во всех функциях анализа RevoScaleR, за исключением `rxDTree`.

## <a name="python-script-execution-issues"></a>Проблемы с выполнения скрипта Python

Этот раздел содержит известные проблемы, относящиеся к с Python в SQL Server, а также проблемы, связанные с Python пакеты, опубликованные корпорацией Майкрософт, включая [revoscalepy](https://docs.microsoft.com/r-server/python-reference/revoscalepy/revoscalepy-package) и [microsoftml](https://docs.microsoft.com/r-server/python-reference/microsoftml/microsoftml-package).

### <a name="1-call-to-pretrained-model-fails-if-path-to-model-is-too-long"></a>1. Вызов предварительно обученной модели завершается неудачей, если указан слишком длинный путь к модели

Если вы установили предварительно обученных моделей в более ранний выпуск SQL Server 2017, полный путь к файлу обученной модели может быть слишком длинным для Python для чтения. Это ограничение будет исправлена в более позднего выпуска службы.

Существует несколько возможных путях ее решения. 

+ При установке предварительно обученных моделей, выберите пользовательское расположение.
+ Если это возможно Установка экземпляра SQL Server в разделе пользовательский путь установки с более коротким путем, например C:\SQL\MSSQL14. MSSQLSERVER.
+ Используйте служебную программу Windows [Fsutil](https://technet.microsoft.com/library/cc788097(v=ws.11).aspx) Чтобы создать жесткую связь, файл модели сопоставляется с более коротким путем.
+ Обновление до последней версии службы.

### <a name="2-error-when-saving-serialized-model-to-sql-server"></a>2. Произошла ошибка при сохранении сериализована модель для SQL Server

Если передать модель с удаленным экземпляром SQL Server и повторите двоичная модель с помощью `rx_unserialize` работать в [revoscalepy](https://docs.microsoft.com/machine-learning-server/python-reference/revoscalepy/revoscalepy-package), может возникнуть ошибка: 

> *NameError: имя «rx_unserialize_model» не определен*

Эта ошибка возникает в том случае, если при сохранении модели, используя последнюю версию функция сериализации, но экземпляр SQL Server, где десериализации модели не распознает интерфейс API сериализации.

Чтобы устранить проблему, обновите экземпляр SQL Server 2017 накопительным пакетом обновления 3 или более поздней версии.

### <a name="3-failure-to-initialize-a-varbinary-variable-causes-an-error-in-bxlserver"></a>3. Не удалось инициализировать переменную varbinary приводит к ошибке в BxlServer

При выполнении кода Python в SQL Server с помощью `sp_execute_external_script`и код содержит выходные переменные типа varbinary(max), varchar(max) или схожие типы, переменной, необходимо инициализировать или как часть скрипта. В противном случае компонент данных exchange, BxlServer, вызывает ошибку и прекращает работу.

Это ограничение будет исправлена в будущем выпуске служб. Избежать этого убедитесь, что переменная инициализируется в скрипте Python. Можно использовать любое допустимое значение, как показано в следующих примерах:

```sql
declare @b varbinary(max);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N'b = 0x0'
  , @params = N'@b varbinary(max) OUTPUT'
  , @b = @b OUTPUT;
go
```

```sql
declare @b varchar(30);
exec sp_execute_external_script
  @language = N'Python'
  , @script = N' b = ""  '
  , @params = N'@b varchar(30) OUTPUT'
  , @b = @b OUTPUT;
go
```

### <a name="4-telemetry-warning-on-successful-execution-of-python-code"></a>4. Предупреждение телеметрии при успешном выполнении кода Python

Начиная с накопительным пакетом обновления 2 для SQL Server 2017, даже в случае успешного выполнения кода Python в противном случае может появиться следующее сообщение:

> *Сообщения STDERR из внешнего скрипта:*
>  *~PYTHON_SERVICES\lib\site-packages\revoscalepy\utils\RxTelemetryLogger*
> *SyntaxWarning: telemetry_state — используется до глобального объявления*


Эта проблема будет исправлена в SQL Server 2017 накопительный пакет обновления 3 (CU3). 

## <a name="revolution-r-enterprise-and-microsoft-r-open"></a>Revolution R Enterprise и Microsoft R Open

В этом разделе перечислены проблемы, относящиеся к подключение R, разработки и средства обеспечения производительности, предоставляемых Revolution Analytics. Эти средства предоставлялись в предварительных версиях [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].

Как правило рекомендуется удалить эти предыдущие версии и установите последнюю версию SQL Server или Microsoft R Server.

### <a name="1-revolution-r-enterprise-is-not-supported"></a>1. Revolution R Enterprise не поддерживается.

Установка Revolution R Enterprise рядом с любой версией [!INCLUDE[rsql_productname_md](../includes/rsql-productname-md.md)] не поддерживается.

При наличии существующей лицензии для Revolution R Enterprise, необходимо поместить его на компьютере, отличном от обоих [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] экземпляра и любой рабочей станции, который вы хотите использовать для подключения к [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] экземпляра.

Некоторые предварительные версии [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)] включены среду разработки R для Windows, который был создан с помощью Revolution Analytics. Это средство больше не предоставляются и не поддерживается.

Для обеспечения совместимости с [!INCLUDE[rsql_productname](../includes/rsql-productname-md.md)], рекомендуется вместо этого установите Microsoft R Client. [Инструменты R для Visual Studio](https://www.visualstudio.com/vs/rtvs/) и [Visual Studio Code](https://code.visualstudio.com/) также поддерживает Microsoft R solutions.

### <a name="2-compatibility-issues-with-sqlite-odbc-driver-and-revoscaler"></a>2. Проблемы совместимости с драйвером SQLite ODBC и RevoScaleR

Версия 0.92 драйвера SQLite ODBC не совместима с RevoScaleR. Версии 0.88 – 0.91 и 0.93 и более поздние совместимы.

## <a name="see-also"></a>См. также

[Что нового в SQL Server 2016](../sql-server/what-s-new-in-sql-server-2016.md)

[Устранение неполадок машинного обучения в SQL Server](machine-learning-troubleshooting-faq.md)
