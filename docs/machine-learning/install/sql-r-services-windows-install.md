---
title: Установка SQL Server 2016 R Services
titleSuffix: ''
description: Сведения о том, как установить службы SQL Server 2016 R Services в Windows. Службы R Services можно использовать для выполнения скриптов R в базе данных.
ms.prod: sql
ms.technology: machine-learning-services
ms.date: 06/03/2020
ms.topic: how-to
author: dphansen
ms.author: davidph
ms.custom: contperfq4
monikerRange: =sql-server-2016||=sqlallproducts-allversions
ms.openlocfilehash: af1d1c36971e3c6e47a97874bca26d55694d4491
ms.sourcegitcommit: 216f377451e53874718ae1645a2611cdb198808a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87246423"
---
# <a name="install-sql-server-2016-r-services"></a>Установка SQL Server 2016 R Services
[!INCLUDE [SQL Server Windows Only - ASDBMI ](../../includes/applies-to-version/sql-windows-only-asdbmi.md)]

Сведения о том, как установить службы SQL Server 2016 R Services в Windows. Службы R Services можно использовать для выполнения скриптов R в базе данных.

> [!NOTE]
> В SQL Server 2017 и более поздних версий R включается в [Службы машинного обучения](../sql-server-machine-learning-services.md) вместе с Python. Если вам требуется R и у вас есть SQL Server 2017 или более поздней версии, см. раздел [Установка Служб машинного обучения SQL Server](sql-machine-learning-services-windows-install.md), чтобы добавить эту функцию.

<a name="bkmk_prereqs"> </a> 

## <a name="pre-install-checklist"></a>Контрольный список перед установкой

+ Необходим экземпляр ядра СУБД. Вы не можете установить только R, хотя его можно добавить в существующий экземпляр добавочным образом.

+ Для обеспечения непрерывности бизнес-процессов [группы доступности Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) поддерживаются для служб R Services. Необходимо установить службы R Services и настроить пакеты на каждом узле.

+ Не устанавливайте службы R Services на экземпляр отказоустойчивого кластера (FCI) SQL Server Always On. Механизм безопасности, используемый для изолирования процессов R, несовместим со средой с экземпляром отказоустойчивого кластера (FCI) SQL Server Always On.

+ Не устанавливайте R Services на контроллер домена. Этап установки служб R Services завершится с ошибкой.

+ Не устанавливайте **Общие компоненты** > **R Server (изолированный)** на том же компьютере, где работает экземпляр для выполнения в базе данных.

+ Параллельная установка с другими версиями R поддерживается, но не рекомендуется. Она поддерживается, так как экземпляр SQL Server использует собственные копии дистрибутива R с открытым кодом. Однако выполнение кода, использующего R, на компьютере SQL Server за пределами SQL Server может привести к различным проблемам:

  + Вы используете другую библиотеку и другой исполняемый файл и получаете результаты, отличающиеся от результатов при работе в SQL Server.
  + Скриптами R, выполняемыми во внешних библиотеках, невозможно управлять с помощью SQL Server, так как это приведет к состязанию за ресурсы.
  
> [!IMPORTANT]
> После установки обязательно выполните действия после конфигурации, описанные в этой статье. В их число входят включение SQL Server для использования внешних скриптов и добавление учетных записей, необходимых для того, чтобы SQL Server выполнял задания R от вашего имени. Изменения в конфигурации обычно требуют перезапуска экземпляра или службы панели элементов.

## <a name="get-the-installation-media"></a>Получение установочного носителя

[!INCLUDE[GetInstallationMedia](../../includes/getssmedia.md)]

<a name="bkmk_ga_instalpatch"></a>

### <a name="install-patch-requirement"></a>Требование для установки исправления

Корпорация Майкрософт выявила проблему с определенной версией двоичных файлов среды выполнения Microsoft VC++ 2013, которые SQL Server устанавливает в качестве необходимого компонента. Если это обновление двоичных файлов среды выполнения VC не установлено, в SQL Server могут возникать проблемы с надежностью в определенных сценариях. Перед установкой SQL Server выполните инструкции, приведенные в [заметках о выпуске SQL Server](../../sql-server/sql-server-2016-release-notes.md#bkmk_ga_instalpatch), чтобы узнать, требуется ли на вашем компьютере исправление для двоичных файлов среды выполнения VC.  

<a name="bkmk2016top"></a>

## <a name="run-setup"></a>Запуск программы установки

Для локальных установок необходимо запускать программу установки с правами администратора. При установке [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] из удаленной общей папки необходимо использовать учетную запись домена с разрешениями на чтение и выполнение для удаленной общей папки.

1. Запустите мастер установки SQL Server 2016.

1. На вкладке **Установка** выберите параметр **Новая установка изолированного экземпляра SQL Server или добавление компонентов к существующей установке**.

    ![Установка служб R Services (в базе данных)](media/2016-setup-installation-rsvcs.png "Запуск установки ядра СУБД с помощью служб R Services")

1. Выберите следующие компоненты на странице **Выбор компонентов**:

    + Выберите **Службы ядра СУБД**. Ядро СУБД требуется в каждом экземпляре, использующем машинное обучение.
    + Выберите **Службы R (в базе данных)** . Устанавливает поддержку использования языка R в базе данных.

    ![Выбор компонентов служб R Services](media/2016setup-rsvcs-features.png "Выберите эти компоненты служб R Services в базе данных")

    > [!IMPORTANT]
    > Не устанавливайте R Server и R Services одновременно. 

1. На странице **Согласие на установку Microsoft R Open** нажмите кнопку **Принять**.
  
    Принятие лицензионного соглашения требуется для скачивания Microsoft R Open — дистрибутива, содержащего базовые пакеты и средства R с открытым исходным кодом, а также поставщики услуг подключения и расширенные пакеты R от команды разработки Microsoft R.
  
1. После принятия лицензионного соглашения в процессе подготовки программы установки возникает небольшая пауза. Нажмите кнопку **Далее**, когда она станет доступной.

1. На странице **Все готово для установки** проверьте, включены ли указанные ниже компоненты, и нажмите **Установить**.

    + Службы ядра СУБД
    + Службы R (в базе данных)

1. Если после завершения установки будет предложено перезагрузить компьютер, выполните перезагрузку. После завершения установки важно прочитать сообщение мастера установки. Дополнительные сведения см. в разделе [View and Read SQL Server Setup Log Files](https://docs.microsoft.com/sql/database-engine/install-windows/view-and-read-sql-server-setup-log-files).

## <a name="set-environment-variables"></a>Настройка переменных среды

Только для интеграции с R присвойте переменной среды **MKL_CBWR** значение [ensure consistent output](https://software.intel.com/articles/introduction-to-the-conditional-numerical-reproducibility-cnr) из вычислений Intel Math Kernel Library (MKL).

1. На панели управления щелкните **Система и безопасность** > **Система** > **Расширенные параметры системы** > **Переменные среды**.

1. Создайте новую пользовательскую или системную переменную.

    + Задайте имя переменной как `MKL_CBWR`.
    + Задайте значение переменной как `AUTO`.

Для этого шага требуется перезагрузка сервера. Вы можете отложить перезапуск до тех пор, пока не будет выполнена вся настройка.

<a name="bkmk_enableFeature"></a>

##  <a name="enable-script-execution"></a>Включение выполнения сценария

1. Откройте [SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms) или [Azure Data Studio](../../azure-data-studio/what-is.md).

1. Подключитесь к экземпляру, в который вы установили R Services, щелкните **Создать запрос**, чтобы открыть окно запроса, и выполните следующую команду:

   ```sql
   sp_configure
   ```

    На данном этапе значение для свойства `external scripts enabled` должно быть **0**. Это связано с тем, что функция по умолчанию отключена. Этот компонент должен быть явно включен администратором, чтобы вы могли выполнять скрипты R.

1. Чтобы включить внешний компонент написания сценариев, выполните следующую инструкцию:
  
    ```sql
    EXEC sp_configure  'external scripts enabled', 1
    RECONFIGURE WITH OVERRIDE
    ```
  
## <a name="restart-the-service"></a>Перезапустите службу.

После завершения установки перезапустите ядро СУБД, прежде чем перейти к следующему шагу — включению выполнения скриптов.

При перезапуске службы автоматически перезапускается соответствующая служба [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)].

Службу можно перезапустить, щелкнув ее правой кнопкой мыши и выбрав команду **Перезапустить** для экземпляра SSMS или используя [диспетчер конфигурации SQL Server](../../relational-databases/sql-server-configuration-manager.md).

## <a name="verify-installation"></a>Проверка установки

Выполните указанные ниже действия, чтобы убедиться в том, что все компоненты, используемые для запуска внешнего скрипта, запущены.

1. Откройте новое окно запроса в SQL Server Management Studio и выполните приведенную ниже команду.

    ```sql
    EXEC sp_configure 'external scripts enabled'
    ```

    Задайте для **run_value** значение 1.

1. Откройте диспетчер конфигурации SQL Server и убедитесь, что служба **Панель запуска SQL Server** запущена. У вас должно быть по одной службе для каждого экземпляра ядра СУБД с установленным R. Дополнительные сведения об этой службе см. в разделе [Платформа расширяемости](../concepts/extensibility-framework.md).

1. Если запущена панель запуска, вы сможете выполнять простые скрипты на R, чтобы убедиться, что внешние среды выполнения скриптов могут взаимодействовать с SQL Server.

    Откройте новое окно **Запрос** в [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] или Azure Data Studio, а затем выполните следующий скрипт:

    ```sql
    EXEC sp_execute_external_script  @language =N'R',
    @script=N'
    OutputDataSet <- InputDataSet;
    ',
    @input_data_1 =N'SELECT 1 AS hello'
    WITH RESULT SETS (([hello] int not null));
    GO
    ```

    Выполнение сценария может занять некоторое время при первой загрузке внешней среды выполнения. Результаты должны выглядеть примерно так:

    | hello |
    |----|
    | 1|

<a name="apply-cu"></a>

## <a name="apply-updates"></a>Применение обновлений

Мы рекомендуем применить последний пакет обновления и накопительный пакет обновления к компонентам ядра СУБД и машинного обучения.

На устройствах, подключенных к Интернету, накопительные обновления обычно применяются с помощью Центра обновления Windows, но вы также можете использовать приведенные ниже шаги для управления контролируемыми обновлениями. При применении обновления для ядра СУБД программа установки извлекает накопительные обновления всех библиотек R, установленных в том же экземпляре. 

На отключенных серверах требуются дополнительные действия. Дополнительные сведения см. в разделе [Установка на компьютерах без доступа к Интернету > Применение накопительных обновлений](sql-ml-component-install-without-internet-access.md#apply-cu).

1. Начните с уже установленного базового экземпляра: Начальный выпуск SQL Server 2016, SQL Server 2016 с пакетом обновления 1 (SP1) или SQL Server 2016 с пакетом обновления 2 (SP2).

1. Перейдите к списку накопительных обновлений: [Последние обновления для Microsoft SQL Server](https://docs.microsoft.com/sql/database-engine/install-windows/latest-updates-for-microsoft-sql-server)

1. Выберите последний пакет обновления (если он еще не установлен в качестве базового экземпляра) и накопительный пакет обновления. Исполняемый файл скачивается и извлекается автоматически.

1. Запустите программу установки. Примите условия лицензионного соглашения и на странице "Выбор компонентов" проверьте компоненты, для которых применяются накопительные пакеты обновления. Вы должны увидеть все компоненты, установленные для текущего экземпляра, включая службы R Services. Программа установки загрузит CAB-файлы, необходимые для обновления всех компонентов.

1. Продолжайте работу с мастером, принимая условия лицензионного соглашения для дистрибутива R.

<a name="bkmk_FollowUp"></a> 

## <a name="additional-configuration"></a>Дополнительная настройка

Если проверка внешнего скрипта будет пройдена успешно, вы сможете выполнять команды R из SQL Server Management Studio, Azure Data Studio или любого другого клиента, который может отправлять инструкции T-SQL на сервер.

Если при выполнении команды возникнет ошибка, обратитесь к дополнительным шагам настройки, указанным в этом разделе. Возможно, потребуется внести какие-то дополнительные настройки в службу или базу данных.

На уровне экземпляра дополнительная конфигурация может включать следующее:

* [Настройка брандмауэра для Служб машинного обучения SQL Server](../../machine-learning/security/firewall-configuration.md).
* [Включение дополнительных сетевых протоколов](../../database-engine/configure-windows/enable-or-disable-a-server-network-protocol.md).
* [Включение удаленных подключений](../../database-engine/configure-windows/configure-the-remote-access-server-configuration-option.md).
* [Управление квотами на диск](https://docs.microsoft.com/windows/desktop/fileio/managing-disk-quotas) во избежание выполнения внешними скриптами задач, тратящих дисковое пространство.

<a name="bkmk_configureAccounts"></a>
<a name="bkmk_AllowLogon"></a>

В базе данных могут потребоваться следующие обновления конфигурации:

* [Предоставление пользователям доступа к службам машинного обучения SQL Server](../../machine-learning/security/user-permission.md)
* [Добавление SQLRUserGroup в качестве пользователя базы данных](../../machine-learning/security/create-a-login-for-sqlrusergroup.md)

> [!NOTE]
> Не все перечисленные изменения являются обязательными; все они могут оказаться ненужными. Требования зависят от схемы безопасности, в которой установлен ваш SQL Server, и от того, как ваши пользователи должны подключаться к базе данных и запускать внешние скрипты. Дополнительные советы по устранению неполадок см. здесь. [Часто задаваемые вопросы по обновлению и установке](../troubleshooting/upgrade-and-installation-faq-sql-server-r-services.md)

## <a name="suggested-optimizations"></a>Предлагаемые оптимизации

Также может потребоваться оптимизировать сервер для поддержки машинного обучения с использованием R или установки предварительно обученных моделей.

### <a name="add-more-worker-accounts"></a>Добавление рабочих учетных записей

Если вы предполагаете, что будете интенсивно использовать среду R или множество пользователей будут одновременно выполнять скрипты, вы можете увеличить количество рабочих учетных записей, назначенных службе панели запуска. Дополнительные сведения см. в разделе [Масштабирование параллельного выполнения внешних сценариев в SQL Server службы машинного обучения](../administration/scale-concurrent-execution-external-scripts.md).

<a name="bkmk_optimize"></a>

### <a name="optimize-the-server-for-external-script-execution"></a>Оптимизация сервера для выполнения внешних скриптов

Параметры по умолчанию для программы установки [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] призваны оптимизировать выполнение на сервере различных служб, поддерживаемых ядром СУБД, включая процессы извлечения, преобразования и загрузки, ведение отчетности, аудит и приложения, использующие данные [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Поэтому при использовании параметров по умолчанию ресурсы для машинного обучения могут быть ограничены или регулироваться, особенно в случае с операциями с интенсивным использованием памяти.

Чтобы задачам машинного обучения назначались соответствующие приоритеты и выделялись необходимые ресурсы, рекомендуем использовать Resource Governor SQL Server для настройки внешнего пула ресурсов. Кроме того, можно изменить размер памяти, выделяемой ядру СУБД [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], или увеличить количество учетных записей в службе [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)].

- Сведения о настройке пула ресурсов для управления внешними ресурсами см. в разделе [Создание внешнего пула ресурсов](../../t-sql/statements/create-external-resource-pool-transact-sql.md).
  
- Сведения об изменении объема памяти, выделяемой для базы данных, см. в разделе [Параметры конфигурации памяти сервера](../../database-engine/configure-windows/server-memory-server-configuration-options.md).
  
- Чтобы изменить число учетных записей R, которые могут быть запущены [!INCLUDE[rsql_launchpad](../../includes/rsql-launchpad-md.md)], см. раздел [масштабирование параллельного выполнения внешних сценариев в SQL Server службы машинного обучения](../administration/scale-concurrent-execution-external-scripts.md).

Если у вас установлен выпуск Standard Edition, но отсутствует Resource Governor, вы можете использовать для управления ресурсами сервера, используемыми R, динамические административные представления и расширенные события, а также мониторинг событий Windows.

### <a name="install-additional-r-packages"></a>Установка дополнительных пакетов R

Решения на R, создаваемые для SQL Server, могут вызывать базовые функции R, функции из собственных пакетов, установленных с SQL Server, а также сторонних пакетов R, совместимых с версией R с открытым исходным кодом, установленной SQL Server.

Пакеты, которыми вы хотите пользоваться из SQL Server, должны быть установлены в библиотеке по умолчанию, используемой экземпляром. При наличии отдельной установки R на компьютере, а также если вы установили пакеты в библиотеки пользователей, вы не сможете использовать их из T-SQL.

Процесс установки пакетов R и управления ими в SQL Server 2016 и SQL Server 2017 отличается. В SQL Server 2016 администратор базы данных должен установить пакеты R, необходимые пользователям. В SQL Server 2017 можно настроить группы пользователей для совместного использования пакетов на уровне базы данных или настроить роли базы данных, чтобы разрешить пользователям устанавливать собственные пакеты. Дополнительные сведения см. в статье [Установка пакетов с помощью средств R](../package-management/install-r-packages-standard-tools.md).

## <a name="next-steps"></a>Дальнейшие действия

Разработчики на языке R могут ознакомиться с простыми примерами, а также узнать, как код R работает с SQL Server. Дополнительные сведения см. в следующих статьях.

+ [Краткое руководство. Запуск R в T-SQL](../tutorials/quickstart-r-create-script.md)
+ [Учебники по использованию R для машинного обучения SQL](../tutorials/r-tutorials.md)
+ [Документация по машинному обучению на SQL](../index.yml)
