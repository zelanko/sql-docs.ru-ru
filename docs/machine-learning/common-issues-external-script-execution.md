---
title: Распространенные проблемы с панелью запуска
description: В этой статье приведены рекомендации по устранению неполадок, препятствующих запуску службы доверенной панели запуска SQL Server, включая проблемы или изменения в конфигурации и отсутствие сетевых протоколов.
ms.prod: sql
ms.technology: ''
ms.date: 07/30/2019
ms.topic: conceptual
author: dphansen
ms.author: davidph
ms.custom: seo-lt-2019
monikerRange: '>=sql-server-2016||>=sql-server-linux-ver15||=sqlallproducts-allversions'
ms.openlocfilehash: 68c731767a83acbd4b7df84843f2c140c5a63d3e
ms.sourcegitcommit: 68583d986ff5539fed73eacb7b2586a71c37b1fa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/04/2020
ms.locfileid: "81118837"
---
# <a name="common-issues-with-launchpad-service-and-external-script-execution-in-sql-server"></a>Распространенные проблемы со службой панели запуска и выполнением внешних скриптов в SQL Server
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md](../includes/appliesto-ss-xxxx-xxxx-xxx-md.md)]

Служба доверенной панели запуска SQL Server поддерживает выполнение внешних скриптов для R и Python. 

Запуску панели запуска SQL Server могут препятствовать различные неполадки, включая проблемы или изменения в конфигурации и отсутствие сетевых протоколов. Эта статья содержит рекомендации по устранению многих неполадок. Если мы что-то пропустили, вы можете задать вопросы на [форуме Machine Learning Server](https://social.msdn.microsoft.com/Forums/home?category=MicrosoftR).

## <a name="determine-whether-launchpad-is-running"></a>Определение того, выполняется панель запуска

1. Откройте панель **Службы**  (Services.msc). Или введите **SQLServerManager13.msc** или **SQLServerManager14.msc** в командной строке, чтобы открыть [Диспетчер конфигурации SQL Server](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Запишите учетную запись службы, под которой выполняется панель запуска. Каждый экземпляр, где включен R или Python, должен иметь собственный экземпляр службы панели запуска. Например, служба для именованного экземпляра может иметь вид _MSSQLLaunchpad$имя_экземпляра_.

3. Если служба остановлена, перезапустите ее. Если при перезапуске возникают проблемы с конфигурацией, в журнал системных событий заносится сообщение, а служба снова останавливается. Проверьте журнал системных событий на наличие сведений о причинах остановки службы.

4. Проверьте содержимое файла RSetup.log и убедитесь в отсутствии ошибок в программе установки. Например, сообщение *Выполняется выход с кодом 0* указывает на сбой запуска службы.

5. Чтобы найти другие ошибки, просмотрите содержимое файла журнала rlauncher.log.

## <a name="check-the-launchpad-service-account"></a>Проверка учетной записи службы панели запуска

По умолчанию может использоваться учетная запись службы "NT Service\$SQL2016" или "NT Service\$SQL2017". Конечная часть может отличаться в зависимости от имени экземпляра SQL.

Служба панели запуска (Launchpad.exe) выполняется с использованием учетной записи службы с минимальными правами доступа. Однако, чтобы запустить R и Python и взаимодействовать с экземпляром базы данных, учетной записи службы панели запуска требуются следующие права пользователя:

- Вход в систему в качестве службы (SeServiceLogonRight)
- Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)
- Обход проходной проверки (SeChangeNotifyPrivilege)
- Настройка квот памяти для процесса (SeIncreaseQuotaSizePrivilege)

Сведения об этих правах пользователя см. в разделе "Права доступа и права Windows" статьи [Настройка учетных записей службы Windows и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

> [!TIP]
> Если вы знакомы с использованием средства Support Diagnostics Platform (SDP) для диагностики SQL Server, можете использовать SDP для просмотра выходного файла с именем "имя_компьютера_UserRights.txt".

## <a name="user-group-for-launchpad-cannot-log-on-locally"></a>Группе пользователей для панели запуска не удается войти в систему локально

Во время установки Служб машинного обучения система SQL Server создает группу пользователей Windows **SQLRUserGroup** и назначает ей все необходимые права для подключения панели запуска к SQL Server и выполнения заданий внешних скриптов. Если эта группа пользователей включена, она также используется для выполнения скриптов Python.

Однако в организациях, где применяются более строгие политики безопасности, права, необходимые этой группе, могли быть удалены вручную или автоматически отменены политикой. Если права были удалены, панель запуска больше не может подключаться к SQL Server, и SQL Server не может вызывать внешнюю среду выполнения.

Чтобы устранить проблему, задайте для группы **SQLRUserGroup** разрешение **Локальный вход в систему**.

Дополнительные сведения см. в статье [Настройка учетных записей службы Windows и разрешений](../database-engine/configure-windows/configure-windows-service-accounts-and-permissions.md).

## <a name="permissions-to-run-external-scripts"></a>Разрешения для запуска внешних скриптов

Даже если панель запуска настроена правильно, она возвращает ошибку, когда у пользователя нет разрешения на выполнение скриптов R или Python.

Если вы установили SQL Server в качестве администратора базы данных или являетесь владельцем базы данных, вы получаете это разрешение автоматически. Однако другие пользователи обычно обладают более ограниченными разрешениями. При попытке запустить скрипт R они получат ошибку панели запуска.

Чтобы устранить эту проблему, в SQL Server Management Studio администратор безопасности может изменить имя входа SQL или учетную запись пользователя Windows, запустив следующий скрипт:

```sql
GRANT EXECUTE ANY EXTERNAL SCRIPT TO <username>
```

Дополнительные сведения см. в разделе [GRANT (Transact-SQL)](../t-sql/statements/grant-transact-sql.md).

## <a name="common-launchpad-errors"></a>Распространенные ошибки панели запуска

В этом разделе перечислены наиболее распространенные сообщения об ошибках, возвращаемые панелью запуска.

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
## <a name="unable-to-launch-runtime-for-r-script"></a>"Не удается запустить среду выполнения для скрипта R"

Если группа Windows для пользователей R (также используемая для Python) не может войти в экземпляр, где выполняются службы R Services, могут отобразиться следующие ошибки:

- Ошибки, возникающие при попытке запуска скриптов R:

    * *Не удается запустить среду выполнения для скрипта R. Проверьте конфигурацию среды выполнения R*.

    * *Возникла ошибка во внешнем скрипте. Не удается запустить среду выполнения*.

- Ошибки, вызываемые службой [!INCLUDE[rsql_launchpad](../includes/rsql-launchpad-md.md)]:

    * *Не удалось инициализировать средство запуска RLauncher.dll*

    * *Библиотеки DLL средства запуска не зарегистрированы*

    * *Согласно журналам безопасности, учетной записи NT SERVICE не удалось выполнить вход*

Сведения о том, как предоставить этой группе пользователей необходимые разрешения, см. в разделе [Установка служб SQL Server R Services](install/sql-r-services-windows-install.md).

> [!NOTE]
> Это ограничение не распространяется на тот случай, если вы используете имена входа SQL для выполнения скриптов R с удаленной рабочей станции.
::: moniker-end

## <a name="logon-failure-the-user-has-not-been-granted-the-requested-logon-type"></a>"Вход в систему не произведен: выбранный режим входа для данного пользователя не предусмотрен"

По умолчанию при запуске [!INCLUDE[rsql_launchpad_md](../includes/rsql-launchpad-md.md)] использует следующую учетную запись: `NT Service\MSSQLLaunchpad`. Учетная запись настраивается программой установки [!INCLUDE[ssNoVersion_md](../includes/ssnoversion-md.md)], чтобы иметь все необходимые разрешения.

Если вы назначите панели запуска другую учетную запись или разрешение будет удалено политикой на компьютере SQL Server, у учетной записи могут отсутствовать необходимые разрешения, в результате чего вы получите следующую ошибку:

>*ERROR_LOGON_TYPE_NOT_GRANTED 1385 (0x569) Вход в систему не произведен: выбранный режим входа для данного пользователя на этом компьютере не предусмотрен*

Чтобы предоставить новой учетной записи службы необходимые разрешения, используйте приложение "Локальная политика безопасности" и добавьте в учетную запись следующие разрешения:

+ Назначение квот памяти процессам (SeIncreaseQuotaPrivilege)
+ Обход проходной проверки (SeChangeNotifyPrivilege)
+ Вход в систему в качестве службы (SeServiceLogonRight)
+ Замена токена уровня процесса (SeAssignPrimaryTokenPrivilege)

## <a name="unable-to-communicate-with-the-launchpad-service"></a>"Не удалось связаться со службой панели запуска"

Если вы установили и затем включили машинное обучение, но эта ошибка возникает при попытке запуска скрипта R или Python, возможно, была остановлена служба панели запуска для этого экземпляра.

1. Запустите диспетчер конфигурации SQL Server из командной строки Windows. Дополнительные сведения см. в разделе [SQL Server Configuration Manager](https://docs.microsoft.com/sql/relational-databases/sql-server-configuration-manager).

2. Щелкните правой кнопкой мыши панель запуска SQL Server для этого экземпляра и выберите пункт **Свойства**.

3. Откройте вкладку **Службы** и убедитесь, что служба запущена. Если это не так, установите **Автоматический** **Режим запуска** и нажмите кнопку **Применить**.

4. Перезапуск службы обычно устраняет проблему и позволяет запускать скрипты машинного обучения. Если перезапуск не устраняет проблему, запишите путь и аргументы в свойстве **Путь к двоичным файлам** и сделайте следующее:

    а. Просмотрите файл CONFIG средства запуска и убедитесь, что рабочий каталог допустим.

    b. Убедитесь, что группа Windows, используемая панелью запуска, может подключаться к экземпляру SQL Server.

    c. При изменении любых свойств службы перезапустите службу панели запуска.

## <a name="fatal-error-creation-of-tmpfile-failed"></a>"Неустранимая ошибка: сбой при создании tmpFile"

В этом сценарии вы успешно установили компоненты машинного обучения, а панель запуска работает. Вы пытаетесь запустить простой код R или Python, но панель запуска завершает работу с ошибкой следующего вида: 

>*Не удалось связаться со средой выполнения для скрипта R. Проверьте требования среды выполнения R.*

В то же время среда выполнения внешнего скрипта записывает следующее сообщение в составе сообщения STDERR: 

>*Неустранимая ошибка: сбой при создании tmpfile.*

Эта ошибка означает, что у учетной записи, которую пытается использовать панель запуска, нет разрешения на вход в базу данных. Такая ситуация может возникать, если применены строгие политики безопасности. Чтобы определить, является ли это причиной, просмотрите журналы SQL Server и проверьте, не был ли запрещен доступ для учетной записи MSSQLSERVER01 при входе. Те же сведения приведены в журналах, относящихся к R\_SERVICES или PYTHON\_SERVICES. Найдите файл ExtLaunchError.log.

По умолчанию настроено 20 учетных записей, сопоставленных с процессом Launchpad.exe, с именами от MSSQLSERVER01 и до MSSQLSERVER20. При интенсивном использовании R или Python число учетных записей можно увеличить.

Чтобы устранить эту проблему, убедитесь, что группа имеет разрешения *Локальный вход в систему* для локального экземпляра, где установлены и включены функции машинного обучения. В некоторых средах для этого уровня разрешений сетевому администратору может потребоваться добавить исключение в GPO.

## <a name="not-enough-quota-to-process-this-command"></a>"Недостаточно квот для обработки этой команды"

Эта ошибка может указывать на одну из следующих ситуаций:

- Панель запуска может иметь недостаточно внешних пользователей для выполнения внешнего запроса. Например, при одновременном запуске более 20 внешних запросов и наличии всего 20 пользователей по умолчанию может произойти сбой одного или нескольких запросов.

- Недостаточно памяти для обработки задачи R. Эта ошибка чаще всего возникает в среде по умолчанию, где SQL Server может использовать до 70 процентов ресурсов компьютера. Сведения о том, как изменить конфигурацию сервера для увеличение объема ресурсов, используемых R, см. в статье [Ввод в эксплуатацию кода R](r/operationalizing-your-r-code.md).

## <a name="cant-find-package"></a>"Не удается найти пакет"

Если вы получаете это сообщение при запуске кода R в SQL Server и не получаете его при запуске кода за пределами SQL Server, значит пакет не был установлен в расположение библиотеки по умолчанию, используемое SQL Server.

Эта ошибка может возникать во многих случаях:

- Вы установили новый пакет на сервере, но в доступе было отказано, поэтому R установил пакет в пользовательскую библиотеку.

- Вы установили службы R Services, а затем установили еще одно средство R или набор библиотек, включая Microsoft R Server (автономная версия), Microsoft R Client, RStudio и т. п.

Чтобы определить расположение библиотеки пакетов R, используемое данным экземпляром, откройте SQL Server Management Studio (или любое другое средство по работе с запросами к базе данных), подключитесь к экземпляру, а затем запустите следующую хранимую процедуру:

```sql
EXEC sp_execute_external_script @language = N'R',  
@script = N' print(normalizePath(R.home())); print(.libPaths());'; 
```

#### <a name="sample-results"></a>Образец результатов

*Сообщения STDOUT из внешнего скрипта:*

*[1] "C:\\Program Files\\Microsoft SQL Server\\MSSQL13.SQL2016\\R_SERVICES"*

*[1] "C:/Program Files/Microsoft SQL Server/MSSQL13.SQL2016/R_SERVICES/library"*

Чтобы устранить эту проблему, необходимо переустановить пакет в библиотеку экземпляров SQL Server.

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
>[!NOTE]
>Если вы обновили экземпляр SQL Server 2016 для использования последней версии Microsoft R, расположение библиотеки по умолчанию отличается. Дополнительные сведения см. в статье [об использовании программы SqlBindR для обновления экземпляра служб R Services](install/upgrade-r-and-python.md).
::: moniker-end

::: moniker range=">=sql-server-2016||=sqlallproducts-allversions"
## <a name="launchpad-shuts-down-due-to-mismatched-dlls"></a>Завершение работы панели запуска из-за несовпадающих библиотек DLL

Если вы устанавливаете ядро СУБД с другими компонентами, устанавливаете исправление для сервера, а затем добавляете компонент Машинного обучения с использованием исходного носителя, может быть установлена неправильная версия компонентов Машинного обучения. Когда панель запуска обнаруживает несовпадение версий, она завершает работу и создает файл дампа.

Чтобы предотвратить эту проблему, обязательно устанавливайте новые компоненты на том же уровне исправлений, что и экземпляр сервера.

**Неправильный способ обновления:**

1. Установите SQL Server 2016 без служб R Services.
2. Установите накопительный пакет обновления 2 для SQL Server 2016.
3. Установите службы R Services (в базе данных) с помощью носителя RTM.

**Правильный способ обновления:**

1. Установите SQL Server 2016 без служб R Services.
2. Обновите SQL Server 2016 до требуемого уровня исправлений. Например, установите пакет обновления 1 (SP1), а затем накопительный пакет обновления 2.
3. Чтобы добавить компонент на правильном уровне исправлений, снова запустите программу установки пакета обновления 1 и накопительного пакета обновления 2, а затем выберите "R Services (в базе данных)". 

## <a name="launchpad-fails-to-start-if-8dot3-notation-is-required"></a>Не удается запустить панель запуска, если требуется нотация 8dot3

> [!NOTE] 
> В старых системах панель запуска может не запускаться, если задано требование нотации 8dot3. Это требование было удалено в более поздних выпусках. Клиенты служб SQL Server 2016 R Services должны установить один из следующих компонентов:
> * Пакет обновления 1 (SP1) и накопительный пакет обновления 2 (CU1) для SQL Server 2016: [Накопительный пакет обновления 1 для SQL Server](https://support.microsoft.com/help/3208177/cumulative-update-1-for-sql-server-2016-sp1).
> * SQL Server 2016 RTM, накопительный пакет обновления 3 и это [исправление](https://support.microsoft.com/help/3210110/on-demand-hotfix-update-package-for-sql-server-2016-cu3), предоставляемое по запросу.

Для совместимости с R службам SQL Server 2016 R Services (в базе данных) необходимо, чтобы диск, куда устанавливается этот компонент, поддерживал создание коротких имен файлов с использованием *нотации 8dot3*. Имя файла 8.3 также называется *коротким именем файла* и используется для обеспечения совместимости с предыдущими версиями Microsoft Windows или в качестве альтернативы длинным именам файлов.

Если том, куда вы устанавливаете R, не поддерживает короткие имена файлов, процессы, запускающие R из SQL Server, могут не найти соответствующий исполняемый файл, и панель запуска не запустится.

В качестве обходного решения можно включить нотацию 8dot3 в томе, где установлен SQL Server со службами R Services. Затем необходимо указать короткое имя для рабочего каталога в файле конфигурации служб R.

1. Чтобы включить нотацию 8dot3, запустите служебную программу fsutil с аргументом *8dot3name*, как описано в следующем разделе: [fsutil 8dot3name](https://technet.microsoft.com/library/ff621566(v=ws.11).aspx).

2. После включения нотации 8dot3 откройте файл RLauncher.config и запишите значение свойства `WORKING_DIRECTORY`. Сведения о том, как найти этот файл, см. в разделе [Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md).

3. Используйте программу fsutil с аргументом *file*, чтобы указать короткий путь к файлу для папки, указанной в свойстве WORKING_DIRECTORY.

4. Измените файл конфигурации, указав тот же рабочий каталог, который вы указали в свойстве WORKING_DIRECTORY. Кроме того, можно указать другой рабочий каталог и выбрать существующий путь, который уже совместим с нотацией 8dot3.
::: moniker-end

## <a name="next-steps"></a>Дальнейшие действия

[Устранение неполадок и известные проблемы Служб машинного обучения](machine-learning-troubleshooting-faq.md)

[Сбор данных для устранения неполадок машинного обучения](data-collection-ml-troubleshooting-process.md)

[Часто задаваемые вопросы по обновлению и установке](r/upgrade-and-installation-faq-sql-server-r-services.md)

[Устранение неполадок подключений к ядру СУБД](../database-engine/configure-windows/troubleshoot-connecting-to-the-sql-server-database-engine.md)
